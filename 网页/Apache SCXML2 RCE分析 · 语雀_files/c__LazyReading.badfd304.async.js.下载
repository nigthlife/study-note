/*! For license information please see c__LazyReading.badfd304.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1146],{3608:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(i=o.key,a=void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===r(a)?a:String(a)),o)}var i,a}var i="x-yuque-pt-signature",a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.query=new URLSearchParams(window.location.search),this.isServify=!!this.get(i),this.viewport=this.get("viewport"),this.sidebar="0"===this.get("toc_sidebar")?"none":"toc",this.cards=this.get("cards").split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})),this.thirdpartyCards=this.get("thirdparty_cards")?this.get("thirdparty_cards").split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})):[],this.showTitle="0"!==this.get("title"),this.showHeader="0"!==this.get("header"),this.isEmbedMode=this.get("mode").startsWith("embed"),this.autoHeight=this.getAutoHeight(),this.editorType=this.get("editor_type"),this.editorMode=this.get("editor_mode"),this.language=this.get("language")||"zh-cn",this.pageMinWidth=this.get("page_min_width"),this.onchange="1"===this.get("onchange"),this.allowMention="0"!==this.get("mention"),this.allowResource="1"===this.get("resource"),this.watermark=this.get("watermark"),this.backgroundColor=this.get("background_color"),this.bodyBackgroundColor=this.get("body_background_color"),this.toolbarBackgroundColor=this.get("toolbar_background_color"),this.autoSaveInterval=this.getAutoSaveInterval(),this.saveToServer="0"!==this.get("save_to_server"),this.customUploadUrl=this.get("upload_url"),this.customUploadTypes=this.get("upload_types"),this.customMentionUrl=this.getMentionUrl(),this.customMentionOrigin=this.get("search_user_origin"),this.imageUploadUrl=this.getImageUploadUrl(),this.fileUploadUrl=this.getFileUploadUrl(),this.videoUploadUrl=this.getVideoUploadUrl(),this.videoUploadStatusUrl=this.getVideoUploadStatusUrl(),this.fullHTML="1"===this.query.get("full_html"),this.allowResizeVideo=!0,this.extraConfig=JSON.parse(this.query.get("extra_config")||"{}")}var t,n,r;return t=e,(n=[{key:"get",value:function(e){return this.query.get(e)||""}},{key:"getAutoHeight",value:function(){return!window.h5&&"0"!==this.get("auto_height")}},{key:"getAutoSaveInterval",value:function(){var e=this.get("auto_save_interval");return e&&!Number.isNaN(Number(e))?((e=Number(e))<60&&(e=60),1e3*e):null}},{key:"getMentionUrl",value:function(){var e=this.get("search_user_url");return this._joinCsrf(e)}},{key:"getImageUploadUrl",value:function(){return this.customUploadTypes&&this.customUploadTypes.includes("image")?"".concat(this._joinCsrf(this.customUploadUrl),"&type=image"):null}},{key:"getFileUploadUrl",value:function(){return this.customUploadTypes&&this.customUploadTypes.includes("attachment")?"".concat(this._joinCsrf(this.customUploadUrl),"&type=attachment"):null}},{key:"getVideoUploadUrl",value:function(){var e=this.get("upload_video_url");return e?this._joinCsrf(e):null}},{key:"getVideoUploadStatusUrl",value:function(){var e=this.get("upload_video_status_url");return e?this._joinCsrf(e):null}},{key:"_joinCsrf",value:function(e){var t=e.includes("?")?"&":"?";return"".concat(e).concat(t).concat(this._getCustomCsrf())}},{key:"_getCustomCsrf",value:function(){var e=this.get("upload_csrf_token_field"),t=this.get("upload_csrf_token_value");return e?"".concat(e,"=").concat(encodeURIComponent(t)):""}},{key:"isExtremeMode",value:function(){return"extreme"===this.editorMode}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();a.isServify=function(){var e=new URLSearchParams(window.location.search).get("from");if(!e)return!1;try{if(new URL(e).searchParams.get(i))return!0}catch(e){}return!1},a.SERVIFY_TAG_SRT=i,t.a=a},3818:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),o=Object(r.createContext)(null)},3840:function(e,t,n){"use strict";n(95);var r=n(38),o=(n(183),n(104)),i=n(0),a=n.n(i),c=n(8),u=n.n(c),l=n(1604),s=n.n(l),d=n(11),f=n.n(d),m=n(31),p="CornerBubble-module_cornerBubble_2kGnu",h="CornerBubble-module_cornerCount_O3YTX",b="CornerBubble-module_cornerCountLarge_3x8Br",v="CornerBubble-module_cornerCountHover_x2J7h",y="CornerBubble-module_cornerIcon_N8Ibc",g="CornerBubble-module_btnWord_-QoZm",w="CornerBubble-module_badge_SQuZN";function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function _(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==O(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===O(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){var t,n,i,c=e.count,u=e.style,l=e.onClick,d=e.iconName,O=e.iconSize,E=e.countPopoverContent,j=e.countPopoverClassName,C=e.renderBadge,k=e.tooltipText,S=e.btnWord;return a.a.createElement(r.a,{title:k},a.a.createElement("div",{className:p,onClick:l,style:u},s()(c)&&c>0&&(n=!!E,i=a.a.createElement("div",{className:f()((t={},_(t,h,!0),_(t,v,n),_(t,b,c>99),t))},c>99?"99+":c),n?a.a.createElement(o.a,{placement:"topRight",trigger:"hover",overlayClassName:j,content:E},i):i),C&&a.a.createElement("div",{className:w},C()),!!d&&a.a.createElement(m.b,{className:y,name:d,width:O||20}),!!S&&a.a.createElement("p",{className:g},S)))};E.propTypes={iconName:u.a.string.isRequired,iconSize:u.a.number,count:u.a.number,style:u.a.object,onClick:u.a.func,countPopoverContent:u.a.element,countPopoverClassName:u.a.string,renderBadge:u.a.func,tooltipText:u.a.string,btnWord:u.a.string};t.a=E},3869:function(e,t,n){"use strict";var r=n(90),o=n.n(r),i=n(26),a=n.n(i),c=n(1511);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var o=m(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}(this,n)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function p(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===u(t)?t:String(t)}var b=o()("biz.comment_collab"),v={inactive:"inactive",error:"error",usersChange:"usersChange",broadcast:"broadcast",statusChange:"statusChange"},y={COMMENT_CREATE:"create",COMMENT_UPDATE:"update",COMMENT_DELETE:"destroy",BELONG_UPDATE:"belong_update",REACTION_UPDATE:"reaction_update"},g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(i,e);var t,n,r,o=d(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),p(f(t=o.call(this)),"conn",void 0),p(f(t),"collab",void 0),p(f(t),"options",void 0),p(f(t),"currentMember",void 0),p(f(t),"socket",void 0),t.options=e,t.collab=e.collab,t.conn=t.createConnect(),t}return t=i,(n=[{key:"createConnect",value:function(){var e=this,t=this.collab,n="".concat(t.host,"/?id=").concat(t.id,"&token=").concat(t.token);b("connect",n);var r=new c.a(n);return r.on("ready",(function(t){e.socket=t,t.addEventListener("message",(function(t){var n;try{n=JSON.parse(t.data)}catch(e){console.error(e)}if(n&&("ready"===n.action&&(e.currentMember=n.data),"broadcast"===n.action)){var r=n.data,o=r.body,i=r.type;o.user.uuid!==e.currentMember.uuid&&e.emit(v.broadcast,{type:i,body:o})}}))})),r}},{key:"reset",value:function(){this.currentMember=null,this.conn.disconnect()}},{key:"updateReaction",value:function(e,t,n){b("reaction update"),this.conn.broadcast(y.REACTION_UPDATE,{user:this.currentMember,reaction:e,comment:t,reactionAction:n})}},{key:"updateBelong",value:function(e){b("comment create"),this.conn.broadcast(y.BELONG_UPDATE,{user:this.currentMember,belong:e})}},{key:"createComment",value:function(e){b("comment create"),this.conn.broadcast(y.COMMENT_CREATE,{user:this.currentMember,comment:e})}},{key:"updateComment",value:function(e){b("comment update"),this.conn.broadcast(y.COMMENT_UPDATE,{user:this.currentMember,comment:e})}},{key:"destroyComment",value:function(e){b("comment destroy"),this.conn.broadcast(y.COMMENT_DELETE,{user:this.currentMember,comment:e})}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(a.a);p(g,"EVENT",v),p(g,"MESSAGE",y),t.a=g},3921:function(e,t,n){"use strict";var r=n(0),o=n.n(r),i=n(8),a=n.n(i),c=n(11),u=n.n(c),l="index-module_SideTipContainer_GOO1q",s="index-module_hovered_0kEK0",d="index-module_hidden_D4-zu",f="index-module_hideIcon_H0k4M",m="index-module_hideIconHovered_qClFl",p="index-module_minus_Q1aw+",h="index-module_domIcon_V0vda";function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_(e);if(t){var o=_(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}(this,n)}}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function E(e,t,n){return(t=j(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){var t=function(e,t){if("object"!==b(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===b(t)?t:String(t)}var C=function(){},k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(a,e);var t,n,r,i=w(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),E(O(t=i.call(this,e)),"isMounted",!1),E(O(t),"leaveTimer",void 0),E(O(t),"nodeList",void 0),E(O(t),"resetNode",(function(){if(t.props.domQuery){var e,n=document.querySelectorAll(t.props.domQuery);n.length!==(null===(e=t.nodeList)||void 0===e?void 0:e.length)&&n.length&&(t.nodeList=n,t.nodeList.forEach((function(e){e.removeEventListener("mouseenter",t.domMouseEnterCb),e.removeEventListener("mouseleave",t.domMouseLeaveCb),e.removeEventListener("click",t.domClickCaptureCb,!0),e.addEventListener("mouseenter",t.domMouseEnterCb),e.addEventListener("mouseleave",t.domMouseLeaveCb),e.addEventListener("click",t.domClickCaptureCb,!0)})))}})),E(O(t),"domMouseEnterCb",(function(e){t.onMouseEnterToHovered()})),E(O(t),"domClickCaptureCb",(function(e){t.isMounted&&!t.state.visible&&t.onClickToShow(e)})),E(O(t),"domMouseLeaveCb",(function(e){t.state.visible?(t.leaveTimer&&clearTimeout(t.leaveTimer),t.leaveTimer=setTimeout((function(){t.isMounted&&t.setState({hovered:!1})}),500)):t.isMounted&&t.setState({hovered:!1})})),E(O(t),"onClickToShow",(function(e){e.stopPropagation(),t.setState({visible:!0})})),E(O(t),"onMouseEnterToHovered",(function(){t.leaveTimer&&clearTimeout(t.leaveTimer),t.isMounted&&t.setState({hovered:!0})})),E(O(t),"icon",(function(){var e;return o.a.createElement("div",{className:u()(f,(e={},E(e,m,t.state.hovered&&t.state.visible),E(e,h,!!t.props.domQuery),e)),onClick:function(){return t.setState({visible:!1})},onMouseEnter:t.onMouseEnterToHovered,onMouseLeave:function(){return t.setState({hovered:!1})},style:t.props.iconStyle},o.a.createElement("div",{className:p}))})),E(O(t),"renderWithChildren",(function(){var e,n=t.state,r=n.visible,i=n.hovered,a=t.props,c=a.children,f=a.className,m=a.forwardedRef,p=a.id,h=a.testId;return o.a.createElement("div",{onClickCapture:r?C:t.onClickToShow,onMouseEnter:function(){return t.setState({hovered:!0})},onMouseLeave:function(){return t.setState({hovered:!1})},className:u()(l,f,(e={},E(e,s,!r&&i),E(e,d,!r&&!i),E(e,"side-tip-container-hidden",!r&&!i),E(e,"side-tip-container-visible",r),e)),ref:m,"data-testid":h,id:p},t.icon(),c)})),E(O(t),"renderWithDom",(function(){var e=t.state,n=e.visible,r=e.hovered;return t.nodeList&&t.nodeList.length?(!n&&r?t.nodeList.forEach((function(e){e.classList.add(s),e.classList.remove(d)})):n||r?t.nodeList.forEach((function(e){e.classList.remove(s),e.classList.remove(d)})):t.nodeList.forEach((function(e){e.classList.remove(s),e.classList.add(d)})),t.icon()):null})),t.state={visible:!0,hovered:!1},t}return t=a,(n=[{key:"componentDidMount",value:function(){this.isMounted=!0,this.resetNode()}},{key:"componentDidUpdate",value:function(){this.resetNode()}},{key:"componentWillUnmount",value:function(){var e=this;this.isMounted=!1,this.nodeList&&this.nodeList.length&&this.nodeList.forEach((function(t){t.removeEventListener("mouseenter",e.domMouseEnterCb),t.removeEventListener("mouseleave",e.domMouseLeaveCb),t.removeEventListener("click",e.domClickCaptureCb,!0)}))}},{key:"render",value:function(){return this.props.children?this.renderWithChildren():this.renderWithDom()}}])&&y(t.prototype,n),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(o.a.Component);k.defaultProps={},k.propTypes={children:a.a.node,className:a.a.string,forwardedRef:a.a.object,id:a.a.string,testId:a.a.string,domQuery:a.a.string,iconStyle:a.a.object};t.a=o.a.forwardRef((function(e,t){return o.a.createElement(k,v({forwardedRef:t},e))}))},3992:function(e,t,n){"use strict";var r=n(0),o=n.n(r),i=n(8),a=n.n(i),c=n(90),u=n.n(c),l=n(67),s=n(905);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}var f=new u.a("doc:error"),m=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(21),n.e(1405)]).then(n.bind(null,3251))}),{suspense:!0}),p=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(21),n.e(1406)]).then(n.bind(null,3250))}),{suspense:!0}),h=Object(s.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(21),n.e(1404)]).then(n.bind(null,3252))}),{suspense:!0}),b=Object(s.b)((function(){return n.e(1401).then(n.bind(null,4167))}),{suspense:!0});function v(e){var t=e.error;f("doc load error",t);var n=Object(l.useHistory)();return o.a.createElement("div",{"data-testid":"empty-view"},function(){if(403===t.status){if(null!=t&&t.needVerifyTargetId&&"need_verify_password"===(null==t?void 0:t.code))return o.a.createElement(m,{targetType:"Doc",needVerifyTargetId:t.needVerifyTargetId,onlyContent:!0});var e=t.data,r=e.organization,i=e.canReadOrg,a=e.groupLogin;return(r&&i||!window.appData.isYuque)&&a?o.a.createElement(h,d({},t.data,{history:n,onlyContent:!0})):o.a.createElement(p,d({},t.data,{history:n,onlyContent:!0}))}return[404,500].includes(t.status)?o.a.createElement(b,{status:t.status}):o.a.createElement("div",{style:{height:"640px"}})}())}v.propTypes={error:a.a.object.isRequired},t.a=v},4119:function(e,t,n){"use strict";n(55);var r=n(22),o=n(0),i=n(90),a=n.n(i),c=n(67),u=n(3608);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=new a.a("hook:useLoadDoc");t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.requestData,i=e.dispatch,a=n.book_id,l=n.slug,s=n.query,f=Object(c.useRouteMatch)().params,p={};p=a&&l?{book_id:a,slug:l}:{user_login:f.group,book_slug:f.book,slug:f.doc},Object(o.useEffect)((function(){m("load doc: ",n);var e=(new u.a).isExtremeMode();if(window.appData.isYuqueMobileApp&&window.__skeletonData&&window.__skeletonData.book_id===a&&window.__skeletonData.slug===l&&(window.__skeletonData=void 0,e=!0),!e){var t="doc_embed"!==s.view;return i({type:"doc/getDetail",payload:d(d({},p),{},{withData:{contributors:t,like:t,hits:t,pager:t,suggests:t}})}).then((function(e){m("doc init done, res: ",e)})).catch((function(e){m("doc init error",e),r.a.error(e.message||__("系统异常"))})),function(){window.scrollTo(0,0)}}i({type:"doc/update",payload:{loaded:!0,loadedAt:+new Date}})}),t)}},4165:function(e,t,n){"use strict";var r=n(0),o=n.n(r),i=n(8),a=n.n(i),c=n(429),u=n(3567);function l(e){var t,n=e.me,i=e.dispatch,a=e.organization,c=null===(t=window.appData.settings)||void 0===t?void 0:t.disabled_login_modal_pop_default;return Object(r.useEffect)((function(){var e,t=a&&a.id,r=null===(e=window.appData.settings)||void 0===e?void 0:e.is_trusted_organization;t&&(a.isPremium||r)&&(c=!0),window.location.pathname.startsWith("/yuque/")&&(c=!0),window.h5&&(c=!0);var o=Object(u.b)("doc_reader_login_modal",864e5);!(null!=n&&n.id||o||c)&&i({type:"error/toggleLoginModal",payload:{visible:!0,from:"doc_reader"}})}),[]),o.a.createElement(o.a.Fragment,null)}l.propTypes={me:a.a.object,dispatch:a.a.func,organization:a.a.object},t.a=Object(c.d)((function(e){return{me:e.me,dispatch:e.dispatch,organization:e.organization}}))(l)},4397:function(e,t,n){"use strict";var r=n(90),o=n.n(r),i=n(4119),a=n(207),c=new o.a("doc:share.page.vm");t.a=function(e){var t=e.book,n=e.doc,r=e.query,o=e.slug,u=e.appData,l=e.dispatch;return r=a.a.normalizeReadPageQuery(r),c("process doc: ",o,r),Object(i.a)({requestData:{query:r,book_id:t.id,slug:o},dispatch:l,doc:n},[o]),{getQuery:function(){return r},isDocEmbed:function(){return"doc_embed"===r.view},isDocInner:function(){return"Doc"===n.type&&r.inner},isRenderSingleDoc:function(){return t.abilities&&!t.abilities.read},needRenderComments:function(){return n.loaded&&t.enable_comment&&!n.error},needRenderPager:function(){return n.loaded&&!u.isDocCollaborator}}}},4490:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));n(223);var r=n(77),o=(n(236),n(60)),i=(n(418),n(112)),a=n(0),c="DocLoading-module_container_nhOpf",u="DocLoading-module_title_ORC1Y",l="DocLoading-module_loading_JiuDc",s="DocLoading-module_col_6Fw0R",d=function(e){return a.createElement("div",{className:c,style:e.style},a.createElement(i.a,{className:u,title:!0,paragraph:!1,active:!0}),a.createElement(r.a,{gutter:16,className:l},a.createElement(o.a,{span:24,className:s},a.createElement(i.a,{title:!1,paragraph:{rows:3},active:!0})),a.createElement(o.a,{span:24,className:s},a.createElement(i.a,{title:!1,paragraph:{rows:3},active:!0}))))}},4528:function(e,t,n){"use strict";t.a={loading:"index-module_loading_LY7-z",header:"index-module_header_+SmFd",content:"index-module_content_GvanO",reward:"index-module_reward_QafG4",likeLayoutMode:"index-module_likeLayoutMode_L4kPJ",lakeFallback:"index-module_lakeFallback_RSH7y"}},4594:function(e,t,n){"use strict";var r=n(0),o=n.n(r),i=n(8),a=n.n(i),c=n(429),u=n(67),l=n(229),s=n(4392),d=n(905),f=n(3847),m=n(549),p=n(4165),h=(n(55),n(22)),b=n(11),v=n.n(b),y=n(30),g=n(120),w=n.n(g),O=n(4542),_=n(101),E=n.n(_),j=n(207),C=n(630),k=n(3921),S=n(3840),R=n(3818),P=n(420),T=n(3869),M=n(4543),L=n(4411),x=n(196),N=n(199),D=n(1501),U=n(2867),A=n(3564),I=n(3552),q=n(1490);function B(e){var t=e.format,n=e.html,i=Object(r.useRef)(null);return Object(r.useEffect)((function(){e.onReady(i.current)}),[n]),o.a.createElement("div",{key:e.id,ref:i,className:"yuque-doc-content typo ".concat("asl"===t?"typo-bi":""),"data-df":"html",style:{position:"relative"},dangerouslySetInnerHTML:{__html:n}})}B.defaultProps={onReady:function(){}},B.propTypes={id:a.a.oneOfType([a.a.string,a.a.number]),html:a.a.string.isRequired,format:a.a.string.isRequired,onReady:a.a.func};var F=B,V=(n(84),n(45)),W=n(1575),H=n(1383),z=n(1573),G=n(1576);function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function Y(){Y=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),c=new C(o||[]);return r(a,"_invoke",{value:O(e,n,c)}),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function f(){}function m(){}function p(){}var h={};u(h,i,(function(){return this}));var b=Object.getPrototypeOf,v=b&&b(b(k([])));v&&v!==t&&n.call(v,i)&&(h=v);var y=p.prototype=f.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(r,i,a,c){var u=s(e[r],e,i);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==Q(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,a,c)}),(function(e){o("throw",e,a,c)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return o("throw",e,a,c)}))}c(u.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){o(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function O(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return S()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function _(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=s(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return m.prototype=p,r(y,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:m,configurable:!0}),m.displayName=u(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,c,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(w.prototype),u(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new w(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),u(y,c,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function J(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,K(r.key),r)}}function X(e,t,n){return(t=K(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e){var t=function(e,t){if("object"!==Q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Q(t)?t:String(t)}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X(this,"modal",void 0),X(this,"lock",void 0)}var t,n,r;return t=e,n=[{key:"show",value:function(e){var t=this,n=function(){window.__engine.setDocument(),t.modal.destroy(),t.modal=null,t.lock=!1},r=function(){var e,n=(e=Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.lock=!1,e.abrupt("return",!0);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){J(i,r,o,a,c,"next",e)}function c(e){J(i,r,o,a,c,"throw",e)}a(void 0)}))});return function(){return n.apply(this,arguments)}}();this.lock||(this.lock=!0,this.modal=V.a.info({content:o.a.createElement(W.a,{lakexOption:z.a,hideWindow:n,afterPublishSuccessOuter:function(){},onPublishOuter:r,onPublishSuccessOuter:function(e){t.modal.destroy(),t.modal=null;var n=o.a.createElement("span",null,__("小记成功")," ",o.a.createElement("a",{href:"/dashboard/notes?scroll_to=".concat(null==e?void 0:e.id),__target:"_blank"},__("查看")));h.a.success(n)},noteApi:H.a,isOnlineOuter:!0,noCache:!0,wordingNote:e}),footer:null,height:null,icon:null,className:G.a.modal,width:614,maskClosable:!0,onCancel:n}))}}],n&&Z(t.prototype,n),r&&Z(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ee=new $;function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var re=function(e){var t=e.getEngine,n=te(Object(r.useState)(),2),i=(n[0],n[1],function(e){ee.show(null==e?void 0:e["text/lake"])});return Object(r.useEffect)((function(){t().on("createNote",i)}),[]),o.a.createElement(o.a.Fragment,null)};function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ae=function(e){var t=e.doc,n=e.book,o=e.group,i=e.showHeaderMeta,a=e.initContents,c=e.onViewportLayoutChange,u=e.review,l=e.getTOCContainer,s=e.getWordingCommentPanelContainer,d=Object(r.useRef)(null),f=Object(r.useRef)(null),m=Object(r.useRef)(null),p=oe(Object(r.useState)(!1),2),h=p[0],b=p[1];return{state:{doc:t,book:n,group:o,showHeaderMeta:i,headerRef:d,contentRef:f,review:u,engineLoaded:h},initContents:a,getEditorMeta:function(e){return{skylark:{docID:e.id}}},initEngine:function(e){m.current=e,b(!0)},getEngine:function(){return m.current},onViewportLayoutChange:c,getTOCContainer:l,getWordingCommentPanelContainer:s}},ce=n(4528);function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ue.apply(this,arguments)}var le=Object(d.c)((function(){return n.e(1188).then(n.bind(null,3933))}),{suspense:!0}),se=Object(d.c)((function(){return Promise.all([n.e(0),n.e(8),n.e(14),n.e(19),n.e(1198)]).then(n.bind(null,5186))}),{suspense:!0}),de=Object(r.forwardRef)((function(e,t){var n,i=ae(e),a=i.state,c=a.doc,u=a.book,s=a.group,d=a.headerRef,f=a.contentRef,m=a.engineLoaded,p=Object(r.useRef)(null),h=u&&u.enable_comment;return Object(r.useEffect)((function(){return Object(U.a)(["#main",ce.a.content],!0)}),[c.content,c.content_html]),Object(r.useImperativeHandle)(t,(function(){var e;return{onPanelClose:null===(e=p.current)||void 0===e?void 0:e.onClose}})),c.loaded?(c.audits=c.audits||(null===(n=window.appData.doc)||void 0===n?void 0:n.audits),o.a.createElement("article",{id:"content",className:v()("article-content"),tabIndex:0,style:{outlineStyle:"none"}},o.a.createElement("div",{ref:f,className:"ne-doc-major-viewer"},"lake"===c.format&&o.a.createElement(o.a.Fragment,null,o.a.createElement(q.default,ue({},e,{key:"doc-".concat(c.id),id:"doc-".concat(c.id),content:c.content,genAnchor:!0,genOutline:!0,header:function(){return d.current},onReady:function(t){window.__engine=t,I.a.initScrollbarPosition({top:60}),window.location.hash||D.a.letReaderFocusToMemorizedPosition(c.id),i.initContents(t.getRenderDOMNode(),t.getViewerContext()),i.initEngine(t),se.start(),le.start(),e.onReady(t)},onViewportLayoutChange:i.onViewportLayoutChange,doc:c,book:u,group:s,scene:e.scene,headingFolding:e.headingFolding,tileRendering:!0,meta:i.getEditorMeta(c),theme:j.a.getTheme(c,u),getTOCContainer:i.getTOCContainer,imageLazyLoad:!0,optimizeGlobalViewerCopy:!0,viewResizeObserver:!0,enableTOC:!0,boundaryTopOffset:60,fallbackLake:!0,enableDynamicTaskList:!0,enableWording:h,enableComments:h})),h&&m&&o.a.createElement(l.a,{noMessage:!0},o.a.createElement(se,{ref:p,sidePanelManager:e.sidePanelManager,getContainer:i.getWordingCommentPanelContainer,getEngine:i.getEngine})),h&&m&&o.a.createElement(l.a,null,o.a.createElement(re,{getEngine:i.getEngine}))),"lake"!==c.format&&o.a.createElement(F,{html:c.content_html,format:c.format,key:"doc-".concat(c.id),id:"doc-".concat(c.id),onReady:function(e){i.initContents(e)}})),o.a.createElement(A.a,{className:v()("article-content-reward",ce.a.reward)},o.a.createElement(le,{type:"Doc",targetId:c.id,likeStatus:c.like.actioned,likeCount:c.like.count,size:"defaultWithBubble"})))):o.a.createElement("article",{id:"content"},o.a.createElement("div",{className:"typo"},o.a.createElement("div",{className:ce.a.loading},o.a.createElement(N.default,null))))}));de.defaultProps={initContents:function(){},onReady:function(){},scene:"other"},de.propTypes={showHeaderMeta:a.a.bool,doc:a.a.object.isRequired,book:a.a.object.isRequired,review:a.a.object,group:a.a.object,initContents:a.a.func,scene:a.a.oneOf(["doc","other"]),onViewportLayoutChange:a.a.func,getTOCContainer:a.a.func,getWordingCommentPanelContainer:a.a.func,headingFolding:a.a.bool,onReady:a.a.func,sidePanelManager:a.a.object};var fe=de,me=n(4156),pe={wrapper:"DocReader-module_wrapper_t3Z8X",header:"DocReader-module_header_xAOtU",comment:"DocReader-module_comment_eDglS",info:"DocReader-module_info_yXA4e",title:"DocReader-module_title_fXOQi",content:"DocReader-module_content_AcIMy",selectedBadge:"DocReader-module_selectedBadge_C3ECZ",meta:"DocReader-module_meta_gZvM4",tipWrap:"DocReader-module_tipWrap_j06P3",reward:"DocReader-module_reward_CmZHM"};function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},he.apply(this,arguments)}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ye=y.ua.macos,ge=Object(d.c)((function(){return Promise.all([n.e(0),n.e(8),n.e(14),n.e(19),n.e(1143)]).then(n.bind(null,4124))}),{suspense:!0}),we=Object(d.c)((function(){return Promise.all([n.e(0),n.e(1),n.e(32)]).then(n.bind(null,4757))}),{suspense:!0}),Oe=Object(d.c)((function(){return n.e(1144).then(n.bind(null,5223))}),{suspense:!0}),_e=Object(d.c)((function(){return n.e(1153).then(n.bind(null,5224))}),{suspense:!0}),Ee=Object(d.c)((function(){return n.e(26).then(n.bind(null,4017))}),{suspense:!0}),je=Object(d.c)((function(){return Promise.resolve().then(n.bind(null,3565))}),{suspense:!0}),Ce=Object(d.b)((function(){return n.e(1145).then(n.bind(null,5225))}),{suspense:!0}),ke=Object(d.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(4),n.e(5),n.e(80)]).then(n.bind(null,5226))}),{suspense:!0}),Se=function(e){var t=e.group,n=e.book,i=e.doc,a=e.isShare,c=e.shouldRenderComments,s=e.scene,f=e.headingFolding,m=e.editMode,p=Object(u.useHistory)(),b=Object(me.b)().sidePanelManager,y=Object(r.useMemo)((function(){return i.comment_collab?new T.a({collab:i.comment_collab}):null}),[i.id]),g=Object(d.e)(),_=be(Object(r.useState)((function(){return j.a.getTheme(i,n).viewport||E.a.VIEWPORT.fixed})),2),N=_[0],D=_[1],U=be(Object(r.useState)(null),2),A=U[0],I=U[1],q=be(Object(r.useState)(!1),2),B=q[0],F=q[1],V=be(Object(r.useState)(!1),2),W=V[0],H=V[1],z=Object(r.useRef)(null),G=Object(r.useRef)(null),Q=Object(r.useRef)(null),Y=Object(r.useRef)(null),J=Object(r.useRef)(null),Z=Object(r.useRef)(null),X=Object(r.useRef)(null),K=Object(r.useRef)(null),$=Object(r.useRef)();$.current=function(){return A};var ee=Object(r.useRef)();ee.current=function(){return N};var te=Object(r.useRef)();te.current=function(){return B};var ne=function(e,t){var n,r;if(!e||!t){var o,i=null===(o=X.current)||void 0===o?void 0:o.getBoundingClientRect();e=e||(null==i?void 0:i.width)||0,t=t||(null==i?void 0:i.left)||0}var a=document.documentElement,c=function(e,t){var n=0;!0===$.current()?n=O.d:!1===$.current()&&(n=O.c),te.current()&&(n=O.b);var r=n?"".concat(n,"px"):"auto";if(ee.current()===E.a.VIEWPORT.fixed){var o=window.innerWidth,i=(o-O.a)/2,a=Math.max(n,i);i>=M.a?r="calc((100vw - ".concat(O.a,"px) / 2)"):o>=M.c&&(e>=O.a+a?r="".concat(a,"px"):e>=O.a&&(r="".concat(Math.max(n,e-O.a),"px")))}var c=0,u="center";return t>n?(u="right",c=t-n):t<n&&(u="left",c=n-t),{viewerCenterAlignRight:r,sideDir:u,sideOffset:c}}(e,t),u=c.viewerCenterAlignRight,l=c.sideDir,s=c.sideOffset;a.style.setProperty("--viewer-center-align-right",u),a.style.setProperty("--viewer-center-align-value","auto"===u?"0px":u),a.style.setProperty("--viewer-center-table-placeholder-left-flex","left"===l?"1":"0"),a.style.setProperty("--viewer-center-left-max-offset","left"===l?"".concat(s,"px"):"0"),a.style.setProperty("--viewer-center-table-placeholder-right-flex","right"===l?"1":"0"),a.style.setProperty("--viewer-center-right-max-offset","right"===l?"".concat(s,"px"):"0"),null!==(n=Z.current)&&void 0!==n&&null!==(r=n.viewer)&&void 0!==r&&r.hasExtendMethod("wording_rerenderWording")&&setTimeout((function(){Z.current.viewer.wording_rerenderWording()}),100)},re=Object(r.useCallback)((function(e){var t=e.layout,n=e.isTOCOpened,r=e.isTOCPinned;D(t),I(n?!!r:null)}),[]);return Object(r.useEffect)((function(){var e=function(e){var t=e.detail,n=t.visible,r=t.type,o={review:function(){var e;return null===(e=Y.current)||void 0===e?void 0:e.onClose(!0)},wordingComment:function(){var e;return null===(e=J.current)||void 0===e?void 0:e.onPanelClose(!0)},moreFeature:function(){return b.hide("MoreFeature")}};if(n){var i=o[G.current];i&&r!==G.current&&i(),F(n),o[r]&&(G.current=r)}else G.current=null,F(n)};return window.addEventListener("contentSidebarVisibleChange",e),function(){window.removeEventListener("contentSidebarVisibleChange",e),null==y||y.reset()}}),[]),Object(r.useEffect)((function(){var e=function(e){var t=new CustomEvent("contentSidebarVisibleChange",{detail:{visible:e,type:"moreFeature"}});window.dispatchEvent(t)};b.subscribe((function(t){"MoreFeature"===t.currentPanel&&t.visible&&e(!0),t.visible||e(!1)}))}),[]),Object(r.useEffect)((function(){var e=null,t=function(){"hidden"===document.visibilityState&&(e=setTimeout((function(){null==y||y.reset(),clearTimeout(e)}),18e5)),"visible"===document.visibilityState&&clearTimeout(e)};return window.addEventListener("visibilitychange",t),function(){window.removeEventListener("visibilitychange",t),clearTimeout(e)}}),[y]),Object(r.useEffect)((function(){var e=new ResizeObserver(w()((function(e){var t=e[0];t&&ne(t.contentRect.width,t.contentRect.left)}),400));return e.observe(X.current),ne(),function(){e.disconnect()}}),[]),Object(r.useEffect)((function(){var e=b.subscribe((function(e){!1!==e.visible||null!==e.currentPanel||m||b.show("Outline",{zIndex:990,height:"auto"})}));return function(){e(),b.hide()}}),[m]),Object(r.useEffect)((function(){ne()}),[N,A,B]),Object(r.useEffect)((function(){ke.preload()}),[]),Object(r.useEffect)((function(){Object(L.a)(null==i?void 0:i.marked).then((function(e){H(e)}))}),[i.marked]),o.a.createElement(R.a.Provider,{value:y},o.a.createElement("div",{className:pe.wrapper,onClick:function(e){var t=e.target.closest("a"),n=ye?e.metaKey:e.ctrlKey;if(t&&t.href&&!n){var r=new URL(t.href,window.location.href),o=new URL(window.location.href),i=r.hash;if(r.hash="",o.hash="",i&&r.toString()===o.toString()){e.preventDefault();var a,c=i.slice(1);try{a=document.querySelector("[id='".concat(decodeURIComponent(c),"']"))}catch(e){console.log(e)}if(a){window.location.hash=i,a.scrollIntoView();var u=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;window.scrollTo(0,u-59)}}}},"data-doc-layout":N,"data-doc-toc":null===A?null:A,"data-doc-sidebar":B,ref:X},o.a.createElement("div",{className:v()(pe.main)},o.a.createElement("div",{id:"doc-reader-content",className:pe.content},m?null:o.a.createElement("div",{className:pe.header},o.a.createElement("div",null,o.a.createElement("div",{className:pe.title},o.a.createElement(C.c,{title:i.title,key:"title"}),!!i.selected_at&&new Date(i.selected_at)<new Date&&o.a.createElement("span",{className:pe.selectedBadge,"data-text":"语雀精选"})),e.showHeaderMeta&&o.a.createElement(Ce,{key:"doc-".concat(i.id,"-meta"),doc:i}))),m?o.a.createElement(ke,{history:p,editMode:m,sidePanelManager:b}):o.a.createElement("div",{ref:K},o.a.createElement(l.a,{withFallbackUI:!0},o.a.createElement(fe,he({ref:J},e,{sidePanelManager:b,doc:i,book:n,group:t,onReady:function(e){Z.current=e,Object(P.b)(i.id,i.type),ge.start(),we.start(),Oe.start(),_e.start(),Ee.start(),je.start(),g.priorityTaskManager.execMedium()},scene:s,headingFolding:f,getTOCContainer:function(){return z&&z.current},getWordingCommentPanelContainer:function(){return Q&&Q.current},showHeaderMeta:e.showHeaderMeta,initContents:e.initContents,onViewportLayoutChange:re,waterMarkContainerClassName:pe.content})))),!m&&o.a.createElement("div",{className:v()(pe.info)},o.a.createElement("div",{className:pe.meta},o.a.createElement(Oe,{doc:i,book:n,pageType:a?"share":"read"}),!a&&o.a.createElement(_e,{book:n,doc:i})))),o.a.createElement("div",{ref:z}),o.a.createElement("div",{ref:Q}),c&&!m&&o.a.createElement("div",{className:v()(pe.comment)},o.a.createElement(ge,{key:i.id,target:i,targetType:"Doc",book:n,group:t,isShare:a,getViewEngine:function(){return Z.current},onCreateComment:e.onCreateComment,onRemoveComment:e.onRemoveComment,withCornerBubble:!0})),!!W&&o.a.createElement(S.a,{btnWord:__("收藏"),style:{bottom:"194px"},onClick:function(){x.webProxy.mine.marks.create({target_type:"Doc",target_id:i.id}).then((function(){h.a.success(__("收藏成功"))}))}}),o.a.createElement(Ee,{style:c?{bottom:"32px"}:{bottom:"86px"}})),o.a.createElement(l.a,null,o.a.createElement(we,{ref:Y,sidePanelManager:b}),o.a.createElement(k.a,{domQuery:"[class^=CornerBubble-module_cornerBubble]",iconStyle:{position:"fixed",bottom:"180px",right:"0px",top:"unset"}})),i.loaded&&!m&&o.a.createElement(je,{center:!0,className:pe.footer})))};Se.propTypes={initContents:a.a.func,group:a.a.object.isRequired,book:a.a.object.isRequired,doc:a.a.object.isRequired,isShare:a.a.bool,showHeaderMeta:a.a.bool,shouldRenderPager:a.a.bool.isRequired,shouldRenderComments:a.a.bool.isRequired,onCreateComment:a.a.func,onRemoveComment:a.a.func,scene:a.a.oneOf(["doc","other"]),headingFolding:a.a.bool};var Re=o.a.memo(Se),Pe=n(3992),Te=n(4490),Me=n(849),Le=Object(d.b)((function(){return n.e(1150).then(n.bind(null,4449))}),{suspense:!0}),xe=Object(d.b)((function(){return Promise.all([n.e(0),n.e(1),n.e(7),n.e(16),n.e(66)]).then(n.bind(null,4448))}),{suspense:!0}),Ne=Object(d.b)((function(){return n.e(1154).then(n.bind(null,5218))}),{suspense:!0}),De=Object(d.b)((function(){return Promise.all([n.e(12),n.e(1149)]).then(n.bind(null,5219))}),{suspense:!0});function Ue(e){var t=e.className,n=void 0===t?"":t,i=e.doc,a=e.group,c=e.book,l=e.isShare,d=e.showHeaderMeta,h=e.review,b=e.shouldRenderPager,v=e.shouldRenderComments,y=e.headingFolding,g=Object(f.c)().editMode,w=Object(me.b)().sidePanelManager,O=Object(Me.b)(),_=Object(u.useParams)().doc;return Object(r.useEffect)((function(){setTimeout((function(){xe.preload(),De.preload()}),5e3)}),[]),Object(r.useEffect)((function(){var e=document.querySelector("Link[rel='shortcut icon']");e&&(e.href=function(e,t){var n=m.LOGO_FAVICON.public;if(e.isYuque){var r;n=t?m.EDIT_LOGO_FAVICON.public:(null===(r=e.organization)||void 0===r?void 0:r.logo)||m.LOGO_FAVICON.public}else{var o=t?m.EDIT_LOGO_FAVICON:m.LOGO_FAVICON,i=e.zone;n=o.alibaba,n=0===(null==i?void 0:i.id)?o.alibaba:o.antgroup}return n}(O,g))}),[O,g]),i.loaded||g||i.slug!==_?!i.loaded&&g?null:_?i.loaded&&i.slug!==_?null:i.error?o.a.createElement(Pe.a,{error:i.error}):["Doc","Sheet","Table","Mind","Board","Show"].includes(i.type)?o.a.createElement("div",{className:n},o.a.createElement(p.a,null),"Doc"===i.type&&o.a.createElement(Re,{key:"doc-content-".concat(i.id),editMode:g,group:a,book:c,doc:i,review:h,scene:"doc",isShare:l,showHeaderMeta:d,shouldRenderPager:b,shouldRenderComments:v,headingFolding:y,sidePanelManager:w,onCreateComment:function(){e.dispatch({type:"doc/addCommentCount"})},onRemoveComment:function(){e.dispatch({type:"doc/reduceCommentCount"})}}),"Sheet"===i.type&&o.a.createElement(De,{key:"doc-content-".concat(i.id),editMode:g,history:e.history,match:e.match,group:a,book:c,doc:i,isShare:l,shouldRenderComments:v}),"Table"===i.type&&o.a.createElement(Ne,{key:"doc-content-".concat(i.id),editMode:g,history:e.history,match:e.match,group:a,book:c,doc:i,isShare:l,shouldRenderComments:v}),("Mind"===i.type||"Board"===i.type)&&o.a.createElement(xe,{key:"doc-content-".concat(i.id),editMode:g,history:e.history,group:a,book:c,doc:i,isShare:l,dispatch:e.dispatch,shouldRenderComments:v}),"Show"===i.type&&o.a.createElement(Le,{editMode:g,group:a,book:c,doc:i,isShare:l,dispatch:e.dispatch,shouldRenderComments:v}),o.a.createElement(s.a,{mark:"finish-doc-render"})):o.a.createElement(o.a.Fragment,null,i.content):null:o.a.createElement(Te.a,null)}Ue.propTypes={className:a.a.string,group:a.a.object.isRequired,book:a.a.object.isRequired,doc:a.a.object.isRequired,review:a.a.object,layout:a.a.oneOf(["center","adapt"]),isShare:a.a.bool,asideWrapperWidth:a.a.number,showHeaderMeta:a.a.bool,shouldRenderPager:a.a.bool,shouldRenderComments:a.a.bool,history:a.a.object,match:a.a.object,dispatch:a.a.func,headingFolding:a.a.bool};t.a=Object(l.b)(Object(u.withRouter)(Object(c.d)((function(e){return{review:e.review}}))(Ue)),!0)},5169:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(8),a=n.n(i),c=n(429),u=n(67),l=n(905),s=n(3847),d=n(4397),f=n(11),m=n.n(f),p=n(120),h=n.n(p),b=n(1501),v=n(207),y=n(4594),g="BookReader-module_wrapper_s6Jdt",w="BookReader-module_editMode_AQq00",O="BookReader-module_docTypographyClassic_tUB5r",_="BookReader-module_content_BGKYX",E="BookReader-module_docContainer_mQ3Tk",j="BookReader-module_sheetContainer_WtnSp";function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,L(r.key),r)}}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var o=T(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}(this,n)}}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function M(e,t,n){return(t=L(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}function x(e){var t=Object(u.useParams)().doc,n=e.doc;return Object(r.useEffect)((function(){var e=h()((function(e){n.loaded&&n.slug!==t||3!==e.eventPhase&&b.a.saveReadPosition(n.id)}),300);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[n,t]),null}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(a,e);var t,n,r,i=R(a);function a(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return M(P(e=i.call.apply(i,[this].concat(n))),"handlePageScroll",h()((function(e){e.eventPhase}),300)),e}return t=a,(n=[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e,t=this.props,n=t.group,r=t.book,i=t.doc,a=t.history,c=t.isShare,u=t.shouldRenderPager,l=void 0===u||u,s=t.scene,d=t.editMode,f="classic"===v.a.getTheme(i,r).typography,p={Doc:E,Sheet:j,Mind:j,Show:j,Table:j};return o.a.createElement("div",{className:m()([g],(e={},M(e,O,f),M(e,w,d&&"Doc"===i.type),e)),"data-testid":"content"},o.a.createElement("div",{className:_,id:"main"},o.a.createElement(x,{doc:i,editMode:d}),o.a.createElement(y.a,{key:i.slug,className:p[i.type],doc:i,group:n,headingFolding:!0,book:r,isShare:c,history:a,scene:s,showHeaderMeta:this.props.showHeaderMeta,shouldRenderPager:l,shouldRenderComments:this.props.shouldRenderComments,dispatch:this.props.dispatch})))}}])&&k(t.prototype,n),r&&k(t,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(r.Component);N.propTypes={history:a.a.object.isRequired,group:a.a.object.isRequired,book:a.a.object.isRequired,doc:a.a.object.isRequired,editMode:a.a.bool,isShare:a.a.bool,showHeaderMeta:a.a.bool,shouldRenderPager:a.a.bool.isRequired,shouldRenderComments:a.a.bool.isRequired,scene:a.a.oneOf(["doc","other"]),dispatch:a.a.func};var D=N;function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},U.apply(this,arguments)}var A=Object(l.b)((function(){return n.e(1403).then(n.bind(null,4763))}),{suspense:!0}),I=function(e){var t=e.book,n=e.location,r=e.doc,i=e.match.params,a=window.appData.sharePage,c=a?"doc_slug":"doc",u=Object(s.c)().editMode,l=Object(d.a)({book:t,doc:r,query:n.query,slug:i[c],appData:window.appData,dispatch:e.dispatch});return l.isRenderSingleDoc()?o.a.createElement(A,U({editMode:u,shouldRenderComments:l.needRenderComments(),shouldRenderPager:l.needRenderPager(),isShare:a},e)):o.a.createElement(D,U({},e,{scene:"doc",editMode:u,shouldRenderComments:l.needRenderComments(),shouldRenderPager:l.needRenderPager(),isShare:a}))};I.propTypes={group:a.a.object.isRequired,book:a.a.object.isRequired,doc:a.a.object.isRequired,location:a.a.object,match:a.a.object,history:a.a.object,dispatch:a.a.func};t.default=Object(c.d)((function(e){return{group:e.group,book:e.book,doc:e.doc}}))(Object(u.withRouter)(I))}}]);