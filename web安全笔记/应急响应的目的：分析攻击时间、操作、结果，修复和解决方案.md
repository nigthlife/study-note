应急响应的目的：分析攻击时间、操作、结果，修复和解决方案



1. 失效的控制访问
2. 加密机制失效
3. 注入
4. 不安全设计
5. 安全配置失误
6. 自带缺陷的和过时组件
7. 身份识别和身份认证错误
8. 软件和数据完整性故障
9. 安全日志和监控故障
10. ssrf





**weblogic漏洞**：java反序列化、ssrf、xmldecoder反序列化（**CVE-2017**）、任意文件上传（**CVE-2018**）

- 存在后台，就可能存在弱口令漏洞、未授权访问

**sql注入**：

过滤不严谨，把数据当sql带入数据库中执行，

原因：参数可控，拼接sql

- 反馈结果分为：有回显和无回显
- 攻击手法分为：联合、堆叠、报错、盲注
- **防御：代码层防御和网络层防御**，预编译，PDO预处理、正则过滤
- 绕过姿势：大小写、双写、编码、内联
- 危害：获取数据库、操作数据库网页篡改，网页挂马，获取服务器权限、改数据库

**XSS**：跨站脚本攻击

- 原理：JavaScript恶意代码注入，当用户浏览网页时执行，从而实现攻击
- 分类：
  - 反射性：反弹shell
  - dom型：
  - 存储型：
- 绕过方式：大小写、引号、斜杠代替空格、编码、双写、制表符绕过
- 危害：窃取cookies、重定向，钓鱼、挂马，获取操作系统权限
- 防范：对用户输入进行过滤、设置httpOnly使用js无法读取cookie、使用模版引擎

**CSRF：跨站请求伪造**

- 原理：再进行敏感操作没有校验token或者referer值，从而导致利用普通用户完成攻击
- 漏洞类型：GET，POST
- 危害：盗用其他用户账号、获取个人隐私或者机密资料、联合其他漏洞组合拳
- 防范：验证码验证、token验证、验证referer、http头自定义属性验证

**SSRF：服务器端请求伪造**

- 原理：攻击访问服务器B，由于存在防火墙或内网主机无法直接访问，控制服务器A向服务器B发起请求，从而访问服务器B，达到攻击内网目的
- 漏洞常在的位置：分享、转码服务、在线翻译、图片加载下载、图片文章收藏、未公开api及其他
- 绕过：@绕过白名单、绕过限制白名单内网ip，短网址、双冒号、进制转换、特殊域名xip.io、句号
- 危害：内外网端口扫描、攻击内网服务器、dos攻击、攻击内网web、获取数据文件
- 防范：禁止跳转，过滤返回信息、统一错误信息、限制请求端口、禁止除http和https以外的协议

**XXE：XML外部实体注入**

- 原理：xml引用外部实体的时候构造恶意内容，到导致读文件，命令执行
- 构建xxe攻击：DTD外部实体声明、DTD引入外部DTD文档，再声明、DTD外部实体声明引入外部实体声明
- 危害：任意文件读取、系统命令执行、远程代码执行、内网端口探测、dos
- 防范：禁用外部实体引入、过滤铭感关键字

**文件上传**

- 绕过：js禁用绕过、修改后缀、抓包改mime、后缀名大小写、图片马、GIF头文件欺骗、%00（换行）截断，htaccess、user.ini、条件竞争、特殊后缀、后缀双写
- 危害：控制服务器、远程命令执行、木马、提权、修改web页面、内网渗透
- 防范：文件上传目录不可执行、严判文件类型、随机修改文件名和文件路径、内容检测、waf

**WAF**

- 概念：web应用防火墙
- 功能：内置很多安全规则，可防御sql注入、xss、网页篡改等等很多
- 不具备：过滤其他协议流量、不能地址映射、不能防ddos、不防病毒
- 绕过：通配符，大小写变种、内联注释/**/、干扰污染字符、字符编码、cookie绕过、云waf绕过寻找真实网站ip

渗透测试常用攻击

- 信息收集：nmap(信息收集)、fofa、shodan、zoomeye、站长工具、Bugscane(看bug的)、潮汐指纹、子域名挖掘机、whois、Layer子域名收集工具、whatweb（网站识别工具）、wappalyzer、

****

**使用过的安全设备（工具）**

**webshell查杀、**

- D盾

**病毒查杀、**

**安全防护、**

**应急响应、**



**常见中间件漏洞**

- 解析漏洞、目录遍历
- Jboss，反序列化
- 



**中间件漏洞**

- Apache：
  - 可以用多个点分割后缀，从右向左依次碰到到合法后缀才进行解析（可绕黑名单过滤）
  - 目录遍历



ssrf：内网访问，提供功能的网站

csrf：身份伪造



**绕过围绕**

- 大小写、单双引号、正反斜杠、空格、编码、双写、点、通配符、干扰字符、拼凑

**防御围绕**

- 正则、黑名单、白名单、流量过滤、代码层过滤





**保护阶段**：保护现场，尝试恢复

**分析阶段**：入侵过程的分析、指纹库搜索、日志分析、后门追查、漏洞检测、进程检测、计划任务

- 过程分析：攻击是从哪里打进来的，然后再哪里入侵成功
- 查看日志文件是否存在相对于的指纹以便识别攻击的攻击工具
  - fireseek、logfusion都是window日志分析工具
  - 360星图日志分析工具，只不过只能分析iis、apache、nginx的日志文件
  - 还可以使用logontracer平台工具自动分析，将相对于的流量、ip、等等归类汇总
  - 还可以根据是否存在相对于的工具指纹，这有助于后面复现和修复
- 使用杀毒工具扫描是否存在后门文件
- 再使用自动化漏洞检测工具进行扫描
- 使用gscan工具对服务器进行全盘扫描，看是否存在可疑进程，可疑端口，可疑计划任务
- window还需要注意是否存在隐藏用户

**复现阶段**：还远攻击过程、模拟攻击思路、关注应用的漏洞、攻击手法

**修复阶段**：分析原因后，修补相关系统、应用漏洞，清除和整改弱口令，

建议阶段





- 漏洞类型：sql注入、模版注入、XSS、XXE、CSRF、SSRF、弱口令、数据泄露、文件包含、文件上传、权限提升、反序列化，DOM、暴力破解、RCE、越权、逻辑漏洞

- 渗透信息收集：系统版本及类型、中间件信息、ip地址范围、开放的端口、域名子域名、代理

- 入侵后信息收集：日志、进程、网络连接、系统配置、服务、
  - Windows：
    - 系统事件日志：C:\Windows\System32\winevt\Logs
    - 安全日志：C:\Windows\System32\winevt\Secu rity.evtx
  - Linux日志位置：
    - 用户相关日志：/etc
    - 登录及各种服务器日志：/var/log

- 日志分类：用户登录日志、授权日志、系统运行日志、服务器日志

- 分析的关注点：账户、端口、进程、网络、启动项、计划任务、服务、文件、日志 

- 加固措施：过滤、身份验证、防火墙、禁用不要的服、禁用最高权限账号、备份、更新系统、软件包

  

- 文件分析关注点：最近使用文件、系统日志、定时任务、计划任务、用户列表、开机启动项、临时目录、服务器日志

- 

- 

- 真实ip、系统类型、版本、端口开放情况、waf

- cms、cnd、证书、dns记录

- whois信息、姓名、旁站、c段，社工、邮件、子域名、备案

- 中间件版本、弱口令、目录结构、爆后台、、网站bananer、测试文件、备份文件、协议、通用漏洞、源码

- 

- 浏览网站、规模、功能点、特点、端口、弱口令、目录扫描、端口探测、mysql、ftp、ssh、

- xxs、xxe、ssrf、csrf、sql注入、代码执行、越权、任意文件下载、远程命令执行、弱口令、编辑器啊、暴力破解、、漏扫

- 

  
